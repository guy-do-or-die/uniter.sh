(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))w(y);new MutationObserver(y=>{for(const B of y)if(B.type==="childList")for(const x of B.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&w(x)}).observe(document,{childList:!0,subtree:!0});function u(y){const B={};return y.integrity&&(B.integrity=y.integrity),y.referrerPolicy&&(B.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?B.credentials="include":y.crossOrigin==="anonymous"?B.credentials="omit":B.credentials="same-origin",B}function w(y){if(y.ep)return;y.ep=!0;const B=u(y);fetch(y.href,B)}})();function At(t,{strict:s=!0}={}){return!t||typeof t!="string"?!1:s?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function qe(t){return At(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const fs="2.33.1";let ni={getDocsUrl:({docsBaseUrl:t,docsPath:s="",docsSlug:u})=>s?`${t??"https://viem.sh"}${s}${u?`#${u}`:""}`:void 0,version:`viem@${fs}`},Z=class mi extends Error{constructor(s,u={}){const w=u.cause instanceof mi?u.cause.details:u.cause?.message?u.cause.message:u.details,y=u.cause instanceof mi&&u.cause.docsPath||u.docsPath,B=ni.getDocsUrl?.({...u,docsPath:y}),x=[s||"An error occurred.","",...u.metaMessages?[...u.metaMessages,""]:[],...B?[`Docs: ${B}`]:[],...w?[`Details: ${w}`]:[],...ni.version?[`Version: ${ni.version}`]:[]].join(`
`);super(x,u.cause?{cause:u.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=w,this.docsPath=y,this.metaMessages=u.metaMessages,this.name=u.name??this.name,this.shortMessage=s,this.version=fs}walk(s){return _s(this,s)}};function _s(t,s){return s?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?_s(t.cause,s):s?null:t}class _r extends Z{constructor({offset:s,position:u,size:w}){super(`Slice ${u==="start"?"starting":"ending"} at offset "${s}" is out-of-bounds (size: ${w}).`,{name:"SliceOffsetOutOfBoundsError"})}}class ps extends Z{constructor({size:s,targetSize:u,type:w}){super(`${w.charAt(0).toUpperCase()}${w.slice(1).toLowerCase()} size (${s}) exceeds padding size (${u}).`,{name:"SizeExceedsPaddingSizeError"})}}function ze(t,{dir:s,size:u=32}={}){return typeof t=="string"?pr(t,{dir:s,size:u}):mr(t,{dir:s,size:u})}function pr(t,{dir:s,size:u=32}={}){if(u===null)return t;const w=t.replace("0x","");if(w.length>u*2)throw new ps({size:Math.ceil(w.length/2),targetSize:u,type:"hex"});return`0x${w[s==="right"?"padEnd":"padStart"](u*2,"0")}`}function mr(t,{dir:s,size:u=32}={}){if(u===null)return t;if(t.length>u)throw new ps({size:t.length,targetSize:u,type:"bytes"});const w=new Uint8Array(u);for(let y=0;y<u;y++){const B=s==="right";w[B?y:u-y-1]=t[B?y:t.length-y-1]}return w}class gr extends Z{constructor({max:s,min:u,signed:w,size:y,value:B}){super(`Number "${B}" is not in safe ${y?`${y*8}-bit ${w?"signed":"unsigned"} `:""}integer range ${s?`(${u} to ${s})`:`(above ${u})`}`,{name:"IntegerOutOfRangeError"})}}class vr extends Z{constructor({givenSize:s,maxSize:u}){super(`Size cannot exceed ${u} bytes. Given size: ${s} bytes.`,{name:"SizeOverflowError"})}}function qt(t,{dir:s="left"}={}){let u=typeof t=="string"?t.replace("0x",""):t,w=0;for(let y=0;y<u.length-1&&u[s==="left"?y:u.length-y-1].toString()==="0";y++)w++;return u=s==="left"?u.slice(w):u.slice(0,u.length-w),typeof t=="string"?(u.length===1&&s==="right"&&(u=`${u}0`),`0x${u.length%2===1?`0${u}`:u}`):u}function Ze(t,{size:s}){if(qe(t)>s)throw new vr({givenSize:qe(t),maxSize:s})}function fe(t,s={}){const{signed:u}=s;s.size&&Ze(t,{size:s.size});const w=BigInt(t);if(!u)return w;const y=(t.length-2)/2,B=(1n<<BigInt(y)*8n-1n)-1n;return w<=B?w:w-BigInt(`0x${"f".padStart(y*2,"f")}`)-1n}function ot(t,s={}){return Number(fe(t,s))}const br=Array.from({length:256},(t,s)=>s.toString(16).padStart(2,"0"));function ue(t,s={}){return typeof t=="number"||typeof t=="bigint"?J(t,s):typeof t=="string"?ms(t,s):typeof t=="boolean"?Cr(t,s):ke(t,s)}function Cr(t,s={}){const u=`0x${Number(t)}`;return typeof s.size=="number"?(Ze(u,{size:s.size}),ze(u,{size:s.size})):u}function ke(t,s={}){let u="";for(let y=0;y<t.length;y++)u+=br[t[y]];const w=`0x${u}`;return typeof s.size=="number"?(Ze(w,{size:s.size}),ze(w,{dir:"right",size:s.size})):w}function J(t,s={}){const{signed:u,size:w}=s,y=BigInt(t);let B;w?u?B=(1n<<BigInt(w)*8n-1n)-1n:B=2n**(BigInt(w)*8n)-1n:typeof t=="number"&&(B=BigInt(Number.MAX_SAFE_INTEGER));const x=typeof B=="bigint"&&u?-B-1n:0;if(B&&y>B||y<x){const a=typeof t=="bigint"?"n":"";throw new gr({max:B?`${B}${a}`:void 0,min:`${x}${a}`,signed:u,size:w,value:`${t}${a}`})}const e=`0x${(u&&y<0?(1n<<BigInt(w*8))+BigInt(y):y).toString(16)}`;return w?ze(e,{size:w}):e}const Sr=new TextEncoder;function ms(t,s={}){const u=Sr.encode(t);return ke(u,s)}const wr=new TextEncoder;function rt(t,s={}){return typeof t=="number"||typeof t=="bigint"?xr(t,s):typeof t=="boolean"?yr(t,s):At(t)?xe(t,s):gs(t,s)}function yr(t,s={}){const u=new Uint8Array(1);return u[0]=Number(t),typeof s.size=="number"?(Ze(u,{size:s.size}),ze(u,{size:s.size})):u}const Ee={zero:48,nine:57,A:65,F:70,a:97,f:102};function ji(t){if(t>=Ee.zero&&t<=Ee.nine)return t-Ee.zero;if(t>=Ee.A&&t<=Ee.F)return t-(Ee.A-10);if(t>=Ee.a&&t<=Ee.f)return t-(Ee.a-10)}function xe(t,s={}){let u=t;s.size&&(Ze(u,{size:s.size}),u=ze(u,{dir:"right",size:s.size}));let w=u.slice(2);w.length%2&&(w=`0${w}`);const y=w.length/2,B=new Uint8Array(y);for(let x=0,e=0;x<y;x++){const a=ji(w.charCodeAt(e++)),h=ji(w.charCodeAt(e++));if(a===void 0||h===void 0)throw new Z(`Invalid byte sequence ("${w[e-2]}${w[e-1]}" in "${w}").`);B[x]=a*16+h}return B}function xr(t,s){const u=J(t,s);return xe(u)}function gs(t,s={}){const u=wr.encode(t);return typeof s.size=="number"?(Ze(u,{size:s.size}),ze(u,{dir:"right",size:s.size})):u}const Ot=BigInt(2**32-1),Gi=BigInt(32);function Br(t,s=!1){return s?{h:Number(t&Ot),l:Number(t>>Gi&Ot)}:{h:Number(t>>Gi&Ot)|0,l:Number(t&Ot)|0}}function Er(t,s=!1){const u=t.length;let w=new Uint32Array(u),y=new Uint32Array(u);for(let B=0;B<u;B++){const{h:x,l:e}=Br(t[B],s);[w[B],y[B]]=[x,e]}return[w,y]}const Lr=(t,s,u)=>t<<u|s>>>32-u,kr=(t,s,u)=>s<<u|t>>>32-u,Ar=(t,s,u)=>s<<u-32|t>>>64-u,Mr=(t,s,u)=>t<<u-32|s>>>64-u;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Dr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function qi(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function at(t,...s){if(!Dr(t))throw new Error("Uint8Array expected");if(s.length>0&&!s.includes(t.length))throw new Error("Uint8Array expected of length "+s+", got length="+t.length)}function Vt(t,s=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(s&&t.finished)throw new Error("Hash#digest() has already been called")}function vs(t,s){at(t);const u=s.outputLen;if(t.length<u)throw new Error("digestInto() expects output buffer of length at least "+u)}function Rr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ct(...t){for(let s=0;s<t.length;s++)t[s].fill(0)}function oi(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ye(t,s){return t<<32-s|t>>>s}const Tr=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Pr(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Ir(t){for(let s=0;s<t.length;s++)t[s]=Pr(t[s]);return t}const Vi=Tr?t=>t:Ir;function Or(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Mi(t){return typeof t=="string"&&(t=Or(t)),at(t),t}class bs{}function Cs(t){const s=w=>t().update(Mi(w)).digest(),u=t();return s.outputLen=u.outputLen,s.blockLen=u.blockLen,s.create=()=>t(),s}const $r=BigInt(0),tt=BigInt(1),Fr=BigInt(2),Hr=BigInt(7),Ur=BigInt(256),Wr=BigInt(113),Ss=[],ws=[],ys=[];for(let t=0,s=tt,u=1,w=0;t<24;t++){[u,w]=[w,(2*u+3*w)%5],Ss.push(2*(5*w+u)),ws.push((t+1)*(t+2)/2%64);let y=$r;for(let B=0;B<7;B++)s=(s<<tt^(s>>Hr)*Wr)%Ur,s&Fr&&(y^=tt<<(tt<<BigInt(B))-tt);ys.push(y)}const xs=Er(ys,!0),Nr=xs[0],zr=xs[1],Ki=(t,s,u)=>u>32?Ar(t,s,u):Lr(t,s,u),Xi=(t,s,u)=>u>32?Mr(t,s,u):kr(t,s,u);function jr(t,s=24){const u=new Uint32Array(10);for(let w=24-s;w<24;w++){for(let x=0;x<10;x++)u[x]=t[x]^t[x+10]^t[x+20]^t[x+30]^t[x+40];for(let x=0;x<10;x+=2){const e=(x+8)%10,a=(x+2)%10,h=u[a],f=u[a+1],o=Ki(h,f,1)^u[e],d=Xi(h,f,1)^u[e+1];for(let m=0;m<50;m+=10)t[x+m]^=o,t[x+m+1]^=d}let y=t[2],B=t[3];for(let x=0;x<24;x++){const e=ws[x],a=Ki(y,B,e),h=Xi(y,B,e),f=Ss[x];y=t[f],B=t[f+1],t[f]=a,t[f+1]=h}for(let x=0;x<50;x+=10){for(let e=0;e<10;e++)u[e]=t[x+e];for(let e=0;e<10;e++)t[x+e]^=~u[(e+2)%10]&u[(e+4)%10]}t[0]^=Nr[w],t[1]^=zr[w]}ct(u)}class Di extends bs{constructor(s,u,w,y=!1,B=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=s,this.suffix=u,this.outputLen=w,this.enableXOF=y,this.rounds=B,qi(w),!(0<s&&s<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Rr(this.state)}clone(){return this._cloneInto()}keccak(){Vi(this.state32),jr(this.state32,this.rounds),Vi(this.state32),this.posOut=0,this.pos=0}update(s){Vt(this),s=Mi(s),at(s);const{blockLen:u,state:w}=this,y=s.length;for(let B=0;B<y;){const x=Math.min(u-this.pos,y-B);for(let e=0;e<x;e++)w[this.pos++]^=s[B++];this.pos===u&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:s,suffix:u,pos:w,blockLen:y}=this;s[w]^=u,(u&128)!==0&&w===y-1&&this.keccak(),s[y-1]^=128,this.keccak()}writeInto(s){Vt(this,!1),at(s),this.finish();const u=this.state,{blockLen:w}=this;for(let y=0,B=s.length;y<B;){this.posOut>=w&&this.keccak();const x=Math.min(w-this.posOut,B-y);s.set(u.subarray(this.posOut,this.posOut+x),y),this.posOut+=x,y+=x}return s}xofInto(s){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(s)}xof(s){return qi(s),this.xofInto(new Uint8Array(s))}digestInto(s){if(vs(s,this),this.finished)throw new Error("digest() was already called");return this.writeInto(s),this.destroy(),s}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,ct(this.state)}_cloneInto(s){const{blockLen:u,suffix:w,outputLen:y,rounds:B,enableXOF:x}=this;return s||(s=new Di(u,w,y,x,B)),s.state32.set(this.state32),s.pos=this.pos,s.posOut=this.posOut,s.finished=this.finished,s.rounds=B,s.suffix=w,s.outputLen=y,s.enableXOF=x,s.destroyed=this.destroyed,s}}const Gr=(t,s,u)=>Cs(()=>new Di(s,t,u)),qr=Gr(1,136,256/8);function Vr(t,s){return qr(At(t,{strict:!1})?rt(t):t)}class ge extends Z{constructor({address:s}){super(`Address "${s}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}class Ri extends Map{constructor(s){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=s}get(s){const u=super.get(s);return super.has(s)&&u!==void 0&&(this.delete(s),super.set(s,u)),u}set(s,u){if(super.set(s,u),this.maxSize&&this.size>this.maxSize){const w=this.keys().next().value;w&&this.delete(w)}return this}}const ai=new Ri(8192);function Bs(t,s){if(ai.has(`${t}.${s}`))return ai.get(`${t}.${s}`);const u=t.substring(2).toLowerCase(),w=Vr(gs(u)),y=u.split("");for(let x=0;x<40;x+=2)w[x>>1]>>4>=8&&y[x]&&(y[x]=y[x].toUpperCase()),(w[x>>1]&15)>=8&&y[x+1]&&(y[x+1]=y[x+1].toUpperCase());const B=`0x${y.join("")}`;return ai.set(`${t}.${s}`,B),B}function Oe(t,s){if(!ve(t,{strict:!1}))throw new ge({address:t});return Bs(t,s)}const Kr=/^0x[a-fA-F0-9]{40}$/,ci=new Ri(8192);function ve(t,s){const{strict:u=!0}=s??{},w=`${t}.${u}`;if(ci.has(w))return ci.get(w);const y=Kr.test(t)?t.toLowerCase()===t?!0:u?Bs(t)===t:!0:!1;return ci.set(w,y),y}function Qe(t){return`0x${t.reduce((s,u)=>s+u.replace("0x",""),"")}`}function Xr(t,s,u,{strict:w}={}){return At(t,{strict:!1})?Yr(t,s,u,{strict:w}):Jr(t,s,u,{strict:w})}function Es(t,s,u){if(qe(t)!==u-s)throw new _r({offset:u,position:"end",size:qe(t)})}function Jr(t,s,u,{strict:w}={}){const y=t.slice(s,u);return w&&Es(y,s,u),y}function Yr(t,s,u,{strict:w}={}){const y=`0x${t.replace("0x","").slice(s*2,u*2)}`;return w&&Es(y,s,u),y}function Yt(t){return typeof t=="string"?{address:t,type:"json-rpc"}:t}class Ji extends Z{constructor({offset:s}){super(`Offset \`${s}\` cannot be negative.`,{name:"NegativeOffsetError"})}}class Zr extends Z{constructor({length:s,position:u}){super(`Position \`${u}\` is out of bounds (\`0 < position < ${s}\`).`,{name:"PositionOutOfBoundsError"})}}class Qr extends Z{constructor({count:s,limit:u}){super(`Recursive read limit of \`${u}\` exceeded (recursive read count: \`${s}\`).`,{name:"RecursiveReadLimitExceededError"})}}const en={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new Qr({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(t){if(t<0||t>this.bytes.length-1)throw new Zr({length:this.bytes.length,position:t})},decrementPosition(t){if(t<0)throw new Ji({offset:t});const s=this.position-t;this.assertPosition(s),this.position=s},getReadCount(t){return this.positionReadCount.get(t||this.position)||0},incrementPosition(t){if(t<0)throw new Ji({offset:t});const s=this.position+t;this.assertPosition(s),this.position=s},inspectByte(t){const s=t??this.position;return this.assertPosition(s),this.bytes[s]},inspectBytes(t,s){const u=s??this.position;return this.assertPosition(u+t-1),this.bytes.subarray(u,u+t)},inspectUint8(t){const s=t??this.position;return this.assertPosition(s),this.bytes[s]},inspectUint16(t){const s=t??this.position;return this.assertPosition(s+1),this.dataView.getUint16(s)},inspectUint24(t){const s=t??this.position;return this.assertPosition(s+2),(this.dataView.getUint16(s)<<8)+this.dataView.getUint8(s+2)},inspectUint32(t){const s=t??this.position;return this.assertPosition(s+3),this.dataView.getUint32(s)},pushByte(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushBytes(t){this.assertPosition(this.position+t.length-1),this.bytes.set(t,this.position),this.position+=t.length},pushUint8(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushUint16(t){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,t),this.position+=2},pushUint24(t){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,t>>8),this.dataView.setUint8(this.position+2,t&255),this.position+=3},pushUint32(t){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,t),this.position+=4},readByte(){this.assertReadLimit(),this._touch();const t=this.inspectByte();return this.position++,t},readBytes(t,s){this.assertReadLimit(),this._touch();const u=this.inspectBytes(t);return this.position+=s??t,u},readUint8(){this.assertReadLimit(),this._touch();const t=this.inspectUint8();return this.position+=1,t},readUint16(){this.assertReadLimit(),this._touch();const t=this.inspectUint16();return this.position+=2,t},readUint24(){this.assertReadLimit(),this._touch();const t=this.inspectUint24();return this.position+=3,t},readUint32(){this.assertReadLimit(),this._touch();const t=this.inspectUint32();return this.position+=4,t},get remaining(){return this.bytes.length-this.position},setPosition(t){const s=this.position;return this.assertPosition(t),this.position=t,()=>this.position=s},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;const t=this.getReadCount();this.positionReadCount.set(this.position,t+1),t>0&&this.recursiveReadCount++}};function Ls(t,{recursiveReadLimit:s=8192}={}){const u=Object.create(en);return u.bytes=t,u.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),u.positionReadCount=new Map,u.recursiveReadLimit=s,u}const He=(t,s,u)=>JSON.stringify(t,(w,y)=>typeof y=="bigint"?y.toString():y,u),tn={gwei:9,wei:18},sn={ether:-9,wei:9};function Ue(t,s){let u=t.toString();const w=u.startsWith("-");w&&(u=u.slice(1)),u=u.padStart(s,"0");let[y,B]=[u.slice(0,u.length-s),u.slice(u.length-s)];return B=B.replace(/(0+)$/,""),`${w?"-":""}${y||"0"}${B?`.${B}`:""}`}function rn(t,s="wei"){return Ue(t,tn[s])}function We(t,s="wei"){return Ue(t,sn[s])}function Yi(t){return t.reduce((s,{slot:u,value:w})=>`${s}        ${u}: ${w}
`,"")}function nn(t){return t.reduce((s,{address:u,...w})=>{let y=`${s}    ${u}:
`;return w.nonce&&(y+=`      nonce: ${w.nonce}
`),w.balance&&(y+=`      balance: ${w.balance}
`),w.code&&(y+=`      code: ${w.code}
`),w.state&&(y+=`      state:
`,y+=Yi(w.state)),w.stateDiff&&(y+=`      stateDiff:
`,y+=Yi(w.stateDiff)),y},`  State Override:
`).slice(0,-1)}function ks(t){const s=Object.entries(t).map(([w,y])=>y===void 0||y===!1?null:[w,y]).filter(Boolean),u=s.reduce((w,[y])=>Math.max(w,y.length),0);return s.map(([w,y])=>`  ${`${w}:`.padEnd(u+1)}  ${y}`).join(`
`)}class on extends Z{constructor(){super(["Cannot specify both a `gasPrice` and a `maxFeePerGas`/`maxPriorityFeePerGas`.","Use `maxFeePerGas`/`maxPriorityFeePerGas` for EIP-1559 compatible networks, and `gasPrice` for others."].join(`
`),{name:"FeeConflictError"})}}class an extends Z{constructor({v:s}){super(`Invalid \`v\` value "${s}". Expected 27 or 28.`,{name:"InvalidLegacyVError"})}}class cn extends Z{constructor({transaction:s}){super("Cannot infer a transaction type from provided transaction.",{metaMessages:["Provided Transaction:","{",ks(s),"}","","To infer the type, either provide:","- a `type` to the Transaction, or","- an EIP-1559 Transaction with `maxFeePerGas`, or","- an EIP-2930 Transaction with `gasPrice` & `accessList`, or","- an EIP-4844 Transaction with `blobs`, `blobVersionedHashes`, `sidecars`, or","- an EIP-7702 Transaction with `authorizationList`, or","- a Legacy Transaction with `gasPrice`"],name:"InvalidSerializableTransactionError"})}}class hn extends Z{constructor({storageKey:s}){super(`Size for storage key "${s}" is invalid. Expected 32 bytes. Got ${Math.floor((s.length-2)/2)} bytes.`,{name:"InvalidStorageKeySizeError"})}}const Ti=t=>t;class ln extends Z{constructor(s,{account:u,docsPath:w,chain:y,data:B,gas:x,gasPrice:e,maxFeePerGas:a,maxPriorityFeePerGas:h,nonce:f,to:o,value:d,stateOverride:m}){const b=u?Yt(u):void 0;let l=ks({from:b?.address,to:o,value:typeof d<"u"&&`${rn(d)} ${y?.nativeCurrency?.symbol||"ETH"}`,data:B,gas:x,gasPrice:typeof e<"u"&&`${We(e)} gwei`,maxFeePerGas:typeof a<"u"&&`${We(a)} gwei`,maxPriorityFeePerGas:typeof h<"u"&&`${We(h)} gwei`,nonce:f});m&&(l+=`
${nn(m)}`),super(s.shortMessage,{cause:s,docsPath:w,metaMessages:[...s.metaMessages?[...s.metaMessages," "]:[],"Raw Call Arguments:",l].filter(Boolean),name:"CallExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=s}}class nt extends Z{constructor({body:s,cause:u,details:w,headers:y,status:B,url:x}){super("HTTP request failed.",{cause:u,details:w,metaMessages:[B&&`Status: ${B}`,`URL: ${Ti(x)}`,s&&`Request body: ${He(s)}`].filter(Boolean),name:"HttpRequestError"}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.body=s,this.headers=y,this.status=B,this.url=x}}class As extends Z{constructor({body:s,error:u,url:w}){super("RPC Request failed.",{cause:u,details:u.message,metaMessages:[`URL: ${Ti(w)}`,`Request body: ${He(s)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=u.code,this.data=u.data}}class Zi extends Z{constructor({body:s,url:u}){super("The request took too long to respond.",{details:"The request timed out.",metaMessages:[`URL: ${Ti(u)}`,`Request body: ${He(s)}`],name:"TimeoutError"})}}const dn=-1;class me extends Z{constructor(s,{code:u,docsPath:w,metaMessages:y,name:B,shortMessage:x}){super(x,{cause:s,docsPath:w,metaMessages:y||s?.metaMessages,name:B||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=B||s.name,this.code=s instanceof As?s.code:u??dn}}class be extends me{constructor(s,u){super(s,u),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=u.data}}class ht extends me{constructor(s){super(s,{code:ht.code,name:"ParseRpcError",shortMessage:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."})}}Object.defineProperty(ht,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});class lt extends me{constructor(s){super(s,{code:lt.code,name:"InvalidRequestRpcError",shortMessage:"JSON is not a valid request object."})}}Object.defineProperty(lt,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});class dt extends me{constructor(s,{method:u}={}){super(s,{code:dt.code,name:"MethodNotFoundRpcError",shortMessage:`The method${u?` "${u}"`:""} does not exist / is not available.`})}}Object.defineProperty(dt,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});class ut extends me{constructor(s){super(s,{code:ut.code,name:"InvalidParamsRpcError",shortMessage:["Invalid parameters were provided to the RPC method.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(ut,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class Ve extends me{constructor(s){super(s,{code:Ve.code,name:"InternalRpcError",shortMessage:"An internal error was received."})}}Object.defineProperty(Ve,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});class ft extends me{constructor(s){super(s,{code:ft.code,name:"InvalidInputRpcError",shortMessage:["Missing or invalid parameters.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(ft,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});class _t extends me{constructor(s){super(s,{code:_t.code,name:"ResourceNotFoundRpcError",shortMessage:"Requested resource not found."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceNotFoundRpcError"})}}Object.defineProperty(_t,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});class Re extends me{constructor(s){super(s,{code:Re.code,name:"ResourceUnavailableRpcError",shortMessage:"Requested resource not available."})}}Object.defineProperty(Re,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});class pt extends me{constructor(s){super(s,{code:pt.code,name:"TransactionRejectedRpcError",shortMessage:"Transaction creation failed."})}}Object.defineProperty(pt,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});class $e extends me{constructor(s,{method:u}={}){super(s,{code:$e.code,name:"MethodNotSupportedRpcError",shortMessage:`Method${u?` "${u}"`:""} is not supported.`})}}Object.defineProperty($e,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});class Ke extends me{constructor(s){super(s,{code:Ke.code,name:"LimitExceededRpcError",shortMessage:"Request exceeds defined limit."})}}Object.defineProperty(Ke,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});class mt extends me{constructor(s){super(s,{code:mt.code,name:"JsonRpcVersionUnsupportedError",shortMessage:"Version of JSON-RPC protocol is not supported."})}}Object.defineProperty(mt,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});class _e extends be{constructor(s){super(s,{code:_e.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(_e,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class gt extends be{constructor(s){super(s,{code:gt.code,name:"UnauthorizedProviderError",shortMessage:"The requested method and/or account has not been authorized by the user."})}}Object.defineProperty(gt,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});class vt extends be{constructor(s,{method:u}={}){super(s,{code:vt.code,name:"UnsupportedProviderMethodError",shortMessage:`The Provider does not support the requested method${u?` " ${u}"`:""}.`})}}Object.defineProperty(vt,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});class bt extends be{constructor(s){super(s,{code:bt.code,name:"ProviderDisconnectedError",shortMessage:"The Provider is disconnected from all chains."})}}Object.defineProperty(bt,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});class Ct extends be{constructor(s){super(s,{code:Ct.code,name:"ChainDisconnectedError",shortMessage:"The Provider is not connected to the requested chain."})}}Object.defineProperty(Ct,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});class Pe extends be{constructor(s){super(s,{code:Pe.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(Pe,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});class St extends be{constructor(s){super(s,{code:St.code,name:"UnsupportedNonOptionalCapabilityError",shortMessage:"This Wallet does not support a capability that was not marked as optional."})}}Object.defineProperty(St,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700});class wt extends be{constructor(s){super(s,{code:wt.code,name:"UnsupportedChainIdError",shortMessage:"This Wallet does not support the requested chain ID."})}}Object.defineProperty(wt,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710});class yt extends be{constructor(s){super(s,{code:yt.code,name:"DuplicateIdError",shortMessage:"There is already a bundle submitted with this ID."})}}Object.defineProperty(yt,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720});class xt extends be{constructor(s){super(s,{code:xt.code,name:"UnknownBundleIdError",shortMessage:"This bundle id is unknown / has not been submitted"})}}Object.defineProperty(xt,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730});class Bt extends be{constructor(s){super(s,{code:Bt.code,name:"BundleTooLargeError",shortMessage:"The call bundle is too large for the Wallet to process."})}}Object.defineProperty(Bt,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740});class Et extends be{constructor(s){super(s,{code:Et.code,name:"AtomicReadyWalletRejectedUpgradeError",shortMessage:"The Wallet can support atomicity after an upgrade, but the user rejected the upgrade."})}}Object.defineProperty(Et,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750});class Lt extends be{constructor(s){super(s,{code:Lt.code,name:"AtomicityNotSupportedError",shortMessage:"The wallet does not support atomic execution but the request requires it."})}}Object.defineProperty(Lt,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760});class un extends me{constructor(s){super(s,{name:"UnknownRpcError",shortMessage:"An unknown RPC error occurred."})}}const fn="modulepreload",_n=function(t){return"/"+t},Qi={},pn=function(s,u,w){let y=Promise.resolve();if(u&&u.length>0){let a=function(h){return Promise.all(h.map(f=>Promise.resolve(f).then(o=>({status:"fulfilled",value:o}),o=>({status:"rejected",reason:o}))))};document.getElementsByTagName("link");const x=document.querySelector("meta[property=csp-nonce]"),e=x?.nonce||x?.getAttribute("nonce");y=a(u.map(h=>{if(h=_n(h),h in Qi)return;Qi[h]=!0;const f=h.endsWith(".css"),o=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${o}`))return;const d=document.createElement("link");if(d.rel=f?"stylesheet":fn,f||(d.as="script"),d.crossOrigin="",d.href=h,e&&d.setAttribute("nonce",e),document.head.appendChild(d),f)return new Promise((m,b)=>{d.addEventListener("load",m),d.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${h}`)))})}))}function B(x){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=x,window.dispatchEvent(e),!e.defaultPrevented)throw x}return y.then(x=>{for(const e of x||[])e.status==="rejected"&&B(e.reason);return s().catch(B)})};function Ie(t,s="hex"){const u=Ms(t),w=Ls(new Uint8Array(u.length));return u.encode(w),s==="hex"?ke(w.bytes):w.bytes}function Ms(t){return Array.isArray(t)?mn(t.map(s=>Ms(s))):gn(t)}function mn(t){const s=t.reduce((y,B)=>y+B.length,0),u=Ds(s);return{length:s<=55?1+s:1+u+s,encode(y){s<=55?y.pushByte(192+s):(y.pushByte(247+u),u===1?y.pushUint8(s):u===2?y.pushUint16(s):u===3?y.pushUint24(s):y.pushUint32(s));for(const{encode:B}of t)B(y)}}}function gn(t){const s=typeof t=="string"?xe(t):t,u=Ds(s.length);return{length:s.length===1&&s[0]<128?1:s.length<=55?1+s.length:1+u+s.length,encode(y){s.length===1&&s[0]<128?y.pushBytes(s):s.length<=55?(y.pushByte(128+s.length),y.pushBytes(s)):(y.pushByte(183+u),u===1?y.pushUint8(s.length):u===2?y.pushUint16(s.length):u===3?y.pushUint24(s.length):y.pushUint32(s.length),y.pushBytes(s))}}}function Ds(t){if(t<2**8)return 1;if(t<2**16)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new Z("Length is too large.")}class Ge extends Z{constructor({cause:s,message:u}={}){const w=u?.replace("execution reverted: ","")?.replace("execution reverted","");super(`Execution reverted ${w?`with reason: ${w}`:"for an unknown reason"}.`,{cause:s,name:"ExecutionRevertedError"})}}Object.defineProperty(Ge,"code",{enumerable:!0,configurable:!0,writable:!0,value:3});Object.defineProperty(Ge,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted/});class Ne extends Z{constructor({cause:s,maxFeePerGas:u}={}){super(`The fee cap (\`maxFeePerGas\`${u?` = ${We(u)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:s,name:"FeeCapTooHighError"})}}Object.defineProperty(Ne,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});class gi extends Z{constructor({cause:s,maxFeePerGas:u}={}){super(`The fee cap (\`maxFeePerGas\`${u?` = ${We(u)}`:""} gwei) cannot be lower than the block base fee.`,{cause:s,name:"FeeCapTooLowError"})}}Object.defineProperty(gi,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas less than block base fee|fee cap less than block base fee|transaction is outdated/});class vi extends Z{constructor({cause:s,nonce:u}={}){super(`Nonce provided for the transaction ${u?`(${u}) `:""}is higher than the next one expected.`,{cause:s,name:"NonceTooHighError"})}}Object.defineProperty(vi,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too high/});class bi extends Z{constructor({cause:s,nonce:u}={}){super([`Nonce provided for the transaction ${u?`(${u}) `:""}is lower than the current nonce of the account.`,"Try increasing the nonce or find the latest nonce with `getTransactionCount`."].join(`
`),{cause:s,name:"NonceTooLowError"})}}Object.defineProperty(bi,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too low|transaction already imported|already known/});class Ci extends Z{constructor({cause:s,nonce:u}={}){super(`Nonce provided for the transaction ${u?`(${u}) `:""}exceeds the maximum allowed nonce.`,{cause:s,name:"NonceMaxValueError"})}}Object.defineProperty(Ci,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce has max value/});class Si extends Z{constructor({cause:s}={}){super(["The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account."].join(`
`),{cause:s,metaMessages:["This error could arise when the account does not have enough funds to:"," - pay for the total gas fee,"," - pay for the value to send."," ","The cost of the transaction is calculated as `gas * gas fee + value`, where:"," - `gas` is the amount of gas needed for transaction to execute,"," - `gas fee` is the gas fee,"," - `value` is the amount of ether to send to the recipient."],name:"InsufficientFundsError"})}}Object.defineProperty(Si,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/insufficient funds|exceeds transaction sender account balance/});class wi extends Z{constructor({cause:s,gas:u}={}){super(`The amount of gas ${u?`(${u}) `:""}provided for the transaction exceeds the limit allowed for the block.`,{cause:s,name:"IntrinsicGasTooHighError"})}}Object.defineProperty(wi,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too high|gas limit reached/});class yi extends Z{constructor({cause:s,gas:u}={}){super(`The amount of gas ${u?`(${u}) `:""}provided for the transaction is too low.`,{cause:s,name:"IntrinsicGasTooLowError"})}}Object.defineProperty(yi,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too low/});class xi extends Z{constructor({cause:s}){super("The transaction type is not supported for this chain.",{cause:s,name:"TransactionTypeNotSupportedError"})}}Object.defineProperty(xi,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/transaction type not valid/});class kt extends Z{constructor({cause:s,maxPriorityFeePerGas:u,maxFeePerGas:w}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${u?` = ${We(u)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${w?` = ${We(w)} gwei`:""}).`].join(`
`),{cause:s,name:"TipAboveFeeCapError"})}}Object.defineProperty(kt,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});class Rs extends Z{constructor({cause:s}){super(`An error occurred while executing: ${s?.shortMessage}`,{cause:s,name:"UnknownNodeError"})}}function vn(t,s){const u=(t.details||"").toLowerCase(),w=t instanceof Z?t.walk(y=>y?.code===Ge.code):t;return w instanceof Z?new Ge({cause:t,message:w.details}):Ge.nodeMessage.test(u)?new Ge({cause:t,message:t.details}):Ne.nodeMessage.test(u)?new Ne({cause:t,maxFeePerGas:s?.maxFeePerGas}):gi.nodeMessage.test(u)?new gi({cause:t,maxFeePerGas:s?.maxFeePerGas}):vi.nodeMessage.test(u)?new vi({cause:t,nonce:s?.nonce}):bi.nodeMessage.test(u)?new bi({cause:t,nonce:s?.nonce}):Ci.nodeMessage.test(u)?new Ci({cause:t,nonce:s?.nonce}):Si.nodeMessage.test(u)?new Si({cause:t}):wi.nodeMessage.test(u)?new wi({cause:t,gas:s?.gas}):yi.nodeMessage.test(u)?new yi({cause:t,gas:s?.gas}):xi.nodeMessage.test(u)?new xi({cause:t}):kt.nodeMessage.test(u)?new kt({cause:t,maxFeePerGas:s?.maxFeePerGas,maxPriorityFeePerGas:s?.maxPriorityFeePerGas}):new Rs({cause:t})}function bn(t,{format:s}){if(!s)return{};const u={};function w(B){const x=Object.keys(B);for(const e of x)e in t&&(u[e]=t[e]),B[e]&&typeof B[e]=="object"&&!Array.isArray(B[e])&&w(B[e])}const y=s(t||{});return w(y),u}function Zt(t,s){return({exclude:u,format:w})=>({exclude:u,format:y=>{const B=s(y);if(u)for(const x of u)delete B[x];return{...B,...w(y)}},type:t})}const Cn={legacy:"0x0",eip2930:"0x1",eip1559:"0x2",eip4844:"0x3",eip7702:"0x4"};function Ts(t){const s={};return typeof t.authorizationList<"u"&&(s.authorizationList=wn(t.authorizationList)),typeof t.accessList<"u"&&(s.accessList=t.accessList),typeof t.blobVersionedHashes<"u"&&(s.blobVersionedHashes=t.blobVersionedHashes),typeof t.blobs<"u"&&(typeof t.blobs[0]!="string"?s.blobs=t.blobs.map(u=>ke(u)):s.blobs=t.blobs),typeof t.data<"u"&&(s.data=t.data),typeof t.from<"u"&&(s.from=t.from),typeof t.gas<"u"&&(s.gas=J(t.gas)),typeof t.gasPrice<"u"&&(s.gasPrice=J(t.gasPrice)),typeof t.maxFeePerBlobGas<"u"&&(s.maxFeePerBlobGas=J(t.maxFeePerBlobGas)),typeof t.maxFeePerGas<"u"&&(s.maxFeePerGas=J(t.maxFeePerGas)),typeof t.maxPriorityFeePerGas<"u"&&(s.maxPriorityFeePerGas=J(t.maxPriorityFeePerGas)),typeof t.nonce<"u"&&(s.nonce=J(t.nonce)),typeof t.to<"u"&&(s.to=t.to),typeof t.type<"u"&&(s.type=Cn[t.type]),typeof t.value<"u"&&(s.value=J(t.value)),s}const Sn=Zt("transactionRequest",Ts);function wn(t){return t.map(s=>({address:s.address,r:s.r?J(BigInt(s.r)):s.r,s:s.s?J(BigInt(s.s)):s.s,chainId:J(s.chainId),nonce:J(s.nonce),...typeof s.yParity<"u"?{yParity:J(s.yParity)}:{},...typeof s.v<"u"&&typeof s.yParity>"u"?{v:J(s.v)}:{}}))}const yn=2n**16n-1n,Qt=2n**256n-1n;function xn(t){const{account:s,gasPrice:u,maxFeePerGas:w,maxPriorityFeePerGas:y,to:B}=t,x=s?Yt(s):void 0;if(x&&!ve(x.address))throw new ge({address:x.address});if(B&&!ve(B))throw new ge({address:B});if(typeof u<"u"&&(typeof w<"u"||typeof y<"u"))throw new on;if(w&&w>Qt)throw new Ne({maxFeePerGas:w});if(y&&w&&y>w)throw new kt({maxFeePerGas:w,maxPriorityFeePerGas:y})}const Ps={"0x0":"legacy","0x1":"eip2930","0x2":"eip1559","0x3":"eip4844","0x4":"eip7702"};function Pi(t){const s={...t,blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,chainId:t.chainId?ot(t.chainId):void 0,gas:t.gas?BigInt(t.gas):void 0,gasPrice:t.gasPrice?BigInt(t.gasPrice):void 0,maxFeePerBlobGas:t.maxFeePerBlobGas?BigInt(t.maxFeePerBlobGas):void 0,maxFeePerGas:t.maxFeePerGas?BigInt(t.maxFeePerGas):void 0,maxPriorityFeePerGas:t.maxPriorityFeePerGas?BigInt(t.maxPriorityFeePerGas):void 0,nonce:t.nonce?ot(t.nonce):void 0,to:t.to?t.to:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null,type:t.type?Ps[t.type]:void 0,typeHex:t.type?t.type:void 0,value:t.value?BigInt(t.value):void 0,v:t.v?BigInt(t.v):void 0};return t.authorizationList&&(s.authorizationList=Bn(t.authorizationList)),s.yParity=(()=>{if(t.yParity)return Number(t.yParity);if(typeof s.v=="bigint"){if(s.v===0n||s.v===27n)return 0;if(s.v===1n||s.v===28n)return 1;if(s.v>=35n)return s.v%2n===0n?1:0}})(),s.type==="legacy"&&(delete s.accessList,delete s.maxFeePerBlobGas,delete s.maxFeePerGas,delete s.maxPriorityFeePerGas,delete s.yParity),s.type==="eip2930"&&(delete s.maxFeePerBlobGas,delete s.maxFeePerGas,delete s.maxPriorityFeePerGas),s.type==="eip1559"&&delete s.maxFeePerBlobGas,s}const Is=Zt("transaction",Pi);function Bn(t){return t.map(s=>({address:s.address,chainId:Number(s.chainId),nonce:Number(s.nonce),r:s.r,s:s.s,yParity:Number(s.yParity)}))}function En(t){const s=(t.transactions??[]).map(u=>typeof u=="string"?u:Pi(u));return{...t,baseFeePerGas:t.baseFeePerGas?BigInt(t.baseFeePerGas):null,blobGasUsed:t.blobGasUsed?BigInt(t.blobGasUsed):void 0,difficulty:t.difficulty?BigInt(t.difficulty):void 0,excessBlobGas:t.excessBlobGas?BigInt(t.excessBlobGas):void 0,gasLimit:t.gasLimit?BigInt(t.gasLimit):void 0,gasUsed:t.gasUsed?BigInt(t.gasUsed):void 0,hash:t.hash?t.hash:null,logsBloom:t.logsBloom?t.logsBloom:null,nonce:t.nonce?t.nonce:null,number:t.number?BigInt(t.number):null,size:t.size?BigInt(t.size):void 0,timestamp:t.timestamp?BigInt(t.timestamp):void 0,transactions:s,totalDifficulty:t.totalDifficulty?BigInt(t.totalDifficulty):null}}const Os=Zt("block",En);function $s(t){const{kzg:s}=t,u=t.to??(typeof t.blobs[0]=="string"?"hex":"bytes"),w=typeof t.blobs[0]=="string"?t.blobs.map(B=>xe(B)):t.blobs,y=[];for(const B of w)y.push(Uint8Array.from(s.blobToKzgCommitment(B)));return u==="bytes"?y:y.map(B=>ke(B))}function Fs(t){const{kzg:s}=t,u=t.to??(typeof t.blobs[0]=="string"?"hex":"bytes"),w=typeof t.blobs[0]=="string"?t.blobs.map(x=>xe(x)):t.blobs,y=typeof t.commitments[0]=="string"?t.commitments.map(x=>xe(x)):t.commitments,B=[];for(let x=0;x<w.length;x++){const e=w[x],a=y[x];B.push(Uint8Array.from(s.computeBlobKzgProof(e,a)))}return u==="bytes"?B:B.map(x=>ke(x))}function Ln(t,s,u,w){if(typeof t.setBigUint64=="function")return t.setBigUint64(s,u,w);const y=BigInt(32),B=BigInt(4294967295),x=Number(u>>y&B),e=Number(u&B),a=w?4:0,h=w?0:4;t.setUint32(s+a,x,w),t.setUint32(s+h,e,w)}function kn(t,s,u){return t&s^~t&u}function An(t,s,u){return t&s^t&u^s&u}class Mn extends bs{constructor(s,u,w,y){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=s,this.outputLen=u,this.padOffset=w,this.isLE=y,this.buffer=new Uint8Array(s),this.view=oi(this.buffer)}update(s){Vt(this),s=Mi(s),at(s);const{view:u,buffer:w,blockLen:y}=this,B=s.length;for(let x=0;x<B;){const e=Math.min(y-this.pos,B-x);if(e===y){const a=oi(s);for(;y<=B-x;x+=y)this.process(a,x);continue}w.set(s.subarray(x,x+e),this.pos),this.pos+=e,x+=e,this.pos===y&&(this.process(u,0),this.pos=0)}return this.length+=s.length,this.roundClean(),this}digestInto(s){Vt(this),vs(s,this),this.finished=!0;const{buffer:u,view:w,blockLen:y,isLE:B}=this;let{pos:x}=this;u[x++]=128,ct(this.buffer.subarray(x)),this.padOffset>y-x&&(this.process(w,0),x=0);for(let o=x;o<y;o++)u[o]=0;Ln(w,y-8,BigInt(this.length*8),B),this.process(w,0);const e=oi(s),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=a/4,f=this.get();if(h>f.length)throw new Error("_sha2: outputLen bigger than state");for(let o=0;o<h;o++)e.setUint32(4*o,f[o],B)}digest(){const{buffer:s,outputLen:u}=this;this.digestInto(s);const w=s.slice(0,u);return this.destroy(),w}_cloneInto(s){s||(s=new this.constructor),s.set(...this.get());const{blockLen:u,buffer:w,length:y,finished:B,destroyed:x,pos:e}=this;return s.destroyed=x,s.finished=B,s.length=y,s.pos=e,y%u&&s.buffer.set(w),s}clone(){return this._cloneInto()}}const Ae=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Dn=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Me=new Uint32Array(64);class Rn extends Mn{constructor(s=32){super(64,s,8,!1),this.A=Ae[0]|0,this.B=Ae[1]|0,this.C=Ae[2]|0,this.D=Ae[3]|0,this.E=Ae[4]|0,this.F=Ae[5]|0,this.G=Ae[6]|0,this.H=Ae[7]|0}get(){const{A:s,B:u,C:w,D:y,E:B,F:x,G:e,H:a}=this;return[s,u,w,y,B,x,e,a]}set(s,u,w,y,B,x,e,a){this.A=s|0,this.B=u|0,this.C=w|0,this.D=y|0,this.E=B|0,this.F=x|0,this.G=e|0,this.H=a|0}process(s,u){for(let o=0;o<16;o++,u+=4)Me[o]=s.getUint32(u,!1);for(let o=16;o<64;o++){const d=Me[o-15],m=Me[o-2],b=ye(d,7)^ye(d,18)^d>>>3,l=ye(m,17)^ye(m,19)^m>>>10;Me[o]=l+Me[o-7]+b+Me[o-16]|0}let{A:w,B:y,C:B,D:x,E:e,F:a,G:h,H:f}=this;for(let o=0;o<64;o++){const d=ye(e,6)^ye(e,11)^ye(e,25),m=f+d+kn(e,a,h)+Dn[o]+Me[o]|0,l=(ye(w,2)^ye(w,13)^ye(w,22))+An(w,y,B)|0;f=h,h=a,a=e,e=x+m|0,x=B,B=y,y=w,w=m+l|0}w=w+this.A|0,y=y+this.B|0,B=B+this.C|0,x=x+this.D|0,e=e+this.E|0,a=a+this.F|0,h=h+this.G|0,f=f+this.H|0,this.set(w,y,B,x,e,a,h,f)}roundClean(){ct(Me)}destroy(){this.set(0,0,0,0,0,0,0,0),ct(this.buffer)}}const Tn=Cs(()=>new Rn),Pn=Tn;function Hs(t,s){const u=s||"hex",w=Pn(At(t,{strict:!1})?rt(t):t);return u==="bytes"?w:ue(w)}function In(t){const{commitment:s,version:u=1}=t,w=t.to??(typeof s=="string"?"hex":"bytes"),y=Hs(s,"bytes");return y.set([u],0),w==="bytes"?y:ke(y)}function On(t){const{commitments:s,version:u}=t,w=t.to??(typeof s[0]=="string"?"hex":"bytes"),y=[];for(const B of s)y.push(In({commitment:B,to:w,version:u}));return y}const es=6,Us=32,Ii=4096,Ws=Us*Ii,ts=Ws*es-1-1*Ii*es,Ns=1;class $n extends Z{constructor({maxSize:s,size:u}){super("Blob size is too large.",{metaMessages:[`Max: ${s} bytes`,`Given: ${u} bytes`],name:"BlobSizeTooLargeError"})}}class zs extends Z{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}}class Fn extends Z{constructor({hash:s,size:u}){super(`Versioned hash "${s}" size is invalid.`,{metaMessages:["Expected: 32",`Received: ${u}`],name:"InvalidVersionedHashSizeError"})}}class Hn extends Z{constructor({hash:s,version:u}){super(`Versioned hash "${s}" version is invalid.`,{metaMessages:[`Expected: ${Ns}`,`Received: ${u}`],name:"InvalidVersionedHashVersionError"})}}function Un(t){const s=t.to??(typeof t.data=="string"?"hex":"bytes"),u=typeof t.data=="string"?xe(t.data):t.data,w=qe(u);if(!w)throw new zs;if(w>ts)throw new $n({maxSize:ts,size:w});const y=[];let B=!0,x=0;for(;B;){const e=Ls(new Uint8Array(Ws));let a=0;for(;a<Ii;){const h=u.slice(x,x+(Us-1));if(e.pushByte(0),e.pushBytes(h),h.length<31){e.pushByte(128),B=!1;break}a++,x+=31}y.push(e)}return s==="bytes"?y.map(e=>e.bytes):y.map(e=>ke(e.bytes))}function Wn(t){const{data:s,kzg:u,to:w}=t,y=t.blobs??Un({data:s,to:w}),B=t.commitments??$s({blobs:y,kzg:u,to:w}),x=t.proofs??Fs({blobs:y,commitments:B,kzg:u,to:w}),e=[];for(let a=0;a<y.length;a++)e.push({blob:y[a],commitment:B[a],proof:x[a]});return e}function Nn(t){if(t.type)return t.type;if(typeof t.authorizationList<"u")return"eip7702";if(typeof t.blobs<"u"||typeof t.blobVersionedHashes<"u"||typeof t.maxFeePerBlobGas<"u"||typeof t.sidecars<"u")return"eip4844";if(typeof t.maxFeePerGas<"u"||typeof t.maxPriorityFeePerGas<"u")return"eip1559";if(typeof t.gasPrice<"u")return typeof t.accessList<"u"?"eip2930":"legacy";throw new cn({transaction:t})}function js(t,{args:s,eventName:u}={}){return{...t,blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,logIndex:t.logIndex?Number(t.logIndex):null,transactionHash:t.transactionHash?t.transactionHash:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null,...u?{args:s,eventName:u}:{}}}class Mt extends Z{constructor({chainId:s}){super(typeof s=="number"?`Chain ID "${s}" is invalid.`:"Chain ID is invalid.",{name:"InvalidChainIdError"})}}function zn(t,{docsPath:s,...u}){const w=(()=>{const y=vn(t,u);return y instanceof Rs?t:y})();return new ln(w,{docsPath:s,...u})}function jn(){let t=()=>{},s=()=>{};return{promise:new Promise((w,y)=>{t=w,s=y}),resolve:t,reject:s}}const hi=new Map;function Gn({fn:t,id:s,shouldSplitBatch:u,wait:w=0,sort:y}){const B=async()=>{const f=a();x();const o=f.map(({args:d})=>d);o.length!==0&&t(o).then(d=>{y&&Array.isArray(d)&&d.sort(y);for(let m=0;m<f.length;m++){const{resolve:b}=f[m];b?.([d[m],d])}}).catch(d=>{for(let m=0;m<f.length;m++){const{reject:b}=f[m];b?.(d)}})},x=()=>hi.delete(s),e=()=>a().map(({args:f})=>f),a=()=>hi.get(s)||[],h=f=>hi.set(s,[...a(),f]);return{flush:x,async schedule(f){const{promise:o,resolve:d,reject:m}=jn();return u?.([...e(),f])&&B(),a().length>0?(h({args:f,resolve:d,reject:m}),o):(h({args:f,resolve:d,reject:m}),setTimeout(B,w),o)}}}async function qn(t){return new Promise(s=>setTimeout(s,t))}class Vn extends Z{constructor({docsPath:s}={}){super(["Could not find an Account to execute with this Action.","Please provide an Account with the `account` argument on the Action, or by supplying an `account` to the Client."].join(`
`),{docsPath:s,docsSlug:"account",name:"AccountNotFoundError"})}}const Kn={"0x0":"reverted","0x1":"success"};function Xn(t){const s={...t,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs?t.logs.map(u=>js(u)):null,to:t.to?t.to:null,transactionIndex:t.transactionIndex?ot(t.transactionIndex):null,status:t.status?Kn[t.status]:null,type:t.type?Ps[t.type]||t.type:null};return t.blobGasPrice&&(s.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(s.blobGasUsed=BigInt(t.blobGasUsed)),s}const Gs=Zt("transactionReceipt",Xn),Bi=256;let $t=Bi,Ft;function qs(t=11){if(!Ft||$t+t>Bi*2){Ft="",$t=0;for(let s=0;s<Bi;s++)Ft+=(256+Math.random()*256|0).toString(16).substring(1)}return Ft.substring($t,$t+++t)}function Jn(t){const{batch:s,chain:u,ccipRead:w,key:y="base",name:B="Base Client",type:x="base"}=t,e=t.experimental_blockTag??(typeof u?.experimental_preconfirmationTime=="number"?"pending":void 0),a=u?.blockTime??12e3,h=Math.min(Math.max(Math.floor(a/2),500),4e3),f=t.pollingInterval??h,o=t.cacheTime??f,d=t.account?Yt(t.account):void 0,{config:m,request:b,value:l}=t.transport({chain:u,pollingInterval:f}),i={...m,...l},c={account:d,batch:s,cacheTime:o,ccipRead:w,chain:u,key:y,name:B,pollingInterval:f,request:b,transport:i,type:x,uid:qs(),...e?{experimental_blockTag:e}:{}};function n(r){return p=>{const v=p(r);for(const C in c)delete v[C];const _={...r,...v};return Object.assign(_,{extend:n(_)})}}return Object.assign(c,{extend:n(c)})}const Ht=new Ri(8192);function Yn(t,{enabled:s=!0,id:u}){if(!s||!u)return t();if(Ht.get(u))return Ht.get(u);const w=t().finally(()=>Ht.delete(u));return Ht.set(u,w),w}function Vs(t,{delay:s=100,retryCount:u=2,shouldRetry:w=()=>!0}={}){return new Promise((y,B)=>{const x=async({count:e=0}={})=>{const a=async({error:h})=>{const f=typeof s=="function"?s({count:e,error:h}):s;f&&await qn(f),x({count:e+1})};try{const h=await t();y(h)}catch(h){if(e<u&&await w({count:e,error:h}))return a({error:h});B(h)}};x()})}function Zn(t,s={}){return async(u,w={})=>{const{dedupe:y=!1,methods:B,retryDelay:x=150,retryCount:e=3,uid:a}={...s,...w},{method:h}=u;if(B?.exclude?.includes(h))throw new $e(new Error("method not supported"),{method:h});if(B?.include&&!B.include.includes(h))throw new $e(new Error("method not supported"),{method:h});const f=y?ms(`${a}.${He(u)}`):void 0;return Yn(()=>Vs(async()=>{try{return await t(u)}catch(o){const d=o;switch(d.code){case ht.code:throw new ht(d);case lt.code:throw new lt(d);case dt.code:throw new dt(d,{method:u.method});case ut.code:throw new ut(d);case Ve.code:throw new Ve(d);case ft.code:throw new ft(d);case _t.code:throw new _t(d);case Re.code:throw new Re(d);case pt.code:throw new pt(d);case $e.code:throw new $e(d,{method:u.method});case Ke.code:throw new Ke(d);case mt.code:throw new mt(d);case _e.code:throw new _e(d);case gt.code:throw new gt(d);case vt.code:throw new vt(d);case bt.code:throw new bt(d);case Ct.code:throw new Ct(d);case Pe.code:throw new Pe(d);case St.code:throw new St(d);case wt.code:throw new wt(d);case yt.code:throw new yt(d);case xt.code:throw new xt(d);case Bt.code:throw new Bt(d);case Et.code:throw new Et(d);case Lt.code:throw new Lt(d);case 5e3:throw new _e(d);default:throw o instanceof Z?o:new un(d)}}},{delay:({count:o,error:d})=>{if(d&&d instanceof nt){const m=d?.headers?.get("Retry-After");if(m?.match(/\d/))return Number.parseInt(m)*1e3}return~~(1<<o)*x},retryCount:e,shouldRetry:({error:o})=>Qn(o)}),{enabled:y,id:f})}}function Qn(t){return"code"in t&&typeof t.code=="number"?t.code===-1||t.code===Ke.code||t.code===Ve.code:t instanceof nt&&t.status?t.status===403||t.status===408||t.status===413||t.status===429||t.status===500||t.status===502||t.status===503||t.status===504:!0}function eo({key:t,methods:s,name:u,request:w,retryCount:y=3,retryDelay:B=150,timeout:x,type:e},a){const h=qs();return{config:{key:t,methods:s,name:u,request:w,retryCount:y,retryDelay:B,timeout:x,type:e},request:Zn(w,{methods:s,retryCount:y,retryDelay:B,uid:h}),value:a}}class to extends Z{constructor(){super("No URL was provided to the Transport. Please provide a valid RPC URL to the Transport.",{docsPath:"/docs/clients/intro",name:"UrlRequiredError"})}}function Ks(t,{errorInstance:s=new Error("timed out"),timeout:u,signal:w}){return new Promise((y,B)=>{(async()=>{let x;try{const e=new AbortController;u>0&&(x=setTimeout(()=>{w?e.abort():B(s)},u)),y(await t({signal:e?.signal||null}))}catch(e){e?.name==="AbortError"&&B(s),B(e)}finally{clearTimeout(x)}})()})}function io(){return{current:0,take(){return this.current++},reset(){this.current=0}}}const is=io();function so(t,s={}){return{async request(u){const{body:w,onRequest:y=s.onRequest,onResponse:B=s.onResponse,timeout:x=s.timeout??1e4}=u,e={...s.fetchOptions??{},...u.fetchOptions??{}},{headers:a,method:h,signal:f}=e;try{const o=await Ks(async({signal:m})=>{const b={...e,body:Array.isArray(w)?He(w.map(n=>({jsonrpc:"2.0",id:n.id??is.take(),...n}))):He({jsonrpc:"2.0",id:w.id??is.take(),...w}),headers:{"Content-Type":"application/json",...a},method:h||"POST",signal:f||(x>0?m:null)},l=new Request(t,b),i=await y?.(l,b)??{...b,url:t};return await fetch(i.url??t,i)},{errorInstance:new Zi({body:w,url:t}),timeout:x,signal:!0});B&&await B(o);let d;if(o.headers.get("Content-Type")?.startsWith("application/json"))d=await o.json();else{d=await o.text();try{d=JSON.parse(d||"{}")}catch(m){if(o.ok)throw m;d={error:d}}}if(!o.ok)throw new nt({body:w,details:He(d.error)||o.statusText,headers:o.headers,status:o.status,url:t});return d}catch(o){throw o instanceof nt||o instanceof Zi?o:new nt({body:w,cause:o,url:t})}}}}function ro(t,s={}){const{batch:u,fetchOptions:w,key:y="http",methods:B,name:x="HTTP JSON-RPC",onFetchRequest:e,onFetchResponse:a,retryDelay:h,raw:f}=s;return({chain:o,retryCount:d,timeout:m})=>{const{batchSize:b=1e3,wait:l=0}=typeof u=="object"?u:{},i=s.retryCount??d,c=m??s.timeout??1e4,n=t||o?.rpcUrls.default.http[0];if(!n)throw new to;const r=so(n,{fetchOptions:w,onRequest:e,onResponse:a,timeout:c});return eo({key:y,methods:B,name:x,async request({method:p,params:v}){const _={method:p,params:v},{schedule:C}=Gn({id:n,wait:l,shouldSplitBatch(L){return L.length>b},fn:L=>r.request({body:L}),sort:(L,M)=>L.id-M.id}),g=async L=>u?C(L):[await r.request({body:L})],[{error:S,result:k}]=await g(_);if(f)return{error:S,result:k};if(S)throw new As({body:_,error:S,url:n});return k},retryCount:i,retryDelay:h,timeout:c,type:"http"},{fetchOptions:w,url:n})}}function Ce(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}function no(t){const{authorizationList:s}=t;if(s)for(const u of s){const{chainId:w}=u,y=u.address;if(!ve(y))throw new ge({address:y});if(w<0)throw new Mt({chainId:w})}Oi(t)}function oo(t){const{blobVersionedHashes:s}=t;if(s){if(s.length===0)throw new zs;for(const u of s){const w=qe(u),y=ot(Xr(u,0,1));if(w!==32)throw new Fn({hash:u,size:w});if(y!==Ns)throw new Hn({hash:u,version:y})}}Oi(t)}function Oi(t){const{chainId:s,maxPriorityFeePerGas:u,maxFeePerGas:w,to:y}=t;if(s<=0)throw new Mt({chainId:s});if(y&&!ve(y))throw new ge({address:y});if(w&&w>Qt)throw new Ne({maxFeePerGas:w});if(u&&w&&u>w)throw new kt({maxFeePerGas:w,maxPriorityFeePerGas:u})}function ao(t){const{chainId:s,maxPriorityFeePerGas:u,gasPrice:w,maxFeePerGas:y,to:B}=t;if(s<=0)throw new Mt({chainId:s});if(B&&!ve(B))throw new ge({address:B});if(u||y)throw new Z("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(w&&w>Qt)throw new Ne({maxFeePerGas:w})}function co(t){const{chainId:s,maxPriorityFeePerGas:u,gasPrice:w,maxFeePerGas:y,to:B}=t;if(B&&!ve(B))throw new ge({address:B});if(typeof s<"u"&&s<=0)throw new Mt({chainId:s});if(u||y)throw new Z("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(w&&w>Qt)throw new Ne({maxFeePerGas:w})}function ei(t){if(!t||t.length===0)return[];const s=[];for(let u=0;u<t.length;u++){const{address:w,storageKeys:y}=t[u];for(let B=0;B<y.length;B++)if(y[B].length-2!==64)throw new hn({storageKey:y[B]});if(!ve(w,{strict:!1}))throw new ge({address:w});s.push([w,y])}return s}function Xs(t,s){const u=Nn(t);return u==="eip1559"?uo(t,s):u==="eip2930"?fo(t,s):u==="eip4844"?lo(t,s):u==="eip7702"?ho(t,s):_o(t,s)}function ho(t,s){const{authorizationList:u,chainId:w,gas:y,nonce:B,to:x,value:e,maxFeePerGas:a,maxPriorityFeePerGas:h,accessList:f,data:o}=t;no(t);const d=ei(f),m=po(u);return Qe(["0x04",Ie([J(w),B?J(B):"0x",h?J(h):"0x",a?J(a):"0x",y?J(y):"0x",x??"0x",e?J(e):"0x",o??"0x",d,m,...Dt(t,s)])])}function lo(t,s){const{chainId:u,gas:w,nonce:y,to:B,value:x,maxFeePerBlobGas:e,maxFeePerGas:a,maxPriorityFeePerGas:h,accessList:f,data:o}=t;oo(t);let d=t.blobVersionedHashes,m=t.sidecars;if(t.blobs&&(typeof d>"u"||typeof m>"u")){const r=typeof t.blobs[0]=="string"?t.blobs:t.blobs.map(_=>ke(_)),p=t.kzg,v=$s({blobs:r,kzg:p});if(typeof d>"u"&&(d=On({commitments:v})),typeof m>"u"){const _=Fs({blobs:r,commitments:v,kzg:p});m=Wn({blobs:r,commitments:v,proofs:_})}}const b=ei(f),l=[J(u),y?J(y):"0x",h?J(h):"0x",a?J(a):"0x",w?J(w):"0x",B??"0x",x?J(x):"0x",o??"0x",b,e?J(e):"0x",d??[],...Dt(t,s)],i=[],c=[],n=[];if(m)for(let r=0;r<m.length;r++){const{blob:p,commitment:v,proof:_}=m[r];i.push(p),c.push(v),n.push(_)}return Qe(["0x03",Ie(m?[l,i,c,n]:l)])}function uo(t,s){const{chainId:u,gas:w,nonce:y,to:B,value:x,maxFeePerGas:e,maxPriorityFeePerGas:a,accessList:h,data:f}=t;Oi(t);const o=ei(h),d=[J(u),y?J(y):"0x",a?J(a):"0x",e?J(e):"0x",w?J(w):"0x",B??"0x",x?J(x):"0x",f??"0x",o,...Dt(t,s)];return Qe(["0x02",Ie(d)])}function fo(t,s){const{chainId:u,gas:w,data:y,nonce:B,to:x,value:e,accessList:a,gasPrice:h}=t;ao(t);const f=ei(a),o=[J(u),B?J(B):"0x",h?J(h):"0x",w?J(w):"0x",x??"0x",e?J(e):"0x",y??"0x",f,...Dt(t,s)];return Qe(["0x01",Ie(o)])}function _o(t,s){const{chainId:u=0,gas:w,data:y,nonce:B,to:x,value:e,gasPrice:a}=t;co(t);let h=[B?J(B):"0x",a?J(a):"0x",w?J(w):"0x",x??"0x",e?J(e):"0x",y??"0x"];if(s){const f=(()=>{if(s.v>=35n)return(s.v-35n)/2n>0?s.v:27n+(s.v===35n?0n:1n);if(u>0)return BigInt(u*2)+BigInt(35n+s.v-27n);const m=27n+(s.v===27n?0n:1n);if(s.v!==m)throw new an({v:s.v});return m})(),o=qt(s.r),d=qt(s.s);h=[...h,J(f),o==="0x00"?"0x":o,d==="0x00"?"0x":d]}else u>0&&(h=[...h,J(u),"0x","0x"]);return Ie(h)}function Dt(t,s){const u=s??t,{v:w,yParity:y}=u;if(typeof u.r>"u")return[];if(typeof u.s>"u")return[];if(typeof w>"u"&&typeof y>"u")return[];const B=qt(u.r),x=qt(u.s);return[typeof y=="number"?y?J(1):"0x":w===0n?"0x":w===1n?J(1):w===27n?"0x":J(1),B==="0x00"?"0x":B,x==="0x00"?"0x":x]}function po(t){if(!t||t.length===0)return[];const s=[];for(const u of t){const{chainId:w,nonce:y,...B}=u,x=u.address;s.push([w?ue(w):"0x",x,y?ue(y):"0x",...Dt({},B)])}return s}class mo extends Z{constructor({value:s}){super(`Number \`${s}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function go(t,s){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(t))throw new mo({value:t});let[u,w="0"]=t.split(".");const y=u.startsWith("-");if(y&&(u=u.slice(1)),w=w.replace(/(0+)$/,""),s===0)Math.round(+`.${w}`)===1&&(u=`${BigInt(u)+1n}`),w="";else if(w.length>s){const[B,x,e]=[w.slice(0,s-1),w.slice(s-1,s),w.slice(s)],a=Math.round(+`${x}.${e}`);a>9?w=`${BigInt(B)+BigInt(1)}0`.padStart(B.length+1,"0"):w=`${B}${a}`,w.length>s&&(w=w.slice(1),u=`${BigInt(u)+1n}`),w=w.slice(0,s)}else w=w.padEnd(s,"0");return BigInt(`${y?"-":""}${u}${w}`)}const $i=50000n,ss=yn*32n,Js={block:Os({format(t){const s=t.transactions?.map(u=>{if(typeof u=="string")return u;const w=Js.transaction?.format(u);return w.typeHex==="0x71"?w.type="eip712":w.typeHex==="0xff"&&(w.type="priority"),w});return{l1BatchNumber:t.l1BatchNumber?fe(t.l1BatchNumber):null,l1BatchTimestamp:t.l1BatchTimestamp?fe(t.l1BatchTimestamp):null,transactions:s}}}),transaction:Is({format(t){const s={};return t.type==="0x71"?s.type="eip712":t.type==="0xff"&&(s.type="priority"),{...s,l1BatchNumber:t.l1BatchNumber?fe(t.l1BatchNumber):null,l1BatchTxIndex:t.l1BatchTxIndex?fe(t.l1BatchTxIndex):null}}}),transactionReceipt:Gs({format(t){return{l1BatchNumber:t.l1BatchNumber?fe(t.l1BatchNumber):null,l1BatchTxIndex:t.l1BatchTxIndex?fe(t.l1BatchTxIndex):null,logs:t.logs.map(s=>({...js(s),l1BatchNumber:s.l1BatchNumber?fe(s.l1BatchNumber):null,transactionLogIndex:ot(s.transactionLogIndex),logType:s.logType})),l2ToL1Logs:t.l2ToL1Logs.map(s=>({blockNumber:fe(s.blockHash),blockHash:s.blockHash,l1BatchNumber:s.l1BatchNumber?fe(s.l1BatchNumber):null,transactionIndex:fe(s.transactionIndex),shardId:fe(s.shardId),isService:s.isService,sender:s.sender,key:s.key,value:s.value,transactionHash:s.transactionHash,logIndex:fe(s.logIndex)}))}}}),transactionRequest:Sn({exclude:["customSignature","factoryDeps","gasPerPubdata","paymaster","paymasterInput"],format(t){return t.gasPerPubdata||t.paymaster&&t.paymasterInput||t.factoryDeps||t.customSignature?{eip712Meta:{...t.gasPerPubdata?{gasPerPubdata:ue(t.gasPerPubdata)}:{gasPerPubdata:ue($i)},...t.paymaster&&t.paymasterInput?{paymasterParams:{paymaster:t.paymaster,paymasterInput:Array.from(xe(t.paymasterInput))}}:{},...t.factoryDeps?{factoryDeps:t.factoryDeps.map(s=>Array.from(xe(s)))}:{},...t.customSignature?{customSignature:Array.from(xe(t.customSignature))}:{}},type:"0x71"}:{}}})};class vo extends Z{constructor(){super(["Transaction is not an EIP712 transaction.","","Transaction must:",'  - include `type: "eip712"`',"  - include one of the following: `customSignature`, `paymaster`, `paymasterInput`, `gasPerPubdata`, `factoryDeps`"].join(`
`),{name:"InvalidEip712TransactionError"})}}function Ys(t){return!!(t.type==="eip712"||"customSignature"in t&&t.customSignature||"paymaster"in t&&t.paymaster||"paymasterInput"in t&&t.paymasterInput||"gasPerPubdata"in t&&typeof t.gasPerPubdata=="bigint"||"factoryDeps"in t&&t.factoryDeps)}function Zs(t){const{chainId:s,to:u,from:w,paymaster:y,paymasterInput:B}=t;if(!Ys(t))throw new vo;if(!s||s<=0)throw new Mt({chainId:s});if(u&&!ve(u))throw new ge({address:u});if(w&&!ve(w))throw new ge({address:w});if(y&&!ve(y))throw new ge({address:y});if(y&&!B)throw new Z("`paymasterInput` must be provided when `paymaster` is defined");if(!y&&B)throw new Z("`paymaster` must be provided when `paymasterInput` is defined")}function bo(t,s){return Ys(t)?So(t):Xs(t,s)}const Co={transaction:bo};function So(t){const{chainId:s,gas:u,nonce:w,to:y,from:B,value:x,maxFeePerGas:e,maxPriorityFeePerGas:a,customSignature:h,factoryDeps:f,paymaster:o,paymasterInput:d,gasPerPubdata:m,data:b}=t;Zs(t);const l=[w?ue(w):"0x",a?ue(a):"0x",e?ue(e):"0x",u?ue(u):"0x",y??"0x",x?ue(x):"0x",b??"0x",ue(s),ue(""),ue(""),ue(s),B??"0x",ue(m||$i),f??[],h??"0x",o&&d?[o,d]:[]];return Qe(["0x71",Ie(l)])}class wo extends Z{constructor({givenLength:s,maxBytecodeSize:u}){super(`Bytecode cannot be longer than ${u} bytes. Given length: ${s}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class yo extends Z{constructor({givenLengthInWords:s}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${s}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class xo extends Z{constructor({givenLength:s}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${s}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function Bo(t){const s=rt(t);if(s.length%32!==0)throw new xo({givenLength:s.length});if(s.length>ss)throw new wo({givenLength:s.length,maxBytecodeSize:ss});const u=Hs(s),w=rt(u),y=s.length/32;if(y%2===0)throw new yo({givenLengthInWords:y});const B=rt(y),x=ze(B,{size:2}),e=new Uint8Array([1,0]);return w.set(e,0),w.set(x,2),w}const Eo=t=>{Zs(t);const s=Lo(t);return{domain:{name:"zkSync",version:"2",chainId:t.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:s}};function Lo(t){const{gas:s,nonce:u,to:w,from:y,value:B,maxFeePerGas:x,maxPriorityFeePerGas:e,factoryDeps:a,paymaster:h,paymasterInput:f,gasPerPubdata:o,data:d}=t;return{txType:113n,from:BigInt(y),to:w?BigInt(w):0n,gasLimit:s??0n,gasPerPubdataByteLimit:o??$i,maxFeePerGas:x??0n,maxPriorityFeePerGas:e??0n,paymaster:h?BigInt(h):0n,nonce:u?BigInt(u):0n,value:B??0n,data:d??"0x",factoryDeps:a?.map(m=>ue(Bo(m)))??[],paymasterInput:f||"0x"}}const ko={blockTime:1e3,formatters:Js,serializers:Co,custom:{getEip712Domain:Eo}},Ao={gasPriceOracle:{address:"0x420000000000000000000000000000000000000F"},l1Block:{address:"0x4200000000000000000000000000000000000015"},l2CrossDomainMessenger:{address:"0x4200000000000000000000000000000000000007"},l2Erc721Bridge:{address:"0x4200000000000000000000000000000000000014"},l2StandardBridge:{address:"0x4200000000000000000000000000000000000010"},l2ToL1MessagePasser:{address:"0x4200000000000000000000000000000000000016"}},Mo={block:Os({format(t){return{transactions:t.transactions?.map(u=>{if(typeof u=="string")return u;const w=Pi(u);return w.typeHex==="0x7e"&&(w.isSystemTx=u.isSystemTx,w.mint=u.mint?fe(u.mint):void 0,w.sourceHash=u.sourceHash,w.type="deposit"),w}),stateRoot:t.stateRoot}}}),transaction:Is({format(t){const s={};return t.type==="0x7e"&&(s.isSystemTx=t.isSystemTx,s.mint=t.mint?fe(t.mint):void 0,s.sourceHash=t.sourceHash,s.type="deposit"),s}}),transactionReceipt:Gs({format(t){return{l1GasPrice:t.l1GasPrice?fe(t.l1GasPrice):null,l1GasUsed:t.l1GasUsed?fe(t.l1GasUsed):null,l1Fee:t.l1Fee?fe(t.l1Fee):null,l1FeeScalar:t.l1FeeScalar?Number(t.l1FeeScalar):null}}})};function Do(t,s){return Po(t)?To(t):Xs(t,s)}const Ro={transaction:Do};function To(t){Io(t);const{sourceHash:s,data:u,from:w,gas:y,isSystemTx:B,mint:x,to:e,value:a}=t,h=[s,w,e??"0x",x?ue(x):"0x",a?ue(a):"0x",y?ue(y):"0x",B?"0x1":"0x",u??"0x"];return Qe(["0x7e",Ie(h)])}function Po(t){return t.type==="deposit"||typeof t.sourceHash<"u"}function Io(t){const{from:s,to:u}=t;if(s&&!ve(s))throw new ge({address:s});if(u&&!ve(u))throw new ge({address:u})}const Xe={blockTime:2e3,contracts:Ao,formatters:Mo,serializers:Ro},Oo=Ce({id:42161,name:"Arbitrum One",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockTime:250,rpcUrls:{default:{http:["https://arb1.arbitrum.io/rpc"]}},blockExplorers:{default:{name:"Arbiscan",url:"https://arbiscan.io",apiUrl:"https://api.arbiscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:7654707}}}),$o=Ce({id:43114,name:"Avalanche",nativeCurrency:{decimals:18,name:"Avalanche",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://snowtrace.io",apiUrl:"https://api.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:11907934}}}),it=1,Qs=Ce({...Xe,id:8453,name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://basescan.org",apiUrl:"https://api.basescan.org/api"}},contracts:{...Xe.contracts,disputeGameFactory:{[it]:{address:"0x43edB88C4B80fDD2AdFF2412A7BebF9dF42cB40e"}},l2OutputOracle:{[it]:{address:"0x56315b90c40730925ec5485cf004d835058518A0"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:5022},portal:{[it]:{address:"0x49048044D57e1C92A77f79988d21Fa8fAF74E97e",blockCreated:17482143}},l1StandardBridge:{[it]:{address:"0x3154Cf16ccdb4C6d922629664174b904d80F2C35",blockCreated:17482143}}},sourceId:it});({...Qs});const Fo=Ce({id:56,name:"BNB Smart Chain",nativeCurrency:{decimals:18,name:"BNB",symbol:"BNB"},rpcUrls:{default:{http:["https://56.rpc.thirdweb.com"]}},blockExplorers:{default:{name:"BscScan",url:"https://bscscan.com",apiUrl:"https://api.bscscan.com/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:15921452}}}),Ho=Ce({id:100,name:"Gnosis",nativeCurrency:{decimals:18,name:"xDAI",symbol:"XDAI"},rpcUrls:{default:{http:["https://rpc.gnosischain.com"],webSocket:["wss://rpc.gnosischain.com/wss"]}},blockExplorers:{default:{name:"Gnosisscan",url:"https://gnosisscan.io",apiUrl:"https://api.gnosisscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:21022491}}});async function Uo(t,s){const{account:u=t.account}=s;if(!u)throw new Vn;const w=Yt(u);try{const{accessList:y,blockNumber:B,blockTag:x,data:e,gas:a,gasPrice:h,maxFeePerGas:f,maxPriorityFeePerGas:o,nonce:d,to:m,value:b,...l}=s,c=(typeof B=="bigint"?J(B):void 0)||x;xn(s);const n=t.chain?.formatters?.transactionRequest?.format,p=(n||Ts)({...bn(l,{format:n}),from:w?.address,accessList:y,data:e,gas:a,gasPrice:h,maxFeePerGas:f,maxPriorityFeePerGas:o,nonce:d,to:m,value:b}),{baseFeePerGas:v,gasLimit:_,priorityFeePerGas:C}=await t.request({method:"linea_estimateGas",params:c?[p,c]:[p]});return{baseFeePerGas:BigInt(v),gasLimit:BigInt(_),priorityFeePerGas:BigInt(C)}}catch(y){throw zn(y,{...s,account:w,chain:t.chain})}}const Wo={fees:{estimateFeesPerGas:rs,async maxPriorityFeePerGas({block:t,client:s,request:u}){const w=await rs({block:t,client:s,multiply:y=>y,request:u,type:"eip1559"});return w?.maxPriorityFeePerGas?w.maxPriorityFeePerGas:null}}};async function rs({client:t,multiply:s,request:u,type:w}){try{const y=await Uo(t,{...u,account:u?.account}),{priorityFeePerGas:B}=y,e=s(BigInt(y.baseFeePerGas))+B;return w==="legacy"?{gasPrice:e}:{maxFeePerGas:e,maxPriorityFeePerGas:B}}catch{return null}}const No=Ce({...Wo,id:59144,name:"Linea Mainnet",nativeCurrency:{name:"Linea Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://rpc.linea.build"],webSocket:["wss://rpc.linea.build"]}},blockExplorers:{default:{name:"Etherscan",url:"https://lineascan.build",apiUrl:"https://api.lineascan.build/api"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:42},ensRegistry:{address:"0x50130b669B28C339991d8676FA73CF122a121267",blockCreated:6682888},ensUniversalResolver:{address:"0x3aA974fb3f8C1E02796048BDCdeD79e9D53a6965",blockCreated:6683e3}},ensTlds:[".linea.eth"],testnet:!1}),zo=Ce({id:1,name:"Ethereum",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://eth.merkle.io"]}},blockExplorers:{default:{name:"Etherscan",url:"https://etherscan.io",apiUrl:"https://api.etherscan.io/api"}},contracts:{ensRegistry:{address:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},ensUniversalResolver:{address:"0xce01f8eee7E479C928F8919abD53E553a36CeF67",blockCreated:19258213},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:14353601}}}),st=1,jo=Ce({...Xe,id:10,name:"OP Mainnet",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.optimism.io"]}},blockExplorers:{default:{name:"Optimism Explorer",url:"https://optimistic.etherscan.io",apiUrl:"https://api-optimistic.etherscan.io/api"}},contracts:{...Xe.contracts,disputeGameFactory:{[st]:{address:"0xe5965Ab5962eDc7477C8520243A95517CD252fA9"}},l2OutputOracle:{[st]:{address:"0xdfe97868233d1aa22e815a266982f2cf17685a27"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:4286263},portal:{[st]:{address:"0xbEb5Fc579115071764c7423A4f12eDde41f106Ed"}},l1StandardBridge:{[st]:{address:"0x99C9fc46f92E8a1c0deC1b1747d010903E884bE1"}}},sourceId:st}),Go=Ce({id:137,name:"Polygon",nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://polygon-rpc.com"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:25770160}}}),qo=Ce({id:146,name:"Sonic",nativeCurrency:{decimals:18,name:"Sonic",symbol:"S"},rpcUrls:{default:{http:["https://rpc.soniclabs.com"]}},blockExplorers:{default:{name:"Sonic Explorer",url:"https://sonicscan.org"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:60}},testnet:!1}),Ut=1,Vo=Ce({...Xe,id:130,name:"Unichain",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.unichain.org/"]}},blockExplorers:{default:{name:"Uniscan",url:"https://uniscan.xyz",apiUrl:"https://api.uniscan.xyz/api"}},contracts:{...Xe.contracts,multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0},disputeGameFactory:{[Ut]:{address:"0x2F12d621a16e2d3285929C9996f478508951dFe4"}},portal:{[Ut]:{address:"0x0bd48f6B86a26D3a217d0Fa6FfE2B491B956A7a2"}},l1StandardBridge:{[Ut]:{address:"0x81014F44b0a345033bB2b3B21C7a1A308B35fEeA"}}},sourceId:Ut}),Ko=Ce({...ko,id:324,name:"ZKsync Era",network:"zksync-era",nativeCurrency:{decimals:18,name:"Ether",symbol:"ETH"},rpcUrls:{default:{http:["https://mainnet.era.zksync.io"],webSocket:["wss://mainnet.era.zksync.io/ws"]}},blockExplorers:{default:{name:"Etherscan",url:"https://era.zksync.network/",apiUrl:"https://api-era.zksync.network/api"},native:{name:"ZKsync Explorer",url:"https://explorer.zksync.io/",apiUrl:"https://block-explorer-api.mainnet.zksync.io/api"}},contracts:{multicall3:{address:"0xF9cda624FBC7e059355ce98a31693d299FACd963"},universalSignatureVerifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:45659388}}}),Te=[Oo,$o,Qs,Fo,Ho,No,zo,jo,Go,qo,Vo,Ko];function Xo(t){for(const[s,u]of Object.entries(Te))if(u.id===t)return u;return null}function Ei(){return Te.map(t=>({id:t.id,name:t.name}))}function ti(t){return Te.find(u=>u.id===t)?.name||"Unknown"}function Jo(t){const s=parseInt(t);if(!isNaN(s)&&Te.find(B=>B.id===s))return s;const u=t.toLowerCase(),w=Te.find(y=>{const B=y.name.toLowerCase();return B===u||u==="arbitrum"&&B.includes("arbitrum")||u==="base"&&B==="base"||u==="ethereum"&&B==="ethereum"||u==="mainnet"&&B==="ethereum"||u==="polygon"&&B==="polygon"});if(!w){const y=Te.map(B=>B.name.toLowerCase()).join(", ");throw new Error(`Unsupported chain: ${t}. Supported: ${y}`)}return w.id}function li(t,s=4){return t===0?"0":t<.001?t.toExponential(2):t<1?t.toFixed(Math.min(6,s)):t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:s})}function Wt(t){return t===0?"$0.00":t<.01?`$${t.toExponential(2)}`:`$${t.toFixed(2)}`}function Kt(t){const s=[];return!t||!t.tokens||t.tokens.length===0?(s.push({type:"info",content:"Scan complete - No tokens found"}),s):(s.push({type:"info",content:`
 PORTFOLIO SUMMARY `}),s.push({type:"info",content:` Total Value: ${Wt(t.totalUSD).padEnd(42)} `}),s.push({type:"info",content:` Total Tokens: ${t.allTokens.length.toString().padEnd(40)} `}),s.push({type:"info",content:` Dust Tokens: ${t.dustTokens.length.toString().padEnd(41)} `}),s.push({type:"info",content:""}),t.significantTokens&&t.significantTokens.length>0&&(s.push({type:"info",content:`
 SIGNIFICANT TOKENS`}),t.significantTokens.forEach((u,w)=>{const y=li(u.balanceNum||u.balanceFormatted),B=Wt(u.balanceUSD||u.usdValue);s.push({type:"info",content:`  ${w+1}. ${u.symbol} - ${y} (${B})`})})),t.mediumTokens&&t.mediumTokens.length>0&&(s.push({type:"info",content:`
 MEDIUM TOKENS`}),t.mediumTokens.forEach((u,w)=>{const y=li(u.balanceNum||u.balanceFormatted),B=Wt(u.balanceUSD||u.usdValue);s.push({type:"info",content:`  ${w+1}. ${u.symbol} - ${y} (${B})`})})),t.dustTokens&&t.dustTokens.length>0&&(s.push({type:"info",content:`
 DUST TOKENS`}),t.dustTokens.slice(0,5).forEach((u,w)=>{const y=li(u.balanceNum||u.balanceFormatted),B=Wt(u.balanceUSD||u.usdValue);s.push({type:"info",content:`  ${w+1}. ${u.symbol} - ${y} (${B})`})}),t.dustTokens.length>5&&s.push({type:"info",content:`     ... and ${t.dustTokens.length-5} more`})),s.push({type:"info",content:"============================================================"}),s)}const Yo=`
\x1B[49m   \x1B[49;38;2;6;21;36m\x1B[38;2;0;3;6;48;2;11;53;87m\x1B[38;2;11;56;93;48;2;13;63;107m\x1B[38;2;14;65;106;49m\x1B[38;2;13;67;107;49m\x1B[49m                                                 \x1B[38;2;249;83;89;49m\x1B[38;2;230;75;81;49m\x1B[38;2;63;20;22;48;2;211;69;76m\x1B[49;38;2;194;67;73m\x1B[49m             \x1B[m
\x1B[49m     \x1B[49;38;2;0;10;10m\x1B[49;38;2;4;23;37m\x1B[38;2;4;22;36;48;2;12;63;104m\x1B[38;2;9;47;77;48;2;14;63;105m\x1B[38;2;12;63;105;49m\x1B[38;2;13;63;104;49m\x1B[49m               \x1B[49;38;2;28;45;66m\x1B[49;38;2;43;115;166m\x1B[38;2;0;0;0;48;2;49;138;199m\x1B[38;2;0;0;0;48;2;53;151;219m\x1B[38;2;4;8;13;48;2;54;153;224m\x1B[38;2;21;60;87;48;2;55;153;223m\x1B[38;2;16;45;65;48;2;54;151;217m\x1B[38;2;27;77;112;48;2;61;153;224m\x1B[38;2;53;151;220;49m\x1B[38;2;54;154;223;49m\x1B[38;2;54;154;225;49m\x1B[49m               \x1B[38;2;255;75;90;49m\x1B[38;2;246;80;86;49m\x1B[38;2;246;80;86;48;2;246;85;94m\x1B[38;2;118;38;41;48;2;245;80;86m\x1B[38;2;41;12;12;48;2;220;71;77m\x1B[49;38;2;23;6;9m\x1B[49m               \x1B[m
\x1B[49m        \x1B[49;38;2;0;0;0m\x1B[49;38;2;5;28;45m\x1B[38;2;0;0;0;48;2;9;45;75m\x1B[38;2;3;16;28;48;2;12;63;104m\x1B[38;2;7;41;67;48;2;13;64;105m\x1B[38;2;12;60;100;48;2;12;64;106m\x1B[38;2;12;61;101;49m\x1B[38;2;9;30;46;49m\x1B[49m \x1B[38;2;246;80;88;49m\x1B[38;2;245;82;87;49m\x1B[38;2;247;80;86;49m\x1B[38;2;246;80;86;48;2;255;81;80m\x1B[38;2;246;80;86;48;2;247;81;85m\x1B[48;2;246;80;86m \x1B[38;2;246;80;86;48;2;247;81;86m\x1B[38;2;246;80;86;48;2;248;81;86m\x1B[38;2;246;80;86;48;2;247;79;86m\x1B[38;2;246;80;86;48;2;244;80;86m\x1B[38;2;246;80;86;48;2;248;81;86m\x1B[38;2;214;70;75;48;2;246;80;87m\x1B[38;2;15;4;4;48;2;245;82;88m\x1B[49m   \x1B[49;38;2;3;9;12m\x1B[49;38;2;28;80;116m\x1B[38;2;0;0;0;48;2;43;121;175m\x1B[38;2;16;72;115;48;2;54;154;223m\x1B[38;2;42;127;188;48;2;54;154;224m\x1B[38;2;54;154;223;48;2;54;154;224m\x1B[38;2;54;154;223;49m\x1B[38;2;53;154;223;49m\x1B[49m        \x1B[38;2;247;81;87;49m\x1B[38;2;246;81;86;49m\x1B[38;2;246;80;86;48;2;245;80;88m\x1B[38;2;206;67;73;48;2;247;80;86m\x1B[38;2;107;35;37;48;2;238;77;83m\x1B[49;38;2;112;38;40m\x1B[49m                  \x1B[m
\x1B[49m             \x1B[49;38;2;0;0;0m\x1B[38;2;245;80;86;48;2;0;2;2m\x1B[38;2;246;80;86;48;2;245;78;88m\x1B[38;2;246;80;86;48;2;245;81;86m\x1B[48;2;246;80;86m \x1B[38;2;245;80;86;48;2;246;80;86m\x1B[38;2;224;78;88;48;2;246;80;86m\x1B[38;2;35;65;102;48;2;246;80;86m\x1B[38;2;12;63;105;48;2;232;79;87m\x1B[38;2;12;63;104;48;2;199;77;90m\x1B[38;2;12;63;104;48;2;180;75;91m\x1B[38;2;12;63;104;48;2;146;72;94m\x1B[38;2;12;63;104;48;2;118;70;96m\x1B[38;2;12;63;104;48;2;111;70;96m\x1B[38;2;12;63;104;48;2;121;71;96m\x1B[38;2;12;63;104;48;2;139;71;95m\x1B[38;2;4;9;13;48;2;136;62;79m\x1B[49m  \x1B[38;2;55;155;224;48;2;51;153;221m\x1B[38;2;54;154;223;48;2;55;154;224m\x1B[38;2;54;154;223;48;2;55;154;223m\x1B[38;2;54;154;224;49m\x1B[49m \x1B[38;2;4;24;37;48;2;11;58;97m\x1B[38;2;12;63;104;48;2;12;63;105m\x1B[38;2;12;63;104;48;2;24;90;139m\x1B[38;2;21;83;130;48;2;54;153;222m\x1B[48;2;54;154;223m \x1B[38;2;54;154;223;48;2;55;156;223m\x1B[38;2;54;153;223;49m\x1B[49m   \x1B[38;2;245;81;89;49m\x1B[38;2;246;80;86;48;2;247;77;85m\x1B[38;2;246;80;86;48;2;247;81;87m\x1B[38;2;245;80;86;48;2;246;80;86m\x1B[38;2;169;55;59;48;2;246;80;86m\x1B[38;2;0;0;0;48;2;210;68;73m\x1B[49;38;2;27;9;9m\x1B[49m                    \x1B[m
\x1B[49m          \x1B[38;2;248;85;85;49m\x1B[38;2;244;80;85;49m\x1B[38;2;246;80;86;48;2;244;81;86m\x1B[38;2;246;80;86;48;2;245;80;86m\x1B[48;2;246;80;86m \x1B[38;2;217;78;89;48;2;246;81;86m\x1B[38;2;77;68;99;48;2;246;80;86m\x1B[38;2;13;63;104;48;2;194;76;91m\x1B[38;2;12;63;104;48;2;43;64;102m\x1B[38;2;12;63;104;48;2;13;63;104m\x1B[48;2;12;63;104m \x1B[38;2;9;48;81;48;2;12;63;104m\x1B[38;2;5;27;45;48;2;12;63;104m\x1B[38;2;3;14;22;48;2;12;63;104m\x1B[38;2;0;0;0;48;2;12;63;104m\x1B[38;2;0;0;0;48;2;12;62;103m\x1B[38;2;0;0;0;48;2;12;63;104m\x1B[38;2;0;3;3;48;2;12;63;104m\x1B[38;2;0;0;0;48;2;7;37;61m\x1B[49m   \x1B[38;2;54;154;223;48;2;54;155;223m\x1B[48;2;54;154;223m  \x1B[38;2;54;154;223;48;2;54;154;224m\x1B[38;2;49;134;194;49m\x1B[49m \x1B[38;2;10;55;91;48;2;12;62;102m\x1B[48;2;12;63;104m \x1B[38;2;12;63;104;48;2;14;68;110m\x1B[38;2;43;122;176;48;2;54;154;223m\x1B[38;2;11;42;64;48;2;25;71;103m\x1B[49;38;2;0;20;20m\x1B[38;2;241;79;86;49m\x1B[38;2;246;80;86;48;2;246;82;91m\x1B[48;2;246;80;86m  \x1B[38;2;220;72;77;48;2;246;80;86m\x1B[38;2;86;29;31;48;2;245;80;86m\x1B[49;38;2;70;23;24m\x1B[49m                       \x1B[m
\x1B[49m     \x1B[38;2;231;73;85;49m\x1B[38;2;238;78;83;49m\x1B[38;2;247;79;86;49m\x1B[38;2;245;80;86;48;2;245;82;85m\x1B[38;2;245;80;86;48;2;246;80;86m\x1B[38;2;238;77;83;48;2;246;80;86m\x1B[38;2;196;64;70;48;2;246;80;86m\x1B[38;2;146;72;93;48;2;246;80;86m\x1B[38;2;15;63;104;48;2;235;79;87m\x1B[38;2;12;63;104;48;2;118;70;96m\x1B[48;2;12;63;104m \x1B[38;2;13;63;104;48;2;12;63;104m\x1B[38;2;9;49;80;48;2;12;63;104m\x1B[38;2;2;14;24;48;2;12;63;103m\x1B[49;38;2;7;40;68m\x1B[49;38;2;4;17;29m\x1B[49;38;2;0;0;0m\x1B[49m   \x1B[38;2;53;149;223;49m\x1B[49m   \x1B[38;2;48;143;223;49m\x1B[38;2;52;152;223;49m\x1B[38;2;51;153;226;49m\x1B[38;2;40;113;163;48;2;53;148;216m\x1B[48;2;54;154;223m   \x1B[38;2;51;147;213;48;2;28;83;121m\x1B[38;2;59;157;226;49m\x1B[49;38;2;6;35;58m\x1B[49;38;2;7;37;61m\x1B[49;38;2;7;35;58m\x1B[38;2;53;149;220;48;2;0;0;0m\x1B[38;2;53;152;222;49m\x1B[38;2;54;154;221;49m\x1B[49;38;2;138;47;51m\x1B[38;2;0;0;0;48;2;160;52;56m\x1B[38;2;14;4;6;48;2;246;80;86m\x1B[38;2;0;0;0;48;2;164;54;58m\x1B[49;38;2;65;19;22m\x1B[49m                         \x1B[m
\x1B[49m     \x1B[49;38;2;0;0;0m\x1B[38;2;28;57;112;48;2;1;0;0m\x1B[38;2;12;63;103;48;2;2;4;6m\x1B[38;2;12;63;104;48;2;20;63;102m\x1B[48;2;12;63;104m  \x1B[38;2;11;57;94;48;2;12;63;104m\x1B[38;2;2;7;11;48;2;12;61;101m\x1B[49;38;2;4;22;36m\x1B[49;38;2;0;0;1m\x1B[49m \x1B[38;2;55;156;225;49m\x1B[38;2;55;154;224;49m\x1B[38;2;54;154;223;48;2;53;158;220m\x1B[38;2;53;150;219;48;2;54;156;228m\x1B[38;2;11;30;47;48;2;54;153;222m\x1B[38;2;0;0;0;48;2;45;129;186m\x1B[49;38;2;2;6;10m\x1B[38;2;54;153;220;49m\x1B[38;2;54;154;223;49m\x1B[38;2;54;154;223;48;2;54;157;227m\x1B[38;2;54;154;223;48;2;53;154;223m\x1B[48;2;54;154;223m \x1B[38;2;54;154;223;48;2;54;155;223m\x1B[38;2;54;154;223;48;2;52;149;216m\x1B[38;2;54;154;223;48;2;38;107;153m\x1B[48;2;54;154;223m  \x1B[38;2;54;154;222;48;2;54;154;223m\x1B[38;2;54;154;223;48;2;55;154;223m\x1B[38;2;54;154;223;48;2;54;155;223m\x1B[38;2;54;154;223;48;2;54;153;222m\x1B[38;2;54;154;223;48;2;54;155;224m\x1B[48;2;54;154;223m   \x1B[38;2;54;154;223;48;2;55;154;225m\x1B[38;2;54;154;223;48;2;51;163;224m\x1B[38;2;54;155;223;49m\x1B[38;2;54;157;228;49m\x1B[49m                          \x1B[m
\x1B[49m       \x1B[38;2;12;64;105;49m\x1B[38;2;12;63;104;48;2;15;66;108m\x1B[38;2;12;63;104;48;2;13;63;104m\x1B[48;2;12;63;104m  \x1B[38;2;8;38;63;48;2;12;63;104m\x1B[38;2;0;0;6;48;2;7;40;65m\x1B[49;38;2;5;19;32m\x1B[38;2;52;155;224;49m\x1B[38;2;54;154;223;49m\x1B[48;2;54;154;223m \x1B[38;2;54;154;223;48;2;54;154;224m\x1B[38;2;52;148;216;48;2;54;154;223m\x1B[38;2;25;71;102;48;2;54;154;223m\x1B[49;38;2;21;61;87m\x1B[49;38;2;8;26;34m\x1B[38;2;54;156;225;49m\x1B[38;2;54;154;223;48;2;56;158;227m\x1B[48;2;54;154;223m  \x1B[38;2;55;154;223;48;2;54;154;223m\x1B[38;2;54;154;223;48;2;54;154;222m\x1B[48;2;54;154;223m     \x1B[38;2;54;154;223;48;2;54;154;222m\x1B[48;2;54;154;223m  \x1B[38;2;54;154;223;48;2;53;152;220m\x1B[38;2;54;154;223;48;2;20;58;82m\x1B[38;2;33;90;132;48;2;48;139;201m\x1B[38;2;13;37;54;48;2;54;154;223m\x1B[38;2;26;75;108;48;2;54;154;223m\x1B[38;2;37;108;156;48;2;54;154;223m\x1B[38;2;53;151;219;48;2;54;154;223m\x1B[48;2;54;154;223m     \x1B[38;2;54;154;223;48;2;54;154;221m\x1B[38;2;51;153;224;49m\x1B[49m                       \x1B[m
\x1B[49m     \x1B[38;2;14;65;105;49m\x1B[38;2;12;63;104;48;2;11;64;105m\x1B[48;2;12;63;104m  \x1B[38;2;12;61;101;48;2;12;63;104m\x1B[38;2;7;38;63;48;2;12;62;102m\x1B[49;38;2;8;41;68m\x1B[49;38;2;0;0;0m\x1B[38;2;54;155;225;49m\x1B[38;2;54;154;223;48;2;54;154;224m\x1B[38;2;54;154;223;48;2;54;154;222m\x1B[38;2;54;154;223;48;2;55;154;223m\x1B[48;2;54;154;223m \x1B[38;2;26;78;112;48;2;52;149;216m\x1B[49;38;2;28;81;117m\x1B[49m \x1B[38;2;55;155;226;49m\x1B[38;2;54;154;223;48;2;54;156;227m\x1B[48;2;54;154;223m    \x1B[38;2;19;56;80;48;2;54;153;222m\x1B[38;2;54;153;221;48;2;48;139;201m\x1B[38;2;55;154;223;48;2;54;154;223m\x1B[48;2;54;154;223m       \x1B[38;2;54;154;222;48;2;55;154;223m\x1B[48;2;54;154;223m  \x1B[38;2;44;127;184;48;2;52;153;222m\x1B[49m \x1B[49;38;2;0;0;0m\x1B[38;2;242;248;248;48;2;0;0;0m\x1B[38;2;255;255;255;48;2;26;71;104m\x1B[38;2;0;0;0;48;2;40;114;167m\x1B[38;2;28;83;119;48;2;54;154;223m\x1B[38;2;52;148;215;48;2;54;154;223m\x1B[48;2;54;154;223m  \x1B[38;2;53;154;222;48;2;53;154;223m\x1B[49m                       \x1B[m
\x1B[49m    \x1B[38;2;12;64;104;48;2;11;66;111m\x1B[48;2;12;63;104m   \x1B[38;2;6;37;62;48;2;12;63;105m\x1B[49;38;2;7;36;59m\x1B[49m  \x1B[38;2;54;154;223;48;2;54;152;222m\x1B[48;2;54;154;223m    \x1B[38;2;37;105;154;48;2;42;121;175m\x1B[49m \x1B[38;2;54;154;221;49m\x1B[38;2;54;154;223;48;2;53;154;225m\x1B[48;2;54;154;223m    \x1B[38;2;55;154;223;48;2;54;154;223m\x1B[38;2;38;112;164;48;2;54;153;222m\x1B[49;38;2;0;0;0m\x1B[38;2;45;132;191;48;2;51;148;214m\x1B[48;2;54;154;223m \x1B[38;2;54;154;222;48;2;54;154;223m\x1B[48;2;54;154;223m \x1B[38;2;54;154;223;48;2;54;154;222m\x1B[48;2;54;154;223m       \x1B[38;2;55;154;223;48;2;24;65;93m\x1B[38;2;51;153;226;49m\x1B[49m \x1B[38;2;9;9;9;48;2;217;219;219m\x1B[38;2;40;40;40;48;2;249;249;250m\x1B[49m  \x1B[49;38;2;0;2;2m\x1B[38;2;53;154;223;48;2;13;38;56m\x1B[38;2;54;154;223;48;2;22;62;91m\x1B[48;2;54;154;223m \x1B[38;2;54;154;223;48;2;56;155;226m\x1B[38;2;55;156;227;49m\x1B[49m                     \x1B[m
\x1B[49m   \x1B[38;2;12;62;105;48;2;15;60;105m\x1B[48;2;12;63;104m \x1B[38;2;12;62;103;48;2;12;63;104m\x1B[38;2;6;38;62;48;2;12;63;104m\x1B[49;38;2;6;35;60m\x1B[49m  \x1B[38;2;57;156;227;49m\x1B[38;2;54;154;223;48;2;55;154;223m\x1B[38;2;55;154;223;48;2;54;154;223m\x1B[48;2;54;154;223m   \x1B[38;2;51;146;211;48;2;54;154;223m\x1B[49;38;2;14;42;71m\x1B[49m \x1B[38;2;54;154;223;48;2;53;154;223m\x1B[48;2;54;154;223m    \x1B[38;2;54;154;223;48;2;54;155;223m\x1B[48;2;54;154;223m \x1B[38;2;25;70;95;48;2;35;100;146m\x1B[49m \x1B[38;2;0;0;0;48;2;34;100;143m\x1B[38;2;41;119;172;48;2;54;154;223m\x1B[48;2;54;154;223m  \x1B[38;2;54;154;223;48;2;55;154;223m\x1B[48;2;54;154;223m         \x1B[38;2;54;154;223;48;2;54;155;223m\x1B[48;2;54;154;223m \x1B[38;2;54;154;223;48;2;54;154;224m\x1B[38;2;54;154;223;48;2;55;153;222m\x1B[38;2;54;154;223;48;2;54;154;222m\x1B[38;2;54;154;222;49m\x1B[38;2;57;156;222;48;2;23;69;97m\x1B[38;2;35;99;144;48;2;54;154;223m\x1B[48;2;54;154;223m   \x1B[38;2;54;154;223;48;2;54;155;225m\x1B[38;2;54;154;224;49m\x1B[49m                   \x1B[m
\x1B[49m   \x1B[38;2;12;63;103;48;2;12;63;104m\x1B[38;2;8;40;66;48;2;12;63;104m\x1B[49;38;2;8;42;71m\x1B[49m    \x1B[38;2;50;145;209;48;2;53;154;219m\x1B[48;2;54;154;223m     \x1B[38;2;46;135;195;48;2;46;133;192m\x1B[49m \x1B[38;2;48;128;183;49m\x1B[48;2;54;154;223m \x1B[38;2;55;154;223;48;2;54;154;223m\x1B[48;2;54;154;223m    \x1B[38;2;52;148;214;48;2;54;154;223m\x1B[49m   \x1B[49;38;2;20;56;79m\x1B[38;2;4;8;13;48;2;47;133;192m\x1B[38;2;50;143;205;48;2;54;154;223m\x1B[38;2;53;151;219;48;2;54;154;223m\x1B[48;2;54;154;223m          \x1B[38;2;54;154;223;48;2;55;154;223m\x1B[48;2;54;154;223m     \x1B[38;2;54;154;223;48;2;42;123;179m\x1B[38;2;51;147;212;48;2;44;124;178m\x1B[48;2;54;154;223m    \x1B[38;2;54;154;223;48;2;54;153;223m\x1B[38;2;54;154;223;49m\x1B[49m                 \x1B[m
\x1B[49m  \x1B[38;2;0;21;31;48;2;11;64;106m\x1B[38;2;6;24;36;48;2;8;39;64m\x1B[49;38;2;0;0;16m\x1B[49m     \x1B[38;2;37;106;154;48;2;47;129;188m\x1B[48;2;54;154;223m     \x1B[38;2;53;152;221;48;2;51;143;208m\x1B[49m \x1B[38;2;28;90;131;48;2;38;119;174m\x1B[48;2;54;154;223m      \x1B[38;2;53;153;223;48;2;51;147;214m\x1B[49m     \x1B[49;38;2;0;0;0m\x1B[49;38;2;11;30;44m\x1B[49;38;2;8;23;35m\x1B[49;38;2;31;88;127m\x1B[38;2;0;0;0;48;2;50;143;207m\x1B[38;2;0;0;0;48;2;52;149;217m\x1B[38;2;1;0;0;48;2;52;149;215m\x1B[38;2;0;0;0;48;2;42;120;174m\x1B[49;38;2;13;37;54m\x1B[49;38;2;5;14;20m\x1B[38;2;0;0;0;48;2;37;105;151m\x1B[38;2;21;62;89;48;2;16;48;68m\x1B[38;2;25;75;108;48;2;28;78;113m\x1B[38;2;49;138;200;48;2;53;152;220m\x1B[38;2;48;138;199;48;2;54;154;223m\x1B[48;2;54;154;223m        \x1B[38;2;54;154;222;48;2;54;154;223m\x1B[48;2;54;154;223m \x1B[38;2;54;155;223;48;2;54;154;223m\x1B[38;2;54;154;223;48;2;55;154;224m\x1B[38;2;54;154;223;48;2;51;153;221m\x1B[38;2;54;155;232;49m\x1B[49m              \x1B[m
\x1B[49m          \x1B[38;2;36;97;140;48;2;45;128;184m\x1B[48;2;54;154;223m      \x1B[38;2;55;155;225;49m\x1B[49;38;2;20;59;78m\x1B[38;2;53;151;219;48;2;54;154;223m\x1B[48;2;54;154;223m   \x1B[38;2;54;154;222;48;2;55;154;223m\x1B[48;2;54;154;223m \x1B[38;2;53;154;223;48;2;54;154;222m\x1B[49m                  \x1B[49;38;2;10;29;44m\x1B[49;38;2;31;89;129m\x1B[38;2;12;39;58;48;2;54;154;223m\x1B[38;2;51;146;210;48;2;54;154;223m\x1B[48;2;54;154;223m       \x1B[38;2;53;153;224;48;2;28;82;119m\x1B[38;2;54;148;228;48;2;26;75;108m\x1B[38;2;31;90;131;48;2;52;150;217m\x1B[38;2;54;154;222;48;2;54;154;223m\x1B[48;2;54;154;223m \x1B[38;2;54;153;223;48;2;51;160;233m\x1B[49m             \x1B[m
\x1B[49m           \x1B[49;38;2;35;99;143m\x1B[38;2;46;132;190;48;2;54;154;223m\x1B[48;2;54;154;223m    \x1B[38;2;54;154;223;48;2;55;156;226m\x1B[38;2;55;151;221;49m\x1B[38;2;45;128;184;48;2;45;129;187m\x1B[48;2;54;154;223m   \x1B[38;2;55;154;223;48;2;54;154;223m\x1B[48;2;54;154;223m \x1B[38;2;54;154;222;48;2;52;153;223m\x1B[49m                     \x1B[38;2;21;57;81;48;2;43;126;183m\x1B[48;2;54;154;223m  \x1B[38;2;51;145;210;48;2;54;154;223m\x1B[38;2;0;3;4;48;2;54;154;223m\x1B[38;2;15;43;63;48;2;54;154;223m\x1B[38;2;54;153;221;48;2;54;154;223m\x1B[48;2;54;154;223m   \x1B[38;2;54;154;223;48;2;54;153;223m\x1B[38;2;54;154;223;48;2;51;147;214m\x1B[48;2;54;154;223m \x1B[38;2;31;91;131;48;2;53;150;217m\x1B[49m             \x1B[m
\x1B[49m            \x1B[49;38;2;10;36;51m\x1B[38;2;12;35;55;48;2;42;122;178m\x1B[38;2;37;105;153;48;2;54;154;223m\x1B[48;2;54;154;223m   \x1B[38;2;54;154;223;48;2;54;153;222m\x1B[38;2;50;142;206;48;2;46;131;191m\x1B[48;2;54;154;223m     \x1B[38;2;54;154;223;48;2;54;155;223m\x1B[38;2;54;154;224;48;2;54;154;227m\x1B[49m                     \x1B[38;2;32;88;128;48;2;54;153;222m\x1B[48;2;54;154;223m \x1B[38;2;54;155;223;48;2;54;154;223m\x1B[48;2;54;154;223m \x1B[38;2;54;154;223;48;2;56;151;223m\x1B[38;2;54;154;224;48;2;10;31;41m\x1B[38;2;51;144;205;48;2;20;57;83m\x1B[38;2;3;13;19;48;2;53;152;220m\x1B[38;2;25;70;102;48;2;54;154;223m\x1B[38;2;47;134;194;48;2;54;154;223m\x1B[38;2;54;152;221;48;2;54;154;223m\x1B[38;2;22;64;95;48;2;48;138;200m\x1B[49;38;2;0;17;34m\x1B[49m             \x1B[m
\x1B[49m              \x1B[49;38;2;0;5;10m\x1B[49;38;2;37;107;155m\x1B[38;2;8;25;37;48;2;54;154;223m\x1B[38;2;49;140;202;48;2;54;154;223m\x1B[48;2;54;154;223m      \x1B[38;2;54;154;223;48;2;54;155;223m\x1B[48;2;54;154;223m  \x1B[38;2;54;154;223;48;2;54;155;226m\x1B[49m                     \x1B[49;38;2;19;54;78m\x1B[49;38;2;35;100;145m\x1B[38;2;0;0;2;48;2;54;154;223m\x1B[38;2;8;23;34;48;2;54;154;223m\x1B[38;2;26;78;112;48;2;54;154;223m\x1B[38;2;16;48;71;48;2;54;154;223m\x1B[38;2;0;2;2;48;2;56;155;225m\x1B[49m \x1B[49;38;2;0;0;0m\x1B[49;38;2;0;2;3m\x1B[49m               \x1B[m
\x1B[49m                 \x1B[49;38;2;0;0;0m\x1B[38;2;0;0;0;48;2;36;100;145m\x1B[38;2;14;39;56;48;2;53;152;220m\x1B[38;2;53;152;220;48;2;54;154;223m\x1B[48;2;54;154;223m       \x1B[38;2;54;154;224;48;2;54;159;230m\x1B[49m                                             \x1B[m
\x1B[49m                    \x1B[49;38;2;7;26;33m\x1B[49;38;2;24;71;102m\x1B[38;2;27;79;113;48;2;54;154;223m\x1B[38;2;51;147;214;48;2;54;154;223m\x1B[48;2;54;154;223m    \x1B[38;2;54;154;223;48;2;54;154;224m\x1B[49m                                             \x1B[m
\x1B[49m                       \x1B[49;38;2;28;81;119m\x1B[38;2;29;81;117;48;2;53;150;217m\x1B[48;2;54;154;223m    \x1B[38;2;32;96;138;48;2;38;102;153m\x1B[49m            \x1B[38;2;217;217;217;49m\x1B[38;2;252;252;252;48;2;255;255;255m\x1B[38;2;252;252;252;48;2;253;253;253m\x1B[38;2;252;252;252;48;2;251;251;251m\x1B[38;2;255;255;255;49m\x1B[49m                           \x1B[m
\x1B[49m                         \x1B[38;2;33;96;142;48;2;47;134;194m\x1B[48;2;54;154;223m  \x1B[38;2;53;152;219;48;2;54;154;223m\x1B[49m              \x1B[38;2;0;0;0;48;2;142;142;142m\x1B[38;2;84;84;84;48;2;252;252;252m\x1B[38;2;249;249;249;48;2;252;252;252m\x1B[48;2;252;252;252m \x1B[38;2;252;252;252;48;2;254;255;254m\x1B[38;2;252;252;252;49m\x1B[38;2;251;251;251;49m\x1B[49m                        \x1B[m
\x1B[49m                         \x1B[49;38;2;13;51;77m\x1B[38;2;53;153;220;48;2;54;154;223m\x1B[48;2;54;154;223m \x1B[38;2;28;83;121;48;2;39;114;165m\x1B[49m                \x1B[49;38;2;48;48;48m\x1B[38;2;0;0;0;48;2;183;183;183m\x1B[38;2;150;150;150;48;2;252;252;252m\x1B[48;2;252;252;252m  \x1B[38;2;252;252;252;48;2;253;253;252m\x1B[38;2;254;254;254;49m\x1B[49m                      \x1B[m
\x1B[49m                          \x1B[38;2;41;118;172;48;2;50;143;207m\x1B[38;2;17;46;64;48;2;34;99;143m\x1B[49m                 \x1B[38;2;255;255;255;49m\x1B[38;2;252;252;252;48;2;255;255;255m\x1B[48;2;252;252;252m  \x1B[38;2;233;233;233;48;2;252;252;252m\x1B[38;2;8;8;8;48;2;241;241;241m\x1B[49;38;2;117;117;117m\x1B[49;38;2;0;0;0m\x1B[49m                     \x1B[m
\x1B[49m                          \x1B[49;38;2;11;22;33m\x1B[49m                \x1B[38;2;253;253;253;49m\x1B[38;2;252;252;252;48;2;253;253;253m\x1B[48;2;252;252;252m \x1B[38;2;252;252;252;48;2;253;252;252m\x1B[38;2;122;122;122;48;2;252;252;252m\x1B[38;2;8;8;8;48;2;150;150;150m\x1B[49;38;2;55;55;55m\x1B[49m  \x1B[38;2;247;247;247;48;2;252;252;252m\x1B[38;2;252;252;252;48;2;253;253;253m\x1B[48;2;252;252;252m \x1B[38;2;253;252;252;48;2;252;252;252m\x1B[48;2;252;252;252m    \x1B[38;2;252;252;252;48;2;251;251;251m\x1B[48;2;252;252;252m \x1B[38;2;248;248;248;48;2;252;252;252m\x1B[49m          \x1B[m
\x1B[49m                                          \x1B[49;38;2;134;134;134m\x1B[38;2;6;6;6;48;2;207;207;207m\x1B[38;2;163;163;163;48;2;252;252;252m\x1B[38;2;3;3;3;48;2;221;221;221m\x1B[49;38;2;61;61;61m\x1B[49m     \x1B[38;2;0;0;0;48;2;199;199;199m\x1B[38;2;0;1;0;48;2;206;206;206m\x1B[38;2;0;0;0;48;2;204;204;204m\x1B[38;2;0;0;0;48;2;203;203;203m\x1B[38;2;1;0;0;48;2;204;204;204m\x1B[38;2;0;0;0;48;2;204;204;204m\x1B[49;38;2;199;199;199m\x1B[49m          \x1B[m
`;class Zo{commands=new Map;adapter;renderer;constructor(s){this.adapter=s,this.initializeCommands()}setRenderer(s){this.renderer=s}displayStartupLogo(){return this.renderer?(this.getTerminalColors(),[{type:"info",content:"Welcome to Uniter.sh - Unified DeFi Terminal"},{type:"info",content:'Type "help" to see available commands.'}]):[{type:"info",content:" UNITER.SH - Unified DeFi Terminal"},{type:"info",content:'Type "help" to see available commands.'}]}getTerminalColors(){return typeof process<"u"&&process.stdout&&process.stdout.isTTY?{primary:"\x1B[36m",accent:"\x1B[94m",reset:"\x1B[0m"}:{primary:"",accent:"",reset:""}}initializeCommands(){[{name:"help",description:"Show available commands",aliases:["h","?"],handler:this.handleHelp.bind(this)},{name:"connect",description:"Connect wallet via WalletConnect",handler:this.handleConnect.bind(this)},{name:"disconnect",description:"Disconnect current wallet",handler:this.handleDisconnect.bind(this)},{name:"status",description:"Show wallet connection status",aliases:["st"],handler:this.handleStatus.bind(this)},{name:"scan",description:"Scan tokens on specific chain",args:["[chain]"],handler:this.handleScan.bind(this)},{name:"multichain",description:"Scan tokens across all chains",aliases:["mc","all"],handler:this.handleMultichain.bind(this)},{name:"chains",description:"List supported chains",handler:this.handleChains.bind(this)},{name:"clear",description:"Clear terminal screen",aliases:["cls"],handler:this.handleClear.bind(this)},{name:"exit",description:"Exit uniter.sh",aliases:["quit","q"],handler:this.handleExit.bind(this)}].forEach(u=>{this.commands.set(u.name,u),u.aliases&&u.aliases.forEach(w=>{this.commands.set(w,u)})})}async executeCommand(s){const u=s.trim().split(/\s+/),w=u[0]?.toLowerCase(),y=u.slice(1);if(!w)return[];const B=this.commands.get(w);if(!B)return[{type:"error",content:`Unknown command: ${w}. Type 'help' for available commands.`}];try{return await B.handler(y)}catch(x){return[{type:"error",content:`Command failed: ${x instanceof Error?x.message:String(x)}`}]}}getAutocompleteSuggestions(s){const u=s.trim().split(/\s+/),w=u[0]?.toLowerCase(),y=u.slice(1);if(u.length<=1)return Array.from(new Set(Array.from(this.commands.keys()))).filter(e=>e.startsWith(w||"")).sort();const B=this.commands.get(w);if(!B)return[];if(B.name==="scan"&&y.length===1){const e=Ei().map(h=>h.name.toLowerCase().replace(/\s+/g,"")),a=y[0]?.toLowerCase()||"";return e.filter(h=>h.startsWith(a)).sort()}return[]}completeInput(s){const u=this.getAutocompleteSuggestions(s);if(u.length===0)return s;const w=s.trim().split(/\s+/),y=w[w.length-1]||"",B=u.find(x=>x.toLowerCase().startsWith(y.toLowerCase()));return B?[...w.slice(0,-1),B].join(" "):s}getStartupBanner(){const s=this.adapter.getEnvironment(),u=s.isBrowser?"Web Terminal":"CLI Terminal",w=s.canConnectWallet?"Full Functionality":"Demo Mode",y=[];return y.push({type:"banner",content:Yo}),y.push({type:"info",content:`${u} - ${w}`},{type:"info",content:'Type "help" to see available commands'}),y}getPrompt(){const s=this.adapter.getCurrentSession();return s&&s.address?`${s.ensName||`${s.address.slice(0,6)}...${s.address.slice(-4)}`}@uniter.sh> `:"guest@uniter.sh> "}async handleHelp(){const s=this.adapter.getEnvironment(),u=[{type:"info",content:`Available Commands:
`}];return Array.from(new Set(Array.from(this.commands.values()))).forEach(y=>{const B=y.aliases?` (${y.aliases.join(", ")})`:"",x=y.args?` ${y.args.join(" ")}`:"";u.push({type:"text",content:`  ${y.name}${x}${B} - ${y.description}`})}),u.push({type:"info",content:`
Examples:
  connect
  scan polygon
  multichain
  help`}),s.canConnectWallet||u.push({type:"warning",content:`
Demo Mode: Limited functionality in web environment.
For full wallet integration, use the CLI version.`}),u}async handleConnect(){if(!this.adapter.getEnvironment().canConnectWallet)return[{type:"warning",content:`Wallet connection not available in web environment.
This is a demo terminal. Use the CLI version for real wallet connection.`}];if(this.adapter.isWalletConnected())return[{type:"warning",content:`Already connected to ${this.adapter.getCurrentSession()?.address||"wallet"}`}];try{const u=await this.adapter.connectWallet();return[{type:"success",content:"Wallet connected successfully"},{type:"info",content:`Address: ${u.address}`},{type:"info",content:`Chain: ${u.chainName||"Unknown"} (${u.chainId||"Unknown"})`}]}catch(u){return[{type:"error",content:`Connection failed: ${u instanceof Error?u.message:String(u)}`}]}}async handleDisconnect(){if(!this.adapter.getEnvironment().canConnectWallet)return[{type:"warning",content:"This is a demo terminal. No real wallet to disconnect."}];if(!this.adapter.isWalletConnected())return[{type:"warning",content:"No wallet currently connected"}];try{return await this.adapter.disconnectWallet(),[{type:"success",content:"Wallet disconnected successfully"}]}catch(u){return[{type:"error",content:`Disconnect failed: ${u instanceof Error?u.message:String(u)}`}]}}async handleStatus(){if(!this.adapter.getEnvironment().canConnectWallet)return[{type:"info",content:"Web Terminal Demo Mode"},{type:"warning",content:`No real wallet connection available.
Use CLI version for full functionality.`}];if(this.adapter.isWalletConnected()){const u=this.adapter.getCurrentSession();return[{type:"success",content:"Wallet connected"},{type:"info",content:`Address: ${u?.address||"Unknown"}`},{type:"info",content:`Chain: ${u?.chainName||"Unknown"} (${u?.chainId||"Unknown"})`}]}else return[{type:"warning",content:"No wallet connected"},{type:"warning",content:'Use "connect" to connect your wallet'}]}async handleScan(s){if(!this.adapter.getEnvironment().canScanTokens)return[{type:"warning",content:`  Token scanning not available in web environment.
This is a demo terminal. Use the CLI version for real token scanning.`}];const w=this.adapter.getCurrentSession();if(!w)return[{type:"error",content:'No wallet connected. Use "connect" first.'}];const y=s[0];if(!y)return[{type:"error",content:`Please specify a chain. Usage: scan <chain>
Example: scan polygon`}];try{const B=Jo(y),x=ti(B);if(this.renderer){const o=this.getTerminalColors();this.renderer.writeln(`Starting scan on ${x}...`)}const e=[],a=o=>{this.renderer&&(o.phase!=="pricing"?(this.renderer.clearProgress(),this.renderer.writeln(o.message)):this.renderer.updateProgress(o.message))},h=await this.adapter.scanTokens(w,B,a);this.renderer&&this.renderer.clearProgress();const f=Kt(h);return this.renderer&&f.forEach(o=>{this.renderer.writeln(o.content)}),e}catch(B){return this.renderer&&this.renderer.clearProgress(),[{type:"error",content:`Scan failed: ${B instanceof Error?B.message:String(B)}`}]}}async handleMultichain(){if(!this.adapter.getEnvironment().canScanTokens)return[{type:"warning",content:`  Multichain scanning not available in web environment.
This is a demo terminal. Use the CLI version for real multichain scanning.`}];const u=this.adapter.getCurrentSession();if(!u)return[{type:"error",content:'No wallet connected. Use "connect" first.'}];try{if(this.renderer){const x=this.getTerminalColors();this.renderer.writeln("Starting multichain scan across all supported chains...")}const w=[],y=x=>{this.renderer&&(x.phase!=="pricing"?(this.renderer.clearProgress(),this.renderer.writeln(x.message)):this.renderer.updateProgress(x.message))},B=await this.adapter.scanTokensMultiChain(u,y);if(this.renderer&&this.renderer.clearProgress(),B&&B.length>0){B.forEach(a=>{this.renderer&&this.renderer.writeln(`
 ${a.chainName||"Chain "+a.chainId} Results:`);const h=Kt(a);this.renderer&&h.forEach(f=>{this.renderer.writeln(f.content)})});const x=B.reduce((a,h)=>a+(h.totalUSD||0),0),e=B.reduce((a,h)=>a+(h.allTokens?.length||0),0);this.renderer&&(this.renderer.writeln(""),this.renderer.writeln(" Multi-Chain Summary:"),this.renderer.writeln(` Total Portfolio Value: $${x.toFixed(2)}`),this.renderer.writeln(` Total Tokens: ${e}`),this.renderer.writeln(` Chains Scanned: ${B.length}`))}else this.renderer&&this.renderer.writeln(" No tokens found across all chains");return w.push({type:"success",content:" Multichain scan complete!"}),w}catch(w){return[{type:"error",content:`Multichain scan failed: ${w instanceof Error?w.message:String(w)}`}]}}async handleChains(){const s=Ei(),u=[{type:"info",content:`  Supported Chains:
`}];return s.forEach((w,y)=>{u.push({type:"text",content:`  ${(y+1).toString().padStart(2)}. ${w.name.padEnd(20)} (ID: ${w.id})`})}),u.push({type:"info",content:`
 Total: ${s.length} chains supported`}),u}async handleClear(){return[{type:"text",content:"\x1B[2J\x1B[H"}]}async handleExit(){return[{type:"info",content:" Thanks for using uniter.sh!"}]}}class Qo{engine;renderer;currentInput="";constructor(s,u){this.engine=s,this.renderer=u,this.engine.setRenderer(u),this.setupEventHandlers()}setupEventHandlers(){this.renderer.onInput(async s=>{await this.handleCommand(s)}),this.renderer.onExit(()=>{this.handleExit()})}async start(){this.renderer.clear(),await this.showStartup(),this.showPrompt()}async showStartup(){const s=this.engine.getStartupBanner();this.renderOutputs(s),this.renderer.writeln(""),this.renderer.writeInfo(" Pro tip: Use Tab for command completion (coming soon)"),this.renderer.writeInfo(' Start with "connect" to connect your wallet');try{const u=await this.engine.executeCommand("status");this.renderOutputs(u)}catch{}}showPrompt(){const s=this.engine.getPrompt();this.renderer.showPrompt(s)}async handleCommand(s){const u=s.trim();if(!u){this.showPrompt();return}try{const w=await this.engine.executeCommand(u);if(this.renderOutputs(w),this.isExitCommand(u)){this.handleExit();return}}catch(w){this.renderer.writeError(` Error: ${w instanceof Error?w.message:String(w)}`)}this.renderer.writeln(""),this.showPrompt()}isExitCommand(s){return["exit","quit","q"].includes(s.toLowerCase())}handleExit(){this.renderer.writeln(""),this.renderer.writeInfo(" Thanks for using uniter.sh!")}renderOutputs(s){s.forEach(u=>{this.renderOutput(u)})}renderOutput(s){const u=s.content;switch(s.type){case"banner":this.renderer.writeBanner(u);break;case"success":this.renderer.writeSuccess(u);break;case"error":this.renderer.writeError(u);break;case"warning":this.renderer.writeWarning(u);break;case"info":this.renderer.writeInfo(u);break;case"table":this.renderer.write(u);break;case"text":default:this.renderer.write(u);break}u.endsWith(`
`)||this.renderer.writeln("")}getAutocompleteSuggestions(s){return this.engine.getAutocompleteSuggestions(s)}completeInput(s){return this.engine.completeInput(s)}}function ea(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function tc(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var s=t.default;if(typeof s=="function"){var u=function w(){var y=!1;try{y=this instanceof w}catch{}return y?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};u.prototype=s.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(t).forEach(function(w){var y=Object.getOwnPropertyDescriptor(t,w);Object.defineProperty(u,w,y.get?y:{enumerable:!0,get:function(){return t[w]}})}),u}var di={exports:{}},ns;function ta(){return ns||(ns=1,function(t,s){(function(u,w){t.exports=w()})(globalThis,()=>(()=>{var u={4567:function(x,e,a){var h=this&&this.__decorate||function(n,r,p,v){var _,C=arguments.length,g=C<3?r:v===null?v=Object.getOwnPropertyDescriptor(r,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(n,r,p,v);else for(var S=n.length-1;S>=0;S--)(_=n[S])&&(g=(C<3?_(g):C>3?_(r,p,g):_(r,p))||g);return C>3&&g&&Object.defineProperty(r,p,g),g},f=this&&this.__param||function(n,r){return function(p,v){r(p,v,n)}};Object.defineProperty(e,"__esModule",{value:!0}),e.AccessibilityManager=void 0;const o=a(9042),d=a(9924),m=a(844),b=a(4725),l=a(2585),i=a(3656);let c=e.AccessibilityManager=class extends m.Disposable{constructor(n,r,p,v){super(),this._terminal=n,this._coreBrowserService=p,this._renderService=v,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let _=0;_<this._terminal.rows;_++)this._rowElements[_]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[_]);if(this._topBoundaryFocusListener=_=>this._handleBoundaryFocus(_,0),this._bottomBoundaryFocusListener=_=>this._handleBoundaryFocus(_,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new d.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(_=>this._handleResize(_.rows))),this.register(this._terminal.onRender(_=>this._refreshRows(_.start,_.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(_=>this._handleChar(_))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(_=>this._handleTab(_))),this.register(this._terminal.onKey(_=>this._handleKey(_.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,i.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,m.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(n){for(let r=0;r<n;r++)this._handleChar(" ")}_handleChar(n){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==n&&(this._charsToAnnounce+=n):this._charsToAnnounce+=n,n===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=o.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(n){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(n)||this._charsToConsume.push(n)}_refreshRows(n,r){this._liveRegionDebouncer.refresh(n,r,this._terminal.rows)}_renderRows(n,r){const p=this._terminal.buffer,v=p.lines.length.toString();for(let _=n;_<=r;_++){const C=p.lines.get(p.ydisp+_),g=[],S=C?.translateToString(!0,void 0,void 0,g)||"",k=(p.ydisp+_+1).toString(),L=this._rowElements[_];L&&(S.length===0?(L.innerText="",this._rowColumns.set(L,[0,1])):(L.textContent=S,this._rowColumns.set(L,g)),L.setAttribute("aria-posinset",k),L.setAttribute("aria-setsize",v))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(n,r){const p=n.target,v=this._rowElements[r===0?1:this._rowElements.length-2];if(p.getAttribute("aria-posinset")===(r===0?"1":`${this._terminal.buffer.lines.length}`)||n.relatedTarget!==v)return;let _,C;if(r===0?(_=p,C=this._rowElements.pop(),this._rowContainer.removeChild(C)):(_=this._rowElements.shift(),C=p,this._rowContainer.removeChild(_)),_.removeEventListener("focus",this._topBoundaryFocusListener),C.removeEventListener("focus",this._bottomBoundaryFocusListener),r===0){const g=this._createAccessibilityTreeNode();this._rowElements.unshift(g),this._rowContainer.insertAdjacentElement("afterbegin",g)}else{const g=this._createAccessibilityTreeNode();this._rowElements.push(g),this._rowContainer.appendChild(g)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(r===0?-1:1),this._rowElements[r===0?1:this._rowElements.length-2].focus(),n.preventDefault(),n.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;const n=document.getSelection();if(!n)return;if(n.isCollapsed)return void(this._rowContainer.contains(n.anchorNode)&&this._terminal.clearSelection());if(!n.anchorNode||!n.focusNode)return void console.error("anchorNode and/or focusNode are null");let r={node:n.anchorNode,offset:n.anchorOffset},p={node:n.focusNode,offset:n.focusOffset};if((r.node.compareDocumentPosition(p.node)&Node.DOCUMENT_POSITION_PRECEDING||r.node===p.node&&r.offset>p.offset)&&([r,p]=[p,r]),r.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(r={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(r.node))return;const v=this._rowElements.slice(-1)[0];if(p.node.compareDocumentPosition(v)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(p={node:v,offset:v.textContent?.length??0}),!this._rowContainer.contains(p.node))return;const _=({node:S,offset:k})=>{const L=S instanceof Text?S.parentNode:S;let M=parseInt(L?.getAttribute("aria-posinset"),10)-1;if(isNaN(M))return console.warn("row is invalid. Race condition?"),null;const A=this._rowColumns.get(L);if(!A)return console.warn("columns is null. Race condition?"),null;let P=k<A.length?A[k]:A.slice(-1)[0]+1;return P>=this._terminal.cols&&(++M,P=0),{row:M,column:P}},C=_(r),g=_(p);if(C&&g){if(C.row>g.row||C.row===g.row&&C.column>=g.column)throw new Error("invalid range");this._terminal.select(C.column,C.row,(g.row-C.row)*this._terminal.cols-C.column+g.column)}}_handleResize(n){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let r=this._rowContainer.children.length;r<this._terminal.rows;r++)this._rowElements[r]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[r]);for(;this._rowElements.length>n;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const n=this._coreBrowserService.mainDocument.createElement("div");return n.setAttribute("role","listitem"),n.tabIndex=-1,this._refreshRowDimensions(n),n}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let n=0;n<this._terminal.rows;n++)this._refreshRowDimensions(this._rowElements[n])}}_refreshRowDimensions(n){n.style.height=`${this._renderService.dimensions.css.cell.height}px`}};e.AccessibilityManager=c=h([f(1,l.IInstantiationService),f(2,b.ICoreBrowserService),f(3,b.IRenderService)],c)},3614:(x,e)=>{function a(d){return d.replace(/\r?\n/g,"\r")}function h(d,m){return m?"\x1B[200~"+d+"\x1B[201~":d}function f(d,m,b,l){d=h(d=a(d),b.decPrivateModes.bracketedPasteMode&&l.rawOptions.ignoreBracketedPasteMode!==!0),b.triggerDataEvent(d,!0),m.value=""}function o(d,m,b){const l=b.getBoundingClientRect(),i=d.clientX-l.left-10,c=d.clientY-l.top-10;m.style.width="20px",m.style.height="20px",m.style.left=`${i}px`,m.style.top=`${c}px`,m.style.zIndex="1000",m.focus()}Object.defineProperty(e,"__esModule",{value:!0}),e.rightClickHandler=e.moveTextAreaUnderMouseCursor=e.paste=e.handlePasteEvent=e.copyHandler=e.bracketTextForPaste=e.prepareTextForTerminal=void 0,e.prepareTextForTerminal=a,e.bracketTextForPaste=h,e.copyHandler=function(d,m){d.clipboardData&&d.clipboardData.setData("text/plain",m.selectionText),d.preventDefault()},e.handlePasteEvent=function(d,m,b,l){d.stopPropagation(),d.clipboardData&&f(d.clipboardData.getData("text/plain"),m,b,l)},e.paste=f,e.moveTextAreaUnderMouseCursor=o,e.rightClickHandler=function(d,m,b,l,i){o(d,m,b),i&&l.rightClickSelect(d),m.value=l.selectionText,m.select()}},7239:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorContrastCache=void 0;const h=a(1505);e.ColorContrastCache=class{constructor(){this._color=new h.TwoKeyMap,this._css=new h.TwoKeyMap}setCss(f,o,d){this._css.set(f,o,d)}getCss(f,o){return this._css.get(f,o)}setColor(f,o,d){this._color.set(f,o,d)}getColor(f,o){return this._color.get(f,o)}clear(){this._color.clear(),this._css.clear()}}},3656:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.addDisposableDomListener=void 0,e.addDisposableDomListener=function(a,h,f,o){a.addEventListener(h,f,o);let d=!1;return{dispose:()=>{d||(d=!0,a.removeEventListener(h,f,o))}}}},3551:function(x,e,a){var h=this&&this.__decorate||function(c,n,r,p){var v,_=arguments.length,C=_<3?n:p===null?p=Object.getOwnPropertyDescriptor(n,r):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(c,n,r,p);else for(var g=c.length-1;g>=0;g--)(v=c[g])&&(C=(_<3?v(C):_>3?v(n,r,C):v(n,r))||C);return _>3&&C&&Object.defineProperty(n,r,C),C},f=this&&this.__param||function(c,n){return function(r,p){n(r,p,c)}};Object.defineProperty(e,"__esModule",{value:!0}),e.Linkifier=void 0;const o=a(3656),d=a(8460),m=a(844),b=a(2585),l=a(4725);let i=e.Linkifier=class extends m.Disposable{get currentLink(){return this._currentLink}constructor(c,n,r,p,v){super(),this._element=c,this._mouseService=n,this._renderService=r,this._bufferService=p,this._linkProviderService=v,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new d.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new d.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,m.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,m.toDisposable)(()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,o.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,o.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(c){this._lastMouseEvent=c;const n=this._positionFromMouseEvent(c,this._element,this._mouseService);if(!n)return;this._isMouseOut=!1;const r=c.composedPath();for(let p=0;p<r.length;p++){const v=r[p];if(v.classList.contains("xterm"))break;if(v.classList.contains("xterm-hover"))return}this._lastBufferCell&&n.x===this._lastBufferCell.x&&n.y===this._lastBufferCell.y||(this._handleHover(n),this._lastBufferCell=n)}_handleHover(c){if(this._activeLine!==c.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(c,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,c)||(this._clearCurrentLink(),this._askForLink(c,!0))}_askForLink(c,n){this._activeProviderReplies&&n||(this._activeProviderReplies?.forEach(p=>{p?.forEach(v=>{v.link.dispose&&v.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=c.y);let r=!1;for(const[p,v]of this._linkProviderService.linkProviders.entries())n?this._activeProviderReplies?.get(p)&&(r=this._checkLinkProviderResult(p,c,r)):v.provideLinks(c.y,_=>{if(this._isMouseOut)return;const C=_?.map(g=>({link:g}));this._activeProviderReplies?.set(p,C),r=this._checkLinkProviderResult(p,c,r),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(c.y,this._activeProviderReplies)})}_removeIntersectingLinks(c,n){const r=new Set;for(let p=0;p<n.size;p++){const v=n.get(p);if(v)for(let _=0;_<v.length;_++){const C=v[_],g=C.link.range.start.y<c?0:C.link.range.start.x,S=C.link.range.end.y>c?this._bufferService.cols:C.link.range.end.x;for(let k=g;k<=S;k++){if(r.has(k)){v.splice(_--,1);break}r.add(k)}}}}_checkLinkProviderResult(c,n,r){if(!this._activeProviderReplies)return r;const p=this._activeProviderReplies.get(c);let v=!1;for(let _=0;_<c;_++)this._activeProviderReplies.has(_)&&!this._activeProviderReplies.get(_)||(v=!0);if(!v&&p){const _=p.find(C=>this._linkAtPosition(C.link,n));_&&(r=!0,this._handleNewLink(_))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!r)for(let _=0;_<this._activeProviderReplies.size;_++){const C=this._activeProviderReplies.get(_)?.find(g=>this._linkAtPosition(g.link,n));if(C){r=!0,this._handleNewLink(C);break}}return r}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(c){if(!this._currentLink)return;const n=this._positionFromMouseEvent(c,this._element,this._mouseService);n&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,n)&&this._currentLink.link.activate(c,this._currentLink.link.text)}_clearCurrentLink(c,n){this._currentLink&&this._lastMouseEvent&&(!c||!n||this._currentLink.link.range.start.y>=c&&this._currentLink.link.range.end.y<=n)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,m.disposeArray)(this._linkCacheDisposables))}_handleNewLink(c){if(!this._lastMouseEvent)return;const n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._linkAtPosition(c.link,n)&&(this._currentLink=c,this._currentLink.state={decorations:{underline:c.link.decorations===void 0||c.link.decorations.underline,pointerCursor:c.link.decorations===void 0||c.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,c.link,this._lastMouseEvent),c.link.decorations={},Object.defineProperties(c.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:r=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==r&&(this._currentLink.state.decorations.pointerCursor=r,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",r))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:r=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==r&&(this._currentLink.state.decorations.underline=r,this._currentLink.state.isHovered&&this._fireUnderlineEvent(c.link,r))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(r=>{if(!this._currentLink)return;const p=r.start===0?0:r.start+1+this._bufferService.buffer.ydisp,v=this._bufferService.buffer.ydisp+1+r.end;if(this._currentLink.link.range.start.y>=p&&this._currentLink.link.range.end.y<=v&&(this._clearCurrentLink(p,v),this._lastMouseEvent)){const _=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);_&&this._askForLink(_,!1)}})))}_linkHover(c,n,r){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(n,!0),this._currentLink.state.decorations.pointerCursor&&c.classList.add("xterm-cursor-pointer")),n.hover&&n.hover(r,n.text)}_fireUnderlineEvent(c,n){const r=c.range,p=this._bufferService.buffer.ydisp,v=this._createLinkUnderlineEvent(r.start.x-1,r.start.y-p-1,r.end.x,r.end.y-p-1,void 0);(n?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(v)}_linkLeave(c,n,r){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(n,!1),this._currentLink.state.decorations.pointerCursor&&c.classList.remove("xterm-cursor-pointer")),n.leave&&n.leave(r,n.text)}_linkAtPosition(c,n){const r=c.range.start.y*this._bufferService.cols+c.range.start.x,p=c.range.end.y*this._bufferService.cols+c.range.end.x,v=n.y*this._bufferService.cols+n.x;return r<=v&&v<=p}_positionFromMouseEvent(c,n,r){const p=r.getCoords(c,n,this._bufferService.cols,this._bufferService.rows);if(p)return{x:p[0],y:p[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(c,n,r,p,v){return{x1:c,y1:n,x2:r,y2:p,cols:this._bufferService.cols,fg:v}}};e.Linkifier=i=h([f(1,l.IMouseService),f(2,l.IRenderService),f(3,b.IBufferService),f(4,l.ILinkProviderService)],i)},9042:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tooMuchOutput=e.promptLabel=void 0,e.promptLabel="Terminal input",e.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(x,e,a){var h=this&&this.__decorate||function(l,i,c,n){var r,p=arguments.length,v=p<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,c):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(l,i,c,n);else for(var _=l.length-1;_>=0;_--)(r=l[_])&&(v=(p<3?r(v):p>3?r(i,c,v):r(i,c))||v);return p>3&&v&&Object.defineProperty(i,c,v),v},f=this&&this.__param||function(l,i){return function(c,n){i(c,n,l)}};Object.defineProperty(e,"__esModule",{value:!0}),e.OscLinkProvider=void 0;const o=a(511),d=a(2585);let m=e.OscLinkProvider=class{constructor(l,i,c){this._bufferService=l,this._optionsService=i,this._oscLinkService=c}provideLinks(l,i){const c=this._bufferService.buffer.lines.get(l-1);if(!c)return void i(void 0);const n=[],r=this._optionsService.rawOptions.linkHandler,p=new o.CellData,v=c.getTrimmedLength();let _=-1,C=-1,g=!1;for(let S=0;S<v;S++)if(C!==-1||c.hasContent(S)){if(c.loadCell(S,p),p.hasExtendedAttrs()&&p.extended.urlId){if(C===-1){C=S,_=p.extended.urlId;continue}g=p.extended.urlId!==_}else C!==-1&&(g=!0);if(g||C!==-1&&S===v-1){const k=this._oscLinkService.getLinkData(_)?.uri;if(k){const L={start:{x:C+1,y:l},end:{x:S+(g||S!==v-1?0:1),y:l}};let M=!1;if(!r?.allowNonHttpProtocols)try{const A=new URL(k);["http:","https:"].includes(A.protocol)||(M=!0)}catch{M=!0}M||n.push({text:k,range:L,activate:(A,P)=>r?r.activate(A,P,L):b(0,P),hover:(A,P)=>r?.hover?.(A,P,L),leave:(A,P)=>r?.leave?.(A,P,L)})}g=!1,p.hasExtendedAttrs()&&p.extended.urlId?(C=S,_=p.extended.urlId):(C=-1,_=-1)}}i(n)}};function b(l,i){if(confirm(`Do you want to navigate to ${i}?

WARNING: This link could potentially be dangerous`)){const c=window.open();if(c){try{c.opener=null}catch{}c.location.href=i}else console.warn("Opening link blocked as opener could not be cleared")}}e.OscLinkProvider=m=h([f(0,d.IBufferService),f(1,d.IOptionsService),f(2,d.IOscLinkService)],m)},6193:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RenderDebouncer=void 0,e.RenderDebouncer=class{constructor(a,h){this._renderCallback=a,this._coreBrowserService=h,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(a,h,f){this._rowCount=f,a=a!==void 0?a:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const a=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,h),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},3236:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;const h=a(3614),f=a(3656),o=a(3551),d=a(9042),m=a(3730),b=a(1680),l=a(3107),i=a(5744),c=a(2950),n=a(1296),r=a(428),p=a(4269),v=a(5114),_=a(8934),C=a(3230),g=a(9312),S=a(4725),k=a(6731),L=a(8055),M=a(8969),A=a(8460),P=a(844),F=a(6114),U=a(8437),H=a(2584),$=a(7399),E=a(5941),R=a(9074),T=a(2585),I=a(5435),N=a(4567),j=a(779);class K extends M.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(O={}){super(O),this.browser=F,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new P.MutableDisposable),this._onCursorMove=this.register(new A.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new A.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new A.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new A.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new A.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new A.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new A.EventEmitter),this._onBlur=this.register(new A.EventEmitter),this._onA11yCharEmitter=this.register(new A.EventEmitter),this._onA11yTabEmitter=this.register(new A.EventEmitter),this._onWillOpen=this.register(new A.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(R.DecorationService),this._instantiationService.setService(T.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(j.LinkProviderService),this._instantiationService.setService(S.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(m.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((D,W)=>this.refresh(D,W))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(D=>this._reportWindowsOptions(D))),this.register(this._inputHandler.onColor(D=>this._handleColorEvent(D))),this.register((0,A.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,A.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,A.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,A.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(D=>this._afterResize(D.cols,D.rows))),this.register((0,P.toDisposable)(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}_handleColorEvent(O){if(this._themeService)for(const D of O){let W,z="";switch(D.index){case 256:W="foreground",z="10";break;case 257:W="background",z="11";break;case 258:W="cursor",z="12";break;default:W="ansi",z="4;"+D.index}switch(D.type){case 0:const q=L.color.toColorRGB(W==="ansi"?this._themeService.colors.ansi[D.index]:this._themeService.colors[W]);this.coreService.triggerDataEvent(`${H.C0.ESC}]${z};${(0,E.toRgbString)(q)}${H.C1_ESCAPED.ST}`);break;case 1:if(W==="ansi")this._themeService.modifyColors(G=>G.ansi[D.index]=L.channels.toColor(...D.color));else{const G=W;this._themeService.modifyColors(ee=>ee[G]=L.channels.toColor(...D.color))}break;case 2:this._themeService.restoreColor(D.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(O){O?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(N.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(O){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(H.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(H.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const O=this.buffer.ybase+this.buffer.y,D=this.buffer.lines.get(O);if(!D)return;const W=Math.min(this.buffer.x,this.cols-1),z=this._renderService.dimensions.css.cell.height,q=D.getWidth(W),G=this._renderService.dimensions.css.cell.width*q,ee=this.buffer.y*this._renderService.dimensions.css.cell.height,Q=W*this._renderService.dimensions.css.cell.width;this.textarea.style.left=Q+"px",this.textarea.style.top=ee+"px",this.textarea.style.width=G+"px",this.textarea.style.height=z+"px",this.textarea.style.lineHeight=z+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,f.addDisposableDomListener)(this.element,"copy",D=>{this.hasSelection()&&(0,h.copyHandler)(D,this._selectionService)}));const O=D=>(0,h.handlePasteEvent)(D,this.textarea,this.coreService,this.optionsService);this.register((0,f.addDisposableDomListener)(this.textarea,"paste",O)),this.register((0,f.addDisposableDomListener)(this.element,"paste",O)),F.isFirefox?this.register((0,f.addDisposableDomListener)(this.element,"mousedown",D=>{D.button===2&&(0,h.rightClickHandler)(D,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,f.addDisposableDomListener)(this.element,"contextmenu",D=>{(0,h.rightClickHandler)(D,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),F.isLinux&&this.register((0,f.addDisposableDomListener)(this.element,"auxclick",D=>{D.button===1&&(0,h.moveTextAreaUnderMouseCursor)(D,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,f.addDisposableDomListener)(this.textarea,"keyup",O=>this._keyUp(O),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keydown",O=>this._keyDown(O),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keypress",O=>this._keyPress(O),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionupdate",O=>this._compositionHelper.compositionupdate(O))),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,f.addDisposableDomListener)(this.textarea,"input",O=>this._inputEvent(O),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(O){if(!O)throw new Error("Terminal requires a parent element.");if(O.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=O.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),O.appendChild(this.element);const D=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),D.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,f.addDisposableDomListener)(this.screenElement,"mousemove",W=>this.updateCursorStyle(W))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),D.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",d.promptLabel),F.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(v.CoreBrowserService,this.textarea,O.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(S.ICoreBrowserService,this._coreBrowserService),this.register((0,f.addDisposableDomListener)(this.textarea,"focus",W=>this._handleTextAreaFocus(W))),this.register((0,f.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(r.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(S.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(k.ThemeService),this._instantiationService.setService(S.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(p.CharacterJoinerService),this._instantiationService.setService(S.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(C.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(S.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(W=>this._onRender.fire(W))),this.onResize(W=>this._renderService.resize(W.cols,W.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(c.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(_.MouseService),this._instantiationService.setService(S.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(o.Linkifier,this.screenElement)),this.element.appendChild(D);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(b.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(W=>this.scrollLines(W.amount,W.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(g.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(S.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(W=>this.scrollLines(W.amount,W.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(W=>this._renderService.handleSelectionChanged(W.start,W.end,W.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(W=>{this.textarea.value=W,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(W=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,f.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(l.BufferDecorationRenderer,this.screenElement)),this.register((0,f.addDisposableDomListener)(this.element,"mousedown",W=>this._selectionService.handleMouseDown(W))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(N.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",W=>this._handleScreenReaderModeOptionChange(W))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(i.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",W=>{!this._overviewRulerRenderer&&W&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(i.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(n.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const O=this,D=this.element;function W(G){const ee=O._mouseService.getMouseReportCoords(G,O.screenElement);if(!ee)return!1;let Q,oe;switch(G.overrideType||G.type){case"mousemove":oe=32,G.buttons===void 0?(Q=3,G.button!==void 0&&(Q=G.button<3?G.button:3)):Q=1&G.buttons?0:4&G.buttons?1:2&G.buttons?2:3;break;case"mouseup":oe=0,Q=G.button<3?G.button:3;break;case"mousedown":oe=1,Q=G.button<3?G.button:3;break;case"wheel":if(O._customWheelEventHandler&&O._customWheelEventHandler(G)===!1||O.viewport.getLinesScrolled(G)===0)return!1;oe=G.deltaY<0?0:1,Q=4;break;default:return!1}return!(oe===void 0||Q===void 0||Q>4)&&O.coreMouseService.triggerMouseEvent({col:ee.col,row:ee.row,x:ee.x,y:ee.y,button:Q,action:oe,ctrl:G.ctrlKey,alt:G.altKey,shift:G.shiftKey})}const z={mouseup:null,wheel:null,mousedrag:null,mousemove:null},q={mouseup:G=>(W(G),G.buttons||(this._document.removeEventListener("mouseup",z.mouseup),z.mousedrag&&this._document.removeEventListener("mousemove",z.mousedrag)),this.cancel(G)),wheel:G=>(W(G),this.cancel(G,!0)),mousedrag:G=>{G.buttons&&W(G)},mousemove:G=>{G.buttons||W(G)}};this.register(this.coreMouseService.onProtocolChange(G=>{G?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(G)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&G?z.mousemove||(D.addEventListener("mousemove",q.mousemove),z.mousemove=q.mousemove):(D.removeEventListener("mousemove",z.mousemove),z.mousemove=null),16&G?z.wheel||(D.addEventListener("wheel",q.wheel,{passive:!1}),z.wheel=q.wheel):(D.removeEventListener("wheel",z.wheel),z.wheel=null),2&G?z.mouseup||(z.mouseup=q.mouseup):(this._document.removeEventListener("mouseup",z.mouseup),z.mouseup=null),4&G?z.mousedrag||(z.mousedrag=q.mousedrag):(this._document.removeEventListener("mousemove",z.mousedrag),z.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,f.addDisposableDomListener)(D,"mousedown",G=>{if(G.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(G))return W(G),z.mouseup&&this._document.addEventListener("mouseup",z.mouseup),z.mousedrag&&this._document.addEventListener("mousemove",z.mousedrag),this.cancel(G)})),this.register((0,f.addDisposableDomListener)(D,"wheel",G=>{if(!z.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(G)===!1)return!1;if(!this.buffer.hasScrollback){const ee=this.viewport.getLinesScrolled(G);if(ee===0)return;const Q=H.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(G.deltaY<0?"A":"B");let oe="";for(let le=0;le<Math.abs(ee);le++)oe+=Q;return this.coreService.triggerDataEvent(oe,!0),this.cancel(G,!0)}return this.viewport.handleWheel(G)?this.cancel(G):void 0}},{passive:!1})),this.register((0,f.addDisposableDomListener)(D,"touchstart",G=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(G),this.cancel(G)},{passive:!0})),this.register((0,f.addDisposableDomListener)(D,"touchmove",G=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(G)?void 0:this.cancel(G)},{passive:!1}))}refresh(O,D){this._renderService?.refreshRows(O,D)}updateCursorStyle(O){this._selectionService?.shouldColumnSelect(O)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(O,D,W=0){W===1?(super.scrollLines(O,D,W),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(O)}paste(O){(0,h.paste)(O,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(O){this._customKeyEventHandler=O}attachCustomWheelEventHandler(O){this._customWheelEventHandler=O}registerLinkProvider(O){return this._linkProviderService.registerLinkProvider(O)}registerCharacterJoiner(O){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const D=this._characterJoinerService.register(O);return this.refresh(0,this.rows-1),D}deregisterCharacterJoiner(O){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(O)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(O){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+O)}registerDecoration(O){return this._decorationService.registerDecoration(O)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(O,D,W){this._selectionService.setSelection(O,D,W)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(O,D){this._selectionService?.selectLines(O,D)}_keyDown(O){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1)return!1;const D=this.browser.isMac&&this.options.macOptionIsMeta&&O.altKey;if(!D&&!this._compositionHelper.keydown(O))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;D||O.key!=="Dead"&&O.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const W=(0,$.evaluateKeyboardEvent)(O,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(O),W.type===3||W.type===2){const z=this.rows-1;return this.scrollLines(W.type===2?-z:z),this.cancel(O,!0)}return W.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,O)||(W.cancel&&this.cancel(O,!0),!W.key||!!(O.key&&!O.ctrlKey&&!O.altKey&&!O.metaKey&&O.key.length===1&&O.key.charCodeAt(0)>=65&&O.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(W.key!==H.C0.ETX&&W.key!==H.C0.CR||(this.textarea.value=""),this._onKey.fire({key:W.key,domEvent:O}),this._showCursor(),this.coreService.triggerDataEvent(W.key,!0),!this.optionsService.rawOptions.screenReaderMode||O.altKey||O.ctrlKey?this.cancel(O,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(O,D){const W=O.isMac&&!this.options.macOptionIsMeta&&D.altKey&&!D.ctrlKey&&!D.metaKey||O.isWindows&&D.altKey&&D.ctrlKey&&!D.metaKey||O.isWindows&&D.getModifierState("AltGraph");return D.type==="keypress"?W:W&&(!D.keyCode||D.keyCode>47)}_keyUp(O){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1||(function(D){return D.keyCode===16||D.keyCode===17||D.keyCode===18}(O)||this.focus(),this.updateCursorStyle(O),this._keyPressHandled=!1)}_keyPress(O){let D;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1)return!1;if(this.cancel(O),O.charCode)D=O.charCode;else if(O.which===null||O.which===void 0)D=O.keyCode;else{if(O.which===0||O.charCode===0)return!1;D=O.which}return!(!D||(O.altKey||O.ctrlKey||O.metaKey)&&!this._isThirdLevelShift(this.browser,O)||(D=String.fromCharCode(D),this._onKey.fire({key:D,domEvent:O}),this._showCursor(),this.coreService.triggerDataEvent(D,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(O){if(O.data&&O.inputType==="insertText"&&(!O.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const D=O.data;return this.coreService.triggerDataEvent(D,!0),this.cancel(O),!0}return!1}resize(O,D){O!==this.cols||D!==this.rows?super.resize(O,D):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(O,D){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let O=1;O<this.rows;O++)this.buffer.lines.push(this.buffer.getBlankLine(U.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const O=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=O,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(H.C0.ESC+"[I"):this.coreService.triggerDataEvent(H.C0.ESC+"[O")}_reportWindowsOptions(O){if(this._renderService)switch(O){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const D=this._renderService.dimensions.css.canvas.width.toFixed(0),W=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${H.C0.ESC}[4;${W};${D}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const z=this._renderService.dimensions.css.cell.width.toFixed(0),q=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${H.C0.ESC}[6;${q};${z}t`)}}cancel(O,D){if(this.options.cancelEvents||D)return O.preventDefault(),O.stopPropagation(),!1}}e.Terminal=K},9924:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TimeBasedDebouncer=void 0,e.TimeBasedDebouncer=class{constructor(a,h=1e3){this._renderCallback=a,this._debounceThresholdMS=h,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,h,f){this._rowCount=f,a=a!==void 0?a:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h;const o=Date.now();if(o-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=o,this._innerRefresh();else if(!this._additionalRefreshRequested){const d=o-this._lastRefreshMs,m=this._debounceThresholdMS-d;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},m)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const a=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,h)}}},1680:function(x,e,a){var h=this&&this.__decorate||function(c,n,r,p){var v,_=arguments.length,C=_<3?n:p===null?p=Object.getOwnPropertyDescriptor(n,r):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(c,n,r,p);else for(var g=c.length-1;g>=0;g--)(v=c[g])&&(C=(_<3?v(C):_>3?v(n,r,C):v(n,r))||C);return _>3&&C&&Object.defineProperty(n,r,C),C},f=this&&this.__param||function(c,n){return function(r,p){n(r,p,c)}};Object.defineProperty(e,"__esModule",{value:!0}),e.Viewport=void 0;const o=a(3656),d=a(4725),m=a(8460),b=a(844),l=a(2585);let i=e.Viewport=class extends b.Disposable{constructor(c,n,r,p,v,_,C,g){super(),this._viewportElement=c,this._scrollArea=n,this._bufferService=r,this._optionsService=p,this._charSizeService=v,this._renderService=_,this._coreBrowserService=C,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new m.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,o.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(S=>this._activeBuffer=S.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(S=>this._renderDimensions=S)),this._handleThemeChange(g.colors),this.register(g.onChangeColors(S=>this._handleThemeChange(S))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(c){this._viewportElement.style.backgroundColor=c.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(c){if(c)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const n=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==n&&(this._lastRecordedBufferHeight=n,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const c=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==c&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=c),this._refreshAnimationFrame=null}syncScrollArea(c=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(c);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(c)}_handleScroll(c){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const n=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:n,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const c=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(c*(this._smoothScrollState.target-this._smoothScrollState.origin)),c<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(c,n){const r=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(n<0&&this._viewportElement.scrollTop!==0||n>0&&r<this._lastRecordedBufferHeight)||(c.cancelable&&c.preventDefault(),!1)}handleWheel(c){const n=this._getPixelsScrolled(c);return n!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+n:this._smoothScrollState.target+=n,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=n,this._bubbleScroll(c,n))}scrollLines(c){if(c!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const n=c*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+n,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:c,suppressScrollEvent:!1})}_getPixelsScrolled(c){if(c.deltaY===0||c.shiftKey)return 0;let n=this._applyScrollModifier(c.deltaY,c);return c.deltaMode===WheelEvent.DOM_DELTA_LINE?n*=this._currentRowHeight:c.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(n*=this._currentRowHeight*this._bufferService.rows),n}getBufferElements(c,n){let r,p="";const v=[],_=n??this._bufferService.buffer.lines.length,C=this._bufferService.buffer.lines;for(let g=c;g<_;g++){const S=C.get(g);if(!S)continue;const k=C.get(g+1)?.isWrapped;if(p+=S.translateToString(!k),!k||g===C.length-1){const L=document.createElement("div");L.textContent=p,v.push(L),p.length>0&&(r=L),p=""}}return{bufferElements:v,cursorElement:r}}getLinesScrolled(c){if(c.deltaY===0||c.shiftKey)return 0;let n=this._applyScrollModifier(c.deltaY,c);return c.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(n/=this._currentRowHeight+0,this._wheelPartialScroll+=n,n=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):c.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(n*=this._bufferService.rows),n}_applyScrollModifier(c,n){const r=this._optionsService.rawOptions.fastScrollModifier;return r==="alt"&&n.altKey||r==="ctrl"&&n.ctrlKey||r==="shift"&&n.shiftKey?c*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:c*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(c){this._lastTouchY=c.touches[0].pageY}handleTouchMove(c){const n=this._lastTouchY-c.touches[0].pageY;return this._lastTouchY=c.touches[0].pageY,n!==0&&(this._viewportElement.scrollTop+=n,this._bubbleScroll(c,n))}};e.Viewport=i=h([f(2,l.IBufferService),f(3,l.IOptionsService),f(4,d.ICharSizeService),f(5,d.IRenderService),f(6,d.ICoreBrowserService),f(7,d.IThemeService)],i)},3107:function(x,e,a){var h=this&&this.__decorate||function(l,i,c,n){var r,p=arguments.length,v=p<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,c):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(l,i,c,n);else for(var _=l.length-1;_>=0;_--)(r=l[_])&&(v=(p<3?r(v):p>3?r(i,c,v):r(i,c))||v);return p>3&&v&&Object.defineProperty(i,c,v),v},f=this&&this.__param||function(l,i){return function(c,n){i(c,n,l)}};Object.defineProperty(e,"__esModule",{value:!0}),e.BufferDecorationRenderer=void 0;const o=a(4725),d=a(844),m=a(2585);let b=e.BufferDecorationRenderer=class extends d.Disposable{constructor(l,i,c,n,r){super(),this._screenElement=l,this._bufferService=i,this._coreBrowserService=c,this._decorationService=n,this._renderService=r,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(p=>this._removeDecoration(p))),this.register((0,d.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const l of this._decorationService.decorations)this._renderDecoration(l);this._dimensionsChanged=!1}_renderDecoration(l){this._refreshStyle(l),this._dimensionsChanged&&this._refreshXPosition(l)}_createElement(l){const i=this._coreBrowserService.mainDocument.createElement("div");i.classList.add("xterm-decoration"),i.classList.toggle("xterm-decoration-top-layer",l?.options?.layer==="top"),i.style.width=`${Math.round((l.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=(l.options.height||1)*this._renderService.dimensions.css.cell.height+"px",i.style.top=(l.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const c=l.options.x??0;return c&&c>this._bufferService.cols&&(i.style.display="none"),this._refreshXPosition(l,i),i}_refreshStyle(l){const i=l.marker.line-this._bufferService.buffers.active.ydisp;if(i<0||i>=this._bufferService.rows)l.element&&(l.element.style.display="none",l.onRenderEmitter.fire(l.element));else{let c=this._decorationElements.get(l);c||(c=this._createElement(l),l.element=c,this._decorationElements.set(l,c),this._container.appendChild(c),l.onDispose(()=>{this._decorationElements.delete(l),c.remove()})),c.style.top=i*this._renderService.dimensions.css.cell.height+"px",c.style.display=this._altBufferIsActive?"none":"block",l.onRenderEmitter.fire(c)}}_refreshXPosition(l,i=l.element){if(!i)return;const c=l.options.x??0;(l.options.anchor||"left")==="right"?i.style.right=c?c*this._renderService.dimensions.css.cell.width+"px":"":i.style.left=c?c*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(l){this._decorationElements.get(l)?.remove(),this._decorationElements.delete(l),l.dispose()}};e.BufferDecorationRenderer=b=h([f(1,m.IBufferService),f(2,o.ICoreBrowserService),f(3,m.IDecorationService),f(4,o.IRenderService)],b)},5871:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorZoneStore=void 0,e.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(const h of this._zones)if(h.color===a.options.overviewRulerOptions.color&&h.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(h,a.marker.line))return;if(this._lineAdjacentToZone(h,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(h,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,h){return h>=a.startBufferLine&&h<=a.endBufferLine}_lineAdjacentToZone(a,h,f){return h>=a.startBufferLine-this._linePadding[f||"full"]&&h<=a.endBufferLine+this._linePadding[f||"full"]}_addLineToZone(a,h){a.startBufferLine=Math.min(a.startBufferLine,h),a.endBufferLine=Math.max(a.endBufferLine,h)}}},5744:function(x,e,a){var h=this&&this.__decorate||function(r,p,v,_){var C,g=arguments.length,S=g<3?p:_===null?_=Object.getOwnPropertyDescriptor(p,v):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(r,p,v,_);else for(var k=r.length-1;k>=0;k--)(C=r[k])&&(S=(g<3?C(S):g>3?C(p,v,S):C(p,v))||S);return g>3&&S&&Object.defineProperty(p,v,S),S},f=this&&this.__param||function(r,p){return function(v,_){p(v,_,r)}};Object.defineProperty(e,"__esModule",{value:!0}),e.OverviewRulerRenderer=void 0;const o=a(5871),d=a(4725),m=a(844),b=a(2585),l={full:0,left:0,center:0,right:0},i={full:0,left:0,center:0,right:0},c={full:0,left:0,center:0,right:0};let n=e.OverviewRulerRenderer=class extends m.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(r,p,v,_,C,g,S){super(),this._viewportElement=r,this._screenElement=p,this._bufferService=v,this._decorationService=_,this._renderService=C,this._optionsService=g,this._coreBrowserService=S,this._colorZoneStore=new o.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const k=this._canvas.getContext("2d");if(!k)throw new Error("Ctx cannot be null");this._ctx=k,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,m.toDisposable)(()=>{this._canvas?.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const r=Math.floor(this._canvas.width/3),p=Math.ceil(this._canvas.width/3);i.full=this._canvas.width,i.left=r,i.center=p,i.right=r,this._refreshDrawHeightConstants(),c.full=0,c.left=0,c.center=i.left,c.right=i.left+i.center}_refreshDrawHeightConstants(){l.full=Math.round(2*this._coreBrowserService.dpr);const r=this._canvas.height/this._bufferService.buffer.lines.length,p=Math.round(Math.max(Math.min(r,12),6)*this._coreBrowserService.dpr);l.left=p,l.center=p,l.right=p}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const p of this._decorationService.decorations)this._colorZoneStore.addDecoration(p);this._ctx.lineWidth=1;const r=this._colorZoneStore.zones;for(const p of r)p.position!=="full"&&this._renderColorZone(p);for(const p of r)p.position==="full"&&this._renderColorZone(p);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(r){this._ctx.fillStyle=r.color,this._ctx.fillRect(c[r.position||"full"],Math.round((this._canvas.height-1)*(r.startBufferLine/this._bufferService.buffers.active.lines.length)-l[r.position||"full"]/2),i[r.position||"full"],Math.round((this._canvas.height-1)*((r.endBufferLine-r.startBufferLine)/this._bufferService.buffers.active.lines.length)+l[r.position||"full"]))}_queueRefresh(r,p){this._shouldUpdateDimensions=r||this._shouldUpdateDimensions,this._shouldUpdateAnchor=p||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};e.OverviewRulerRenderer=n=h([f(2,b.IBufferService),f(3,b.IDecorationService),f(4,d.IRenderService),f(5,b.IOptionsService),f(6,d.ICoreBrowserService)],n)},2950:function(x,e,a){var h=this&&this.__decorate||function(l,i,c,n){var r,p=arguments.length,v=p<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,c):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(l,i,c,n);else for(var _=l.length-1;_>=0;_--)(r=l[_])&&(v=(p<3?r(v):p>3?r(i,c,v):r(i,c))||v);return p>3&&v&&Object.defineProperty(i,c,v),v},f=this&&this.__param||function(l,i){return function(c,n){i(c,n,l)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CompositionHelper=void 0;const o=a(4725),d=a(2585),m=a(2584);let b=e.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(l,i,c,n,r,p){this._textarea=l,this._compositionView=i,this._bufferService=c,this._optionsService=n,this._coreService=r,this._renderService=p,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(l){this._compositionView.textContent=l.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(l){if(this._isComposing||this._isSendingComposition){if(l.keyCode===229||l.keyCode===16||l.keyCode===17||l.keyCode===18)return!1;this._finalizeComposition(!1)}return l.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(l){if(this._compositionView.classList.remove("active"),this._isComposing=!1,l){const i={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let c;this._isSendingComposition=!1,i.start+=this._dataAlreadySent.length,c=this._isComposing?this._textarea.value.substring(i.start,i.end):this._textarea.value.substring(i.start),c.length>0&&this._coreService.triggerDataEvent(c,!0)}},0)}else{this._isSendingComposition=!1;const i=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(i,!0)}}_handleAnyTextareaChanges(){const l=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const i=this._textarea.value,c=i.replace(l,"");this._dataAlreadySent=c,i.length>l.length?this._coreService.triggerDataEvent(c,!0):i.length<l.length?this._coreService.triggerDataEvent(`${m.C0.DEL}`,!0):i.length===l.length&&i!==l&&this._coreService.triggerDataEvent(i,!0)}},0)}updateCompositionElements(l){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const i=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),c=this._renderService.dimensions.css.cell.height,n=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=i*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=n+"px",this._compositionView.style.height=c+"px",this._compositionView.style.lineHeight=c+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const p=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=n+"px",this._textarea.style.width=Math.max(p.width,1)+"px",this._textarea.style.height=Math.max(p.height,1)+"px",this._textarea.style.lineHeight=p.height+"px"}l||setTimeout(()=>this.updateCompositionElements(!0),0)}}};e.CompositionHelper=b=h([f(2,d.IBufferService),f(3,d.IOptionsService),f(4,d.ICoreService),f(5,o.IRenderService)],b)},9806:(x,e)=>{function a(h,f,o){const d=o.getBoundingClientRect(),m=h.getComputedStyle(o),b=parseInt(m.getPropertyValue("padding-left")),l=parseInt(m.getPropertyValue("padding-top"));return[f.clientX-d.left-b,f.clientY-d.top-l]}Object.defineProperty(e,"__esModule",{value:!0}),e.getCoords=e.getCoordsRelativeToElement=void 0,e.getCoordsRelativeToElement=a,e.getCoords=function(h,f,o,d,m,b,l,i,c){if(!b)return;const n=a(h,f,o);return n?(n[0]=Math.ceil((n[0]+(c?l/2:0))/l),n[1]=Math.ceil(n[1]/i),n[0]=Math.min(Math.max(n[0],1),d+(c?1:0)),n[1]=Math.min(Math.max(n[1],1),m),n):void 0}},9504:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.moveToCellSequence=void 0;const h=a(2584);function f(i,c,n,r){const p=i-o(i,n),v=c-o(c,n),_=Math.abs(p-v)-function(C,g,S){let k=0;const L=C-o(C,S),M=g-o(g,S);for(let A=0;A<Math.abs(L-M);A++){const P=d(C,g)==="A"?-1:1;S.buffer.lines.get(L+P*A)?.isWrapped&&k++}return k}(i,c,n);return l(_,b(d(i,c),r))}function o(i,c){let n=0,r=c.buffer.lines.get(i),p=r?.isWrapped;for(;p&&i>=0&&i<c.rows;)n++,r=c.buffer.lines.get(--i),p=r?.isWrapped;return n}function d(i,c){return i>c?"A":"B"}function m(i,c,n,r,p,v){let _=i,C=c,g="";for(;_!==n||C!==r;)_+=p?1:-1,p&&_>v.cols-1?(g+=v.buffer.translateBufferLineToString(C,!1,i,_),_=0,i=0,C++):!p&&_<0&&(g+=v.buffer.translateBufferLineToString(C,!1,0,i+1),_=v.cols-1,i=_,C--);return g+v.buffer.translateBufferLineToString(C,!1,i,_)}function b(i,c){const n=c?"O":"[";return h.C0.ESC+n+i}function l(i,c){i=Math.floor(i);let n="";for(let r=0;r<i;r++)n+=c;return n}e.moveToCellSequence=function(i,c,n,r){const p=n.buffer.x,v=n.buffer.y;if(!n.buffer.hasScrollback)return function(g,S,k,L,M,A){return f(S,L,M,A).length===0?"":l(m(g,S,g,S-o(S,M),!1,M).length,b("D",A))}(p,v,0,c,n,r)+f(v,c,n,r)+function(g,S,k,L,M,A){let P;P=f(S,L,M,A).length>0?L-o(L,M):S;const F=L,U=function(H,$,E,R,T,I){let N;return N=f(E,R,T,I).length>0?R-o(R,T):$,H<E&&N<=R||H>=E&&N<R?"C":"D"}(g,S,k,L,M,A);return l(m(g,P,k,F,U==="C",M).length,b(U,A))}(p,v,i,c,n,r);let _;if(v===c)return _=p>i?"D":"C",l(Math.abs(p-i),b(_,r));_=v>c?"D":"C";const C=Math.abs(v-c);return l(function(g,S){return S.cols-g}(v>c?i:p,n)+(C-1)*n.cols+1+((v>c?p:i)-1),b(_,r))}},1296:function(x,e,a){var h=this&&this.__decorate||function(A,P,F,U){var H,$=arguments.length,E=$<3?P:U===null?U=Object.getOwnPropertyDescriptor(P,F):U;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(A,P,F,U);else for(var R=A.length-1;R>=0;R--)(H=A[R])&&(E=($<3?H(E):$>3?H(P,F,E):H(P,F))||E);return $>3&&E&&Object.defineProperty(P,F,E),E},f=this&&this.__param||function(A,P){return function(F,U){P(F,U,A)}};Object.defineProperty(e,"__esModule",{value:!0}),e.DomRenderer=void 0;const o=a(3787),d=a(2550),m=a(2223),b=a(6171),l=a(6052),i=a(4725),c=a(8055),n=a(8460),r=a(844),p=a(2585),v="xterm-dom-renderer-owner-",_="xterm-rows",C="xterm-fg-",g="xterm-bg-",S="xterm-focus",k="xterm-selection";let L=1,M=e.DomRenderer=class extends r.Disposable{constructor(A,P,F,U,H,$,E,R,T,I,N,j,K){super(),this._terminal=A,this._document=P,this._element=F,this._screenElement=U,this._viewportElement=H,this._helperContainer=$,this._linkifier2=E,this._charSizeService=T,this._optionsService=I,this._bufferService=N,this._coreBrowserService=j,this._themeService=K,this._terminalClass=L++,this._rowElements=[],this._selectionRenderModel=(0,l.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new n.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(_),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(k),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,b.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(X=>this._injectCss(X))),this._injectCss(this._themeService.colors),this._rowFactory=R.createInstance(o.DomRendererRowFactory,document),this._element.classList.add(v+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(X=>this._handleLinkHover(X))),this.register(this._linkifier2.onHideLinkUnderline(X=>this._handleLinkLeave(X))),this.register((0,r.toDisposable)(()=>{this._element.classList.remove(v+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new d.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const A=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*A,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*A),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/A),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/A),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const F of this._rowElements)F.style.width=`${this.dimensions.css.canvas.width}px`,F.style.height=`${this.dimensions.css.cell.height}px`,F.style.lineHeight=`${this.dimensions.css.cell.height}px`,F.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const P=`${this._terminalSelector} .${_} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=P,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(A){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let P=`${this._terminalSelector} .${_} { color: ${A.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;P+=`${this._terminalSelector} .${_} .xterm-dim { color: ${c.color.multiplyOpacity(A.foreground,.5).css};}`,P+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const F=`blink_underline_${this._terminalClass}`,U=`blink_bar_${this._terminalClass}`,H=`blink_block_${this._terminalClass}`;P+=`@keyframes ${F} { 50% {  border-bottom-style: hidden; }}`,P+=`@keyframes ${U} { 50% {  box-shadow: none; }}`,P+=`@keyframes ${H} { 0% {  background-color: ${A.cursor.css};  color: ${A.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${A.cursor.css}; }}`,P+=`${this._terminalSelector} .${_}.${S} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${F} 1s step-end infinite;}${this._terminalSelector} .${_}.${S} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${U} 1s step-end infinite;}${this._terminalSelector} .${_}.${S} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${H} 1s step-end infinite;}${this._terminalSelector} .${_} .xterm-cursor.xterm-cursor-block { background-color: ${A.cursor.css}; color: ${A.cursorAccent.css};}${this._terminalSelector} .${_} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${A.cursor.css} !important; color: ${A.cursorAccent.css} !important;}${this._terminalSelector} .${_} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${A.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${_} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${A.cursor.css} inset;}${this._terminalSelector} .${_} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${A.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,P+=`${this._terminalSelector} .${k} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${k} div { position: absolute; background-color: ${A.selectionBackgroundOpaque.css};}${this._terminalSelector} .${k} div { position: absolute; background-color: ${A.selectionInactiveBackgroundOpaque.css};}`;for(const[$,E]of A.ansi.entries())P+=`${this._terminalSelector} .${C}${$} { color: ${E.css}; }${this._terminalSelector} .${C}${$}.xterm-dim { color: ${c.color.multiplyOpacity(E,.5).css}; }${this._terminalSelector} .${g}${$} { background-color: ${E.css}; }`;P+=`${this._terminalSelector} .${C}${m.INVERTED_DEFAULT_COLOR} { color: ${c.color.opaque(A.background).css}; }${this._terminalSelector} .${C}${m.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${c.color.multiplyOpacity(c.color.opaque(A.background),.5).css}; }${this._terminalSelector} .${g}${m.INVERTED_DEFAULT_COLOR} { background-color: ${A.foreground.css}; }`,this._themeStyleElement.textContent=P}_setDefaultSpacing(){const A=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${A}px`,this._rowFactory.defaultSpacing=A}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(A,P){for(let F=this._rowElements.length;F<=P;F++){const U=this._document.createElement("div");this._rowContainer.appendChild(U),this._rowElements.push(U)}for(;this._rowElements.length>P;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(A,P){this._refreshRowElements(A,P),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(S),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(S),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(A,P,F){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(A,P,F),this.renderRows(0,this._bufferService.rows-1),!A||!P)return;this._selectionRenderModel.update(this._terminal,A,P,F);const U=this._selectionRenderModel.viewportStartRow,H=this._selectionRenderModel.viewportEndRow,$=this._selectionRenderModel.viewportCappedStartRow,E=this._selectionRenderModel.viewportCappedEndRow;if($>=this._bufferService.rows||E<0)return;const R=this._document.createDocumentFragment();if(F){const T=A[0]>P[0];R.appendChild(this._createSelectionElement($,T?P[0]:A[0],T?A[0]:P[0],E-$+1))}else{const T=U===$?A[0]:0,I=$===H?P[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement($,T,I));const N=E-$-1;if(R.appendChild(this._createSelectionElement($+1,0,this._bufferService.cols,N)),$!==E){const j=H===E?P[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(E,0,j))}}this._selectionContainer.appendChild(R)}_createSelectionElement(A,P,F,U=1){const H=this._document.createElement("div"),$=P*this.dimensions.css.cell.width;let E=this.dimensions.css.cell.width*(F-P);return $+E>this.dimensions.css.canvas.width&&(E=this.dimensions.css.canvas.width-$),H.style.height=U*this.dimensions.css.cell.height+"px",H.style.top=A*this.dimensions.css.cell.height+"px",H.style.left=`${$}px`,H.style.width=`${E}px`,H}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const A of this._rowElements)A.replaceChildren()}renderRows(A,P){const F=this._bufferService.buffer,U=F.ybase+F.y,H=Math.min(F.x,this._bufferService.cols-1),$=this._optionsService.rawOptions.cursorBlink,E=this._optionsService.rawOptions.cursorStyle,R=this._optionsService.rawOptions.cursorInactiveStyle;for(let T=A;T<=P;T++){const I=T+F.ydisp,N=this._rowElements[T],j=F.lines.get(I);if(!N||!j)break;N.replaceChildren(...this._rowFactory.createRow(j,I,I===U,E,R,H,$,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${v}${this._terminalClass}`}_handleLinkHover(A){this._setCellUnderline(A.x1,A.x2,A.y1,A.y2,A.cols,!0)}_handleLinkLeave(A){this._setCellUnderline(A.x1,A.x2,A.y1,A.y2,A.cols,!1)}_setCellUnderline(A,P,F,U,H,$){F<0&&(A=0),U<0&&(P=0);const E=this._bufferService.rows-1;F=Math.max(Math.min(F,E),0),U=Math.max(Math.min(U,E),0),H=Math.min(H,this._bufferService.cols);const R=this._bufferService.buffer,T=R.ybase+R.y,I=Math.min(R.x,H-1),N=this._optionsService.rawOptions.cursorBlink,j=this._optionsService.rawOptions.cursorStyle,K=this._optionsService.rawOptions.cursorInactiveStyle;for(let X=F;X<=U;++X){const O=X+R.ydisp,D=this._rowElements[X],W=R.lines.get(O);if(!D||!W)break;D.replaceChildren(...this._rowFactory.createRow(W,O,O===T,j,K,I,N,this.dimensions.css.cell.width,this._widthCache,$?X===F?A:0:-1,$?(X===U?P:H)-1:-1))}}};e.DomRenderer=M=h([f(7,p.IInstantiationService),f(8,i.ICharSizeService),f(9,p.IOptionsService),f(10,p.IBufferService),f(11,i.ICoreBrowserService),f(12,i.IThemeService)],M)},3787:function(x,e,a){var h=this&&this.__decorate||function(_,C,g,S){var k,L=arguments.length,M=L<3?C:S===null?S=Object.getOwnPropertyDescriptor(C,g):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(_,C,g,S);else for(var A=_.length-1;A>=0;A--)(k=_[A])&&(M=(L<3?k(M):L>3?k(C,g,M):k(C,g))||M);return L>3&&M&&Object.defineProperty(C,g,M),M},f=this&&this.__param||function(_,C){return function(g,S){C(g,S,_)}};Object.defineProperty(e,"__esModule",{value:!0}),e.DomRendererRowFactory=void 0;const o=a(2223),d=a(643),m=a(511),b=a(2585),l=a(8055),i=a(4725),c=a(4269),n=a(6171),r=a(3734);let p=e.DomRendererRowFactory=class{constructor(_,C,g,S,k,L,M){this._document=_,this._characterJoinerService=C,this._optionsService=g,this._coreBrowserService=S,this._coreService=k,this._decorationService=L,this._themeService=M,this._workCell=new m.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(_,C,g){this._selectionStart=_,this._selectionEnd=C,this._columnSelectMode=g}createRow(_,C,g,S,k,L,M,A,P,F,U){const H=[],$=this._characterJoinerService.getJoinedCharacters(C),E=this._themeService.colors;let R,T=_.getNoBgTrimmedLength();g&&T<L+1&&(T=L+1);let I=0,N="",j=0,K=0,X=0,O=!1,D=0,W=!1,z=0;const q=[],G=F!==-1&&U!==-1;for(let ee=0;ee<T;ee++){_.loadCell(ee,this._workCell);let Q=this._workCell.getWidth();if(Q===0)continue;let oe=!1,le=ee,Y=this._workCell;if($.length>0&&ee===$[0][0]){oe=!0;const te=$.shift();Y=new c.JoinedCellData(this._workCell,_.translateToString(!0,te[0],te[1]),te[1]-te[0]),le=te[1]-1,Q=Y.getWidth()}const we=this._isCellInSelection(ee,C),je=g&&ee===L,ne=G&&ee>=F&&ee<=U;let ie=!1;this._decorationService.forEachDecorationAtCell(ee,C,void 0,te=>{ie=!0});let se=Y.getChars()||d.WHITESPACE_CELL_CHAR;if(se===" "&&(Y.isUnderline()||Y.isOverline())&&(se=""),z=Q*A-P.get(se,Y.isBold(),Y.isItalic()),R){if(I&&(we&&W||!we&&!W&&Y.bg===j)&&(we&&W&&E.selectionForeground||Y.fg===K)&&Y.extended.ext===X&&ne===O&&z===D&&!je&&!oe&&!ie){Y.isInvisible()?N+=d.WHITESPACE_CELL_CHAR:N+=se,I++;continue}I&&(R.textContent=N),R=this._document.createElement("span"),I=0,N=""}else R=this._document.createElement("span");if(j=Y.bg,K=Y.fg,X=Y.extended.ext,O=ne,D=z,W=we,oe&&L>=ee&&L<=le&&(L=ee),!this._coreService.isCursorHidden&&je&&this._coreService.isCursorInitialized){if(q.push("xterm-cursor"),this._coreBrowserService.isFocused)M&&q.push("xterm-cursor-blink"),q.push(S==="bar"?"xterm-cursor-bar":S==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(k)switch(k){case"outline":q.push("xterm-cursor-outline");break;case"block":q.push("xterm-cursor-block");break;case"bar":q.push("xterm-cursor-bar");break;case"underline":q.push("xterm-cursor-underline")}}if(Y.isBold()&&q.push("xterm-bold"),Y.isItalic()&&q.push("xterm-italic"),Y.isDim()&&q.push("xterm-dim"),N=Y.isInvisible()?d.WHITESPACE_CELL_CHAR:Y.getChars()||d.WHITESPACE_CELL_CHAR,Y.isUnderline()&&(q.push(`xterm-underline-${Y.extended.underlineStyle}`),N===" "&&(N=""),!Y.isUnderlineColorDefault()))if(Y.isUnderlineColorRGB())R.style.textDecorationColor=`rgb(${r.AttributeData.toColorRGB(Y.getUnderlineColor()).join(",")})`;else{let te=Y.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Y.isBold()&&te<8&&(te+=8),R.style.textDecorationColor=E.ansi[te].css}Y.isOverline()&&(q.push("xterm-overline"),N===" "&&(N="")),Y.isStrikethrough()&&q.push("xterm-strikethrough"),ne&&(R.style.textDecoration="underline");let V=Y.getFgColor(),re=Y.getFgColorMode(),he=Y.getBgColor(),ce=Y.getBgColorMode();const Be=!!Y.isInverse();if(Be){const te=V;V=he,he=te;const et=re;re=ce,ce=et}let pe,Se,de,ae=!1;switch(this._decorationService.forEachDecorationAtCell(ee,C,void 0,te=>{te.options.layer!=="top"&&ae||(te.backgroundColorRGB&&(ce=50331648,he=te.backgroundColorRGB.rgba>>8&16777215,pe=te.backgroundColorRGB),te.foregroundColorRGB&&(re=50331648,V=te.foregroundColorRGB.rgba>>8&16777215,Se=te.foregroundColorRGB),ae=te.options.layer==="top")}),!ae&&we&&(pe=this._coreBrowserService.isFocused?E.selectionBackgroundOpaque:E.selectionInactiveBackgroundOpaque,he=pe.rgba>>8&16777215,ce=50331648,ae=!0,E.selectionForeground&&(re=50331648,V=E.selectionForeground.rgba>>8&16777215,Se=E.selectionForeground)),ae&&q.push("xterm-decoration-top"),ce){case 16777216:case 33554432:de=E.ansi[he],q.push(`xterm-bg-${he}`);break;case 50331648:de=l.channels.toColor(he>>16,he>>8&255,255&he),this._addStyle(R,`background-color:#${v((he>>>0).toString(16),"0",6)}`);break;default:Be?(de=E.foreground,q.push(`xterm-bg-${o.INVERTED_DEFAULT_COLOR}`)):de=E.background}switch(pe||Y.isDim()&&(pe=l.color.multiplyOpacity(de,.5)),re){case 16777216:case 33554432:Y.isBold()&&V<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(V+=8),this._applyMinimumContrast(R,de,E.ansi[V],Y,pe,void 0)||q.push(`xterm-fg-${V}`);break;case 50331648:const te=l.channels.toColor(V>>16&255,V>>8&255,255&V);this._applyMinimumContrast(R,de,te,Y,pe,Se)||this._addStyle(R,`color:#${v(V.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(R,de,E.foreground,Y,pe,Se)||Be&&q.push(`xterm-fg-${o.INVERTED_DEFAULT_COLOR}`)}q.length&&(R.className=q.join(" "),q.length=0),je||oe||ie?R.textContent=N:I++,z!==this.defaultSpacing&&(R.style.letterSpacing=`${z}px`),H.push(R),ee=le}return R&&I&&(R.textContent=N),H}_applyMinimumContrast(_,C,g,S,k,L){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,n.treatGlyphAsBackgroundColor)(S.getCode()))return!1;const M=this._getContrastCache(S);let A;if(k||L||(A=M.getColor(C.rgba,g.rgba)),A===void 0){const P=this._optionsService.rawOptions.minimumContrastRatio/(S.isDim()?2:1);A=l.color.ensureContrastRatio(k||C,L||g,P),M.setColor((k||C).rgba,(L||g).rgba,A??null)}return!!A&&(this._addStyle(_,`color:${A.css}`),!0)}_getContrastCache(_){return _.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(_,C){_.setAttribute("style",`${_.getAttribute("style")||""}${C};`)}_isCellInSelection(_,C){const g=this._selectionStart,S=this._selectionEnd;return!(!g||!S)&&(this._columnSelectMode?g[0]<=S[0]?_>=g[0]&&C>=g[1]&&_<S[0]&&C<=S[1]:_<g[0]&&C>=g[1]&&_>=S[0]&&C<=S[1]:C>g[1]&&C<S[1]||g[1]===S[1]&&C===g[1]&&_>=g[0]&&_<S[0]||g[1]<S[1]&&C===S[1]&&_<S[0]||g[1]<S[1]&&C===g[1]&&_>=g[0])}};function v(_,C,g){for(;_.length<g;)_=C+_;return _}e.DomRendererRowFactory=p=h([f(1,i.ICharacterJoinerService),f(2,b.IOptionsService),f(3,i.ICoreBrowserService),f(4,b.ICoreService),f(5,b.IDecorationService),f(6,i.IThemeService)],p)},2550:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WidthCache=void 0,e.WidthCache=class{constructor(a,h){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const f=a.createElement("span");f.classList.add("xterm-char-measure-element");const o=a.createElement("span");o.classList.add("xterm-char-measure-element"),o.style.fontWeight="bold";const d=a.createElement("span");d.classList.add("xterm-char-measure-element"),d.style.fontStyle="italic";const m=a.createElement("span");m.classList.add("xterm-char-measure-element"),m.style.fontWeight="bold",m.style.fontStyle="italic",this._measureElements=[f,o,d,m],this._container.appendChild(f),this._container.appendChild(o),this._container.appendChild(d),this._container.appendChild(m),h.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,h,f,o){a===this._font&&h===this._fontSize&&f===this._weight&&o===this._weightBold||(this._font=a,this._fontSize=h,this._weight=f,this._weightBold=o,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${f}`,this._measureElements[1].style.fontWeight=`${o}`,this._measureElements[2].style.fontWeight=`${f}`,this._measureElements[3].style.fontWeight=`${o}`,this.clear())}get(a,h,f){let o=0;if(!h&&!f&&a.length===1&&(o=a.charCodeAt(0))<256){if(this._flat[o]!==-9999)return this._flat[o];const b=this._measure(a,0);return b>0&&(this._flat[o]=b),b}let d=a;h&&(d+="B"),f&&(d+="I");let m=this._holey.get(d);if(m===void 0){let b=0;h&&(b|=1),f&&(b|=2),m=this._measure(a,b),m>0&&this._holey.set(d,m)}return m}_measure(a,h){const f=this._measureElements[h];return f.textContent=a.repeat(32),f.offsetWidth/32}}},2223:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TEXT_BASELINE=e.DIM_OPACITY=e.INVERTED_DEFAULT_COLOR=void 0;const h=a(6114);e.INVERTED_DEFAULT_COLOR=257,e.DIM_OPACITY=.5,e.TEXT_BASELINE=h.isFirefox||h.isLegacyEdge?"bottom":"ideographic"},6171:(x,e)=>{function a(f){return 57508<=f&&f<=57558}function h(f){return f>=128512&&f<=128591||f>=127744&&f<=128511||f>=128640&&f<=128767||f>=9728&&f<=9983||f>=9984&&f<=10175||f>=65024&&f<=65039||f>=129280&&f<=129535||f>=127462&&f<=127487}Object.defineProperty(e,"__esModule",{value:!0}),e.computeNextVariantOffset=e.createRenderDimensions=e.treatGlyphAsBackgroundColor=e.allowRescaling=e.isEmoji=e.isRestrictedPowerlineGlyph=e.isPowerlineGlyph=e.throwIfFalsy=void 0,e.throwIfFalsy=function(f){if(!f)throw new Error("value must not be falsy");return f},e.isPowerlineGlyph=a,e.isRestrictedPowerlineGlyph=function(f){return 57520<=f&&f<=57527},e.isEmoji=h,e.allowRescaling=function(f,o,d,m){return o===1&&d>Math.ceil(1.5*m)&&f!==void 0&&f>255&&!h(f)&&!a(f)&&!function(b){return 57344<=b&&b<=63743}(f)},e.treatGlyphAsBackgroundColor=function(f){return a(f)||function(o){return 9472<=o&&o<=9631}(f)},e.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},e.computeNextVariantOffset=function(f,o,d=0){return(f-(2*Math.round(o)-d))%(2*Math.round(o))}},6052:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(f,o,d,m=!1){if(this.selectionStart=o,this.selectionEnd=d,!o||!d||o[0]===d[0]&&o[1]===d[1])return void this.clear();const b=f.buffers.active.ydisp,l=o[1]-b,i=d[1]-b,c=Math.max(l,0),n=Math.min(i,f.rows-1);c>=f.rows||n<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=m,this.viewportStartRow=l,this.viewportEndRow=i,this.viewportCappedStartRow=c,this.viewportCappedEndRow=n,this.startCol=o[0],this.endCol=d[0])}isCellSelected(f,o,d){return!!this.hasSelection&&(d-=f.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?o>=this.startCol&&d>=this.viewportCappedStartRow&&o<this.endCol&&d<=this.viewportCappedEndRow:o<this.startCol&&d>=this.viewportCappedStartRow&&o>=this.endCol&&d<=this.viewportCappedEndRow:d>this.viewportStartRow&&d<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&d===this.viewportStartRow&&o>=this.startCol&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&d===this.viewportEndRow&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&d===this.viewportStartRow&&o>=this.startCol)}}e.createSelectionRenderModel=function(){return new a}},456:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionModel=void 0,e.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const a=this.selectionStart,h=this.selectionEnd;return!(!a||!h)&&(a[1]>h[1]||a[1]===h[1]&&a[0]>h[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(x,e,a){var h=this&&this.__decorate||function(n,r,p,v){var _,C=arguments.length,g=C<3?r:v===null?v=Object.getOwnPropertyDescriptor(r,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(n,r,p,v);else for(var S=n.length-1;S>=0;S--)(_=n[S])&&(g=(C<3?_(g):C>3?_(r,p,g):_(r,p))||g);return C>3&&g&&Object.defineProperty(r,p,g),g},f=this&&this.__param||function(n,r){return function(p,v){r(p,v,n)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CharSizeService=void 0;const o=a(2585),d=a(8460),m=a(844);let b=e.CharSizeService=class extends m.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(n,r,p){super(),this._optionsService=p,this.width=0,this.height=0,this._onCharSizeChange=this.register(new d.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new c(this._optionsService))}catch{this._measureStrategy=this.register(new i(n,r,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const n=this._measureStrategy.measure();n.width===this.width&&n.height===this.height||(this.width=n.width,this.height=n.height,this._onCharSizeChange.fire())}};e.CharSizeService=b=h([f(2,o.IOptionsService)],b);class l extends m.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(r,p){r!==void 0&&r>0&&p!==void 0&&p>0&&(this._result.width=r,this._result.height=p)}}class i extends l{constructor(r,p,v){super(),this._document=r,this._parentElement=p,this._optionsService=v,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class c extends l{constructor(r){super(),this._optionsService=r,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const p=this._ctx.measureText("W");if(!("width"in p&&"fontBoundingBoxAscent"in p&&"fontBoundingBoxDescent"in p))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const r=this._ctx.measureText("W");return this._validateAndSet(r.width,r.fontBoundingBoxAscent+r.fontBoundingBoxDescent),this._result}}},4269:function(x,e,a){var h=this&&this.__decorate||function(c,n,r,p){var v,_=arguments.length,C=_<3?n:p===null?p=Object.getOwnPropertyDescriptor(n,r):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(c,n,r,p);else for(var g=c.length-1;g>=0;g--)(v=c[g])&&(C=(_<3?v(C):_>3?v(n,r,C):v(n,r))||C);return _>3&&C&&Object.defineProperty(n,r,C),C},f=this&&this.__param||function(c,n){return function(r,p){n(r,p,c)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CharacterJoinerService=e.JoinedCellData=void 0;const o=a(3734),d=a(643),m=a(511),b=a(2585);class l extends o.AttributeData{constructor(n,r,p){super(),this.content=0,this.combinedData="",this.fg=n.fg,this.bg=n.bg,this.combinedData=r,this._width=p}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(n){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}e.JoinedCellData=l;let i=e.CharacterJoinerService=class er{constructor(n){this._bufferService=n,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new m.CellData}register(n){const r={id:this._nextCharacterJoinerId++,handler:n};return this._characterJoiners.push(r),r.id}deregister(n){for(let r=0;r<this._characterJoiners.length;r++)if(this._characterJoiners[r].id===n)return this._characterJoiners.splice(r,1),!0;return!1}getJoinedCharacters(n){if(this._characterJoiners.length===0)return[];const r=this._bufferService.buffer.lines.get(n);if(!r||r.length===0)return[];const p=[],v=r.translateToString(!0);let _=0,C=0,g=0,S=r.getFg(0),k=r.getBg(0);for(let L=0;L<r.getTrimmedLength();L++)if(r.loadCell(L,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==S||this._workCell.bg!==k){if(L-_>1){const M=this._getJoinedRanges(v,g,C,r,_);for(let A=0;A<M.length;A++)p.push(M[A])}_=L,g=C,S=this._workCell.fg,k=this._workCell.bg}C+=this._workCell.getChars().length||d.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-_>1){const L=this._getJoinedRanges(v,g,C,r,_);for(let M=0;M<L.length;M++)p.push(L[M])}return p}_getJoinedRanges(n,r,p,v,_){const C=n.substring(r,p);let g=[];try{g=this._characterJoiners[0].handler(C)}catch(S){console.error(S)}for(let S=1;S<this._characterJoiners.length;S++)try{const k=this._characterJoiners[S].handler(C);for(let L=0;L<k.length;L++)er._mergeRanges(g,k[L])}catch(k){console.error(k)}return this._stringRangesToCellRanges(g,v,_),g}_stringRangesToCellRanges(n,r,p){let v=0,_=!1,C=0,g=n[v];if(g){for(let S=p;S<this._bufferService.cols;S++){const k=r.getWidth(S),L=r.getString(S).length||d.WHITESPACE_CELL_CHAR.length;if(k!==0){if(!_&&g[0]<=C&&(g[0]=S,_=!0),g[1]<=C){if(g[1]=S,g=n[++v],!g)break;g[0]<=C?(g[0]=S,_=!0):_=!1}C+=L}}g&&(g[1]=this._bufferService.cols)}}static _mergeRanges(n,r){let p=!1;for(let v=0;v<n.length;v++){const _=n[v];if(p){if(r[1]<=_[0])return n[v-1][1]=r[1],n;if(r[1]<=_[1])return n[v-1][1]=Math.max(r[1],_[1]),n.splice(v,1),n;n.splice(v,1),v--}else{if(r[1]<=_[0])return n.splice(v,0,r),n;if(r[1]<=_[1])return _[0]=Math.min(r[0],_[0]),n;r[0]<_[1]&&(_[0]=Math.min(r[0],_[0]),p=!0)}}return p?n[n.length-1][1]=r[1]:n.push(r),n}};e.CharacterJoinerService=i=h([f(0,b.IBufferService)],i)},5114:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreBrowserService=void 0;const h=a(844),f=a(8460),o=a(3656);class d extends h.Disposable{constructor(l,i,c){super(),this._textarea=l,this._window=i,this.mainDocument=c,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new m(this._window),this._onDprChange=this.register(new f.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new f.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(n=>this._screenDprMonitor.setWindow(n))),this.register((0,f.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(l){this._window!==l&&(this._window=l,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}e.CoreBrowserService=d;class m extends h.Disposable{constructor(l){super(),this._parentWindow=l,this._windowResizeListener=this.register(new h.MutableDisposable),this._onDprChange=this.register(new f.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,h.toDisposable)(()=>this.clearListener()))}setWindow(l){this._parentWindow=l,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,o.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LinkProviderService=void 0;const h=a(844);class f extends h.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,h.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(d){return this.linkProviders.push(d),{dispose:()=>{const m=this.linkProviders.indexOf(d);m!==-1&&this.linkProviders.splice(m,1)}}}}e.LinkProviderService=f},8934:function(x,e,a){var h=this&&this.__decorate||function(b,l,i,c){var n,r=arguments.length,p=r<3?l:c===null?c=Object.getOwnPropertyDescriptor(l,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(b,l,i,c);else for(var v=b.length-1;v>=0;v--)(n=b[v])&&(p=(r<3?n(p):r>3?n(l,i,p):n(l,i))||p);return r>3&&p&&Object.defineProperty(l,i,p),p},f=this&&this.__param||function(b,l){return function(i,c){l(i,c,b)}};Object.defineProperty(e,"__esModule",{value:!0}),e.MouseService=void 0;const o=a(4725),d=a(9806);let m=e.MouseService=class{constructor(b,l){this._renderService=b,this._charSizeService=l}getCoords(b,l,i,c,n){return(0,d.getCoords)(window,b,l,i,c,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,n)}getMouseReportCoords(b,l){const i=(0,d.getCoordsRelativeToElement)(window,b,l);if(this._charSizeService.hasValidSize)return i[0]=Math.min(Math.max(i[0],0),this._renderService.dimensions.css.canvas.width-1),i[1]=Math.min(Math.max(i[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(i[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(i[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(i[0]),y:Math.floor(i[1])}}};e.MouseService=m=h([f(0,o.IRenderService),f(1,o.ICharSizeService)],m)},3230:function(x,e,a){var h=this&&this.__decorate||function(n,r,p,v){var _,C=arguments.length,g=C<3?r:v===null?v=Object.getOwnPropertyDescriptor(r,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(n,r,p,v);else for(var S=n.length-1;S>=0;S--)(_=n[S])&&(g=(C<3?_(g):C>3?_(r,p,g):_(r,p))||g);return C>3&&g&&Object.defineProperty(r,p,g),g},f=this&&this.__param||function(n,r){return function(p,v){r(p,v,n)}};Object.defineProperty(e,"__esModule",{value:!0}),e.RenderService=void 0;const o=a(6193),d=a(4725),m=a(8460),b=a(844),l=a(7226),i=a(2585);let c=e.RenderService=class extends b.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(n,r,p,v,_,C,g,S){super(),this._rowCount=n,this._charSizeService=v,this._renderer=this.register(new b.MutableDisposable),this._pausedResizeTask=new l.DebouncedIdleTask,this._observerDisposable=this.register(new b.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new m.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new m.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new m.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new m.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new o.RenderDebouncer((k,L)=>this._renderRows(k,L),g),this.register(this._renderDebouncer),this.register(g.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(C.onResize(()=>this._fullRefresh())),this.register(C.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this.register(p.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(_.onDecorationRegistered(()=>this._fullRefresh())),this.register(_.onDecorationRemoved(()=>this._fullRefresh())),this.register(p.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(C.cols,C.rows),this._fullRefresh()})),this.register(p.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(C.buffer.y,C.buffer.y,!0))),this.register(S.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(g.window,r),this.register(g.onWindowChange(k=>this._registerIntersectionObserver(k,r)))}_registerIntersectionObserver(n,r){if("IntersectionObserver"in n){const p=new n.IntersectionObserver(v=>this._handleIntersectionChange(v[v.length-1]),{threshold:0});p.observe(r),this._observerDisposable.value=(0,b.toDisposable)(()=>p.disconnect())}}_handleIntersectionChange(n){this._isPaused=n.isIntersecting===void 0?n.intersectionRatio===0:!n.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(n,r,p=!1){this._isPaused?this._needsFullRefresh=!0:(p||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(n,r,this._rowCount))}_renderRows(n,r){this._renderer.value&&(n=Math.min(n,this._rowCount-1),r=Math.min(r,this._rowCount-1),this._renderer.value.renderRows(n,r),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:n,end:r}),this._onRender.fire({start:n,end:r}),this._isNextRenderRedrawOnly=!0)}resize(n,r){this._rowCount=r,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(n){this._renderer.value=n,this._renderer.value&&(this._renderer.value.onRequestRedraw(r=>this.refreshRows(r.start,r.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(n){return this._renderDebouncer.addRefreshCallback(n)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(n,r){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(n,r)):this._renderer.value.handleResize(n,r),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(n,r,p){this._selectionState.start=n,this._selectionState.end=r,this._selectionState.columnSelectMode=p,this._renderer.value?.handleSelectionChanged(n,r,p)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};e.RenderService=c=h([f(2,i.IOptionsService),f(3,d.ICharSizeService),f(4,i.IDecorationService),f(5,i.IBufferService),f(6,d.ICoreBrowserService),f(7,d.IThemeService)],c)},9312:function(x,e,a){var h=this&&this.__decorate||function(g,S,k,L){var M,A=arguments.length,P=A<3?S:L===null?L=Object.getOwnPropertyDescriptor(S,k):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(g,S,k,L);else for(var F=g.length-1;F>=0;F--)(M=g[F])&&(P=(A<3?M(P):A>3?M(S,k,P):M(S,k))||P);return A>3&&P&&Object.defineProperty(S,k,P),P},f=this&&this.__param||function(g,S){return function(k,L){S(k,L,g)}};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionService=void 0;const o=a(9806),d=a(9504),m=a(456),b=a(4725),l=a(8460),i=a(844),c=a(6114),n=a(4841),r=a(511),p=a(2585),v="",_=new RegExp(v,"g");let C=e.SelectionService=class extends i.Disposable{constructor(g,S,k,L,M,A,P,F,U){super(),this._element=g,this._screenElement=S,this._linkifier=k,this._bufferService=L,this._coreService=M,this._mouseService=A,this._optionsService=P,this._renderService=F,this._coreBrowserService=U,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new r.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new l.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new l.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new l.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new l.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=H=>this._handleMouseMove(H),this._mouseUpListener=H=>this._handleMouseUp(H),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(H=>this._handleTrim(H)),this.register(this._bufferService.buffers.onBufferActivate(H=>this._handleBufferActivate(H))),this.enable(),this._model=new m.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,i.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const g=this._model.finalSelectionStart,S=this._model.finalSelectionEnd;return!(!g||!S||g[0]===S[0]&&g[1]===S[1])}get selectionText(){const g=this._model.finalSelectionStart,S=this._model.finalSelectionEnd;if(!g||!S)return"";const k=this._bufferService.buffer,L=[];if(this._activeSelectionMode===3){if(g[0]===S[0])return"";const M=g[0]<S[0]?g[0]:S[0],A=g[0]<S[0]?S[0]:g[0];for(let P=g[1];P<=S[1];P++){const F=k.translateBufferLineToString(P,!0,M,A);L.push(F)}}else{const M=g[1]===S[1]?S[0]:void 0;L.push(k.translateBufferLineToString(g[1],!0,g[0],M));for(let A=g[1]+1;A<=S[1]-1;A++){const P=k.lines.get(A),F=k.translateBufferLineToString(A,!0);P?.isWrapped?L[L.length-1]+=F:L.push(F)}if(g[1]!==S[1]){const A=k.lines.get(S[1]),P=k.translateBufferLineToString(S[1],!0,0,S[0]);A&&A.isWrapped?L[L.length-1]+=P:L.push(P)}}return L.map(M=>M.replace(_," ")).join(c.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(g){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),c.isLinux&&g&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(g){const S=this._getMouseBufferCoords(g),k=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!!(k&&L&&S)&&this._areCoordsInSelection(S,k,L)}isCellInSelection(g,S){const k=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!(!k||!L)&&this._areCoordsInSelection([g,S],k,L)}_areCoordsInSelection(g,S,k){return g[1]>S[1]&&g[1]<k[1]||S[1]===k[1]&&g[1]===S[1]&&g[0]>=S[0]&&g[0]<k[0]||S[1]<k[1]&&g[1]===k[1]&&g[0]<k[0]||S[1]<k[1]&&g[1]===S[1]&&g[0]>=S[0]}_selectWordAtCursor(g,S){const k=this._linkifier.currentLink?.link?.range;if(k)return this._model.selectionStart=[k.start.x-1,k.start.y-1],this._model.selectionStartLength=(0,n.getRangeLength)(k,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const L=this._getMouseBufferCoords(g);return!!L&&(this._selectWordAt(L,S),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(g,S){this._model.clearSelection(),g=Math.max(g,0),S=Math.min(S,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,g],this._model.selectionEnd=[this._bufferService.cols,S],this.refresh(),this._onSelectionChange.fire()}_handleTrim(g){this._model.handleTrim(g)&&this.refresh()}_getMouseBufferCoords(g){const S=this._mouseService.getCoords(g,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(S)return S[0]--,S[1]--,S[1]+=this._bufferService.buffer.ydisp,S}_getMouseEventScrollAmount(g){let S=(0,o.getCoordsRelativeToElement)(this._coreBrowserService.window,g,this._screenElement)[1];const k=this._renderService.dimensions.css.canvas.height;return S>=0&&S<=k?0:(S>k&&(S-=k),S=Math.min(Math.max(S,-50),50),S/=50,S/Math.abs(S)+Math.round(14*S))}shouldForceSelection(g){return c.isMac?g.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:g.shiftKey}handleMouseDown(g){if(this._mouseDownTimeStamp=g.timeStamp,(g.button!==2||!this.hasSelection)&&g.button===0){if(!this._enabled){if(!this.shouldForceSelection(g))return;g.stopPropagation()}g.preventDefault(),this._dragScrollAmount=0,this._enabled&&g.shiftKey?this._handleIncrementalClick(g):g.detail===1?this._handleSingleClick(g):g.detail===2?this._handleDoubleClick(g):g.detail===3&&this._handleTripleClick(g),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(g){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(g))}_handleSingleClick(g){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(g)?3:0,this._model.selectionStart=this._getMouseBufferCoords(g),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const S=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);S&&S.length!==this._model.selectionStart[0]&&S.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(g){this._selectWordAtCursor(g,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(g){const S=this._getMouseBufferCoords(g);S&&(this._activeSelectionMode=2,this._selectLineAt(S[1]))}shouldColumnSelect(g){return g.altKey&&!(c.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(g){if(g.stopImmediatePropagation(),!this._model.selectionStart)return;const S=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(g),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(g),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const k=this._bufferService.buffer;if(this._model.selectionEnd[1]<k.lines.length){const L=k.lines.get(this._model.selectionEnd[1]);L&&L.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}S&&S[0]===this._model.selectionEnd[0]&&S[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const g=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(g.ydisp+this._bufferService.rows,g.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=g.ydisp),this.refresh()}}_handleMouseUp(g){const S=g.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&S<500&&g.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const k=this._mouseService.getCoords(g,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(k&&k[0]!==void 0&&k[1]!==void 0){const L=(0,d.moveToCellSequence)(k[0]-1,k[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(L,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const g=this._model.finalSelectionStart,S=this._model.finalSelectionEnd,k=!(!g||!S||g[0]===S[0]&&g[1]===S[1]);k?g&&S&&(this._oldSelectionStart&&this._oldSelectionEnd&&g[0]===this._oldSelectionStart[0]&&g[1]===this._oldSelectionStart[1]&&S[0]===this._oldSelectionEnd[0]&&S[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(g,S,k)):this._oldHasSelection&&this._fireOnSelectionChange(g,S,k)}_fireOnSelectionChange(g,S,k){this._oldSelectionStart=g,this._oldSelectionEnd=S,this._oldHasSelection=k,this._onSelectionChange.fire()}_handleBufferActivate(g){this.clearSelection(),this._trimListener.dispose(),this._trimListener=g.activeBuffer.lines.onTrim(S=>this._handleTrim(S))}_convertViewportColToCharacterIndex(g,S){let k=S;for(let L=0;S>=L;L++){const M=g.loadCell(L,this._workCell).getChars().length;this._workCell.getWidth()===0?k--:M>1&&S!==L&&(k+=M-1)}return k}setSelection(g,S,k){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[g,S],this._model.selectionStartLength=k,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(g){this._isClickInSelection(g)||(this._selectWordAtCursor(g,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(g,S,k=!0,L=!0){if(g[0]>=this._bufferService.cols)return;const M=this._bufferService.buffer,A=M.lines.get(g[1]);if(!A)return;const P=M.translateBufferLineToString(g[1],!1);let F=this._convertViewportColToCharacterIndex(A,g[0]),U=F;const H=g[0]-F;let $=0,E=0,R=0,T=0;if(P.charAt(F)===" "){for(;F>0&&P.charAt(F-1)===" ";)F--;for(;U<P.length&&P.charAt(U+1)===" ";)U++}else{let j=g[0],K=g[0];A.getWidth(j)===0&&($++,j--),A.getWidth(K)===2&&(E++,K++);const X=A.getString(K).length;for(X>1&&(T+=X-1,U+=X-1);j>0&&F>0&&!this._isCharWordSeparator(A.loadCell(j-1,this._workCell));){A.loadCell(j-1,this._workCell);const O=this._workCell.getChars().length;this._workCell.getWidth()===0?($++,j--):O>1&&(R+=O-1,F-=O-1),F--,j--}for(;K<A.length&&U+1<P.length&&!this._isCharWordSeparator(A.loadCell(K+1,this._workCell));){A.loadCell(K+1,this._workCell);const O=this._workCell.getChars().length;this._workCell.getWidth()===2?(E++,K++):O>1&&(T+=O-1,U+=O-1),U++,K++}}U++;let I=F+H-$+R,N=Math.min(this._bufferService.cols,U-F+$+E-R-T);if(S||P.slice(F,U).trim()!==""){if(k&&I===0&&A.getCodePoint(0)!==32){const j=M.lines.get(g[1]-1);if(j&&A.isWrapped&&j.getCodePoint(this._bufferService.cols-1)!==32){const K=this._getWordAt([this._bufferService.cols-1,g[1]-1],!1,!0,!1);if(K){const X=this._bufferService.cols-K.start;I-=X,N+=X}}}if(L&&I+N===this._bufferService.cols&&A.getCodePoint(this._bufferService.cols-1)!==32){const j=M.lines.get(g[1]+1);if(j?.isWrapped&&j.getCodePoint(0)!==32){const K=this._getWordAt([0,g[1]+1],!1,!1,!0);K&&(N+=K.length)}}return{start:I,length:N}}}_selectWordAt(g,S){const k=this._getWordAt(g,S);if(k){for(;k.start<0;)k.start+=this._bufferService.cols,g[1]--;this._model.selectionStart=[k.start,g[1]],this._model.selectionStartLength=k.length}}_selectToWordAt(g){const S=this._getWordAt(g,!0);if(S){let k=g[1];for(;S.start<0;)S.start+=this._bufferService.cols,k--;if(!this._model.areSelectionValuesReversed())for(;S.start+S.length>this._bufferService.cols;)S.length-=this._bufferService.cols,k++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?S.start:S.start+S.length,k]}}_isCharWordSeparator(g){return g.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(g.getChars())>=0}_selectLineAt(g){const S=this._bufferService.buffer.getWrappedRangeForLine(g),k={start:{x:0,y:S.first},end:{x:this._bufferService.cols-1,y:S.last}};this._model.selectionStart=[0,S.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,n.getRangeLength)(k,this._bufferService.cols)}};e.SelectionService=C=h([f(3,p.IBufferService),f(4,p.ICoreService),f(5,b.IMouseService),f(6,p.IOptionsService),f(7,b.IRenderService),f(8,b.ICoreBrowserService)],C)},4725:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ILinkProviderService=e.IThemeService=e.ICharacterJoinerService=e.ISelectionService=e.IRenderService=e.IMouseService=e.ICoreBrowserService=e.ICharSizeService=void 0;const h=a(8343);e.ICharSizeService=(0,h.createDecorator)("CharSizeService"),e.ICoreBrowserService=(0,h.createDecorator)("CoreBrowserService"),e.IMouseService=(0,h.createDecorator)("MouseService"),e.IRenderService=(0,h.createDecorator)("RenderService"),e.ISelectionService=(0,h.createDecorator)("SelectionService"),e.ICharacterJoinerService=(0,h.createDecorator)("CharacterJoinerService"),e.IThemeService=(0,h.createDecorator)("ThemeService"),e.ILinkProviderService=(0,h.createDecorator)("LinkProviderService")},6731:function(x,e,a){var h=this&&this.__decorate||function(C,g,S,k){var L,M=arguments.length,A=M<3?g:k===null?k=Object.getOwnPropertyDescriptor(g,S):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(C,g,S,k);else for(var P=C.length-1;P>=0;P--)(L=C[P])&&(A=(M<3?L(A):M>3?L(g,S,A):L(g,S))||A);return M>3&&A&&Object.defineProperty(g,S,A),A},f=this&&this.__param||function(C,g){return function(S,k){g(S,k,C)}};Object.defineProperty(e,"__esModule",{value:!0}),e.ThemeService=e.DEFAULT_ANSI_COLORS=void 0;const o=a(7239),d=a(8055),m=a(8460),b=a(844),l=a(2585),i=d.css.toColor("#ffffff"),c=d.css.toColor("#000000"),n=d.css.toColor("#ffffff"),r=d.css.toColor("#000000"),p={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};e.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const C=[d.css.toColor("#2e3436"),d.css.toColor("#cc0000"),d.css.toColor("#4e9a06"),d.css.toColor("#c4a000"),d.css.toColor("#3465a4"),d.css.toColor("#75507b"),d.css.toColor("#06989a"),d.css.toColor("#d3d7cf"),d.css.toColor("#555753"),d.css.toColor("#ef2929"),d.css.toColor("#8ae234"),d.css.toColor("#fce94f"),d.css.toColor("#729fcf"),d.css.toColor("#ad7fa8"),d.css.toColor("#34e2e2"),d.css.toColor("#eeeeec")],g=[0,95,135,175,215,255];for(let S=0;S<216;S++){const k=g[S/36%6|0],L=g[S/6%6|0],M=g[S%6];C.push({css:d.channels.toCss(k,L,M),rgba:d.channels.toRgba(k,L,M)})}for(let S=0;S<24;S++){const k=8+10*S;C.push({css:d.channels.toCss(k,k,k),rgba:d.channels.toRgba(k,k,k)})}return C})());let v=e.ThemeService=class extends b.Disposable{get colors(){return this._colors}constructor(C){super(),this._optionsService=C,this._contrastCache=new o.ColorContrastCache,this._halfContrastCache=new o.ColorContrastCache,this._onChangeColors=this.register(new m.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:i,background:c,cursor:n,cursorAccent:r,selectionForeground:void 0,selectionBackgroundTransparent:p,selectionBackgroundOpaque:d.color.blend(c,p),selectionInactiveBackgroundTransparent:p,selectionInactiveBackgroundOpaque:d.color.blend(c,p),ansi:e.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(C={}){const g=this._colors;if(g.foreground=_(C.foreground,i),g.background=_(C.background,c),g.cursor=_(C.cursor,n),g.cursorAccent=_(C.cursorAccent,r),g.selectionBackgroundTransparent=_(C.selectionBackground,p),g.selectionBackgroundOpaque=d.color.blend(g.background,g.selectionBackgroundTransparent),g.selectionInactiveBackgroundTransparent=_(C.selectionInactiveBackground,g.selectionBackgroundTransparent),g.selectionInactiveBackgroundOpaque=d.color.blend(g.background,g.selectionInactiveBackgroundTransparent),g.selectionForeground=C.selectionForeground?_(C.selectionForeground,d.NULL_COLOR):void 0,g.selectionForeground===d.NULL_COLOR&&(g.selectionForeground=void 0),d.color.isOpaque(g.selectionBackgroundTransparent)&&(g.selectionBackgroundTransparent=d.color.opacity(g.selectionBackgroundTransparent,.3)),d.color.isOpaque(g.selectionInactiveBackgroundTransparent)&&(g.selectionInactiveBackgroundTransparent=d.color.opacity(g.selectionInactiveBackgroundTransparent,.3)),g.ansi=e.DEFAULT_ANSI_COLORS.slice(),g.ansi[0]=_(C.black,e.DEFAULT_ANSI_COLORS[0]),g.ansi[1]=_(C.red,e.DEFAULT_ANSI_COLORS[1]),g.ansi[2]=_(C.green,e.DEFAULT_ANSI_COLORS[2]),g.ansi[3]=_(C.yellow,e.DEFAULT_ANSI_COLORS[3]),g.ansi[4]=_(C.blue,e.DEFAULT_ANSI_COLORS[4]),g.ansi[5]=_(C.magenta,e.DEFAULT_ANSI_COLORS[5]),g.ansi[6]=_(C.cyan,e.DEFAULT_ANSI_COLORS[6]),g.ansi[7]=_(C.white,e.DEFAULT_ANSI_COLORS[7]),g.ansi[8]=_(C.brightBlack,e.DEFAULT_ANSI_COLORS[8]),g.ansi[9]=_(C.brightRed,e.DEFAULT_ANSI_COLORS[9]),g.ansi[10]=_(C.brightGreen,e.DEFAULT_ANSI_COLORS[10]),g.ansi[11]=_(C.brightYellow,e.DEFAULT_ANSI_COLORS[11]),g.ansi[12]=_(C.brightBlue,e.DEFAULT_ANSI_COLORS[12]),g.ansi[13]=_(C.brightMagenta,e.DEFAULT_ANSI_COLORS[13]),g.ansi[14]=_(C.brightCyan,e.DEFAULT_ANSI_COLORS[14]),g.ansi[15]=_(C.brightWhite,e.DEFAULT_ANSI_COLORS[15]),C.extendedAnsi){const S=Math.min(g.ansi.length-16,C.extendedAnsi.length);for(let k=0;k<S;k++)g.ansi[k+16]=_(C.extendedAnsi[k],e.DEFAULT_ANSI_COLORS[k+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(C){this._restoreColor(C),this._onChangeColors.fire(this.colors)}_restoreColor(C){if(C!==void 0)switch(C){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[C]=this._restoreColors.ansi[C]}else for(let g=0;g<this._restoreColors.ansi.length;++g)this._colors.ansi[g]=this._restoreColors.ansi[g]}modifyColors(C){C(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function _(C,g){if(C!==void 0)try{return d.css.toColor(C)}catch{}return g}e.ThemeService=v=h([f(0,l.IOptionsService)],v)},6349:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CircularList=void 0;const h=a(8460),f=a(844);class o extends f.Disposable{constructor(m){super(),this._maxLength=m,this.onDeleteEmitter=this.register(new h.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new h.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new h.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(m){if(this._maxLength===m)return;const b=new Array(m);for(let l=0;l<Math.min(m,this.length);l++)b[l]=this._array[this._getCyclicIndex(l)];this._array=b,this._maxLength=m,this._startIndex=0}get length(){return this._length}set length(m){if(m>this._length)for(let b=this._length;b<m;b++)this._array[b]=void 0;this._length=m}get(m){return this._array[this._getCyclicIndex(m)]}set(m,b){this._array[this._getCyclicIndex(m)]=b}push(m){this._array[this._getCyclicIndex(this._length)]=m,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(m,b,...l){if(b){for(let i=m;i<this._length-b;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+b)];this._length-=b,this.onDeleteEmitter.fire({index:m,amount:b})}for(let i=this._length-1;i>=m;i--)this._array[this._getCyclicIndex(i+l.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<l.length;i++)this._array[this._getCyclicIndex(m+i)]=l[i];if(l.length&&this.onInsertEmitter.fire({index:m,amount:l.length}),this._length+l.length>this._maxLength){const i=this._length+l.length-this._maxLength;this._startIndex+=i,this._length=this._maxLength,this.onTrimEmitter.fire(i)}else this._length+=l.length}trimStart(m){m>this._length&&(m=this._length),this._startIndex+=m,this._length-=m,this.onTrimEmitter.fire(m)}shiftElements(m,b,l){if(!(b<=0)){if(m<0||m>=this._length)throw new Error("start argument out of range");if(m+l<0)throw new Error("Cannot shift elements in list beyond index 0");if(l>0){for(let c=b-1;c>=0;c--)this.set(m+c+l,this.get(m+c));const i=m+b+l-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<b;i++)this.set(m+i+l,this.get(m+i))}}_getCyclicIndex(m){return(this._startIndex+m)%this._maxLength}}e.CircularList=o},1439:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.clone=void 0,e.clone=function a(h,f=5){if(typeof h!="object")return h;const o=Array.isArray(h)?[]:{};for(const d in h)o[d]=f<=1?h[d]:h[d]&&a(h[d],f-1);return o}},8055:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.contrastRatio=e.toPaddedHex=e.rgba=e.rgb=e.css=e.color=e.channels=e.NULL_COLOR=void 0;let a=0,h=0,f=0,o=0;var d,m,b,l,i;function c(r){const p=r.toString(16);return p.length<2?"0"+p:p}function n(r,p){return r<p?(p+.05)/(r+.05):(r+.05)/(p+.05)}e.NULL_COLOR={css:"#00000000",rgba:0},function(r){r.toCss=function(p,v,_,C){return C!==void 0?`#${c(p)}${c(v)}${c(_)}${c(C)}`:`#${c(p)}${c(v)}${c(_)}`},r.toRgba=function(p,v,_,C=255){return(p<<24|v<<16|_<<8|C)>>>0},r.toColor=function(p,v,_,C){return{css:r.toCss(p,v,_,C),rgba:r.toRgba(p,v,_,C)}}}(d||(e.channels=d={})),function(r){function p(v,_){return o=Math.round(255*_),[a,h,f]=i.toChannels(v.rgba),{css:d.toCss(a,h,f,o),rgba:d.toRgba(a,h,f,o)}}r.blend=function(v,_){if(o=(255&_.rgba)/255,o===1)return{css:_.css,rgba:_.rgba};const C=_.rgba>>24&255,g=_.rgba>>16&255,S=_.rgba>>8&255,k=v.rgba>>24&255,L=v.rgba>>16&255,M=v.rgba>>8&255;return a=k+Math.round((C-k)*o),h=L+Math.round((g-L)*o),f=M+Math.round((S-M)*o),{css:d.toCss(a,h,f),rgba:d.toRgba(a,h,f)}},r.isOpaque=function(v){return(255&v.rgba)==255},r.ensureContrastRatio=function(v,_,C){const g=i.ensureContrastRatio(v.rgba,_.rgba,C);if(g)return d.toColor(g>>24&255,g>>16&255,g>>8&255)},r.opaque=function(v){const _=(255|v.rgba)>>>0;return[a,h,f]=i.toChannels(_),{css:d.toCss(a,h,f),rgba:_}},r.opacity=p,r.multiplyOpacity=function(v,_){return o=255&v.rgba,p(v,o*_/255)},r.toColorRGB=function(v){return[v.rgba>>24&255,v.rgba>>16&255,v.rgba>>8&255]}}(m||(e.color=m={})),function(r){let p,v;try{const _=document.createElement("canvas");_.width=1,_.height=1;const C=_.getContext("2d",{willReadFrequently:!0});C&&(p=C,p.globalCompositeOperation="copy",v=p.createLinearGradient(0,0,1,1))}catch{}r.toColor=function(_){if(_.match(/#[\da-f]{3,8}/i))switch(_.length){case 4:return a=parseInt(_.slice(1,2).repeat(2),16),h=parseInt(_.slice(2,3).repeat(2),16),f=parseInt(_.slice(3,4).repeat(2),16),d.toColor(a,h,f);case 5:return a=parseInt(_.slice(1,2).repeat(2),16),h=parseInt(_.slice(2,3).repeat(2),16),f=parseInt(_.slice(3,4).repeat(2),16),o=parseInt(_.slice(4,5).repeat(2),16),d.toColor(a,h,f,o);case 7:return{css:_,rgba:(parseInt(_.slice(1),16)<<8|255)>>>0};case 9:return{css:_,rgba:parseInt(_.slice(1),16)>>>0}}const C=_.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(C)return a=parseInt(C[1]),h=parseInt(C[2]),f=parseInt(C[3]),o=Math.round(255*(C[5]===void 0?1:parseFloat(C[5]))),d.toColor(a,h,f,o);if(!p||!v)throw new Error("css.toColor: Unsupported css format");if(p.fillStyle=v,p.fillStyle=_,typeof p.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(p.fillRect(0,0,1,1),[a,h,f,o]=p.getImageData(0,0,1,1).data,o!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:d.toRgba(a,h,f,o),css:_}}}(b||(e.css=b={})),function(r){function p(v,_,C){const g=v/255,S=_/255,k=C/255;return .2126*(g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4))+.7152*(S<=.03928?S/12.92:Math.pow((S+.055)/1.055,2.4))+.0722*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))}r.relativeLuminance=function(v){return p(v>>16&255,v>>8&255,255&v)},r.relativeLuminance2=p}(l||(e.rgb=l={})),function(r){function p(_,C,g){const S=_>>24&255,k=_>>16&255,L=_>>8&255;let M=C>>24&255,A=C>>16&255,P=C>>8&255,F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));for(;F<g&&(M>0||A>0||P>0);)M-=Math.max(0,Math.ceil(.1*M)),A-=Math.max(0,Math.ceil(.1*A)),P-=Math.max(0,Math.ceil(.1*P)),F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));return(M<<24|A<<16|P<<8|255)>>>0}function v(_,C,g){const S=_>>24&255,k=_>>16&255,L=_>>8&255;let M=C>>24&255,A=C>>16&255,P=C>>8&255,F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));for(;F<g&&(M<255||A<255||P<255);)M=Math.min(255,M+Math.ceil(.1*(255-M))),A=Math.min(255,A+Math.ceil(.1*(255-A))),P=Math.min(255,P+Math.ceil(.1*(255-P))),F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));return(M<<24|A<<16|P<<8|255)>>>0}r.blend=function(_,C){if(o=(255&C)/255,o===1)return C;const g=C>>24&255,S=C>>16&255,k=C>>8&255,L=_>>24&255,M=_>>16&255,A=_>>8&255;return a=L+Math.round((g-L)*o),h=M+Math.round((S-M)*o),f=A+Math.round((k-A)*o),d.toRgba(a,h,f)},r.ensureContrastRatio=function(_,C,g){const S=l.relativeLuminance(_>>8),k=l.relativeLuminance(C>>8);if(n(S,k)<g){if(k<S){const A=p(_,C,g),P=n(S,l.relativeLuminance(A>>8));if(P<g){const F=v(_,C,g);return P>n(S,l.relativeLuminance(F>>8))?A:F}return A}const L=v(_,C,g),M=n(S,l.relativeLuminance(L>>8));if(M<g){const A=p(_,C,g);return M>n(S,l.relativeLuminance(A>>8))?L:A}return L}},r.reduceLuminance=p,r.increaseLuminance=v,r.toChannels=function(_){return[_>>24&255,_>>16&255,_>>8&255,255&_]}}(i||(e.rgba=i={})),e.toPaddedHex=c,e.contrastRatio=n},8969:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreTerminal=void 0;const h=a(844),f=a(2585),o=a(4348),d=a(7866),m=a(744),b=a(7302),l=a(6975),i=a(8460),c=a(1753),n=a(1480),r=a(7994),p=a(9282),v=a(5435),_=a(5981),C=a(2660);let g=!1;class S extends h.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new i.EventEmitter),this._onScroll.event(L=>{this._onScrollApi?.fire(L.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(L){for(const M in L)this.optionsService.options[M]=L[M]}constructor(L){super(),this._windowsWrappingHeuristics=this.register(new h.MutableDisposable),this._onBinary=this.register(new i.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new i.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new i.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new i.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new i.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new i.EventEmitter),this._instantiationService=new o.InstantiationService,this.optionsService=this.register(new b.OptionsService(L)),this._instantiationService.setService(f.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(m.BufferService)),this._instantiationService.setService(f.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(d.LogService)),this._instantiationService.setService(f.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(l.CoreService)),this._instantiationService.setService(f.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(c.CoreMouseService)),this._instantiationService.setService(f.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(n.UnicodeService)),this._instantiationService.setService(f.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(r.CharsetService),this._instantiationService.setService(f.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(C.OscLinkService),this._instantiationService.setService(f.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new v.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,i.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,i.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,i.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,i.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new _.WriteBuffer((M,A)=>this._inputHandler.parse(M,A))),this.register((0,i.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(L,M){this._writeBuffer.write(L,M)}writeSync(L,M){this._logService.logLevel<=f.LogLevelEnum.WARN&&!g&&(this._logService.warn("writeSync is unreliable and will be removed soon."),g=!0),this._writeBuffer.writeSync(L,M)}input(L,M=!0){this.coreService.triggerDataEvent(L,M)}resize(L,M){isNaN(L)||isNaN(M)||(L=Math.max(L,m.MINIMUM_COLS),M=Math.max(M,m.MINIMUM_ROWS),this._bufferService.resize(L,M))}scroll(L,M=!1){this._bufferService.scroll(L,M)}scrollLines(L,M,A){this._bufferService.scrollLines(L,M,A)}scrollPages(L){this.scrollLines(L*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(L){const M=L-this._bufferService.buffer.ydisp;M!==0&&this.scrollLines(M)}registerEscHandler(L,M){return this._inputHandler.registerEscHandler(L,M)}registerDcsHandler(L,M){return this._inputHandler.registerDcsHandler(L,M)}registerCsiHandler(L,M){return this._inputHandler.registerCsiHandler(L,M)}registerOscHandler(L,M){return this._inputHandler.registerOscHandler(L,M)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let L=!1;const M=this.optionsService.rawOptions.windowsPty;M&&M.buildNumber!==void 0&&M.buildNumber!==void 0?L=M.backend==="conpty"&&M.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(L=!0),L?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const L=[];L.push(this.onLineFeed(p.updateWindowsModeWrappedState.bind(null,this._bufferService))),L.push(this.registerCsiHandler({final:"H"},()=>((0,p.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,h.toDisposable)(()=>{for(const M of L)M.dispose()})}}}e.CoreTerminal=S},8460:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.runAndSubscribe=e.forwardEvent=e.EventEmitter=void 0,e.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===a)return void this._listeners.splice(h,1)}}})),this._event}fire(a,h){const f=[];for(let o=0;o<this._listeners.length;o++)f.push(this._listeners[o]);for(let o=0;o<f.length;o++)f[o].call(void 0,a,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},e.forwardEvent=function(a,h){return a(f=>h.fire(f))},e.runAndSubscribe=function(a,h){return h(void 0),a(f=>h(f))}},5435:function(x,e,a){var h=this&&this.__decorate||function($,E,R,T){var I,N=arguments.length,j=N<3?E:T===null?T=Object.getOwnPropertyDescriptor(E,R):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate($,E,R,T);else for(var K=$.length-1;K>=0;K--)(I=$[K])&&(j=(N<3?I(j):N>3?I(E,R,j):I(E,R))||j);return N>3&&j&&Object.defineProperty(E,R,j),j},f=this&&this.__param||function($,E){return function(R,T){E(R,T,$)}};Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandler=e.WindowsOptionsReportType=void 0;const o=a(2584),d=a(7116),m=a(2015),b=a(844),l=a(482),i=a(8437),c=a(8460),n=a(643),r=a(511),p=a(3734),v=a(2585),_=a(1480),C=a(6242),g=a(6351),S=a(5941),k={"(":0,")":1,"*":2,"+":3,"-":1,".":2},L=131072;function M($,E){if($>24)return E.setWinLines||!1;switch($){case 1:return!!E.restoreWin;case 2:return!!E.minimizeWin;case 3:return!!E.setWinPosition;case 4:return!!E.setWinSizePixels;case 5:return!!E.raiseWin;case 6:return!!E.lowerWin;case 7:return!!E.refreshWin;case 8:return!!E.setWinSizeChars;case 9:return!!E.maximizeWin;case 10:return!!E.fullscreenWin;case 11:return!!E.getWinState;case 13:return!!E.getWinPosition;case 14:return!!E.getWinSizePixels;case 15:return!!E.getScreenSizePixels;case 16:return!!E.getCellSizePixels;case 18:return!!E.getWinSizeChars;case 19:return!!E.getScreenSizeChars;case 20:return!!E.getIconTitle;case 21:return!!E.getWinTitle;case 22:return!!E.pushTitle;case 23:return!!E.popTitle;case 24:return!!E.setWinLines}return!1}var A;(function($){$[$.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",$[$.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(A||(e.WindowsOptionsReportType=A={}));let P=0;class F extends b.Disposable{getAttrData(){return this._curAttrData}constructor(E,R,T,I,N,j,K,X,O=new m.EscapeSequenceParser){super(),this._bufferService=E,this._charsetService=R,this._coreService=T,this._logService=I,this._optionsService=N,this._oscLinkService=j,this._coreMouseService=K,this._unicodeService=X,this._parser=O,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new l.StringToUtf32,this._utf8Decoder=new l.Utf8ToUtf32,this._workCell=new r.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=i.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=i.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new c.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new c.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new c.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new c.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new c.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new c.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new c.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new c.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new c.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new c.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new c.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new c.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new c.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new U(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(D=>this._activeBuffer=D.activeBuffer)),this._parser.setCsiHandlerFallback((D,W)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(D),params:W.toArray()})}),this._parser.setEscHandlerFallback(D=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(D)})}),this._parser.setExecuteHandlerFallback(D=>{this._logService.debug("Unknown EXECUTE code: ",{code:D})}),this._parser.setOscHandlerFallback((D,W,z)=>{this._logService.debug("Unknown OSC code: ",{identifier:D,action:W,data:z})}),this._parser.setDcsHandlerFallback((D,W,z)=>{W==="HOOK"&&(z=z.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(D),action:W,payload:z})}),this._parser.setPrintHandler((D,W,z)=>this.print(D,W,z)),this._parser.registerCsiHandler({final:"@"},D=>this.insertChars(D)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},D=>this.scrollLeft(D)),this._parser.registerCsiHandler({final:"A"},D=>this.cursorUp(D)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},D=>this.scrollRight(D)),this._parser.registerCsiHandler({final:"B"},D=>this.cursorDown(D)),this._parser.registerCsiHandler({final:"C"},D=>this.cursorForward(D)),this._parser.registerCsiHandler({final:"D"},D=>this.cursorBackward(D)),this._parser.registerCsiHandler({final:"E"},D=>this.cursorNextLine(D)),this._parser.registerCsiHandler({final:"F"},D=>this.cursorPrecedingLine(D)),this._parser.registerCsiHandler({final:"G"},D=>this.cursorCharAbsolute(D)),this._parser.registerCsiHandler({final:"H"},D=>this.cursorPosition(D)),this._parser.registerCsiHandler({final:"I"},D=>this.cursorForwardTab(D)),this._parser.registerCsiHandler({final:"J"},D=>this.eraseInDisplay(D,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},D=>this.eraseInDisplay(D,!0)),this._parser.registerCsiHandler({final:"K"},D=>this.eraseInLine(D,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},D=>this.eraseInLine(D,!0)),this._parser.registerCsiHandler({final:"L"},D=>this.insertLines(D)),this._parser.registerCsiHandler({final:"M"},D=>this.deleteLines(D)),this._parser.registerCsiHandler({final:"P"},D=>this.deleteChars(D)),this._parser.registerCsiHandler({final:"S"},D=>this.scrollUp(D)),this._parser.registerCsiHandler({final:"T"},D=>this.scrollDown(D)),this._parser.registerCsiHandler({final:"X"},D=>this.eraseChars(D)),this._parser.registerCsiHandler({final:"Z"},D=>this.cursorBackwardTab(D)),this._parser.registerCsiHandler({final:"`"},D=>this.charPosAbsolute(D)),this._parser.registerCsiHandler({final:"a"},D=>this.hPositionRelative(D)),this._parser.registerCsiHandler({final:"b"},D=>this.repeatPrecedingCharacter(D)),this._parser.registerCsiHandler({final:"c"},D=>this.sendDeviceAttributesPrimary(D)),this._parser.registerCsiHandler({prefix:">",final:"c"},D=>this.sendDeviceAttributesSecondary(D)),this._parser.registerCsiHandler({final:"d"},D=>this.linePosAbsolute(D)),this._parser.registerCsiHandler({final:"e"},D=>this.vPositionRelative(D)),this._parser.registerCsiHandler({final:"f"},D=>this.hVPosition(D)),this._parser.registerCsiHandler({final:"g"},D=>this.tabClear(D)),this._parser.registerCsiHandler({final:"h"},D=>this.setMode(D)),this._parser.registerCsiHandler({prefix:"?",final:"h"},D=>this.setModePrivate(D)),this._parser.registerCsiHandler({final:"l"},D=>this.resetMode(D)),this._parser.registerCsiHandler({prefix:"?",final:"l"},D=>this.resetModePrivate(D)),this._parser.registerCsiHandler({final:"m"},D=>this.charAttributes(D)),this._parser.registerCsiHandler({final:"n"},D=>this.deviceStatus(D)),this._parser.registerCsiHandler({prefix:"?",final:"n"},D=>this.deviceStatusPrivate(D)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},D=>this.softReset(D)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},D=>this.setCursorStyle(D)),this._parser.registerCsiHandler({final:"r"},D=>this.setScrollRegion(D)),this._parser.registerCsiHandler({final:"s"},D=>this.saveCursor(D)),this._parser.registerCsiHandler({final:"t"},D=>this.windowOptions(D)),this._parser.registerCsiHandler({final:"u"},D=>this.restoreCursor(D)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},D=>this.insertColumns(D)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},D=>this.deleteColumns(D)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},D=>this.selectProtected(D)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},D=>this.requestMode(D,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},D=>this.requestMode(D,!1)),this._parser.setExecuteHandler(o.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(o.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(o.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(o.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(o.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(o.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(o.C1.IND,()=>this.index()),this._parser.setExecuteHandler(o.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(o.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new C.OscHandler(D=>(this.setTitle(D),this.setIconName(D),!0))),this._parser.registerOscHandler(1,new C.OscHandler(D=>this.setIconName(D))),this._parser.registerOscHandler(2,new C.OscHandler(D=>this.setTitle(D))),this._parser.registerOscHandler(4,new C.OscHandler(D=>this.setOrReportIndexedColor(D))),this._parser.registerOscHandler(8,new C.OscHandler(D=>this.setHyperlink(D))),this._parser.registerOscHandler(10,new C.OscHandler(D=>this.setOrReportFgColor(D))),this._parser.registerOscHandler(11,new C.OscHandler(D=>this.setOrReportBgColor(D))),this._parser.registerOscHandler(12,new C.OscHandler(D=>this.setOrReportCursorColor(D))),this._parser.registerOscHandler(104,new C.OscHandler(D=>this.restoreIndexedColor(D))),this._parser.registerOscHandler(110,new C.OscHandler(D=>this.restoreFgColor(D))),this._parser.registerOscHandler(111,new C.OscHandler(D=>this.restoreBgColor(D))),this._parser.registerOscHandler(112,new C.OscHandler(D=>this.restoreCursorColor(D))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const D in d.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:D},()=>this.selectCharset("("+D)),this._parser.registerEscHandler({intermediates:")",final:D},()=>this.selectCharset(")"+D)),this._parser.registerEscHandler({intermediates:"*",final:D},()=>this.selectCharset("*"+D)),this._parser.registerEscHandler({intermediates:"+",final:D},()=>this.selectCharset("+"+D)),this._parser.registerEscHandler({intermediates:"-",final:D},()=>this.selectCharset("-"+D)),this._parser.registerEscHandler({intermediates:".",final:D},()=>this.selectCharset("."+D)),this._parser.registerEscHandler({intermediates:"/",final:D},()=>this.selectCharset("/"+D));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(D=>(this._logService.error("Parsing error: ",D),D)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new g.DcsHandler((D,W)=>this.requestStatusString(D,W)))}_preserveStack(E,R,T,I){this._parseStack.paused=!0,this._parseStack.cursorStartX=E,this._parseStack.cursorStartY=R,this._parseStack.decodedLength=T,this._parseStack.position=I}_logSlowResolvingAsync(E){this._logService.logLevel<=v.LogLevelEnum.WARN&&Promise.race([E,new Promise((R,T)=>setTimeout(()=>T("#SLOW_TIMEOUT"),5e3))]).catch(R=>{if(R!=="#SLOW_TIMEOUT")throw R;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(E,R){let T,I=this._activeBuffer.x,N=this._activeBuffer.y,j=0;const K=this._parseStack.paused;if(K){if(T=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,R))return this._logSlowResolvingAsync(T),T;I=this._parseStack.cursorStartX,N=this._parseStack.cursorStartY,this._parseStack.paused=!1,E.length>L&&(j=this._parseStack.position+L)}if(this._logService.logLevel<=v.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof E=="string"?` "${E}"`:` "${Array.prototype.map.call(E,D=>String.fromCharCode(D)).join("")}"`),typeof E=="string"?E.split("").map(D=>D.charCodeAt(0)):E),this._parseBuffer.length<E.length&&this._parseBuffer.length<L&&(this._parseBuffer=new Uint32Array(Math.min(E.length,L))),K||this._dirtyRowTracker.clearRange(),E.length>L)for(let D=j;D<E.length;D+=L){const W=D+L<E.length?D+L:E.length,z=typeof E=="string"?this._stringDecoder.decode(E.substring(D,W),this._parseBuffer):this._utf8Decoder.decode(E.subarray(D,W),this._parseBuffer);if(T=this._parser.parse(this._parseBuffer,z))return this._preserveStack(I,N,z,D),this._logSlowResolvingAsync(T),T}else if(!K){const D=typeof E=="string"?this._stringDecoder.decode(E,this._parseBuffer):this._utf8Decoder.decode(E,this._parseBuffer);if(T=this._parser.parse(this._parseBuffer,D))return this._preserveStack(I,N,D,0),this._logSlowResolvingAsync(T),T}this._activeBuffer.x===I&&this._activeBuffer.y===N||this._onCursorMove.fire();const X=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),O=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);O<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(O,this._bufferService.rows-1),Math.min(X,this._bufferService.rows-1))}print(E,R,T){let I,N;const j=this._charsetService.charset,K=this._optionsService.rawOptions.screenReaderMode,X=this._bufferService.cols,O=this._coreService.decPrivateModes.wraparound,D=this._coreService.modes.insertMode,W=this._curAttrData;let z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&T-R>0&&z.getWidth(this._activeBuffer.x-1)===2&&z.setCellFromCodepoint(this._activeBuffer.x-1,0,1,W);let q=this._parser.precedingJoinState;for(let G=R;G<T;++G){if(I=E[G],I<127&&j){const le=j[String.fromCharCode(I)];le&&(I=le.charCodeAt(0))}const ee=this._unicodeService.charProperties(I,q);N=_.UnicodeService.extractWidth(ee);const Q=_.UnicodeService.extractShouldJoin(ee),oe=Q?_.UnicodeService.extractWidth(q):0;if(q=ee,K&&this._onA11yChar.fire((0,l.stringFromCodePoint)(I)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+N-oe>X){if(O){const le=z;let Y=this._activeBuffer.x-oe;for(this._activeBuffer.x=oe,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),oe>0&&z instanceof i.BufferLine&&z.copyCellsFrom(le,Y,0,oe,!1);Y<X;)le.setCellFromCodepoint(Y++,0,1,W)}else if(this._activeBuffer.x=X-1,N===2)continue}if(Q&&this._activeBuffer.x){const le=z.getWidth(this._activeBuffer.x-1)?1:2;z.addCodepointToCell(this._activeBuffer.x-le,I,N);for(let Y=N-oe;--Y>=0;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,W)}else if(D&&(z.insertCells(this._activeBuffer.x,N-oe,this._activeBuffer.getNullCell(W)),z.getWidth(X-1)===2&&z.setCellFromCodepoint(X-1,n.NULL_CELL_CODE,n.NULL_CELL_WIDTH,W)),z.setCellFromCodepoint(this._activeBuffer.x++,I,N,W),N>0)for(;--N;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,W)}this._parser.precedingJoinState=q,this._activeBuffer.x<X&&T-R>0&&z.getWidth(this._activeBuffer.x)===0&&!z.hasContent(this._activeBuffer.x)&&z.setCellFromCodepoint(this._activeBuffer.x,0,1,W),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(E,R){return E.final!=="t"||E.prefix||E.intermediates?this._parser.registerCsiHandler(E,R):this._parser.registerCsiHandler(E,T=>!M(T.params[0],this._optionsService.rawOptions.windowOptions)||R(T))}registerDcsHandler(E,R){return this._parser.registerDcsHandler(E,new g.DcsHandler(R))}registerEscHandler(E,R){return this._parser.registerEscHandler(E,R)}registerOscHandler(E,R){return this._parser.registerOscHandler(E,new C.OscHandler(R))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);E.hasWidth(this._activeBuffer.x)&&!E.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const E=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-E),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(E=this._bufferService.cols-1){this._activeBuffer.x=Math.min(E,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(E,R){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=E,this._activeBuffer.y=this._activeBuffer.scrollTop+R):(this._activeBuffer.x=E,this._activeBuffer.y=R),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(E,R){this._restrictCursor(),this._setCursor(this._activeBuffer.x+E,this._activeBuffer.y+R)}cursorUp(E){const R=this._activeBuffer.y-this._activeBuffer.scrollTop;return R>=0?this._moveCursor(0,-Math.min(R,E.params[0]||1)):this._moveCursor(0,-(E.params[0]||1)),!0}cursorDown(E){const R=this._activeBuffer.scrollBottom-this._activeBuffer.y;return R>=0?this._moveCursor(0,Math.min(R,E.params[0]||1)):this._moveCursor(0,E.params[0]||1),!0}cursorForward(E){return this._moveCursor(E.params[0]||1,0),!0}cursorBackward(E){return this._moveCursor(-(E.params[0]||1),0),!0}cursorNextLine(E){return this.cursorDown(E),this._activeBuffer.x=0,!0}cursorPrecedingLine(E){return this.cursorUp(E),this._activeBuffer.x=0,!0}cursorCharAbsolute(E){return this._setCursor((E.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(E){return this._setCursor(E.length>=2?(E.params[1]||1)-1:0,(E.params[0]||1)-1),!0}charPosAbsolute(E){return this._setCursor((E.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(E){return this._moveCursor(E.params[0]||1,0),!0}linePosAbsolute(E){return this._setCursor(this._activeBuffer.x,(E.params[0]||1)-1),!0}vPositionRelative(E){return this._moveCursor(0,E.params[0]||1),!0}hVPosition(E){return this.cursorPosition(E),!0}tabClear(E){const R=E.params[0];return R===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:R===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(E){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=E.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(E){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=E.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(E){const R=E.params[0];return R===1&&(this._curAttrData.bg|=536870912),R!==2&&R!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(E,R,T,I=!1,N=!1){const j=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);j.replaceCells(R,T,this._activeBuffer.getNullCell(this._eraseAttrData()),N),I&&(j.isWrapped=!1)}_resetBufferLine(E,R=!1){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);T&&(T.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),R),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+E),T.isWrapped=!1)}eraseInDisplay(E,R=!1){let T;switch(this._restrictCursor(this._bufferService.cols),E.params[0]){case 0:for(T=this._activeBuffer.y,this._dirtyRowTracker.markDirty(T),this._eraseInBufferLine(T++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);T<this._bufferService.rows;T++)this._resetBufferLine(T,R);this._dirtyRowTracker.markDirty(T);break;case 1:for(T=this._activeBuffer.y,this._dirtyRowTracker.markDirty(T),this._eraseInBufferLine(T,0,this._activeBuffer.x+1,!0,R),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(T+1).isWrapped=!1);T--;)this._resetBufferLine(T,R);this._dirtyRowTracker.markDirty(0);break;case 2:for(T=this._bufferService.rows,this._dirtyRowTracker.markDirty(T-1);T--;)this._resetBufferLine(T,R);this._dirtyRowTracker.markDirty(0);break;case 3:const I=this._activeBuffer.lines.length-this._bufferService.rows;I>0&&(this._activeBuffer.lines.trimStart(I),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-I,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-I,0),this._onScroll.fire(0))}return!0}eraseInLine(E,R=!1){switch(this._restrictCursor(this._bufferService.cols),E.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,R);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,R)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(E){this._restrictCursor();let R=E.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const T=this._activeBuffer.ybase+this._activeBuffer.y,I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,N=this._bufferService.rows-1+this._activeBuffer.ybase-I+1;for(;R--;)this._activeBuffer.lines.splice(N-1,1),this._activeBuffer.lines.splice(T,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(E){this._restrictCursor();let R=E.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const T=this._activeBuffer.ybase+this._activeBuffer.y;let I;for(I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,I=this._bufferService.rows-1+this._activeBuffer.ybase-I;R--;)this._activeBuffer.lines.splice(T,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(E){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.insertCells(this._activeBuffer.x,E.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(E){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.deleteCells(this._activeBuffer.x,E.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(E){let R=E.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(E){let R=E.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(i.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=E.params[0]||1;for(let T=this._activeBuffer.scrollTop;T<=this._activeBuffer.scrollBottom;++T){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);I.deleteCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=E.params[0]||1;for(let T=this._activeBuffer.scrollTop;T<=this._activeBuffer.scrollBottom;++T){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);I.insertCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=E.params[0]||1;for(let T=this._activeBuffer.scrollTop;T<=this._activeBuffer.scrollBottom;++T){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);I.insertCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=E.params[0]||1;for(let T=this._activeBuffer.scrollTop;T<=this._activeBuffer.scrollBottom;++T){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);I.deleteCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(E){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(E.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(E){const R=this._parser.precedingJoinState;if(!R)return!0;const T=E.params[0]||1,I=_.UnicodeService.extractWidth(R),N=this._activeBuffer.x-I,j=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(N),K=new Uint32Array(j.length*T);let X=0;for(let D=0;D<j.length;){const W=j.codePointAt(D)||0;K[X++]=W,D+=W>65535?2:1}let O=X;for(let D=1;D<T;++D)K.copyWithin(O,0,X),O+=X;return this.print(K,0,O),!0}sendDeviceAttributesPrimary(E){return E.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(o.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(o.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(E){return E.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(o.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(o.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(E.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(o.C0.ESC+"[>83;40003;0c")),!0}_is(E){return(this._optionsService.rawOptions.termName+"").indexOf(E)===0}setMode(E){for(let R=0;R<E.length;R++)switch(E.params[R]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(E){for(let R=0;R<E.length;R++)switch(E.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,d.DEFAULT_CHARSET),this._charsetService.setgCharset(1,d.DEFAULT_CHARSET),this._charsetService.setgCharset(2,d.DEFAULT_CHARSET),this._charsetService.setgCharset(3,d.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(E){for(let R=0;R<E.length;R++)switch(E.params[R]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(E){for(let R=0;R<E.length;R++)switch(E.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),E.params[R]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(E,R){const T=this._coreService.decPrivateModes,{activeProtocol:I,activeEncoding:N}=this._coreMouseService,j=this._coreService,{buffers:K,cols:X}=this._bufferService,{active:O,alt:D}=K,W=this._optionsService.rawOptions,z=Q=>Q?1:2,q=E.params[0];return G=q,ee=R?q===2?4:q===4?z(j.modes.insertMode):q===12?3:q===20?z(W.convertEol):0:q===1?z(T.applicationCursorKeys):q===3?W.windowOptions.setWinLines?X===80?2:X===132?1:0:0:q===6?z(T.origin):q===7?z(T.wraparound):q===8?3:q===9?z(I==="X10"):q===12?z(W.cursorBlink):q===25?z(!j.isCursorHidden):q===45?z(T.reverseWraparound):q===66?z(T.applicationKeypad):q===67?4:q===1e3?z(I==="VT200"):q===1002?z(I==="DRAG"):q===1003?z(I==="ANY"):q===1004?z(T.sendFocus):q===1005?4:q===1006?z(N==="SGR"):q===1015?4:q===1016?z(N==="SGR_PIXELS"):q===1048?1:q===47||q===1047||q===1049?z(O===D):q===2004?z(T.bracketedPasteMode):0,j.triggerDataEvent(`${o.C0.ESC}[${R?"":"?"}${G};${ee}$y`),!0;var G,ee}_updateAttrColor(E,R,T,I,N){return R===2?(E|=50331648,E&=-16777216,E|=p.AttributeData.fromColorRGB([T,I,N])):R===5&&(E&=-50331904,E|=33554432|255&T),E}_extractColor(E,R,T){const I=[0,0,-1,0,0,0];let N=0,j=0;do{if(I[j+N]=E.params[R+j],E.hasSubParams(R+j)){const K=E.getSubParams(R+j);let X=0;do I[1]===5&&(N=1),I[j+X+1+N]=K[X];while(++X<K.length&&X+j+1+N<I.length);break}if(I[1]===5&&j+N>=2||I[1]===2&&j+N>=5)break;I[1]&&(N=1)}while(++j+R<E.length&&j+N<I.length);for(let K=2;K<I.length;++K)I[K]===-1&&(I[K]=0);switch(I[0]){case 38:T.fg=this._updateAttrColor(T.fg,I[1],I[3],I[4],I[5]);break;case 48:T.bg=this._updateAttrColor(T.bg,I[1],I[3],I[4],I[5]);break;case 58:T.extended=T.extended.clone(),T.extended.underlineColor=this._updateAttrColor(T.extended.underlineColor,I[1],I[3],I[4],I[5])}return j}_processUnderline(E,R){R.extended=R.extended.clone(),(!~E||E>5)&&(E=1),R.extended.underlineStyle=E,R.fg|=268435456,E===0&&(R.fg&=-268435457),R.updateExtended()}_processSGR0(E){E.fg=i.DEFAULT_ATTR_DATA.fg,E.bg=i.DEFAULT_ATTR_DATA.bg,E.extended=E.extended.clone(),E.extended.underlineStyle=0,E.extended.underlineColor&=-67108864,E.updateExtended()}charAttributes(E){if(E.length===1&&E.params[0]===0)return this._processSGR0(this._curAttrData),!0;const R=E.length;let T;const I=this._curAttrData;for(let N=0;N<R;N++)T=E.params[N],T>=30&&T<=37?(I.fg&=-50331904,I.fg|=16777216|T-30):T>=40&&T<=47?(I.bg&=-50331904,I.bg|=16777216|T-40):T>=90&&T<=97?(I.fg&=-50331904,I.fg|=16777224|T-90):T>=100&&T<=107?(I.bg&=-50331904,I.bg|=16777224|T-100):T===0?this._processSGR0(I):T===1?I.fg|=134217728:T===3?I.bg|=67108864:T===4?(I.fg|=268435456,this._processUnderline(E.hasSubParams(N)?E.getSubParams(N)[0]:1,I)):T===5?I.fg|=536870912:T===7?I.fg|=67108864:T===8?I.fg|=1073741824:T===9?I.fg|=2147483648:T===2?I.bg|=134217728:T===21?this._processUnderline(2,I):T===22?(I.fg&=-134217729,I.bg&=-134217729):T===23?I.bg&=-67108865:T===24?(I.fg&=-268435457,this._processUnderline(0,I)):T===25?I.fg&=-536870913:T===27?I.fg&=-67108865:T===28?I.fg&=-1073741825:T===29?I.fg&=2147483647:T===39?(I.fg&=-67108864,I.fg|=16777215&i.DEFAULT_ATTR_DATA.fg):T===49?(I.bg&=-67108864,I.bg|=16777215&i.DEFAULT_ATTR_DATA.bg):T===38||T===48||T===58?N+=this._extractColor(E,N,I):T===53?I.bg|=1073741824:T===55?I.bg&=-1073741825:T===59?(I.extended=I.extended.clone(),I.extended.underlineColor=-1,I.updateExtended()):T===100?(I.fg&=-67108864,I.fg|=16777215&i.DEFAULT_ATTR_DATA.fg,I.bg&=-67108864,I.bg|=16777215&i.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",T);return!0}deviceStatus(E){switch(E.params[0]){case 5:this._coreService.triggerDataEvent(`${o.C0.ESC}[0n`);break;case 6:const R=this._activeBuffer.y+1,T=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[${R};${T}R`)}return!0}deviceStatusPrivate(E){if(E.params[0]===6){const R=this._activeBuffer.y+1,T=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[?${R};${T}R`)}return!0}softReset(E){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=i.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(E){const R=E.params[0]||1;switch(R){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const T=R%2==1;return this._optionsService.options.cursorBlink=T,!0}setScrollRegion(E){const R=E.params[0]||1;let T;return(E.length<2||(T=E.params[1])>this._bufferService.rows||T===0)&&(T=this._bufferService.rows),T>R&&(this._activeBuffer.scrollTop=R-1,this._activeBuffer.scrollBottom=T-1,this._setCursor(0,0)),!0}windowOptions(E){if(!M(E.params[0],this._optionsService.rawOptions.windowOptions))return!0;const R=E.length>1?E.params[1]:0;switch(E.params[0]){case 14:R!==2&&this._onRequestWindowsOptionsReport.fire(A.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(A.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${o.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:R!==0&&R!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),R!==0&&R!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:R!==0&&R!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),R!==0&&R!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(E){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(E){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(E){return this._windowTitle=E,this._onTitleChange.fire(E),!0}setIconName(E){return this._iconName=E,!0}setOrReportIndexedColor(E){const R=[],T=E.split(";");for(;T.length>1;){const I=T.shift(),N=T.shift();if(/^\d+$/.exec(I)){const j=parseInt(I);if(H(j))if(N==="?")R.push({type:0,index:j});else{const K=(0,S.parseColor)(N);K&&R.push({type:1,index:j,color:K})}}}return R.length&&this._onColor.fire(R),!0}setHyperlink(E){const R=E.split(";");return!(R.length<2)&&(R[1]?this._createHyperlink(R[0],R[1]):!R[0]&&this._finishHyperlink())}_createHyperlink(E,R){this._getCurrentLinkId()&&this._finishHyperlink();const T=E.split(":");let I;const N=T.findIndex(j=>j.startsWith("id="));return N!==-1&&(I=T[N].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:I,uri:R}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(E,R){const T=E.split(";");for(let I=0;I<T.length&&!(R>=this._specialColors.length);++I,++R)if(T[I]==="?")this._onColor.fire([{type:0,index:this._specialColors[R]}]);else{const N=(0,S.parseColor)(T[I]);N&&this._onColor.fire([{type:1,index:this._specialColors[R],color:N}])}return!0}setOrReportFgColor(E){return this._setOrReportSpecialColor(E,0)}setOrReportBgColor(E){return this._setOrReportSpecialColor(E,1)}setOrReportCursorColor(E){return this._setOrReportSpecialColor(E,2)}restoreIndexedColor(E){if(!E)return this._onColor.fire([{type:2}]),!0;const R=[],T=E.split(";");for(let I=0;I<T.length;++I)if(/^\d+$/.exec(T[I])){const N=parseInt(T[I]);H(N)&&R.push({type:2,index:N})}return R.length&&this._onColor.fire(R),!0}restoreFgColor(E){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(E){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(E){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,d.DEFAULT_CHARSET),!0}selectCharset(E){return E.length!==2?(this.selectDefaultCharset(),!0):(E[0]==="/"||this._charsetService.setgCharset(k[E[0]],d.CHARSETS[E[1]]||d.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const E=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,E,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=i.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=i.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(E){return this._charsetService.setgLevel(E),!0}screenAlignmentPattern(){const E=new r.CellData;E.content=4194373,E.fg=this._curAttrData.fg,E.bg=this._curAttrData.bg,this._setCursor(0,0);for(let R=0;R<this._bufferService.rows;++R){const T=this._activeBuffer.ybase+this._activeBuffer.y+R,I=this._activeBuffer.lines.get(T);I&&(I.fill(E),I.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(E,R){const T=this._bufferService.buffer,I=this._optionsService.rawOptions;return(N=>(this._coreService.triggerDataEvent(`${o.C0.ESC}${N}${o.C0.ESC}\\`),!0))(E==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:E==='"p'?'P1$r61;1"p':E==="r"?`P1$r${T.scrollTop+1};${T.scrollBottom+1}r`:E==="m"?"P1$r0m":E===" q"?`P1$r${{block:2,underline:4,bar:6}[I.cursorStyle]-(I.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(E,R){this._dirtyRowTracker.markRangeDirty(E,R)}}e.InputHandler=F;let U=class{constructor($){this._bufferService=$,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty($){$<this.start?this.start=$:$>this.end&&(this.end=$)}markRangeDirty($,E){$>E&&(P=$,$=E,E=P),$<this.start&&(this.start=$),E>this.end&&(this.end=E)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function H($){return 0<=$&&$<256}U=h([f(0,v.IBufferService)],U)},844:(x,e)=>{function a(h){for(const f of h)f.dispose();h.length=0}Object.defineProperty(e,"__esModule",{value:!0}),e.getDisposeArrayDisposable=e.disposeArray=e.toDisposable=e.MutableDisposable=e.Disposable=void 0,e.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){const f=this._disposables.indexOf(h);f!==-1&&this._disposables.splice(f,1)}},e.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){this._isDisposed||h===this._value||(this._value?.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},e.toDisposable=function(h){return{dispose:h}},e.disposeArray=a,e.getDisposeArrayDisposable=function(h){return{dispose:()=>a(h)}}},1505:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FourKeyMap=e.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(f,o,d){this._data[f]||(this._data[f]={}),this._data[f][o]=d}get(f,o){return this._data[f]?this._data[f][o]:void 0}clear(){this._data={}}}e.TwoKeyMap=a,e.FourKeyMap=class{constructor(){this._data=new a}set(h,f,o,d,m){this._data.get(h,f)||this._data.set(h,f,new a),this._data.get(h,f).set(o,d,m)}get(h,f,o,d){return this._data.get(h,f)?.get(o,d)}clear(){this._data.clear()}}},6114:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isChromeOS=e.isLinux=e.isWindows=e.isIphone=e.isIpad=e.isMac=e.getSafariVersion=e.isSafari=e.isLegacyEdge=e.isFirefox=e.isNode=void 0,e.isNode=typeof process<"u"&&"title"in process;const a=e.isNode?"node":navigator.userAgent,h=e.isNode?"node":navigator.platform;e.isFirefox=a.includes("Firefox"),e.isLegacyEdge=a.includes("Edge"),e.isSafari=/^((?!chrome|android).)*safari/i.test(a),e.getSafariVersion=function(){if(!e.isSafari)return 0;const f=a.match(/Version\/(\d+)/);return f===null||f.length<2?0:parseInt(f[1])},e.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(h),e.isIpad=h==="iPad",e.isIphone=h==="iPhone",e.isWindows=["Windows","Win16","Win32","WinCE"].includes(h),e.isLinux=h.indexOf("Linux")>=0,e.isChromeOS=/\bCrOS\b/.test(a)},6106:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SortedList=void 0;let a=0;e.SortedList=class{constructor(h){this._getKey=h,this._array=[]}clear(){this._array.length=0}insert(h){this._array.length!==0?(a=this._search(this._getKey(h)),this._array.splice(a,0,h)):this._array.push(h)}delete(h){if(this._array.length===0)return!1;const f=this._getKey(h);if(f===void 0||(a=this._search(f),a===-1)||this._getKey(this._array[a])!==f)return!1;do if(this._array[a]===h)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===f);return!1}*getKeyIterator(h){if(this._array.length!==0&&(a=this._search(h),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===h))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===h)}forEachByKey(h,f){if(this._array.length!==0&&(a=this._search(h),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===h))do f(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===h)}values(){return[...this._array].values()}_search(h){let f=0,o=this._array.length-1;for(;o>=f;){let d=f+o>>1;const m=this._getKey(this._array[d]);if(m>h)o=d-1;else{if(!(m<h)){for(;d>0&&this._getKey(this._array[d-1])===h;)d--;return d}f=d+1}}return f}}},7226:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DebouncedIdleTask=e.IdleTaskQueue=e.PriorityTaskQueue=void 0;const h=a(6114);class f{constructor(){this._tasks=[],this._i=0}enqueue(m){this._tasks.push(m),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(m){this._idleCallback=void 0;let b=0,l=0,i=m.timeRemaining(),c=0;for(;this._i<this._tasks.length;){if(b=Date.now(),this._tasks[this._i]()||this._i++,b=Math.max(1,Date.now()-b),l=Math.max(b,l),c=m.timeRemaining(),1.5*l>c)return i-b<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-b))}ms`),void this._start();i=c}this.clear()}}class o extends f{_requestCallback(m){return setTimeout(()=>m(this._createDeadline(16)))}_cancelCallback(m){clearTimeout(m)}_createDeadline(m){const b=Date.now()+m;return{timeRemaining:()=>Math.max(0,b-Date.now())}}}e.PriorityTaskQueue=o,e.IdleTaskQueue=!h.isNode&&"requestIdleCallback"in window?class extends f{_requestCallback(d){return requestIdleCallback(d)}_cancelCallback(d){cancelIdleCallback(d)}}:o,e.DebouncedIdleTask=class{constructor(){this._queue=new e.IdleTaskQueue}set(d){this._queue.clear(),this._queue.enqueue(d)}flush(){this._queue.flush()}}},9282:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.updateWindowsModeWrappedState=void 0;const h=a(643);e.updateWindowsModeWrappedState=function(f){const o=f.buffer.lines.get(f.buffer.ybase+f.buffer.y-1),d=o?.get(f.cols-1),m=f.buffer.lines.get(f.buffer.ybase+f.buffer.y);m&&d&&(m.isWrapped=d[h.CHAR_DATA_CODE_INDEX]!==h.NULL_CELL_CODE&&d[h.CHAR_DATA_CODE_INDEX]!==h.WHITESPACE_CELL_CODE)}},3734:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtendedAttrs=e.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new h}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){const o=new a;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}e.AttributeData=a;class h{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}get underlineVariantOffset(){const o=(3758096384&this._ext)>>29;return o<0?4294967288^o:o}set underlineVariantOffset(o){this._ext&=536870911,this._ext|=o<<29&3758096384}constructor(o=0,d=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=d}clone(){return new h(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}e.ExtendedAttrs=h},9092:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Buffer=e.MAX_BUFFER_SIZE=void 0;const h=a(6349),f=a(7226),o=a(3734),d=a(8437),m=a(4634),b=a(511),l=a(643),i=a(4863),c=a(7116);e.MAX_BUFFER_SIZE=4294967295,e.Buffer=class{constructor(n,r,p){this._hasScrollback=n,this._optionsService=r,this._bufferService=p,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=d.DEFAULT_ATTR_DATA.clone(),this.savedCharset=c.DEFAULT_CHARSET,this.markers=[],this._nullCell=b.CellData.fromCharData([0,l.NULL_CELL_CHAR,l.NULL_CELL_WIDTH,l.NULL_CELL_CODE]),this._whitespaceCell=b.CellData.fromCharData([0,l.WHITESPACE_CELL_CHAR,l.WHITESPACE_CELL_WIDTH,l.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new f.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(n){return n?(this._nullCell.fg=n.fg,this._nullCell.bg=n.bg,this._nullCell.extended=n.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new o.ExtendedAttrs),this._nullCell}getWhitespaceCell(n){return n?(this._whitespaceCell.fg=n.fg,this._whitespaceCell.bg=n.bg,this._whitespaceCell.extended=n.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new o.ExtendedAttrs),this._whitespaceCell}getBlankLine(n,r){return new d.BufferLine(this._bufferService.cols,this.getNullCell(n),r)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const n=this.ybase+this.y-this.ydisp;return n>=0&&n<this._rows}_getCorrectBufferLength(n){if(!this._hasScrollback)return n;const r=n+this._optionsService.rawOptions.scrollback;return r>e.MAX_BUFFER_SIZE?e.MAX_BUFFER_SIZE:r}fillViewportRows(n){if(this.lines.length===0){n===void 0&&(n=d.DEFAULT_ATTR_DATA);let r=this._rows;for(;r--;)this.lines.push(this.getBlankLine(n))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(n,r){const p=this.getNullCell(d.DEFAULT_ATTR_DATA);let v=0;const _=this._getCorrectBufferLength(r);if(_>this.lines.maxLength&&(this.lines.maxLength=_),this.lines.length>0){if(this._cols<n)for(let g=0;g<this.lines.length;g++)v+=+this.lines.get(g).resize(n,p);let C=0;if(this._rows<r)for(let g=this._rows;g<r;g++)this.lines.length<r+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new d.BufferLine(n,p)):this.ybase>0&&this.lines.length<=this.ybase+this.y+C+1?(this.ybase--,C++,this.ydisp>0&&this.ydisp--):this.lines.push(new d.BufferLine(n,p)));else for(let g=this._rows;g>r;g--)this.lines.length>r+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(_<this.lines.maxLength){const g=this.lines.length-_;g>0&&(this.lines.trimStart(g),this.ybase=Math.max(this.ybase-g,0),this.ydisp=Math.max(this.ydisp-g,0),this.savedY=Math.max(this.savedY-g,0)),this.lines.maxLength=_}this.x=Math.min(this.x,n-1),this.y=Math.min(this.y,r-1),C&&(this.y+=C),this.savedX=Math.min(this.savedX,n-1),this.scrollTop=0}if(this.scrollBottom=r-1,this._isReflowEnabled&&(this._reflow(n,r),this._cols>n))for(let C=0;C<this.lines.length;C++)v+=+this.lines.get(C).resize(n,p);this._cols=n,this._rows=r,this._memoryCleanupQueue.clear(),v>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let n=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,n=!1);let r=0;for(;this._memoryCleanupPosition<this.lines.length;)if(r+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),r>100)return!0;return n}get _isReflowEnabled(){const n=this._optionsService.rawOptions.windowsPty;return n&&n.buildNumber?this._hasScrollback&&n.backend==="conpty"&&n.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(n,r){this._cols!==n&&(n>this._cols?this._reflowLarger(n,r):this._reflowSmaller(n,r))}_reflowLarger(n,r){const p=(0,m.reflowLargerGetLinesToRemove)(this.lines,this._cols,n,this.ybase+this.y,this.getNullCell(d.DEFAULT_ATTR_DATA));if(p.length>0){const v=(0,m.reflowLargerCreateNewLayout)(this.lines,p);(0,m.reflowLargerApplyNewLayout)(this.lines,v.layout),this._reflowLargerAdjustViewport(n,r,v.countRemoved)}}_reflowLargerAdjustViewport(n,r,p){const v=this.getNullCell(d.DEFAULT_ATTR_DATA);let _=p;for(;_-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<r&&this.lines.push(new d.BufferLine(n,v))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-p,0)}_reflowSmaller(n,r){const p=this.getNullCell(d.DEFAULT_ATTR_DATA),v=[];let _=0;for(let C=this.lines.length-1;C>=0;C--){let g=this.lines.get(C);if(!g||!g.isWrapped&&g.getTrimmedLength()<=n)continue;const S=[g];for(;g.isWrapped&&C>0;)g=this.lines.get(--C),S.unshift(g);const k=this.ybase+this.y;if(k>=C&&k<C+S.length)continue;const L=S[S.length-1].getTrimmedLength(),M=(0,m.reflowSmallerGetNewLineLengths)(S,this._cols,n),A=M.length-S.length;let P;P=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+A):Math.max(0,this.lines.length-this.lines.maxLength+A);const F=[];for(let T=0;T<A;T++){const I=this.getBlankLine(d.DEFAULT_ATTR_DATA,!0);F.push(I)}F.length>0&&(v.push({start:C+S.length+_,newLines:F}),_+=F.length),S.push(...F);let U=M.length-1,H=M[U];H===0&&(U--,H=M[U]);let $=S.length-A-1,E=L;for(;$>=0;){const T=Math.min(E,H);if(S[U]===void 0)break;if(S[U].copyCellsFrom(S[$],E-T,H-T,T,!0),H-=T,H===0&&(U--,H=M[U]),E-=T,E===0){$--;const I=Math.max($,0);E=(0,m.getWrappedLineTrimmedLength)(S,I,this._cols)}}for(let T=0;T<S.length;T++)M[T]<n&&S[T].setCell(M[T],p);let R=A-P;for(;R-- >0;)this.ybase===0?this.y<r-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+_)-r&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+A,this.ybase+r-1)}if(v.length>0){const C=[],g=[];for(let U=0;U<this.lines.length;U++)g.push(this.lines.get(U));const S=this.lines.length;let k=S-1,L=0,M=v[L];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+_);let A=0;for(let U=Math.min(this.lines.maxLength-1,S+_-1);U>=0;U--)if(M&&M.start>k+A){for(let H=M.newLines.length-1;H>=0;H--)this.lines.set(U--,M.newLines[H]);U++,C.push({index:k+1,amount:M.newLines.length}),A+=M.newLines.length,M=v[++L]}else this.lines.set(U,g[k--]);let P=0;for(let U=C.length-1;U>=0;U--)C[U].index+=P,this.lines.onInsertEmitter.fire(C[U]),P+=C[U].amount;const F=Math.max(0,S+_-this.lines.maxLength);F>0&&this.lines.onTrimEmitter.fire(F)}}translateBufferLineToString(n,r,p=0,v){const _=this.lines.get(n);return _?_.translateToString(r,p,v):""}getWrappedRangeForLine(n){let r=n,p=n;for(;r>0&&this.lines.get(r).isWrapped;)r--;for(;p+1<this.lines.length&&this.lines.get(p+1).isWrapped;)p++;return{first:r,last:p}}setupTabStops(n){for(n!=null?this.tabs[n]||(n=this.prevStop(n)):(this.tabs={},n=0);n<this._cols;n+=this._optionsService.rawOptions.tabStopWidth)this.tabs[n]=!0}prevStop(n){for(n==null&&(n=this.x);!this.tabs[--n]&&n>0;);return n>=this._cols?this._cols-1:n<0?0:n}nextStop(n){for(n==null&&(n=this.x);!this.tabs[++n]&&n<this._cols;);return n>=this._cols?this._cols-1:n<0?0:n}clearMarkers(n){this._isClearing=!0;for(let r=0;r<this.markers.length;r++)this.markers[r].line===n&&(this.markers[r].dispose(),this.markers.splice(r--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let n=0;n<this.markers.length;n++)this.markers[n].dispose(),this.markers.splice(n--,1);this._isClearing=!1}addMarker(n){const r=new i.Marker(n);return this.markers.push(r),r.register(this.lines.onTrim(p=>{r.line-=p,r.line<0&&r.dispose()})),r.register(this.lines.onInsert(p=>{r.line>=p.index&&(r.line+=p.amount)})),r.register(this.lines.onDelete(p=>{r.line>=p.index&&r.line<p.index+p.amount&&r.dispose(),r.line>p.index&&(r.line-=p.amount)})),r.register(r.onDispose(()=>this._removeMarker(r))),r}_removeMarker(n){this._isClearing||this.markers.splice(this.markers.indexOf(n),1)}}},8437:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferLine=e.DEFAULT_ATTR_DATA=void 0;const h=a(3734),f=a(511),o=a(643),d=a(482);e.DEFAULT_ATTR_DATA=Object.freeze(new h.AttributeData);let m=0;class b{constructor(i,c,n=!1){this.isWrapped=n,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*i);const r=c||f.CellData.fromCharData([0,o.NULL_CELL_CHAR,o.NULL_CELL_WIDTH,o.NULL_CELL_CODE]);for(let p=0;p<i;++p)this.setCell(p,r);this.length=i}get(i){const c=this._data[3*i+0],n=2097151&c;return[this._data[3*i+1],2097152&c?this._combined[i]:n?(0,d.stringFromCodePoint)(n):"",c>>22,2097152&c?this._combined[i].charCodeAt(this._combined[i].length-1):n]}set(i,c){this._data[3*i+1]=c[o.CHAR_DATA_ATTR_INDEX],c[o.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[i]=c[1],this._data[3*i+0]=2097152|i|c[o.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*i+0]=c[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|c[o.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(i){return this._data[3*i+0]>>22}hasWidth(i){return 12582912&this._data[3*i+0]}getFg(i){return this._data[3*i+1]}getBg(i){return this._data[3*i+2]}hasContent(i){return 4194303&this._data[3*i+0]}getCodePoint(i){const c=this._data[3*i+0];return 2097152&c?this._combined[i].charCodeAt(this._combined[i].length-1):2097151&c}isCombined(i){return 2097152&this._data[3*i+0]}getString(i){const c=this._data[3*i+0];return 2097152&c?this._combined[i]:2097151&c?(0,d.stringFromCodePoint)(2097151&c):""}isProtected(i){return 536870912&this._data[3*i+2]}loadCell(i,c){return m=3*i,c.content=this._data[m+0],c.fg=this._data[m+1],c.bg=this._data[m+2],2097152&c.content&&(c.combinedData=this._combined[i]),268435456&c.bg&&(c.extended=this._extendedAttrs[i]),c}setCell(i,c){2097152&c.content&&(this._combined[i]=c.combinedData),268435456&c.bg&&(this._extendedAttrs[i]=c.extended),this._data[3*i+0]=c.content,this._data[3*i+1]=c.fg,this._data[3*i+2]=c.bg}setCellFromCodepoint(i,c,n,r){268435456&r.bg&&(this._extendedAttrs[i]=r.extended),this._data[3*i+0]=c|n<<22,this._data[3*i+1]=r.fg,this._data[3*i+2]=r.bg}addCodepointToCell(i,c,n){let r=this._data[3*i+0];2097152&r?this._combined[i]+=(0,d.stringFromCodePoint)(c):2097151&r?(this._combined[i]=(0,d.stringFromCodePoint)(2097151&r)+(0,d.stringFromCodePoint)(c),r&=-2097152,r|=2097152):r=c|4194304,n&&(r&=-12582913,r|=n<<22),this._data[3*i+0]=r}insertCells(i,c,n){if((i%=this.length)&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i-1,0,1,n),c<this.length-i){const r=new f.CellData;for(let p=this.length-i-c-1;p>=0;--p)this.setCell(i+c+p,this.loadCell(i+p,r));for(let p=0;p<c;++p)this.setCell(i+p,n)}else for(let r=i;r<this.length;++r)this.setCell(r,n);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,n)}deleteCells(i,c,n){if(i%=this.length,c<this.length-i){const r=new f.CellData;for(let p=0;p<this.length-i-c;++p)this.setCell(i+p,this.loadCell(i+c+p,r));for(let p=this.length-c;p<this.length;++p)this.setCell(p,n)}else for(let r=i;r<this.length;++r)this.setCell(r,n);i&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i-1,0,1,n),this.getWidth(i)!==0||this.hasContent(i)||this.setCellFromCodepoint(i,0,1,n)}replaceCells(i,c,n,r=!1){if(r)for(i&&this.getWidth(i-1)===2&&!this.isProtected(i-1)&&this.setCellFromCodepoint(i-1,0,1,n),c<this.length&&this.getWidth(c-1)===2&&!this.isProtected(c)&&this.setCellFromCodepoint(c,0,1,n);i<c&&i<this.length;)this.isProtected(i)||this.setCell(i,n),i++;else for(i&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i-1,0,1,n),c<this.length&&this.getWidth(c-1)===2&&this.setCellFromCodepoint(c,0,1,n);i<c&&i<this.length;)this.setCell(i++,n)}resize(i,c){if(i===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const n=3*i;if(i>this.length){if(this._data.buffer.byteLength>=4*n)this._data=new Uint32Array(this._data.buffer,0,n);else{const r=new Uint32Array(n);r.set(this._data),this._data=r}for(let r=this.length;r<i;++r)this.setCell(r,c)}else{this._data=this._data.subarray(0,n);const r=Object.keys(this._combined);for(let v=0;v<r.length;v++){const _=parseInt(r[v],10);_>=i&&delete this._combined[_]}const p=Object.keys(this._extendedAttrs);for(let v=0;v<p.length;v++){const _=parseInt(p[v],10);_>=i&&delete this._extendedAttrs[_]}}return this.length=i,4*n*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const i=new Uint32Array(this._data.length);return i.set(this._data),this._data=i,1}return 0}fill(i,c=!1){if(c)for(let n=0;n<this.length;++n)this.isProtected(n)||this.setCell(n,i);else{this._combined={},this._extendedAttrs={};for(let n=0;n<this.length;++n)this.setCell(n,i)}}copyFrom(i){this.length!==i.length?this._data=new Uint32Array(i._data):this._data.set(i._data),this.length=i.length,this._combined={};for(const c in i._combined)this._combined[c]=i._combined[c];this._extendedAttrs={};for(const c in i._extendedAttrs)this._extendedAttrs[c]=i._extendedAttrs[c];this.isWrapped=i.isWrapped}clone(){const i=new b(0);i._data=new Uint32Array(this._data),i.length=this.length;for(const c in this._combined)i._combined[c]=this._combined[c];for(const c in this._extendedAttrs)i._extendedAttrs[c]=this._extendedAttrs[c];return i.isWrapped=this.isWrapped,i}getTrimmedLength(){for(let i=this.length-1;i>=0;--i)if(4194303&this._data[3*i+0])return i+(this._data[3*i+0]>>22);return 0}getNoBgTrimmedLength(){for(let i=this.length-1;i>=0;--i)if(4194303&this._data[3*i+0]||50331648&this._data[3*i+2])return i+(this._data[3*i+0]>>22);return 0}copyCellsFrom(i,c,n,r,p){const v=i._data;if(p)for(let C=r-1;C>=0;C--){for(let g=0;g<3;g++)this._data[3*(n+C)+g]=v[3*(c+C)+g];268435456&v[3*(c+C)+2]&&(this._extendedAttrs[n+C]=i._extendedAttrs[c+C])}else for(let C=0;C<r;C++){for(let g=0;g<3;g++)this._data[3*(n+C)+g]=v[3*(c+C)+g];268435456&v[3*(c+C)+2]&&(this._extendedAttrs[n+C]=i._extendedAttrs[c+C])}const _=Object.keys(i._combined);for(let C=0;C<_.length;C++){const g=parseInt(_[C],10);g>=c&&(this._combined[g-c+n]=i._combined[g])}}translateToString(i,c,n,r){c=c??0,n=n??this.length,i&&(n=Math.min(n,this.getTrimmedLength())),r&&(r.length=0);let p="";for(;c<n;){const v=this._data[3*c+0],_=2097151&v,C=2097152&v?this._combined[c]:_?(0,d.stringFromCodePoint)(_):o.WHITESPACE_CELL_CHAR;if(p+=C,r)for(let g=0;g<C.length;++g)r.push(c);c+=v>>22||1}return r&&r.push(c),p}}e.BufferLine=b},4841:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getRangeLength=void 0,e.getRangeLength=function(a,h){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return h*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(x,e)=>{function a(h,f,o){if(f===h.length-1)return h[f].getTrimmedLength();const d=!h[f].hasContent(o-1)&&h[f].getWidth(o-1)===1,m=h[f+1].getWidth(0)===2;return d&&m?o-1:o}Object.defineProperty(e,"__esModule",{value:!0}),e.getWrappedLineTrimmedLength=e.reflowSmallerGetNewLineLengths=e.reflowLargerApplyNewLayout=e.reflowLargerCreateNewLayout=e.reflowLargerGetLinesToRemove=void 0,e.reflowLargerGetLinesToRemove=function(h,f,o,d,m){const b=[];for(let l=0;l<h.length-1;l++){let i=l,c=h.get(++i);if(!c.isWrapped)continue;const n=[h.get(l)];for(;i<h.length&&c.isWrapped;)n.push(c),c=h.get(++i);if(d>=l&&d<i){l+=n.length-1;continue}let r=0,p=a(n,r,f),v=1,_=0;for(;v<n.length;){const g=a(n,v,f),S=g-_,k=o-p,L=Math.min(S,k);n[r].copyCellsFrom(n[v],_,p,L,!1),p+=L,p===o&&(r++,p=0),_+=L,_===g&&(v++,_=0),p===0&&r!==0&&n[r-1].getWidth(o-1)===2&&(n[r].copyCellsFrom(n[r-1],o-1,p++,1,!1),n[r-1].setCell(o-1,m))}n[r].replaceCells(p,o,m);let C=0;for(let g=n.length-1;g>0&&(g>r||n[g].getTrimmedLength()===0);g--)C++;C>0&&(b.push(l+n.length-C),b.push(C)),l+=n.length-1}return b},e.reflowLargerCreateNewLayout=function(h,f){const o=[];let d=0,m=f[d],b=0;for(let l=0;l<h.length;l++)if(m===l){const i=f[++d];h.onDeleteEmitter.fire({index:l-b,amount:i}),l+=i-1,b+=i,m=f[++d]}else o.push(l);return{layout:o,countRemoved:b}},e.reflowLargerApplyNewLayout=function(h,f){const o=[];for(let d=0;d<f.length;d++)o.push(h.get(f[d]));for(let d=0;d<o.length;d++)h.set(d,o[d]);h.length=f.length},e.reflowSmallerGetNewLineLengths=function(h,f,o){const d=[],m=h.map((c,n)=>a(h,n,f)).reduce((c,n)=>c+n);let b=0,l=0,i=0;for(;i<m;){if(m-i<o){d.push(m-i);break}b+=o;const c=a(h,l,f);b>c&&(b-=c,l++);const n=h[l].getWidth(b-1)===2;n&&b--;const r=n?o-1:o;d.push(r),i+=r}return d},e.getWrappedLineTrimmedLength=a},5295:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferSet=void 0;const h=a(8460),f=a(844),o=a(9092);class d extends f.Disposable{constructor(b,l){super(),this._optionsService=b,this._bufferService=l,this._onBufferActivate=this.register(new h.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new o.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new o.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(b){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(b),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(b,l){this._normal.resize(b,l),this._alt.resize(b,l),this.setupTabStops(b)}setupTabStops(b){this._normal.setupTabStops(b),this._alt.setupTabStops(b)}}e.BufferSet=d},511:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CellData=void 0;const h=a(482),f=a(643),o=a(3734);class d extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(b){const l=new d;return l.setFromCharData(b),l}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,h.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(b){this.fg=b[f.CHAR_DATA_ATTR_INDEX],this.bg=0;let l=!1;if(b[f.CHAR_DATA_CHAR_INDEX].length>2)l=!0;else if(b[f.CHAR_DATA_CHAR_INDEX].length===2){const i=b[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){const c=b[f.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=c&&c<=57343?this.content=1024*(i-55296)+c-56320+65536|b[f.CHAR_DATA_WIDTH_INDEX]<<22:l=!0}else l=!0}else this.content=b[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|b[f.CHAR_DATA_WIDTH_INDEX]<<22;l&&(this.combinedData=b[f.CHAR_DATA_CHAR_INDEX],this.content=2097152|b[f.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}e.CellData=d},643:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WHITESPACE_CELL_CODE=e.WHITESPACE_CELL_WIDTH=e.WHITESPACE_CELL_CHAR=e.NULL_CELL_CODE=e.NULL_CELL_WIDTH=e.NULL_CELL_CHAR=e.CHAR_DATA_CODE_INDEX=e.CHAR_DATA_WIDTH_INDEX=e.CHAR_DATA_CHAR_INDEX=e.CHAR_DATA_ATTR_INDEX=e.DEFAULT_EXT=e.DEFAULT_ATTR=e.DEFAULT_COLOR=void 0,e.DEFAULT_COLOR=0,e.DEFAULT_ATTR=256|e.DEFAULT_COLOR<<9,e.DEFAULT_EXT=0,e.CHAR_DATA_ATTR_INDEX=0,e.CHAR_DATA_CHAR_INDEX=1,e.CHAR_DATA_WIDTH_INDEX=2,e.CHAR_DATA_CODE_INDEX=3,e.NULL_CELL_CHAR="",e.NULL_CELL_WIDTH=1,e.NULL_CELL_CODE=0,e.WHITESPACE_CELL_CHAR=" ",e.WHITESPACE_CELL_WIDTH=1,e.WHITESPACE_CELL_CODE=32},4863:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Marker=void 0;const h=a(8460),f=a(844);class o{get id(){return this._id}constructor(m){this.line=m,this.isDisposed=!1,this._disposables=[],this._id=o._nextId++,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,f.disposeArray)(this._disposables),this._disposables.length=0)}register(m){return this._disposables.push(m),m}}e.Marker=o,o._nextId=1},7116:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_CHARSET=e.CHARSETS=void 0,e.CHARSETS={},e.DEFAULT_CHARSET=e.CHARSETS.B,e.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},e.CHARSETS.A={"#":""},e.CHARSETS.B=void 0,e.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},e.CHARSETS.C=e.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},e.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},e.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.E=e.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},e.CHARSETS.H=e.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(x,e)=>{var a,h,f;Object.defineProperty(e,"__esModule",{value:!0}),e.C1_ESCAPED=e.C1=e.C0=void 0,function(o){o.NUL="\0",o.SOH="",o.STX="",o.ETX="",o.EOT="",o.ENQ="",o.ACK="",o.BEL="\x07",o.BS="\b",o.HT="	",o.LF=`
`,o.VT="\v",o.FF="\f",o.CR="\r",o.SO="",o.SI="",o.DLE="",o.DC1="",o.DC2="",o.DC3="",o.DC4="",o.NAK="",o.SYN="",o.ETB="",o.CAN="",o.EM="",o.SUB="",o.ESC="\x1B",o.FS="",o.GS="",o.RS="",o.US="",o.SP=" ",o.DEL=""}(a||(e.C0=a={})),function(o){o.PAD="",o.HOP="",o.BPH="",o.NBH="",o.IND="",o.NEL="",o.SSA="",o.ESA="",o.HTS="",o.HTJ="",o.VTS="",o.PLD="",o.PLU="",o.RI="",o.SS2="",o.SS3="",o.DCS="",o.PU1="",o.PU2="",o.STS="",o.CCH="",o.MW="",o.SPA="",o.EPA="",o.SOS="",o.SGCI="",o.SCI="",o.CSI="",o.ST="",o.OSC="",o.PM="",o.APC=""}(h||(e.C1=h={})),function(o){o.ST=`${a.ESC}\\`}(f||(e.C1_ESCAPED=f={}))},7399:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.evaluateKeyboardEvent=void 0;const h=a(2584),f={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};e.evaluateKeyboardEvent=function(o,d,m,b){const l={type:0,cancel:!1,key:void 0},i=(o.shiftKey?1:0)|(o.altKey?2:0)|(o.ctrlKey?4:0)|(o.metaKey?8:0);switch(o.keyCode){case 0:o.key==="UIKeyInputUpArrow"?l.key=d?h.C0.ESC+"OA":h.C0.ESC+"[A":o.key==="UIKeyInputLeftArrow"?l.key=d?h.C0.ESC+"OD":h.C0.ESC+"[D":o.key==="UIKeyInputRightArrow"?l.key=d?h.C0.ESC+"OC":h.C0.ESC+"[C":o.key==="UIKeyInputDownArrow"&&(l.key=d?h.C0.ESC+"OB":h.C0.ESC+"[B");break;case 8:l.key=o.ctrlKey?"\b":h.C0.DEL,o.altKey&&(l.key=h.C0.ESC+l.key);break;case 9:if(o.shiftKey){l.key=h.C0.ESC+"[Z";break}l.key=h.C0.HT,l.cancel=!0;break;case 13:l.key=o.altKey?h.C0.ESC+h.C0.CR:h.C0.CR,l.cancel=!0;break;case 27:l.key=h.C0.ESC,o.altKey&&(l.key=h.C0.ESC+h.C0.ESC),l.cancel=!0;break;case 37:if(o.metaKey)break;i?(l.key=h.C0.ESC+"[1;"+(i+1)+"D",l.key===h.C0.ESC+"[1;3D"&&(l.key=h.C0.ESC+(m?"b":"[1;5D"))):l.key=d?h.C0.ESC+"OD":h.C0.ESC+"[D";break;case 39:if(o.metaKey)break;i?(l.key=h.C0.ESC+"[1;"+(i+1)+"C",l.key===h.C0.ESC+"[1;3C"&&(l.key=h.C0.ESC+(m?"f":"[1;5C"))):l.key=d?h.C0.ESC+"OC":h.C0.ESC+"[C";break;case 38:if(o.metaKey)break;i?(l.key=h.C0.ESC+"[1;"+(i+1)+"A",m||l.key!==h.C0.ESC+"[1;3A"||(l.key=h.C0.ESC+"[1;5A")):l.key=d?h.C0.ESC+"OA":h.C0.ESC+"[A";break;case 40:if(o.metaKey)break;i?(l.key=h.C0.ESC+"[1;"+(i+1)+"B",m||l.key!==h.C0.ESC+"[1;3B"||(l.key=h.C0.ESC+"[1;5B")):l.key=d?h.C0.ESC+"OB":h.C0.ESC+"[B";break;case 45:o.shiftKey||o.ctrlKey||(l.key=h.C0.ESC+"[2~");break;case 46:l.key=i?h.C0.ESC+"[3;"+(i+1)+"~":h.C0.ESC+"[3~";break;case 36:l.key=i?h.C0.ESC+"[1;"+(i+1)+"H":d?h.C0.ESC+"OH":h.C0.ESC+"[H";break;case 35:l.key=i?h.C0.ESC+"[1;"+(i+1)+"F":d?h.C0.ESC+"OF":h.C0.ESC+"[F";break;case 33:o.shiftKey?l.type=2:o.ctrlKey?l.key=h.C0.ESC+"[5;"+(i+1)+"~":l.key=h.C0.ESC+"[5~";break;case 34:o.shiftKey?l.type=3:o.ctrlKey?l.key=h.C0.ESC+"[6;"+(i+1)+"~":l.key=h.C0.ESC+"[6~";break;case 112:l.key=i?h.C0.ESC+"[1;"+(i+1)+"P":h.C0.ESC+"OP";break;case 113:l.key=i?h.C0.ESC+"[1;"+(i+1)+"Q":h.C0.ESC+"OQ";break;case 114:l.key=i?h.C0.ESC+"[1;"+(i+1)+"R":h.C0.ESC+"OR";break;case 115:l.key=i?h.C0.ESC+"[1;"+(i+1)+"S":h.C0.ESC+"OS";break;case 116:l.key=i?h.C0.ESC+"[15;"+(i+1)+"~":h.C0.ESC+"[15~";break;case 117:l.key=i?h.C0.ESC+"[17;"+(i+1)+"~":h.C0.ESC+"[17~";break;case 118:l.key=i?h.C0.ESC+"[18;"+(i+1)+"~":h.C0.ESC+"[18~";break;case 119:l.key=i?h.C0.ESC+"[19;"+(i+1)+"~":h.C0.ESC+"[19~";break;case 120:l.key=i?h.C0.ESC+"[20;"+(i+1)+"~":h.C0.ESC+"[20~";break;case 121:l.key=i?h.C0.ESC+"[21;"+(i+1)+"~":h.C0.ESC+"[21~";break;case 122:l.key=i?h.C0.ESC+"[23;"+(i+1)+"~":h.C0.ESC+"[23~";break;case 123:l.key=i?h.C0.ESC+"[24;"+(i+1)+"~":h.C0.ESC+"[24~";break;default:if(!o.ctrlKey||o.shiftKey||o.altKey||o.metaKey)if(m&&!b||!o.altKey||o.metaKey)!m||o.altKey||o.ctrlKey||o.shiftKey||!o.metaKey?o.key&&!o.ctrlKey&&!o.altKey&&!o.metaKey&&o.keyCode>=48&&o.key.length===1?l.key=o.key:o.key&&o.ctrlKey&&(o.key==="_"&&(l.key=h.C0.US),o.key==="@"&&(l.key=h.C0.NUL)):o.keyCode===65&&(l.type=1);else{const c=f[o.keyCode],n=c?.[o.shiftKey?1:0];if(n)l.key=h.C0.ESC+n;else if(o.keyCode>=65&&o.keyCode<=90){const r=o.ctrlKey?o.keyCode-64:o.keyCode+32;let p=String.fromCharCode(r);o.shiftKey&&(p=p.toUpperCase()),l.key=h.C0.ESC+p}else if(o.keyCode===32)l.key=h.C0.ESC+(o.ctrlKey?h.C0.NUL:" ");else if(o.key==="Dead"&&o.code.startsWith("Key")){let r=o.code.slice(3,4);o.shiftKey||(r=r.toLowerCase()),l.key=h.C0.ESC+r,l.cancel=!0}}else o.keyCode>=65&&o.keyCode<=90?l.key=String.fromCharCode(o.keyCode-64):o.keyCode===32?l.key=h.C0.NUL:o.keyCode>=51&&o.keyCode<=55?l.key=String.fromCharCode(o.keyCode-51+27):o.keyCode===56?l.key=h.C0.DEL:o.keyCode===219?l.key=h.C0.ESC:o.keyCode===220?l.key=h.C0.FS:o.keyCode===221&&(l.key=h.C0.GS)}return l}},482:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utf8ToUtf32=e.StringToUtf32=e.utf32ToString=e.stringFromCodePoint=void 0,e.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},e.utf32ToString=function(a,h=0,f=a.length){let o="";for(let d=h;d<f;++d){let m=a[d];m>65535?(m-=65536,o+=String.fromCharCode(55296+(m>>10))+String.fromCharCode(m%1024+56320)):o+=String.fromCharCode(m)}return o},e.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,h){const f=a.length;if(!f)return 0;let o=0,d=0;if(this._interim){const m=a.charCodeAt(d++);56320<=m&&m<=57343?h[o++]=1024*(this._interim-55296)+m-56320+65536:(h[o++]=this._interim,h[o++]=m),this._interim=0}for(let m=d;m<f;++m){const b=a.charCodeAt(m);if(55296<=b&&b<=56319){if(++m>=f)return this._interim=b,o;const l=a.charCodeAt(m);56320<=l&&l<=57343?h[o++]=1024*(b-55296)+l-56320+65536:(h[o++]=b,h[o++]=l)}else b!==65279&&(h[o++]=b)}return o}},e.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,h){const f=a.length;if(!f)return 0;let o,d,m,b,l=0,i=0,c=0;if(this.interim[0]){let p=!1,v=this.interim[0];v&=(224&v)==192?31:(240&v)==224?15:7;let _,C=0;for(;(_=63&this.interim[++C])&&C<4;)v<<=6,v|=_;const g=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,S=g-C;for(;c<S;){if(c>=f)return 0;if(_=a[c++],(192&_)!=128){c--,p=!0;break}this.interim[C++]=_,v<<=6,v|=63&_}p||(g===2?v<128?c--:h[l++]=v:g===3?v<2048||v>=55296&&v<=57343||v===65279||(h[l++]=v):v<65536||v>1114111||(h[l++]=v)),this.interim.fill(0)}const n=f-4;let r=c;for(;r<f;){for(;!(!(r<n)||128&(o=a[r])||128&(d=a[r+1])||128&(m=a[r+2])||128&(b=a[r+3]));)h[l++]=o,h[l++]=d,h[l++]=m,h[l++]=b,r+=4;if(o=a[r++],o<128)h[l++]=o;else if((224&o)==192){if(r>=f)return this.interim[0]=o,l;if(d=a[r++],(192&d)!=128){r--;continue}if(i=(31&o)<<6|63&d,i<128){r--;continue}h[l++]=i}else if((240&o)==224){if(r>=f)return this.interim[0]=o,l;if(d=a[r++],(192&d)!=128){r--;continue}if(r>=f)return this.interim[0]=o,this.interim[1]=d,l;if(m=a[r++],(192&m)!=128){r--;continue}if(i=(15&o)<<12|(63&d)<<6|63&m,i<2048||i>=55296&&i<=57343||i===65279)continue;h[l++]=i}else if((248&o)==240){if(r>=f)return this.interim[0]=o,l;if(d=a[r++],(192&d)!=128){r--;continue}if(r>=f)return this.interim[0]=o,this.interim[1]=d,l;if(m=a[r++],(192&m)!=128){r--;continue}if(r>=f)return this.interim[0]=o,this.interim[1]=d,this.interim[2]=m,l;if(b=a[r++],(192&b)!=128){r--;continue}if(i=(7&o)<<18|(63&d)<<12|(63&m)<<6|63&b,i<65536||i>1114111)continue;h[l++]=i}}return l}}},225:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UnicodeV6=void 0;const h=a(1480),f=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],o=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let d;e.UnicodeV6=class{constructor(){if(this.version="6",!d){d=new Uint8Array(65536),d.fill(1),d[0]=0,d.fill(0,1,32),d.fill(0,127,160),d.fill(2,4352,4448),d[9001]=2,d[9002]=2,d.fill(2,11904,42192),d[12351]=1,d.fill(2,44032,55204),d.fill(2,63744,64256),d.fill(2,65040,65050),d.fill(2,65072,65136),d.fill(2,65280,65377),d.fill(2,65504,65511);for(let m=0;m<f.length;++m)d.fill(0,f[m][0],f[m][1]+1)}}wcwidth(m){return m<32?0:m<127?1:m<65536?d[m]:function(b,l){let i,c=0,n=l.length-1;if(b<l[0][0]||b>l[n][1])return!1;for(;n>=c;)if(i=c+n>>1,b>l[i][1])c=i+1;else{if(!(b<l[i][0]))return!0;n=i-1}return!1}(m,o)?0:m>=131072&&m<=196605||m>=196608&&m<=262141?2:1}charProperties(m,b){let l=this.wcwidth(m),i=l===0&&b!==0;if(i){const c=h.UnicodeService.extractWidth(b);c===0?i=!1:c>l&&(l=c)}return h.UnicodeService.createPropertyValue(0,l,i)}}},5981:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WriteBuffer=void 0;const h=a(8460),f=a(844);class o extends f.Disposable{constructor(m){super(),this._action=m,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new h.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(m,b){if(b!==void 0&&this._syncCalls>b)return void(this._syncCalls=0);if(this._pendingData+=m.length,this._writeBuffer.push(m),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let l;for(this._isSyncWriting=!0;l=this._writeBuffer.shift();){this._action(l);const i=this._callbacks.shift();i&&i()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(m,b){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=m.length,this._writeBuffer.push(m),this._callbacks.push(b),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=m.length,this._writeBuffer.push(m),this._callbacks.push(b)}_innerWrite(m=0,b=!0){const l=m||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const i=this._writeBuffer[this._bufferOffset],c=this._action(i,b);if(c){const r=p=>Date.now()-l>=12?setTimeout(()=>this._innerWrite(0,p)):this._innerWrite(l,p);return void c.catch(p=>(queueMicrotask(()=>{throw p}),Promise.resolve(!1))).then(r)}const n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=i.length,Date.now()-l>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}e.WriteBuffer=o},5941:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.toRgbString=e.parseColor=void 0;const a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,h=/^[\da-f]+$/;function f(o,d){const m=o.toString(16),b=m.length<2?"0"+m:m;switch(d){case 4:return m[0];case 8:return b;case 12:return(b+b).slice(0,3);default:return b+b}}e.parseColor=function(o){if(!o)return;let d=o.toLowerCase();if(d.indexOf("rgb:")===0){d=d.slice(4);const m=a.exec(d);if(m){const b=m[1]?15:m[4]?255:m[7]?4095:65535;return[Math.round(parseInt(m[1]||m[4]||m[7]||m[10],16)/b*255),Math.round(parseInt(m[2]||m[5]||m[8]||m[11],16)/b*255),Math.round(parseInt(m[3]||m[6]||m[9]||m[12],16)/b*255)]}}else if(d.indexOf("#")===0&&(d=d.slice(1),h.exec(d)&&[3,6,9,12].includes(d.length))){const m=d.length/3,b=[0,0,0];for(let l=0;l<3;++l){const i=parseInt(d.slice(m*l,m*l+m),16);b[l]=m===1?i<<4:m===2?i:m===3?i>>4:i>>8}return b}},e.toRgbString=function(o,d=16){const[m,b,l]=o;return`rgb:${f(m,d)}/${f(b,d)}/${f(l,d)}`}},5770:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PAYLOAD_LIMIT=void 0,e.PAYLOAD_LIMIT=1e7},6351:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DcsHandler=e.DcsParser=void 0;const h=a(482),f=a(8742),o=a(5770),d=[];e.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=d,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=d}registerHandler(b,l){this._handlers[b]===void 0&&(this._handlers[b]=[]);const i=this._handlers[b];return i.push(l),{dispose:()=>{const c=i.indexOf(l);c!==-1&&i.splice(c,1)}}}clearHandler(b){this._handlers[b]&&delete this._handlers[b]}setHandlerFallback(b){this._handlerFb=b}reset(){if(this._active.length)for(let b=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;b>=0;--b)this._active[b].unhook(!1);this._stack.paused=!1,this._active=d,this._ident=0}hook(b,l){if(this.reset(),this._ident=b,this._active=this._handlers[b]||d,this._active.length)for(let i=this._active.length-1;i>=0;i--)this._active[i].hook(l);else this._handlerFb(this._ident,"HOOK",l)}put(b,l,i){if(this._active.length)for(let c=this._active.length-1;c>=0;c--)this._active[c].put(b,l,i);else this._handlerFb(this._ident,"PUT",(0,h.utf32ToString)(b,l,i))}unhook(b,l=!0){if(this._active.length){let i=!1,c=this._active.length-1,n=!1;if(this._stack.paused&&(c=this._stack.loopPosition-1,i=l,n=this._stack.fallThrough,this._stack.paused=!1),!n&&i===!1){for(;c>=0&&(i=this._active[c].unhook(b),i!==!0);c--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=c,this._stack.fallThrough=!1,i;c--}for(;c>=0;c--)if(i=this._active[c].unhook(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=c,this._stack.fallThrough=!0,i}else this._handlerFb(this._ident,"UNHOOK",b);this._active=d,this._ident=0}};const m=new f.Params;m.addParam(0),e.DcsHandler=class{constructor(b){this._handler=b,this._data="",this._params=m,this._hitLimit=!1}hook(b){this._params=b.length>1||b.params[0]?b.clone():m,this._data="",this._hitLimit=!1}put(b,l,i){this._hitLimit||(this._data+=(0,h.utf32ToString)(b,l,i),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(b){let l=!1;if(this._hitLimit)l=!1;else if(b&&(l=this._handler(this._data,this._params),l instanceof Promise))return l.then(i=>(this._params=m,this._data="",this._hitLimit=!1,i));return this._params=m,this._data="",this._hitLimit=!1,l}}},2015:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EscapeSequenceParser=e.VT500_TRANSITION_TABLE=e.TransitionTable=void 0;const h=a(844),f=a(8742),o=a(6242),d=a(6351);class m{constructor(c){this.table=new Uint8Array(c)}setDefault(c,n){this.table.fill(c<<4|n)}add(c,n,r,p){this.table[n<<8|c]=r<<4|p}addMany(c,n,r,p){for(let v=0;v<c.length;v++)this.table[n<<8|c[v]]=r<<4|p}}e.TransitionTable=m;const b=160;e.VT500_TRANSITION_TABLE=function(){const i=new m(4095),c=Array.apply(null,Array(256)).map((C,g)=>g),n=(C,g)=>c.slice(C,g),r=n(32,127),p=n(0,24);p.push(25),p.push.apply(p,n(28,32));const v=n(0,14);let _;for(_ in i.setDefault(1,0),i.addMany(r,0,2,0),v)i.addMany([24,26,153,154],_,3,0),i.addMany(n(128,144),_,3,0),i.addMany(n(144,152),_,3,0),i.add(156,_,0,0),i.add(27,_,11,1),i.add(157,_,4,8),i.addMany([152,158,159],_,0,7),i.add(155,_,11,3),i.add(144,_,11,9);return i.addMany(p,0,3,0),i.addMany(p,1,3,1),i.add(127,1,0,1),i.addMany(p,8,0,8),i.addMany(p,3,3,3),i.add(127,3,0,3),i.addMany(p,4,3,4),i.add(127,4,0,4),i.addMany(p,6,3,6),i.addMany(p,5,3,5),i.add(127,5,0,5),i.addMany(p,2,3,2),i.add(127,2,0,2),i.add(93,1,4,8),i.addMany(r,8,5,8),i.add(127,8,5,8),i.addMany([156,27,24,26,7],8,6,0),i.addMany(n(28,32),8,0,8),i.addMany([88,94,95],1,0,7),i.addMany(r,7,0,7),i.addMany(p,7,0,7),i.add(156,7,0,0),i.add(127,7,0,7),i.add(91,1,11,3),i.addMany(n(64,127),3,7,0),i.addMany(n(48,60),3,8,4),i.addMany([60,61,62,63],3,9,4),i.addMany(n(48,60),4,8,4),i.addMany(n(64,127),4,7,0),i.addMany([60,61,62,63],4,0,6),i.addMany(n(32,64),6,0,6),i.add(127,6,0,6),i.addMany(n(64,127),6,0,0),i.addMany(n(32,48),3,9,5),i.addMany(n(32,48),5,9,5),i.addMany(n(48,64),5,0,6),i.addMany(n(64,127),5,7,0),i.addMany(n(32,48),4,9,5),i.addMany(n(32,48),1,9,2),i.addMany(n(32,48),2,9,2),i.addMany(n(48,127),2,10,0),i.addMany(n(48,80),1,10,0),i.addMany(n(81,88),1,10,0),i.addMany([89,90,92],1,10,0),i.addMany(n(96,127),1,10,0),i.add(80,1,11,9),i.addMany(p,9,0,9),i.add(127,9,0,9),i.addMany(n(28,32),9,0,9),i.addMany(n(32,48),9,9,12),i.addMany(n(48,60),9,8,10),i.addMany([60,61,62,63],9,9,10),i.addMany(p,11,0,11),i.addMany(n(32,128),11,0,11),i.addMany(n(28,32),11,0,11),i.addMany(p,10,0,10),i.add(127,10,0,10),i.addMany(n(28,32),10,0,10),i.addMany(n(48,60),10,8,10),i.addMany([60,61,62,63],10,0,11),i.addMany(n(32,48),10,9,12),i.addMany(p,12,0,12),i.add(127,12,0,12),i.addMany(n(28,32),12,0,12),i.addMany(n(32,48),12,9,12),i.addMany(n(48,64),12,0,11),i.addMany(n(64,127),12,12,13),i.addMany(n(64,127),10,12,13),i.addMany(n(64,127),9,12,13),i.addMany(p,13,13,13),i.addMany(r,13,13,13),i.add(127,13,0,13),i.addMany([27,156,24,26],13,14,0),i.add(b,0,2,0),i.add(b,8,5,8),i.add(b,6,0,6),i.add(b,11,0,11),i.add(b,13,13,13),i}();class l extends h.Disposable{constructor(c=e.VT500_TRANSITION_TABLE){super(),this._transitions=c,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new f.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(n,r,p)=>{},this._executeHandlerFb=n=>{},this._csiHandlerFb=(n,r)=>{},this._escHandlerFb=n=>{},this._errorHandlerFb=n=>n,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,h.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new o.OscParser),this._dcsParser=this.register(new d.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(c,n=[64,126]){let r=0;if(c.prefix){if(c.prefix.length>1)throw new Error("only one byte as prefix supported");if(r=c.prefix.charCodeAt(0),r&&60>r||r>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(c.intermediates){if(c.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let v=0;v<c.intermediates.length;++v){const _=c.intermediates.charCodeAt(v);if(32>_||_>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");r<<=8,r|=_}}if(c.final.length!==1)throw new Error("final must be a single byte");const p=c.final.charCodeAt(0);if(n[0]>p||p>n[1])throw new Error(`final must be in range ${n[0]} .. ${n[1]}`);return r<<=8,r|=p,r}identToString(c){const n=[];for(;c;)n.push(String.fromCharCode(255&c)),c>>=8;return n.reverse().join("")}setPrintHandler(c){this._printHandler=c}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(c,n){const r=this._identifier(c,[48,126]);this._escHandlers[r]===void 0&&(this._escHandlers[r]=[]);const p=this._escHandlers[r];return p.push(n),{dispose:()=>{const v=p.indexOf(n);v!==-1&&p.splice(v,1)}}}clearEscHandler(c){this._escHandlers[this._identifier(c,[48,126])]&&delete this._escHandlers[this._identifier(c,[48,126])]}setEscHandlerFallback(c){this._escHandlerFb=c}setExecuteHandler(c,n){this._executeHandlers[c.charCodeAt(0)]=n}clearExecuteHandler(c){this._executeHandlers[c.charCodeAt(0)]&&delete this._executeHandlers[c.charCodeAt(0)]}setExecuteHandlerFallback(c){this._executeHandlerFb=c}registerCsiHandler(c,n){const r=this._identifier(c);this._csiHandlers[r]===void 0&&(this._csiHandlers[r]=[]);const p=this._csiHandlers[r];return p.push(n),{dispose:()=>{const v=p.indexOf(n);v!==-1&&p.splice(v,1)}}}clearCsiHandler(c){this._csiHandlers[this._identifier(c)]&&delete this._csiHandlers[this._identifier(c)]}setCsiHandlerFallback(c){this._csiHandlerFb=c}registerDcsHandler(c,n){return this._dcsParser.registerHandler(this._identifier(c),n)}clearDcsHandler(c){this._dcsParser.clearHandler(this._identifier(c))}setDcsHandlerFallback(c){this._dcsParser.setHandlerFallback(c)}registerOscHandler(c,n){return this._oscParser.registerHandler(c,n)}clearOscHandler(c){this._oscParser.clearHandler(c)}setOscHandlerFallback(c){this._oscParser.setHandlerFallback(c)}setErrorHandler(c){this._errorHandler=c}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(c,n,r,p,v){this._parseStack.state=c,this._parseStack.handlers=n,this._parseStack.handlerPos=r,this._parseStack.transition=p,this._parseStack.chunkPos=v}parse(c,n,r){let p,v=0,_=0,C=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,C=this._parseStack.chunkPos+1;else{if(r===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const g=this._parseStack.handlers;let S=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(r===!1&&S>-1){for(;S>=0&&(p=g[S](this._params),p!==!0);S--)if(p instanceof Promise)return this._parseStack.handlerPos=S,p}this._parseStack.handlers=[];break;case 4:if(r===!1&&S>-1){for(;S>=0&&(p=g[S](),p!==!0);S--)if(p instanceof Promise)return this._parseStack.handlerPos=S,p}this._parseStack.handlers=[];break;case 6:if(v=c[this._parseStack.chunkPos],p=this._dcsParser.unhook(v!==24&&v!==26,r),p)return p;v===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(v=c[this._parseStack.chunkPos],p=this._oscParser.end(v!==24&&v!==26,r),p)return p;v===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,C=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let g=C;g<n;++g){switch(v=c[g],_=this._transitions.table[this.currentState<<8|(v<160?v:b)],_>>4){case 2:for(let A=g+1;;++A){if(A>=n||(v=c[A])<32||v>126&&v<b){this._printHandler(c,g,A),g=A-1;break}if(++A>=n||(v=c[A])<32||v>126&&v<b){this._printHandler(c,g,A),g=A-1;break}if(++A>=n||(v=c[A])<32||v>126&&v<b){this._printHandler(c,g,A),g=A-1;break}if(++A>=n||(v=c[A])<32||v>126&&v<b){this._printHandler(c,g,A),g=A-1;break}}break;case 3:this._executeHandlers[v]?this._executeHandlers[v]():this._executeHandlerFb(v),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:g,code:v,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const S=this._csiHandlers[this._collect<<8|v];let k=S?S.length-1:-1;for(;k>=0&&(p=S[k](this._params),p!==!0);k--)if(p instanceof Promise)return this._preserveStack(3,S,k,_,g),p;k<0&&this._csiHandlerFb(this._collect<<8|v,this._params),this.precedingJoinState=0;break;case 8:do switch(v){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(v-48)}while(++g<n&&(v=c[g])>47&&v<60);g--;break;case 9:this._collect<<=8,this._collect|=v;break;case 10:const L=this._escHandlers[this._collect<<8|v];let M=L?L.length-1:-1;for(;M>=0&&(p=L[M](),p!==!0);M--)if(p instanceof Promise)return this._preserveStack(4,L,M,_,g),p;M<0&&this._escHandlerFb(this._collect<<8|v),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|v,this._params);break;case 13:for(let A=g+1;;++A)if(A>=n||(v=c[A])===24||v===26||v===27||v>127&&v<b){this._dcsParser.put(c,g,A),g=A-1;break}break;case 14:if(p=this._dcsParser.unhook(v!==24&&v!==26),p)return this._preserveStack(6,[],0,_,g),p;v===27&&(_|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let A=g+1;;A++)if(A>=n||(v=c[A])<32||v>127&&v<b){this._oscParser.put(c,g,A),g=A-1;break}break;case 6:if(p=this._oscParser.end(v!==24&&v!==26),p)return this._preserveStack(5,[],0,_,g),p;v===27&&(_|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&_}}}e.EscapeSequenceParser=l},6242:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OscHandler=e.OscParser=void 0;const h=a(5770),f=a(482),o=[];e.OscParser=class{constructor(){this._state=0,this._active=o,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(d,m){this._handlers[d]===void 0&&(this._handlers[d]=[]);const b=this._handlers[d];return b.push(m),{dispose:()=>{const l=b.indexOf(m);l!==-1&&b.splice(l,1)}}}clearHandler(d){this._handlers[d]&&delete this._handlers[d]}setHandlerFallback(d){this._handlerFb=d}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}reset(){if(this._state===2)for(let d=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;d>=0;--d)this._active[d].end(!1);this._stack.paused=!1,this._active=o,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||o,this._active.length)for(let d=this._active.length-1;d>=0;d--)this._active[d].start();else this._handlerFb(this._id,"START")}_put(d,m,b){if(this._active.length)for(let l=this._active.length-1;l>=0;l--)this._active[l].put(d,m,b);else this._handlerFb(this._id,"PUT",(0,f.utf32ToString)(d,m,b))}start(){this.reset(),this._state=1}put(d,m,b){if(this._state!==3){if(this._state===1)for(;m<b;){const l=d[m++];if(l===59){this._state=2,this._start();break}if(l<48||57<l)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+l-48}this._state===2&&b-m>0&&this._put(d,m,b)}}end(d,m=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let b=!1,l=this._active.length-1,i=!1;if(this._stack.paused&&(l=this._stack.loopPosition-1,b=m,i=this._stack.fallThrough,this._stack.paused=!1),!i&&b===!1){for(;l>=0&&(b=this._active[l].end(d),b!==!0);l--)if(b instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=l,this._stack.fallThrough=!1,b;l--}for(;l>=0;l--)if(b=this._active[l].end(!1),b instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=l,this._stack.fallThrough=!0,b}else this._handlerFb(this._id,"END",d);this._active=o,this._id=-1,this._state=0}}},e.OscHandler=class{constructor(d){this._handler=d,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(d,m,b){this._hitLimit||(this._data+=(0,f.utf32ToString)(d,m,b),this._data.length>h.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(d){let m=!1;if(this._hitLimit)m=!1;else if(d&&(m=this._handler(this._data),m instanceof Promise))return m.then(b=>(this._data="",this._hitLimit=!1,b));return this._data="",this._hitLimit=!1,m}}},8742:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Params=void 0;const a=2147483647;class h{static fromArray(o){const d=new h;if(!o.length)return d;for(let m=Array.isArray(o[0])?1:0;m<o.length;++m){const b=o[m];if(Array.isArray(b))for(let l=0;l<b.length;++l)d.addSubParam(b[l]);else d.addParam(b)}return d}constructor(o=32,d=32){if(this.maxLength=o,this.maxSubParamsLength=d,d>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(o),this.length=0,this._subParams=new Int32Array(d),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(o),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const o=new h(this.maxLength,this.maxSubParamsLength);return o.params.set(this.params),o.length=this.length,o._subParams.set(this._subParams),o._subParamsLength=this._subParamsLength,o._subParamsIdx.set(this._subParamsIdx),o._rejectDigits=this._rejectDigits,o._rejectSubDigits=this._rejectSubDigits,o._digitIsSub=this._digitIsSub,o}toArray(){const o=[];for(let d=0;d<this.length;++d){o.push(this.params[d]);const m=this._subParamsIdx[d]>>8,b=255&this._subParamsIdx[d];b-m>0&&o.push(Array.prototype.slice.call(this._subParams,m,b))}return o}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(o){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=o>a?a:o}}addSubParam(o){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=o>a?a:o,this._subParamsIdx[this.length-1]++}}hasSubParams(o){return(255&this._subParamsIdx[o])-(this._subParamsIdx[o]>>8)>0}getSubParams(o){const d=this._subParamsIdx[o]>>8,m=255&this._subParamsIdx[o];return m-d>0?this._subParams.subarray(d,m):null}getSubParamsAll(){const o={};for(let d=0;d<this.length;++d){const m=this._subParamsIdx[d]>>8,b=255&this._subParamsIdx[d];b-m>0&&(o[d]=this._subParams.slice(m,b))}return o}addDigit(o){let d;if(this._rejectDigits||!(d=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const m=this._digitIsSub?this._subParams:this.params,b=m[d-1];m[d-1]=~b?Math.min(10*b+o,a):o}}e.Params=h},5741:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AddonManager=void 0,e.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,h){const f={instance:h,dispose:h.dispose,isDisposed:!1};this._addons.push(f),h.dispose=()=>this._wrappedAddonDispose(f),h.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let h=-1;for(let f=0;f<this._addons.length;f++)if(this._addons[f]===a){h=f;break}if(h===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(h,1)}}},8771:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferApiView=void 0;const h=a(3785),f=a(511);e.BufferApiView=class{constructor(o,d){this._buffer=o,this.type=d}init(o){return this._buffer=o,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(o){const d=this._buffer.lines.get(o);if(d)return new h.BufferLineApiView(d)}getNullCell(){return new f.CellData}}},3785:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferLineApiView=void 0;const h=a(511);e.BufferLineApiView=class{constructor(f){this._line=f}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(f,o){if(!(f<0||f>=this._line.length))return o?(this._line.loadCell(f,o),o):this._line.loadCell(f,new h.CellData)}translateToString(f,o,d){return this._line.translateToString(f,o,d)}}},8285:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferNamespaceApi=void 0;const h=a(8771),f=a(8460),o=a(844);class d extends o.Disposable{constructor(b){super(),this._core=b,this._onBufferChange=this.register(new f.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new h.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new h.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}e.BufferNamespaceApi=d},7975:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ParserApi=void 0,e.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,h){return this._core.registerCsiHandler(a,f=>h(f.toArray()))}addCsiHandler(a,h){return this.registerCsiHandler(a,h)}registerDcsHandler(a,h){return this._core.registerDcsHandler(a,(f,o)=>h(f,o.toArray()))}addDcsHandler(a,h){return this.registerDcsHandler(a,h)}registerEscHandler(a,h){return this._core.registerEscHandler(a,h)}addEscHandler(a,h){return this.registerEscHandler(a,h)}registerOscHandler(a,h){return this._core.registerOscHandler(a,h)}addOscHandler(a,h){return this.registerOscHandler(a,h)}}},7090:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UnicodeApi=void 0,e.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(x,e,a){var h=this&&this.__decorate||function(i,c,n,r){var p,v=arguments.length,_=v<3?c:r===null?r=Object.getOwnPropertyDescriptor(c,n):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(i,c,n,r);else for(var C=i.length-1;C>=0;C--)(p=i[C])&&(_=(v<3?p(_):v>3?p(c,n,_):p(c,n))||_);return v>3&&_&&Object.defineProperty(c,n,_),_},f=this&&this.__param||function(i,c){return function(n,r){c(n,r,i)}};Object.defineProperty(e,"__esModule",{value:!0}),e.BufferService=e.MINIMUM_ROWS=e.MINIMUM_COLS=void 0;const o=a(8460),d=a(844),m=a(5295),b=a(2585);e.MINIMUM_COLS=2,e.MINIMUM_ROWS=1;let l=e.BufferService=class extends d.Disposable{get buffer(){return this.buffers.active}constructor(i){super(),this.isUserScrolling=!1,this._onResize=this.register(new o.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(i.rawOptions.cols||0,e.MINIMUM_COLS),this.rows=Math.max(i.rawOptions.rows||0,e.MINIMUM_ROWS),this.buffers=this.register(new m.BufferSet(i,this))}resize(i,c){this.cols=i,this.rows=c,this.buffers.resize(i,c),this._onResize.fire({cols:i,rows:c})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(i,c=!1){const n=this.buffer;let r;r=this._cachedBlankLine,r&&r.length===this.cols&&r.getFg(0)===i.fg&&r.getBg(0)===i.bg||(r=n.getBlankLine(i,c),this._cachedBlankLine=r),r.isWrapped=c;const p=n.ybase+n.scrollTop,v=n.ybase+n.scrollBottom;if(n.scrollTop===0){const _=n.lines.isFull;v===n.lines.length-1?_?n.lines.recycle().copyFrom(r):n.lines.push(r.clone()):n.lines.splice(v+1,0,r.clone()),_?this.isUserScrolling&&(n.ydisp=Math.max(n.ydisp-1,0)):(n.ybase++,this.isUserScrolling||n.ydisp++)}else{const _=v-p+1;n.lines.shiftElements(p+1,_-1,-1),n.lines.set(v,r.clone())}this.isUserScrolling||(n.ydisp=n.ybase),this._onScroll.fire(n.ydisp)}scrollLines(i,c,n){const r=this.buffer;if(i<0){if(r.ydisp===0)return;this.isUserScrolling=!0}else i+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);const p=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+i,r.ybase),0),p!==r.ydisp&&(c||this._onScroll.fire(r.ydisp))}};e.BufferService=l=h([f(0,b.IOptionsService)],l)},7994:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CharsetService=void 0,e.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,h){this._charsets[a]=h,this.glevel===a&&(this.charset=h)}}},1753:function(x,e,a){var h=this&&this.__decorate||function(r,p,v,_){var C,g=arguments.length,S=g<3?p:_===null?_=Object.getOwnPropertyDescriptor(p,v):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(r,p,v,_);else for(var k=r.length-1;k>=0;k--)(C=r[k])&&(S=(g<3?C(S):g>3?C(p,v,S):C(p,v))||S);return g>3&&S&&Object.defineProperty(p,v,S),S},f=this&&this.__param||function(r,p){return function(v,_){p(v,_,r)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CoreMouseService=void 0;const o=a(2585),d=a(8460),m=a(844),b={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:r=>r.button!==4&&r.action===1&&(r.ctrl=!1,r.alt=!1,r.shift=!1,!0)},VT200:{events:19,restrict:r=>r.action!==32},DRAG:{events:23,restrict:r=>r.action!==32||r.button!==3},ANY:{events:31,restrict:r=>!0}};function l(r,p){let v=(r.ctrl?16:0)|(r.shift?4:0)|(r.alt?8:0);return r.button===4?(v|=64,v|=r.action):(v|=3&r.button,4&r.button&&(v|=64),8&r.button&&(v|=128),r.action===32?v|=32:r.action!==0||p||(v|=3)),v}const i=String.fromCharCode,c={DEFAULT:r=>{const p=[l(r,!1)+32,r.col+32,r.row+32];return p[0]>255||p[1]>255||p[2]>255?"":`\x1B[M${i(p[0])}${i(p[1])}${i(p[2])}`},SGR:r=>{const p=r.action===0&&r.button!==4?"m":"M";return`\x1B[<${l(r,!0)};${r.col};${r.row}${p}`},SGR_PIXELS:r=>{const p=r.action===0&&r.button!==4?"m":"M";return`\x1B[<${l(r,!0)};${r.x};${r.y}${p}`}};let n=e.CoreMouseService=class extends m.Disposable{constructor(r,p){super(),this._bufferService=r,this._coreService=p,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new d.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const v of Object.keys(b))this.addProtocol(v,b[v]);for(const v of Object.keys(c))this.addEncoding(v,c[v]);this.reset()}addProtocol(r,p){this._protocols[r]=p}addEncoding(r,p){this._encodings[r]=p}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(r){if(!this._protocols[r])throw new Error(`unknown protocol "${r}"`);this._activeProtocol=r,this._onProtocolChange.fire(this._protocols[r].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(r){if(!this._encodings[r])throw new Error(`unknown encoding "${r}"`);this._activeEncoding=r}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(r){if(r.col<0||r.col>=this._bufferService.cols||r.row<0||r.row>=this._bufferService.rows||r.button===4&&r.action===32||r.button===3&&r.action!==32||r.button!==4&&(r.action===2||r.action===3)||(r.col++,r.row++,r.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,r,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(r))return!1;const p=this._encodings[this._activeEncoding](r);return p&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(p):this._coreService.triggerDataEvent(p,!0)),this._lastEvent=r,!0}explainEvents(r){return{down:!!(1&r),up:!!(2&r),drag:!!(4&r),move:!!(8&r),wheel:!!(16&r)}}_equalEvents(r,p,v){if(v){if(r.x!==p.x||r.y!==p.y)return!1}else if(r.col!==p.col||r.row!==p.row)return!1;return r.button===p.button&&r.action===p.action&&r.ctrl===p.ctrl&&r.alt===p.alt&&r.shift===p.shift}};e.CoreMouseService=n=h([f(0,o.IBufferService),f(1,o.ICoreService)],n)},6975:function(x,e,a){var h=this&&this.__decorate||function(n,r,p,v){var _,C=arguments.length,g=C<3?r:v===null?v=Object.getOwnPropertyDescriptor(r,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(n,r,p,v);else for(var S=n.length-1;S>=0;S--)(_=n[S])&&(g=(C<3?_(g):C>3?_(r,p,g):_(r,p))||g);return C>3&&g&&Object.defineProperty(r,p,g),g},f=this&&this.__param||function(n,r){return function(p,v){r(p,v,n)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CoreService=void 0;const o=a(1439),d=a(8460),m=a(844),b=a(2585),l=Object.freeze({insertMode:!1}),i=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let c=e.CoreService=class extends m.Disposable{constructor(n,r,p){super(),this._bufferService=n,this._logService=r,this._optionsService=p,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new d.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new d.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new d.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new d.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,o.clone)(l),this.decPrivateModes=(0,o.clone)(i)}reset(){this.modes=(0,o.clone)(l),this.decPrivateModes=(0,o.clone)(i)}triggerDataEvent(n,r=!1){if(this._optionsService.rawOptions.disableStdin)return;const p=this._bufferService.buffer;r&&this._optionsService.rawOptions.scrollOnUserInput&&p.ybase!==p.ydisp&&this._onRequestScrollToBottom.fire(),r&&this._onUserInput.fire(),this._logService.debug(`sending data "${n}"`,()=>n.split("").map(v=>v.charCodeAt(0))),this._onData.fire(n)}triggerBinaryEvent(n){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${n}"`,()=>n.split("").map(r=>r.charCodeAt(0))),this._onBinary.fire(n))}};e.CoreService=c=h([f(0,b.IBufferService),f(1,b.ILogService),f(2,b.IOptionsService)],c)},9074:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DecorationService=void 0;const h=a(8055),f=a(8460),o=a(844),d=a(6106);let m=0,b=0;class l extends o.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new d.SortedList(n=>n?.marker.line),this._onDecorationRegistered=this.register(new f.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new f.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,o.toDisposable)(()=>this.reset()))}registerDecoration(n){if(n.marker.isDisposed)return;const r=new i(n);if(r){const p=r.marker.onDispose(()=>r.dispose());r.onDispose(()=>{r&&(this._decorations.delete(r)&&this._onDecorationRemoved.fire(r),p.dispose())}),this._decorations.insert(r),this._onDecorationRegistered.fire(r)}return r}reset(){for(const n of this._decorations.values())n.dispose();this._decorations.clear()}*getDecorationsAtCell(n,r,p){let v=0,_=0;for(const C of this._decorations.getKeyIterator(r))v=C.options.x??0,_=v+(C.options.width??1),n>=v&&n<_&&(!p||(C.options.layer??"bottom")===p)&&(yield C)}forEachDecorationAtCell(n,r,p,v){this._decorations.forEachByKey(r,_=>{m=_.options.x??0,b=m+(_.options.width??1),n>=m&&n<b&&(!p||(_.options.layer??"bottom")===p)&&v(_)})}}e.DecorationService=l;class i extends o.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=h.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=h.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(n){super(),this.options=n,this.onRenderEmitter=this.register(new f.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new f.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=n.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InstantiationService=e.ServiceCollection=void 0;const h=a(2585),f=a(8343);class o{constructor(...m){this._entries=new Map;for(const[b,l]of m)this.set(b,l)}set(m,b){const l=this._entries.get(m);return this._entries.set(m,b),l}forEach(m){for(const[b,l]of this._entries.entries())m(b,l)}has(m){return this._entries.has(m)}get(m){return this._entries.get(m)}}e.ServiceCollection=o,e.InstantiationService=class{constructor(){this._services=new o,this._services.set(h.IInstantiationService,this)}setService(d,m){this._services.set(d,m)}getService(d){return this._services.get(d)}createInstance(d,...m){const b=(0,f.getServiceDependencies)(d).sort((c,n)=>c.index-n.index),l=[];for(const c of b){const n=this._services.get(c.id);if(!n)throw new Error(`[createInstance] ${d.name} depends on UNKNOWN service ${c.id}.`);l.push(n)}const i=b.length>0?b[0].index:m.length;if(m.length!==i)throw new Error(`[createInstance] First service dependency of ${d.name} at position ${i+1} conflicts with ${m.length} static arguments`);return new d(...m,...l)}}},7866:function(x,e,a){var h=this&&this.__decorate||function(i,c,n,r){var p,v=arguments.length,_=v<3?c:r===null?r=Object.getOwnPropertyDescriptor(c,n):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(i,c,n,r);else for(var C=i.length-1;C>=0;C--)(p=i[C])&&(_=(v<3?p(_):v>3?p(c,n,_):p(c,n))||_);return v>3&&_&&Object.defineProperty(c,n,_),_},f=this&&this.__param||function(i,c){return function(n,r){c(n,r,i)}};Object.defineProperty(e,"__esModule",{value:!0}),e.traceCall=e.setTraceLogger=e.LogService=void 0;const o=a(844),d=a(2585),m={trace:d.LogLevelEnum.TRACE,debug:d.LogLevelEnum.DEBUG,info:d.LogLevelEnum.INFO,warn:d.LogLevelEnum.WARN,error:d.LogLevelEnum.ERROR,off:d.LogLevelEnum.OFF};let b,l=e.LogService=class extends o.Disposable{get logLevel(){return this._logLevel}constructor(i){super(),this._optionsService=i,this._logLevel=d.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),b=this}_updateLogLevel(){this._logLevel=m[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(i){for(let c=0;c<i.length;c++)typeof i[c]=="function"&&(i[c]=i[c]())}_log(i,c,n){this._evalLazyOptionalParams(n),i.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+c,...n)}trace(i,...c){this._logLevel<=d.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,i,c)}debug(i,...c){this._logLevel<=d.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,i,c)}info(i,...c){this._logLevel<=d.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,i,c)}warn(i,...c){this._logLevel<=d.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,i,c)}error(i,...c){this._logLevel<=d.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,i,c)}};e.LogService=l=h([f(0,d.IOptionsService)],l),e.setTraceLogger=function(i){b=i},e.traceCall=function(i,c,n){if(typeof n.value!="function")throw new Error("not supported");const r=n.value;n.value=function(...p){if(b.logLevel!==d.LogLevelEnum.TRACE)return r.apply(this,p);b.trace(`GlyphRenderer#${r.name}(${p.map(_=>JSON.stringify(_)).join(", ")})`);const v=r.apply(this,p);return b.trace(`GlyphRenderer#${r.name} return`,v),v}}},7302:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionsService=e.DEFAULT_OPTIONS=void 0;const h=a(8460),f=a(844),o=a(6114);e.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:o.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const d=["normal","bold","100","200","300","400","500","600","700","800","900"];class m extends f.Disposable{constructor(l){super(),this._onOptionChange=this.register(new h.EventEmitter),this.onOptionChange=this._onOptionChange.event;const i={...e.DEFAULT_OPTIONS};for(const c in l)if(c in i)try{const n=l[c];i[c]=this._sanitizeAndValidateOption(c,n)}catch(n){console.error(n)}this.rawOptions=i,this.options={...i},this._setupOptions(),this.register((0,f.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(l,i){return this.onOptionChange(c=>{c===l&&i(this.rawOptions[l])})}onMultipleOptionChange(l,i){return this.onOptionChange(c=>{l.indexOf(c)!==-1&&i()})}_setupOptions(){const l=c=>{if(!(c in e.DEFAULT_OPTIONS))throw new Error(`No option with key "${c}"`);return this.rawOptions[c]},i=(c,n)=>{if(!(c in e.DEFAULT_OPTIONS))throw new Error(`No option with key "${c}"`);n=this._sanitizeAndValidateOption(c,n),this.rawOptions[c]!==n&&(this.rawOptions[c]=n,this._onOptionChange.fire(c))};for(const c in this.rawOptions){const n={get:l.bind(this,c),set:i.bind(this,c)};Object.defineProperty(this.options,c,n)}}_sanitizeAndValidateOption(l,i){switch(l){case"cursorStyle":if(i||(i=e.DEFAULT_OPTIONS[l]),!function(c){return c==="block"||c==="underline"||c==="bar"}(i))throw new Error(`"${i}" is not a valid value for ${l}`);break;case"wordSeparator":i||(i=e.DEFAULT_OPTIONS[l]);break;case"fontWeight":case"fontWeightBold":if(typeof i=="number"&&1<=i&&i<=1e3)break;i=d.includes(i)?i:e.DEFAULT_OPTIONS[l];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw new Error(`${l} cannot be less than 1, value: ${i}`);break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(10*i)/10));break;case"scrollback":if((i=Math.min(i,4294967295))<0)throw new Error(`${l} cannot be less than 0, value: ${i}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw new Error(`${l} cannot be less than or equal to 0, value: ${i}`);break;case"rows":case"cols":if(!i&&i!==0)throw new Error(`${l} must be numeric, value: ${i}`);break;case"windowsPty":i=i??{}}return i}}e.OptionsService=m},2660:function(x,e,a){var h=this&&this.__decorate||function(m,b,l,i){var c,n=arguments.length,r=n<3?b:i===null?i=Object.getOwnPropertyDescriptor(b,l):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(m,b,l,i);else for(var p=m.length-1;p>=0;p--)(c=m[p])&&(r=(n<3?c(r):n>3?c(b,l,r):c(b,l))||r);return n>3&&r&&Object.defineProperty(b,l,r),r},f=this&&this.__param||function(m,b){return function(l,i){b(l,i,m)}};Object.defineProperty(e,"__esModule",{value:!0}),e.OscLinkService=void 0;const o=a(2585);let d=e.OscLinkService=class{constructor(m){this._bufferService=m,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(m){const b=this._bufferService.buffer;if(m.id===void 0){const p=b.addMarker(b.ybase+b.y),v={data:m,id:this._nextId++,lines:[p]};return p.onDispose(()=>this._removeMarkerFromLink(v,p)),this._dataByLinkId.set(v.id,v),v.id}const l=m,i=this._getEntryIdKey(l),c=this._entriesWithId.get(i);if(c)return this.addLineToLink(c.id,b.ybase+b.y),c.id;const n=b.addMarker(b.ybase+b.y),r={id:this._nextId++,key:this._getEntryIdKey(l),data:l,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(r,n)),this._entriesWithId.set(r.key,r),this._dataByLinkId.set(r.id,r),r.id}addLineToLink(m,b){const l=this._dataByLinkId.get(m);if(l&&l.lines.every(i=>i.line!==b)){const i=this._bufferService.buffer.addMarker(b);l.lines.push(i),i.onDispose(()=>this._removeMarkerFromLink(l,i))}}getLinkData(m){return this._dataByLinkId.get(m)?.data}_getEntryIdKey(m){return`${m.id};;${m.uri}`}_removeMarkerFromLink(m,b){const l=m.lines.indexOf(b);l!==-1&&(m.lines.splice(l,1),m.lines.length===0&&(m.data.id!==void 0&&this._entriesWithId.delete(m.key),this._dataByLinkId.delete(m.id)))}};e.OscLinkService=d=h([f(0,o.IBufferService)],d)},8343:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createDecorator=e.getServiceDependencies=e.serviceRegistry=void 0;const a="di$target",h="di$dependencies";e.serviceRegistry=new Map,e.getServiceDependencies=function(f){return f[h]||[]},e.createDecorator=function(f){if(e.serviceRegistry.has(f))return e.serviceRegistry.get(f);const o=function(d,m,b){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(l,i,c){i[a]===i?i[h].push({id:l,index:c}):(i[h]=[{id:l,index:c}],i[a]=i)})(o,d,b)};return o.toString=()=>f,e.serviceRegistry.set(f,o),o}},2585:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IDecorationService=e.IUnicodeService=e.IOscLinkService=e.IOptionsService=e.ILogService=e.LogLevelEnum=e.IInstantiationService=e.ICharsetService=e.ICoreService=e.ICoreMouseService=e.IBufferService=void 0;const h=a(8343);var f;e.IBufferService=(0,h.createDecorator)("BufferService"),e.ICoreMouseService=(0,h.createDecorator)("CoreMouseService"),e.ICoreService=(0,h.createDecorator)("CoreService"),e.ICharsetService=(0,h.createDecorator)("CharsetService"),e.IInstantiationService=(0,h.createDecorator)("InstantiationService"),function(o){o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=5]="OFF"}(f||(e.LogLevelEnum=f={})),e.ILogService=(0,h.createDecorator)("LogService"),e.IOptionsService=(0,h.createDecorator)("OptionsService"),e.IOscLinkService=(0,h.createDecorator)("OscLinkService"),e.IUnicodeService=(0,h.createDecorator)("UnicodeService"),e.IDecorationService=(0,h.createDecorator)("DecorationService")},1480:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UnicodeService=void 0;const h=a(8460),f=a(225);class o{static extractShouldJoin(m){return(1&m)!=0}static extractWidth(m){return m>>1&3}static extractCharKind(m){return m>>3}static createPropertyValue(m,b,l=!1){return(16777215&m)<<3|(3&b)<<1|(l?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new h.EventEmitter,this.onChange=this._onChange.event;const m=new f.UnicodeV6;this.register(m),this._active=m.version,this._activeProvider=m}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(m){if(!this._providers[m])throw new Error(`unknown Unicode version "${m}"`);this._active=m,this._activeProvider=this._providers[m],this._onChange.fire(m)}register(m){this._providers[m.version]=m}wcwidth(m){return this._activeProvider.wcwidth(m)}getStringCellWidth(m){let b=0,l=0;const i=m.length;for(let c=0;c<i;++c){let n=m.charCodeAt(c);if(55296<=n&&n<=56319){if(++c>=i)return b+this.wcwidth(n);const v=m.charCodeAt(c);56320<=v&&v<=57343?n=1024*(n-55296)+v-56320+65536:b+=this.wcwidth(v)}const r=this.charProperties(n,l);let p=o.extractWidth(r);o.extractShouldJoin(r)&&(p-=o.extractWidth(l)),b+=p,l=r}return b}charProperties(m,b){return this._activeProvider.charProperties(m,b)}}e.UnicodeService=o}},w={};function y(x){var e=w[x];if(e!==void 0)return e.exports;var a=w[x]={exports:{}};return u[x].call(a.exports,a,a.exports,y),a.exports}var B={};return(()=>{var x=B;Object.defineProperty(x,"__esModule",{value:!0}),x.Terminal=void 0;const e=y(9042),a=y(3236),h=y(844),f=y(5741),o=y(8285),d=y(7975),m=y(7090),b=["cols","rows"];class l extends h.Disposable{constructor(c){super(),this._core=this.register(new a.Terminal(c)),this._addonManager=this.register(new f.AddonManager),this._publicOptions={...this._core.options};const n=p=>this._core.options[p],r=(p,v)=>{this._checkReadonlyOptions(p),this._core.options[p]=v};for(const p in this._core.options){const v={get:n.bind(this,p),set:r.bind(this,p)};Object.defineProperty(this._publicOptions,p,v)}}_checkReadonlyOptions(c){if(b.includes(c))throw new Error(`Option "${c}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new d.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new m.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new o.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const c=this._core.coreService.decPrivateModes;let n="none";switch(this._core.coreMouseService.activeProtocol){case"X10":n="x10";break;case"VT200":n="vt200";break;case"DRAG":n="drag";break;case"ANY":n="any"}return{applicationCursorKeysMode:c.applicationCursorKeys,applicationKeypadMode:c.applicationKeypad,bracketedPasteMode:c.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:n,originMode:c.origin,reverseWraparoundMode:c.reverseWraparound,sendFocusMode:c.sendFocus,wraparoundMode:c.wraparound}}get options(){return this._publicOptions}set options(c){for(const n in c)this._publicOptions[n]=c[n]}blur(){this._core.blur()}focus(){this._core.focus()}input(c,n=!0){this._core.input(c,n)}resize(c,n){this._verifyIntegers(c,n),this._core.resize(c,n)}open(c){this._core.open(c)}attachCustomKeyEventHandler(c){this._core.attachCustomKeyEventHandler(c)}attachCustomWheelEventHandler(c){this._core.attachCustomWheelEventHandler(c)}registerLinkProvider(c){return this._core.registerLinkProvider(c)}registerCharacterJoiner(c){return this._checkProposedApi(),this._core.registerCharacterJoiner(c)}deregisterCharacterJoiner(c){this._checkProposedApi(),this._core.deregisterCharacterJoiner(c)}registerMarker(c=0){return this._verifyIntegers(c),this._core.registerMarker(c)}registerDecoration(c){return this._checkProposedApi(),this._verifyPositiveIntegers(c.x??0,c.width??0,c.height??0),this._core.registerDecoration(c)}hasSelection(){return this._core.hasSelection()}select(c,n,r){this._verifyIntegers(c,n,r),this._core.select(c,n,r)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(c,n){this._verifyIntegers(c,n),this._core.selectLines(c,n)}dispose(){super.dispose()}scrollLines(c){this._verifyIntegers(c),this._core.scrollLines(c)}scrollPages(c){this._verifyIntegers(c),this._core.scrollPages(c)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(c){this._verifyIntegers(c),this._core.scrollToLine(c)}clear(){this._core.clear()}write(c,n){this._core.write(c,n)}writeln(c,n){this._core.write(c),this._core.write(`\r
`,n)}paste(c){this._core.paste(c)}refresh(c,n){this._verifyIntegers(c,n),this._core.refresh(c,n)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(c){this._addonManager.loadAddon(this,c)}static get strings(){return e}_verifyIntegers(...c){for(const n of c)if(n===1/0||isNaN(n)||n%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...c){for(const n of c)if(n&&(n===1/0||isNaN(n)||n%1!=0||n<0))throw new Error("This API only accepts positive integers")}}x.Terminal=l})(),B})())}(di)),di.exports}var ia=ta(),ui={exports:{}},os;function sa(){return os||(os=1,function(t,s){(function(u,w){t.exports=w()})(self,()=>(()=>{var u={};return(()=>{var w=u;Object.defineProperty(w,"__esModule",{value:!0}),w.FitAddon=void 0,w.FitAddon=class{activate(y){this._terminal=y}dispose(){}fit(){const y=this.proposeDimensions();if(!y||!this._terminal||isNaN(y.cols)||isNaN(y.rows))return;const B=this._terminal._core;this._terminal.rows===y.rows&&this._terminal.cols===y.cols||(B._renderService.clear(),this._terminal.resize(y.cols,y.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const y=this._terminal._core,B=y._renderService.dimensions;if(B.css.cell.width===0||B.css.cell.height===0)return;const x=this._terminal.options.scrollback===0?0:y.viewport.scrollBarWidth,e=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(e.getPropertyValue("height")),h=Math.max(0,parseInt(e.getPropertyValue("width"))),f=window.getComputedStyle(this._terminal.element),o=a-(parseInt(f.getPropertyValue("padding-top"))+parseInt(f.getPropertyValue("padding-bottom"))),d=h-(parseInt(f.getPropertyValue("padding-right"))+parseInt(f.getPropertyValue("padding-left")))-x;return{cols:Math.max(2,Math.floor(d/B.css.cell.width)),rows:Math.max(1,Math.floor(o/B.css.cell.height))}}}})(),u})())}(ui)),ui.exports}var ra=sa(),fi={exports:{}},as;function na(){return as||(as=1,function(t,s){(function(u,w){t.exports=w()})(self,()=>(()=>{var u={903:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseRenderLayer=void 0;const h=a(274),f=a(627),o=a(237),d=a(860),m=a(374),b=a(296),l=a(345),i=a(859),c=a(399),n=a(855);class r extends i.Disposable{get canvas(){return this._canvas}get cacheCanvas(){return this._charAtlas?.pages[0].canvas}constructor(_,C,g,S,k,L,M,A,P,F){super(),this._terminal=_,this._container=C,this._alpha=k,this._themeService=L,this._bufferService=M,this._optionsService=A,this._decorationService=P,this._coreBrowserService=F,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._selectionModel=(0,b.createSelectionRenderModel)(),this._bitmapGenerator=[],this._charAtlasDisposable=this.register(new i.MutableDisposable),this._onAddTextureAtlasCanvas=this.register(new l.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._cellColorResolver=new h.CellColorResolver(this._terminal,this._optionsService,this._selectionModel,this._decorationService,this._coreBrowserService,this._themeService),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${g}-layer`),this._canvas.style.zIndex=S.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._refreshCharAtlas(this._themeService.colors),this.register(this._themeService.onChangeColors(U=>{this._refreshCharAtlas(U),this.reset(),this.handleSelectionChanged(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)})),this.register((0,i.toDisposable)(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=(0,m.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(){}handleFocus(){}handleCursorMove(){}handleGridChanged(_,C){}handleSelectionChanged(_,C,g=!1){this._selectionModel.update(this._terminal._core,_,C,g)}_setTransparency(_){if(_===this._alpha)return;const C=this._canvas;this._alpha=_,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,C),this._refreshCharAtlas(this._themeService.colors),this.handleGridChanged(0,this._bufferService.rows-1)}_refreshCharAtlas(_){if(!(this._deviceCharWidth<=0&&this._deviceCharHeight<=0)){this._charAtlas=(0,f.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,_,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlasDisposable.value=(0,l.forwardEvent)(this._charAtlas.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),this._charAtlas.warmUp();for(let C=0;C<this._charAtlas.pages.length;C++)this._bitmapGenerator[C]=new p(this._charAtlas.pages[C].canvas)}}resize(_){this._deviceCellWidth=_.device.cell.width,this._deviceCellHeight=_.device.cell.height,this._deviceCharWidth=_.device.char.width,this._deviceCharHeight=_.device.char.height,this._deviceCharLeft=_.device.char.left,this._deviceCharTop=_.device.char.top,this._canvas.width=_.device.canvas.width,this._canvas.height=_.device.canvas.height,this._canvas.style.width=`${_.css.canvas.width}px`,this._canvas.style.height=`${_.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(this._themeService.colors)}clearTextureAtlas(){this._charAtlas?.clearTexture()}_fillCells(_,C,g,S){this._ctx.fillRect(_*this._deviceCellWidth,C*this._deviceCellHeight,g*this._deviceCellWidth,S*this._deviceCellHeight)}_fillMiddleLineAtCells(_,C,g=1){const S=Math.ceil(.5*this._deviceCellHeight);this._ctx.fillRect(_*this._deviceCellWidth,(C+1)*this._deviceCellHeight-S-this._coreBrowserService.dpr,g*this._deviceCellWidth,this._coreBrowserService.dpr)}_fillBottomLineAtCells(_,C,g=1,S=0){this._ctx.fillRect(_*this._deviceCellWidth,(C+1)*this._deviceCellHeight+S-this._coreBrowserService.dpr-1,g*this._deviceCellWidth,this._coreBrowserService.dpr)}_curlyUnderlineAtCell(_,C,g=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const S=this._coreBrowserService.dpr;this._ctx.lineWidth=S;for(let k=0;k<g;k++){const L=(_+k)*this._deviceCellWidth,M=(_+k+.5)*this._deviceCellWidth,A=(_+k+1)*this._deviceCellWidth,P=(C+1)*this._deviceCellHeight-S-1,F=P-S,U=P+S;this._ctx.moveTo(L,P),this._ctx.bezierCurveTo(L,F,M,F,M,P),this._ctx.bezierCurveTo(M,U,A,U,A,P)}this._ctx.stroke(),this._ctx.restore()}_dottedUnderlineAtCell(_,C,g=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const S=this._coreBrowserService.dpr;this._ctx.lineWidth=S,this._ctx.setLineDash([2*S,S]);const k=_*this._deviceCellWidth,L=(C+1)*this._deviceCellHeight-S-1;this._ctx.moveTo(k,L);for(let M=0;M<g;M++){const A=(_+g+M)*this._deviceCellWidth;this._ctx.lineTo(A,L)}this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_dashedUnderlineAtCell(_,C,g=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const S=this._coreBrowserService.dpr;this._ctx.lineWidth=S,this._ctx.setLineDash([4*S,3*S]);const k=_*this._deviceCellWidth,L=(_+g)*this._deviceCellWidth,M=(C+1)*this._deviceCellHeight-S-1;this._ctx.moveTo(k,M),this._ctx.lineTo(L,M),this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_fillLeftLineAtCell(_,C,g){this._ctx.fillRect(_*this._deviceCellWidth,C*this._deviceCellHeight,this._coreBrowserService.dpr*g,this._deviceCellHeight)}_strokeRectAtCell(_,C,g,S){const k=this._coreBrowserService.dpr;this._ctx.lineWidth=k,this._ctx.strokeRect(_*this._deviceCellWidth+k/2,C*this._deviceCellHeight+k/2,g*this._deviceCellWidth-k,S*this._deviceCellHeight-k)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(_,C,g,S){this._alpha?this._ctx.clearRect(_*this._deviceCellWidth,C*this._deviceCellHeight,g*this._deviceCellWidth,S*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(_*this._deviceCellWidth,C*this._deviceCellHeight,g*this._deviceCellWidth,S*this._deviceCellHeight))}_fillCharTrueColor(_,C,g){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline=o.TEXT_BASELINE,this._clipRow(g);let S=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(S=(0,d.tryDrawCustomChar)(this._ctx,_.getChars(),C*this._deviceCellWidth,g*this._deviceCellHeight,this._deviceCellWidth,this._deviceCellHeight,this._optionsService.rawOptions.fontSize,this._coreBrowserService.dpr)),S||this._ctx.fillText(_.getChars(),C*this._deviceCellWidth+this._deviceCharLeft,g*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_drawChars(_,C,g){const S=_.getChars(),k=_.getCode(),L=_.getWidth();if(this._cellColorResolver.resolve(_,C,this._bufferService.buffer.ydisp+g,this._deviceCellWidth),!this._charAtlas)return;let M;if(M=S&&S.length>1?this._charAtlas.getRasterizedGlyphCombinedChar(S,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0):this._charAtlas.getRasterizedGlyph(_.getCode()||n.WHITESPACE_CELL_CODE,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0),!M.size.x||!M.size.y)return;this._ctx.save(),this._clipRow(g),this._bitmapGenerator[M.texturePage]&&this._charAtlas.pages[M.texturePage].canvas!==this._bitmapGenerator[M.texturePage].canvas&&(this._bitmapGenerator[M.texturePage]?.bitmap?.close(),delete this._bitmapGenerator[M.texturePage]),this._charAtlas.pages[M.texturePage].version!==this._bitmapGenerator[M.texturePage]?.version&&(this._bitmapGenerator[M.texturePage]||(this._bitmapGenerator[M.texturePage]=new p(this._charAtlas.pages[M.texturePage].canvas)),this._bitmapGenerator[M.texturePage].refresh(),this._bitmapGenerator[M.texturePage].version=this._charAtlas.pages[M.texturePage].version);let A=M.size.x;this._optionsService.rawOptions.rescaleOverlappingGlyphs&&(0,m.allowRescaling)(k,L,M.size.x,this._deviceCellWidth)&&(A=this._deviceCellWidth-1),this._ctx.drawImage(this._bitmapGenerator[M.texturePage]?.bitmap||this._charAtlas.pages[M.texturePage].canvas,M.texturePosition.x,M.texturePosition.y,M.size.x,M.size.y,C*this._deviceCellWidth+this._deviceCharLeft-M.offset.x,g*this._deviceCellHeight+this._deviceCharTop-M.offset.y,A,M.size.y),this._ctx.restore()}_clipRow(_){this._ctx.beginPath(),this._ctx.rect(0,_*this._deviceCellHeight,this._bufferService.cols*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(_,C){return`${C?"italic":""} ${_?this._optionsService.rawOptions.fontWeightBold:this._optionsService.rawOptions.fontWeight} ${this._optionsService.rawOptions.fontSize*this._coreBrowserService.dpr}px ${this._optionsService.rawOptions.fontFamily}`}}e.BaseRenderLayer=r;class p{get bitmap(){return this._bitmap}constructor(_){this.canvas=_,this._state=0,this._commitTimeout=void 0,this._bitmap=void 0,this.version=-1}refresh(){this._bitmap?.close(),this._bitmap=void 0,c.isSafari||(this._commitTimeout===void 0&&(this._commitTimeout=window.setTimeout(()=>this._generate(),100)),this._state===1&&(this._state=2))}_generate(){this._state===0&&(this._bitmap?.close(),this._bitmap=void 0,this._state=1,window.createImageBitmap(this.canvas).then(_=>{this._state===2?this.refresh():this._bitmap=_,this._state=0}),this._commitTimeout&&(this._commitTimeout=void 0))}}},949:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasRenderer=void 0;const h=a(627),f=a(56),o=a(374),d=a(345),m=a(859),b=a(873),l=a(43),i=a(630),c=a(744);class n extends m.Disposable{constructor(p,v,_,C,g,S,k,L,M,A,P){super(),this._terminal=p,this._screenElement=v,this._bufferService=C,this._charSizeService=g,this._optionsService=S,this._coreBrowserService=M,this._themeService=P,this._observerDisposable=this.register(new m.MutableDisposable),this._onRequestRedraw=this.register(new d.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onChangeTextureAtlas=this.register(new d.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new d.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;const F=this._optionsService.rawOptions.allowTransparency;this._renderLayers=[new c.TextRenderLayer(this._terminal,this._screenElement,0,F,this._bufferService,this._optionsService,k,A,this._coreBrowserService,P),new i.SelectionRenderLayer(this._terminal,this._screenElement,1,this._bufferService,this._coreBrowserService,A,this._optionsService,P),new l.LinkRenderLayer(this._terminal,this._screenElement,2,_,this._bufferService,this._optionsService,A,this._coreBrowserService,P),new b.CursorRenderLayer(this._terminal,this._screenElement,3,this._onRequestRedraw,this._bufferService,this._optionsService,L,this._coreBrowserService,A,P)];for(const U of this._renderLayers)(0,d.forwardEvent)(U.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas);this.dimensions=(0,o.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._observerDisposable.value=(0,f.observeDevicePixelDimensions)(this._renderLayers[0].canvas,this._coreBrowserService.window,(U,H)=>this._setCanvasDevicePixelDimensions(U,H)),this.register(this._coreBrowserService.onWindowChange(U=>{this._observerDisposable.value=(0,f.observeDevicePixelDimensions)(this._renderLayers[0].canvas,U,(H,$)=>this._setCanvasDevicePixelDimensions(H,$))})),this.register((0,m.toDisposable)(()=>{for(const U of this._renderLayers)U.dispose();(0,h.removeTerminalFromCache)(this._terminal)}))}get textureAtlas(){return this._renderLayers[0].cacheCanvas}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._bufferService.cols,this._bufferService.rows))}handleResize(p,v){this._updateDimensions();for(const _ of this._renderLayers)_.resize(this.dimensions);this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}handleCharSizeChanged(){this.handleResize(this._bufferService.cols,this._bufferService.rows)}handleBlur(){this._runOperation(p=>p.handleBlur())}handleFocus(){this._runOperation(p=>p.handleFocus())}handleSelectionChanged(p,v,_=!1){this._runOperation(C=>C.handleSelectionChanged(p,v,_)),this._themeService.colors.selectionForeground&&this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}handleCursorMove(){this._runOperation(p=>p.handleCursorMove())}clear(){this._runOperation(p=>p.reset())}_runOperation(p){for(const v of this._renderLayers)p(v)}renderRows(p,v){for(const _ of this._renderLayers)_.handleGridChanged(p,v)}clearTextureAtlas(){for(const p of this._renderLayers)p.clearTextureAtlas()}_updateDimensions(){if(!this._charSizeService.hasValidSize)return;const p=this._coreBrowserService.dpr;this.dimensions.device.char.width=Math.floor(this._charSizeService.width*p),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*p),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._bufferService.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._bufferService.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/p),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/p),this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows,this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols}_setCanvasDevicePixelDimensions(p,v){this.dimensions.device.canvas.height=v,this.dimensions.device.canvas.width=p;for(const _ of this._renderLayers)_.resize(this.dimensions);this._requestRedrawViewport()}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}}e.CanvasRenderer=n},873:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CursorRenderLayer=void 0;const h=a(457),f=a(859),o=a(399),d=a(782),m=a(903);class b extends m.BaseRenderLayer{constructor(i,c,n,r,p,v,_,C,g,S){super(i,c,"cursor",n,!0,S,p,v,g,C),this._onRequestRedraw=r,this._coreService=_,this._cursorBlinkStateManager=this.register(new f.MutableDisposable),this._cell=new d.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this),outline:this._renderOutlineCursor.bind(this)},this.register(v.onOptionChange(()=>this._handleOptionsChanged())),this._handleOptionsChanged()}resize(i){super.resize(i),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(){this._clearCursor(),this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._handleOptionsChanged()}handleBlur(){this._cursorBlinkStateManager.value?.pause(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleFocus(){this._cursorBlinkStateManager.value?.resume(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}_handleOptionsChanged(){this._optionsService.rawOptions.cursorBlink?this._cursorBlinkStateManager.value||(this._cursorBlinkStateManager.value=new h.CursorBlinkStateManager(()=>this._render(!0),this._coreBrowserService)):this._cursorBlinkStateManager.clear(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleCursorMove(){this._cursorBlinkStateManager.value?.restartBlinkAnimation()}handleGridChanged(i,c){!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isPaused?this._render(!1):this._cursorBlinkStateManager.value.restartBlinkAnimation()}_render(i){if(!this._coreService.isCursorInitialized||this._coreService.isCursorHidden)return void this._clearCursor();const c=this._bufferService.buffer.ybase+this._bufferService.buffer.y,n=c-this._bufferService.buffer.ydisp;if(n<0||n>=this._bufferService.rows)return void this._clearCursor();const r=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1);if(this._bufferService.buffer.lines.get(c).loadCell(r,this._cell),this._cell.content!==void 0){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css;const p=this._optionsService.rawOptions.cursorStyle,v=this._optionsService.rawOptions.cursorInactiveStyle;return v&&v!=="none"&&this._cursorRenderers[v](r,n,this._cell),this._ctx.restore(),this._state.x=r,this._state.y=n,this._state.isFocused=!1,this._state.style=p,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible){if(this._state){if(this._state.x===r&&this._state.y===n&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.rawOptions.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.rawOptions.cursorStyle||"block"](r,n,this._cell),this._ctx.restore(),this._state.x=r,this._state.y=n,this._state.isFocused=!1,this._state.style=this._optionsService.rawOptions.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(o.isFirefox||this._coreBrowserService.dpr<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})}_renderBarCursor(i,c,n){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillLeftLineAtCell(i,c,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()}_renderBlockCursor(i,c,n){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillCells(i,c,n.getWidth(),1),this._ctx.fillStyle=this._themeService.colors.cursorAccent.css,this._fillCharTrueColor(n,i,c),this._ctx.restore()}_renderUnderlineCursor(i,c,n){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillBottomLineAtCells(i,c),this._ctx.restore()}_renderOutlineCursor(i,c,n){this._ctx.save(),this._ctx.strokeStyle=this._themeService.colors.cursor.css,this._strokeRectAtCell(i,c,n.getWidth(),1),this._ctx.restore()}}e.CursorRenderLayer=b},574:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GridCache=void 0,e.GridCache=class{constructor(){this.cache=[]}resize(a,h){for(let f=0;f<a;f++){this.cache.length<=f&&this.cache.push([]);for(let o=this.cache[f].length;o<h;o++)this.cache[f].push(void 0);this.cache[f].length=h}this.cache.length=a}clear(){for(let a=0;a<this.cache.length;a++)for(let h=0;h<this.cache[a].length;h++)this.cache[a][h]=void 0}}},43:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LinkRenderLayer=void 0;const h=a(197),f=a(237),o=a(903);class d extends o.BaseRenderLayer{constructor(b,l,i,c,n,r,p,v,_){super(b,l,"link",i,!0,_,n,r,p,v),this.register(c.onShowLinkUnderline(C=>this._handleShowLinkUnderline(C))),this.register(c.onHideLinkUnderline(C=>this._handleHideLinkUnderline(C)))}resize(b){super.resize(b),this._state=void 0}reset(){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const b=this._state.y2-this._state.y1-1;b>0&&this._clearCells(0,this._state.y1+1,this._state.cols,b),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(b){if(b.fg===f.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:b.fg&&(0,h.is256Color)(b.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[b.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,b.y1===b.y2)this._fillBottomLineAtCells(b.x1,b.y1,b.x2-b.x1);else{this._fillBottomLineAtCells(b.x1,b.y1,b.cols-b.x1);for(let l=b.y1+1;l<b.y2;l++)this._fillBottomLineAtCells(0,l,b.cols);this._fillBottomLineAtCells(0,b.y2,b.x2)}this._state=b}_handleHideLinkUnderline(b){this._clearCurrentLink()}}e.LinkRenderLayer=d},630:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionRenderLayer=void 0;const h=a(903);class f extends h.BaseRenderLayer{constructor(d,m,b,l,i,c,n,r){super(d,m,"selection",b,!0,r,l,n,c,i),this._clearState()}_clearState(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}}resize(d){super.resize(d),this._selectionModel.selectionStart&&this._selectionModel.selectionEnd&&(this._clearState(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode))}reset(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())}handleBlur(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleFocus(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleSelectionChanged(d,m,b){super.handleSelectionChanged(d,m,b),this._redrawSelection(d,m,b)}_redrawSelection(d,m,b){if(!this._didStateChange(d,m,b,this._bufferService.buffer.ydisp))return;if(this._clearAll(),!d||!m)return void this._clearState();const l=d[1]-this._bufferService.buffer.ydisp,i=m[1]-this._bufferService.buffer.ydisp,c=Math.max(l,0),n=Math.min(i,this._bufferService.rows-1);if(c>=this._bufferService.rows||n<0)this._state.ydisp=this._bufferService.buffer.ydisp;else{if(this._ctx.fillStyle=(this._coreBrowserService.isFocused?this._themeService.colors.selectionBackgroundTransparent:this._themeService.colors.selectionInactiveBackgroundTransparent).css,b){const r=d[0],p=m[0]-r,v=n-c+1;this._fillCells(r,c,p,v)}else{const r=l===c?d[0]:0,p=c===i?m[0]:this._bufferService.cols;this._fillCells(r,c,p-r,1);const v=Math.max(n-c-1,0);if(this._fillCells(0,c+1,this._bufferService.cols,v),c!==n){const _=i===n?m[0]:this._bufferService.cols;this._fillCells(0,n,_,1)}}this._state.start=[d[0],d[1]],this._state.end=[m[0],m[1]],this._state.columnSelectMode=b,this._state.ydisp=this._bufferService.buffer.ydisp}}_didStateChange(d,m,b,l){return!this._areCoordinatesEqual(d,this._state.start)||!this._areCoordinatesEqual(m,this._state.end)||b!==this._state.columnSelectMode||l!==this._state.ydisp}_areCoordinatesEqual(d,m){return!(!d||!m)&&d[0]===m[0]&&d[1]===m[1]}}e.SelectionRenderLayer=f},744:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextRenderLayer=void 0;const h=a(577),f=a(147),o=a(782),d=a(855),m=a(903),b=a(574);class l extends m.BaseRenderLayer{constructor(c,n,r,p,v,_,C,g,S,k){super(c,n,"text",r,p,k,v,_,g,S),this._characterJoinerService=C,this._characterWidth=0,this._characterFont="",this._characterOverlapCache={},this._workCell=new o.CellData,this._state=new b.GridCache,this.register(_.onSpecificOptionChange("allowTransparency",L=>this._setTransparency(L)))}resize(c){super.resize(c);const n=this._getFont(!1,!1);this._characterWidth===c.device.char.width&&this._characterFont===n||(this._characterWidth=c.device.char.width,this._characterFont=n,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)}reset(){this._state.clear(),this._clearAll()}_forEachCell(c,n,r){for(let p=c;p<=n;p++){const v=p+this._bufferService.buffer.ydisp,_=this._bufferService.buffer.lines.get(v),C=this._characterJoinerService.getJoinedCharacters(v);for(let g=0;g<this._bufferService.cols;g++){_.loadCell(g,this._workCell);let S=this._workCell,k=!1,L=g;if(S.getWidth()!==0){if(C.length>0&&g===C[0][0]){k=!0;const M=C.shift();S=new h.JoinedCellData(this._workCell,_.translateToString(!0,M[0],M[1]),M[1]-M[0]),L=M[1]-1}!k&&this._isOverlapping(S)&&L<_.length-1&&_.getCodePoint(L+1)===d.NULL_CELL_CODE&&(S.content&=-12582913,S.content|=8388608),r(S,g,p),g=L}}}}_drawBackground(c,n){const r=this._ctx,p=this._bufferService.cols;let v=0,_=0,C=null;r.save(),this._forEachCell(c,n,(g,S,k)=>{let L=null;g.isInverse()?L=g.isFgDefault()?this._themeService.colors.foreground.css:g.isFgRGB()?`rgb(${f.AttributeData.toColorRGB(g.getFgColor()).join(",")})`:this._themeService.colors.ansi[g.getFgColor()].css:g.isBgRGB()?L=`rgb(${f.AttributeData.toColorRGB(g.getBgColor()).join(",")})`:g.isBgPalette()&&(L=this._themeService.colors.ansi[g.getBgColor()].css);let M=!1;this._decorationService.forEachDecorationAtCell(S,this._bufferService.buffer.ydisp+k,void 0,A=>{A.options.layer!=="top"&&M||(A.backgroundColorRGB&&(L=A.backgroundColorRGB.css),M=A.options.layer==="top")}),C===null&&(v=S,_=k),k!==_?(r.fillStyle=C||"",this._fillCells(v,_,p-v,1),v=S,_=k):C!==L&&(r.fillStyle=C||"",this._fillCells(v,_,S-v,1),v=S,_=k),C=L}),C!==null&&(r.fillStyle=C,this._fillCells(v,_,p-v,1)),r.restore()}_drawForeground(c,n){this._forEachCell(c,n,(r,p,v)=>this._drawChars(r,p,v))}handleGridChanged(c,n){this._state.cache.length!==0&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,c,this._bufferService.cols,n-c+1),this._drawBackground(c,n),this._drawForeground(c,n))}_isOverlapping(c){if(c.getWidth()!==1||c.getCode()<256)return!1;const n=c.getChars();if(this._characterOverlapCache.hasOwnProperty(n))return this._characterOverlapCache[n];this._ctx.save(),this._ctx.font=this._characterFont;const r=Math.floor(this._ctx.measureText(n).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[n]=r,r}}e.TextRenderLayer=l},274:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CellColorResolver=void 0;const h=a(855),f=a(160),o=a(374);let d,m=0,b=0,l=!1,i=!1,c=!1,n=0;e.CellColorResolver=class{constructor(r,p,v,_,C,g){this._terminal=r,this._optionService=p,this._selectionRenderModel=v,this._decorationService=_,this._coreBrowserService=C,this._themeService=g,this.result={fg:0,bg:0,ext:0}}resolve(r,p,v,_){if(this.result.bg=r.bg,this.result.fg=r.fg,this.result.ext=268435456&r.bg?r.extended.ext:0,b=0,m=0,i=!1,l=!1,c=!1,d=this._themeService.colors,n=0,r.getCode()!==h.NULL_CELL_CODE&&r.extended.underlineStyle===4){const C=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));n=p*_%(2*Math.round(C))}if(this._decorationService.forEachDecorationAtCell(p,v,"bottom",C=>{C.backgroundColorRGB&&(b=C.backgroundColorRGB.rgba>>8&16777215,i=!0),C.foregroundColorRGB&&(m=C.foregroundColorRGB.rgba>>8&16777215,l=!0)}),c=this._selectionRenderModel.isCellSelected(this._terminal,p,v),c){if(67108864&this.result.fg||(50331648&this.result.bg)!=0){if(67108864&this.result.fg)switch(50331648&this.result.fg){case 16777216:case 33554432:b=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:b=(16777215&this.result.fg)<<8|255;break;default:b=this._themeService.colors.foreground.rgba}else switch(50331648&this.result.bg){case 16777216:case 33554432:b=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:b=(16777215&this.result.bg)<<8|255}b=f.rgba.blend(b,4294967040&(this._coreBrowserService.isFocused?d.selectionBackgroundOpaque:d.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}else b=(this._coreBrowserService.isFocused?d.selectionBackgroundOpaque:d.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(i=!0,d.selectionForeground&&(m=d.selectionForeground.rgba>>8&16777215,l=!0),(0,o.treatGlyphAsBackgroundColor)(r.getCode())){if(67108864&this.result.fg&&(50331648&this.result.bg)==0)m=(this._coreBrowserService.isFocused?d.selectionBackgroundOpaque:d.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(67108864&this.result.fg)switch(50331648&this.result.bg){case 16777216:case 33554432:m=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:m=(16777215&this.result.bg)<<8|255}else switch(50331648&this.result.fg){case 16777216:case 33554432:m=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:m=(16777215&this.result.fg)<<8|255;break;default:m=this._themeService.colors.foreground.rgba}m=f.rgba.blend(m,4294967040&(this._coreBrowserService.isFocused?d.selectionBackgroundOpaque:d.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}l=!0}}this._decorationService.forEachDecorationAtCell(p,v,"top",C=>{C.backgroundColorRGB&&(b=C.backgroundColorRGB.rgba>>8&16777215,i=!0),C.foregroundColorRGB&&(m=C.foregroundColorRGB.rgba>>8&16777215,l=!0)}),i&&(b=c?-16777216&r.bg&-134217729|b|50331648:-16777216&r.bg|b|50331648),l&&(m=-16777216&r.fg&-67108865|m|50331648),67108864&this.result.fg&&(i&&!l&&(m=(50331648&this.result.bg)==0?-134217728&this.result.fg|16777215&d.background.rgba>>8|50331648:-134217728&this.result.fg|67108863&this.result.bg,l=!0),!i&&l&&(b=(50331648&this.result.fg)==0?-67108864&this.result.bg|16777215&d.foreground.rgba>>8|50331648:-67108864&this.result.bg|67108863&this.result.fg,i=!0)),d=void 0,this.result.bg=i?b:this.result.bg,this.result.fg=l?m:this.result.fg,this.result.ext&=536870911,this.result.ext|=n<<29&3758096384}}},627:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.removeTerminalFromCache=e.acquireTextureAtlas=void 0;const h=a(509),f=a(197),o=[];e.acquireTextureAtlas=function(d,m,b,l,i,c,n,r){const p=(0,f.generateConfig)(l,i,c,n,m,b,r);for(let C=0;C<o.length;C++){const g=o[C],S=g.ownedBy.indexOf(d);if(S>=0){if((0,f.configEquals)(g.config,p))return g.atlas;g.ownedBy.length===1?(g.atlas.dispose(),o.splice(C,1)):g.ownedBy.splice(S,1);break}}for(let C=0;C<o.length;C++){const g=o[C];if((0,f.configEquals)(g.config,p))return g.ownedBy.push(d),g.atlas}const v=d._core,_={atlas:new h.TextureAtlas(document,p,v.unicodeService),config:p,ownedBy:[d]};return o.push(_),_.atlas},e.removeTerminalFromCache=function(d){for(let m=0;m<o.length;m++){const b=o[m].ownedBy.indexOf(d);if(b!==-1){o[m].ownedBy.length===1?(o[m].atlas.dispose(),o.splice(m,1)):o[m].ownedBy.splice(b,1);break}}}},197:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.is256Color=e.configEquals=e.generateConfig=void 0;const h=a(160);e.generateConfig=function(f,o,d,m,b,l,i){const c={foreground:l.foreground,background:l.background,cursor:h.NULL_COLOR,cursorAccent:h.NULL_COLOR,selectionForeground:h.NULL_COLOR,selectionBackgroundTransparent:h.NULL_COLOR,selectionBackgroundOpaque:h.NULL_COLOR,selectionInactiveBackgroundTransparent:h.NULL_COLOR,selectionInactiveBackgroundOpaque:h.NULL_COLOR,ansi:l.ansi.slice(),contrastCache:l.contrastCache,halfContrastCache:l.halfContrastCache};return{customGlyphs:b.customGlyphs,devicePixelRatio:i,letterSpacing:b.letterSpacing,lineHeight:b.lineHeight,deviceCellWidth:f,deviceCellHeight:o,deviceCharWidth:d,deviceCharHeight:m,fontFamily:b.fontFamily,fontSize:b.fontSize,fontWeight:b.fontWeight,fontWeightBold:b.fontWeightBold,allowTransparency:b.allowTransparency,drawBoldTextInBrightColors:b.drawBoldTextInBrightColors,minimumContrastRatio:b.minimumContrastRatio,colors:c}},e.configEquals=function(f,o){for(let d=0;d<f.colors.ansi.length;d++)if(f.colors.ansi[d].rgba!==o.colors.ansi[d].rgba)return!1;return f.devicePixelRatio===o.devicePixelRatio&&f.customGlyphs===o.customGlyphs&&f.lineHeight===o.lineHeight&&f.letterSpacing===o.letterSpacing&&f.fontFamily===o.fontFamily&&f.fontSize===o.fontSize&&f.fontWeight===o.fontWeight&&f.fontWeightBold===o.fontWeightBold&&f.allowTransparency===o.allowTransparency&&f.deviceCharWidth===o.deviceCharWidth&&f.deviceCharHeight===o.deviceCharHeight&&f.drawBoldTextInBrightColors===o.drawBoldTextInBrightColors&&f.minimumContrastRatio===o.minimumContrastRatio&&f.colors.foreground.rgba===o.colors.foreground.rgba&&f.colors.background.rgba===o.colors.background.rgba},e.is256Color=function(f){return(50331648&f)==16777216||(50331648&f)==33554432}},237:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TEXT_BASELINE=e.DIM_OPACITY=e.INVERTED_DEFAULT_COLOR=void 0;const h=a(399);e.INVERTED_DEFAULT_COLOR=257,e.DIM_OPACITY=.5,e.TEXT_BASELINE=h.isFirefox||h.isLegacyEdge?"bottom":"ideographic"},457:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CursorBlinkStateManager=void 0,e.CursorBlinkStateManager=class{constructor(a,h){this._renderCallback=a,this._coreBrowserService=h,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(a=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){const h=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,h>0)return void this._restartInterval(h)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){const h=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(h)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},a)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tryDrawCustomChar=e.powerlineDefinitions=e.boxDrawingDefinitions=e.blockElementDefinitions=void 0;const h=a(374);e.blockElementDefinitions={"":[{x:0,y:0,w:8,h:4}],"":[{x:0,y:7,w:8,h:1}],"":[{x:0,y:6,w:8,h:2}],"":[{x:0,y:5,w:8,h:3}],"":[{x:0,y:4,w:8,h:4}],"":[{x:0,y:3,w:8,h:5}],"":[{x:0,y:2,w:8,h:6}],"":[{x:0,y:1,w:8,h:7}],"":[{x:0,y:0,w:8,h:8}],"":[{x:0,y:0,w:7,h:8}],"":[{x:0,y:0,w:6,h:8}],"":[{x:0,y:0,w:5,h:8}],"":[{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:3,h:8}],"":[{x:0,y:0,w:2,h:8}],"":[{x:0,y:0,w:1,h:8}],"":[{x:4,y:0,w:4,h:8}],"":[{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8}],"":[{x:0,y:4,w:4,h:4}],"":[{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"":[{x:4,y:0,w:4,h:4}],"":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:1,y:0,w:1,h:8}],"":[{x:2,y:0,w:1,h:8}],"":[{x:3,y:0,w:1,h:8}],"":[{x:4,y:0,w:1,h:8}],"":[{x:5,y:0,w:1,h:8}],"":[{x:6,y:0,w:1,h:8}],"":[{x:0,y:1,w:8,h:1}],"":[{x:0,y:2,w:8,h:1}],"":[{x:0,y:3,w:8,h:1}],"":[{x:0,y:4,w:8,h:1}],"":[{x:0,y:5,w:8,h:1}],"":[{x:0,y:6,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:2}],"":[{x:0,y:0,w:8,h:3}],"":[{x:0,y:0,w:8,h:5}],"":[{x:0,y:0,w:8,h:6}],"":[{x:0,y:0,w:8,h:7}],"":[{x:6,y:0,w:2,h:8}],"":[{x:5,y:0,w:3,h:8}],"":[{x:3,y:0,w:5,h:8}],"":[{x:2,y:0,w:6,h:8}],"":[{x:1,y:0,w:7,h:8}],"":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};const f={"":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"":[[1,0],[0,0],[0,1],[0,0]],"":[[0,1],[1,1],[1,0],[1,1]]};e.boxDrawingDefinitions={"":{1:"M0,.5 L1,.5"},"":{3:"M0,.5 L1,.5"},"":{1:"M.5,0 L.5,1"},"":{3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5"},"":{3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M0,.5 L.5,.5 L.5,1"},"":{3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L1,.5"},"":{3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L0,.5"},"":{3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{1:"M.5,.5 L0,.5"},"":{3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0"},"":{3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5"},"":{3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1"},"":{3:"M.5,.5 L.5,1"},"":{1:(l,i)=>`M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i}`},"":{1:(l,i)=>`M${.5-l},0 L${.5-l},1 M${.5+l},0 L${.5+l},1`},"":{1:(l,i)=>`M.5,1 L.5,${.5-i} L1,${.5-i} M.5,${.5+i} L1,${.5+i}`},"":{1:(l,i)=>`M${.5-l},1 L${.5-l},.5 L1,.5 M${.5+l},.5 L${.5+l},1`},"":{1:(l,i)=>`M1,${.5-i} L${.5-l},${.5-i} L${.5-l},1 M1,${.5+i} L${.5+l},${.5+i} L${.5+l},1`},"":{1:(l,i)=>`M0,${.5-i} L.5,${.5-i} L.5,1 M0,${.5+i} L.5,${.5+i}`},"":{1:(l,i)=>`M${.5+l},1 L${.5+l},.5 L0,.5 M${.5-l},.5 L${.5-l},1`},"":{1:(l,i)=>`M0,${.5+i} L${.5-l},${.5+i} L${.5-l},1 M0,${.5-i} L${.5+l},${.5-i} L${.5+l},1`},"":{1:(l,i)=>`M.5,0 L.5,${.5+i} L1,${.5+i} M.5,${.5-i} L1,${.5-i}`},"":{1:(l,i)=>`M1,.5 L${.5-l},.5 L${.5-l},0 M${.5+l},.5 L${.5+l},0`},"":{1:(l,i)=>`M1,${.5-i} L${.5+l},${.5-i} L${.5+l},0 M1,${.5+i} L${.5-l},${.5+i} L${.5-l},0`},"":{1:(l,i)=>`M0,${.5+i} L.5,${.5+i} L.5,0 M0,${.5-i} L.5,${.5-i}`},"":{1:(l,i)=>`M0,.5 L${.5+l},.5 L${.5+l},0 M${.5-l},.5 L${.5-l},0`},"":{1:(l,i)=>`M0,${.5-i} L${.5-l},${.5-i} L${.5-l},0 M0,${.5+i} L${.5+l},${.5+i} L${.5+l},0`},"":{1:(l,i)=>`M.5,0 L.5,1 M.5,${.5-i} L1,${.5-i} M.5,${.5+i} L1,${.5+i}`},"":{1:(l,i)=>`M${.5-l},0 L${.5-l},1 M${.5+l},0 L${.5+l},1 M${.5+l},.5 L1,.5`},"":{1:(l,i)=>`M${.5-l},0 L${.5-l},1 M1,${.5+i} L${.5+l},${.5+i} L${.5+l},1 M1,${.5-i} L${.5+l},${.5-i} L${.5+l},0`},"":{1:(l,i)=>`M.5,0 L.5,1 M0,${.5-i} L.5,${.5-i} M0,${.5+i} L.5,${.5+i}`},"":{1:(l,i)=>`M0,.5 L${.5-l},.5 M${.5-l},0 L${.5-l},1 M${.5+l},0 L${.5+l},1`},"":{1:(l,i)=>`M${.5+l},0 L${.5+l},1 M0,${.5+i} L${.5-l},${.5+i} L${.5-l},1 M0,${.5-i} L${.5-l},${.5-i} L${.5-l},0`},"":{1:(l,i)=>`M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i} M.5,${.5+i} L.5,1`},"":{1:(l,i)=>`M0,.5 L1,.5 M${.5-l},.5 L${.5-l},1 M${.5+l},.5 L${.5+l},1`},"":{1:(l,i)=>`M0,${.5-i} L1,${.5-i} M0,${.5+i} L${.5-l},${.5+i} L${.5-l},1 M1,${.5+i} L${.5+l},${.5+i} L${.5+l},1`},"":{1:(l,i)=>`M.5,0 L.5,${.5-i} M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i}`},"":{1:(l,i)=>`M0,.5 L1,.5 M${.5-l},.5 L${.5-l},0 M${.5+l},.5 L${.5+l},0`},"":{1:(l,i)=>`M0,${.5+i} L1,${.5+i} M0,${.5-i} L${.5-l},${.5-i} L${.5-l},0 M1,${.5-i} L${.5+l},${.5-i} L${.5+l},0`},"":{1:(l,i)=>`M.5,0 L.5,1 M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i}`},"":{1:(l,i)=>`M0,.5 L1,.5 M${.5-l},0 L${.5-l},1 M${.5+l},0 L${.5+l},1`},"":{1:(l,i)=>`M0,${.5+i} L${.5-l},${.5+i} L${.5-l},1 M1,${.5+i} L${.5+l},${.5+i} L${.5+l},1 M0,${.5-i} L${.5-l},${.5-i} L${.5-l},0 M1,${.5-i} L${.5+l},${.5-i} L${.5+l},0`},"":{1:"M1,0 L0,1"},"":{1:"M0,0 L1,1"},"":{1:"M1,0 L0,1 M0,0 L1,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{1:(l,i)=>`M.5,1 L.5,${.5+i/.15*.5} C.5,${.5+i/.15*.5},.5,.5,1,.5`},"":{1:(l,i)=>`M.5,1 L.5,${.5+i/.15*.5} C.5,${.5+i/.15*.5},.5,.5,0,.5`},"":{1:(l,i)=>`M.5,0 L.5,${.5-i/.15*.5} C.5,${.5-i/.15*.5},.5,.5,0,.5`},"":{1:(l,i)=>`M.5,0 L.5,${.5-i/.15*.5} C.5,${.5-i/.15*.5},.5,.5,1,.5`}},e.powerlineDefinitions={"":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},e.powerlineDefinitions[""]=e.powerlineDefinitions[""],e.powerlineDefinitions[""]=e.powerlineDefinitions[""],e.tryDrawCustomChar=function(l,i,c,n,r,p,v,_){const C=e.blockElementDefinitions[i];if(C)return function(L,M,A,P,F,U){for(let H=0;H<M.length;H++){const $=M[H],E=F/8,R=U/8;L.fillRect(A+$.x*E,P+$.y*R,$.w*E,$.h*R)}}(l,C,c,n,r,p),!0;const g=f[i];if(g)return function(L,M,A,P,F,U){let H=o.get(M);H||(H=new Map,o.set(M,H));const $=L.fillStyle;if(typeof $!="string")throw new Error(`Unexpected fillStyle type "${$}"`);let E=H.get($);if(!E){const R=M[0].length,T=M.length,I=L.canvas.ownerDocument.createElement("canvas");I.width=R,I.height=T;const N=(0,h.throwIfFalsy)(I.getContext("2d")),j=new ImageData(R,T);let K,X,O,D;if($.startsWith("#"))K=parseInt($.slice(1,3),16),X=parseInt($.slice(3,5),16),O=parseInt($.slice(5,7),16),D=$.length>7&&parseInt($.slice(7,9),16)||1;else{if(!$.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${$}" when drawing pattern glyph`);[K,X,O,D]=$.substring(5,$.length-1).split(",").map(W=>parseFloat(W))}for(let W=0;W<T;W++)for(let z=0;z<R;z++)j.data[4*(W*R+z)]=K,j.data[4*(W*R+z)+1]=X,j.data[4*(W*R+z)+2]=O,j.data[4*(W*R+z)+3]=M[W][z]*(255*D);N.putImageData(j,0,0),E=(0,h.throwIfFalsy)(L.createPattern(I,null)),H.set($,E)}L.fillStyle=E,L.fillRect(A,P,F,U)}(l,g,c,n,r,p),!0;const S=e.boxDrawingDefinitions[i];if(S)return function(L,M,A,P,F,U,H){L.strokeStyle=L.fillStyle;for(const[$,E]of Object.entries(M)){let R;L.beginPath(),L.lineWidth=H*Number.parseInt($),R=typeof E=="function"?E(.15,.15/U*F):E;for(const T of R.split(" ")){const I=T[0],N=m[I];if(!N){console.error(`Could not find drawing instructions for "${I}"`);continue}const j=T.substring(1).split(",");j[0]&&j[1]&&N(L,b(j,F,U,A,P,!0,H))}L.stroke(),L.closePath()}}(l,S,c,n,r,p,_),!0;const k=e.powerlineDefinitions[i];return!!k&&(function(L,M,A,P,F,U,H,$){const E=new Path2D;E.rect(A,P,F,U),L.clip(E),L.beginPath();const R=H/12;L.lineWidth=$*R;for(const T of M.d.split(" ")){const I=T[0],N=m[I];if(!N){console.error(`Could not find drawing instructions for "${I}"`);continue}const j=T.substring(1).split(",");j[0]&&j[1]&&N(L,b(j,F,U,A,P,!1,$,(M.leftPadding??0)*(R/2),(M.rightPadding??0)*(R/2)))}M.type===1?(L.strokeStyle=L.fillStyle,L.stroke()):L.fill(),L.closePath()}(l,k,c,n,r,p,v,_),!0)};const o=new Map;function d(l,i,c=0){return Math.max(Math.min(l,i),c)}const m={C:(l,i)=>l.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]),L:(l,i)=>l.lineTo(i[0],i[1]),M:(l,i)=>l.moveTo(i[0],i[1])};function b(l,i,c,n,r,p,v,_=0,C=0){const g=l.map(S=>parseFloat(S)||parseInt(S));if(g.length<2)throw new Error("Too few arguments for instruction");for(let S=0;S<g.length;S+=2)g[S]*=i-_*v-C*v,p&&g[S]!==0&&(g[S]=d(Math.round(g[S]+.5)-.5,i,0)),g[S]+=n+_*v;for(let S=1;S<g.length;S+=2)g[S]*=c,p&&g[S]!==0&&(g[S]=d(Math.round(g[S]+.5)-.5,c,0)),g[S]+=r;return g}},56:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.observeDevicePixelDimensions=void 0;const h=a(859);e.observeDevicePixelDimensions=function(f,o,d){let m=new o.ResizeObserver(b=>{const l=b.find(n=>n.target===f);if(!l)return;if(!("devicePixelContentBoxSize"in l))return m?.disconnect(),void(m=void 0);const i=l.devicePixelContentBoxSize[0].inlineSize,c=l.devicePixelContentBoxSize[0].blockSize;i>0&&c>0&&d(i,c)});try{m.observe(f,{box:["device-pixel-content-box"]})}catch{m.disconnect(),m=void 0}return(0,h.toDisposable)(()=>m?.disconnect())}},374:(x,e)=>{function a(f){return 57508<=f&&f<=57558}function h(f){return f>=128512&&f<=128591||f>=127744&&f<=128511||f>=128640&&f<=128767||f>=9728&&f<=9983||f>=9984&&f<=10175||f>=65024&&f<=65039||f>=129280&&f<=129535||f>=127462&&f<=127487}Object.defineProperty(e,"__esModule",{value:!0}),e.computeNextVariantOffset=e.createRenderDimensions=e.treatGlyphAsBackgroundColor=e.allowRescaling=e.isEmoji=e.isRestrictedPowerlineGlyph=e.isPowerlineGlyph=e.throwIfFalsy=void 0,e.throwIfFalsy=function(f){if(!f)throw new Error("value must not be falsy");return f},e.isPowerlineGlyph=a,e.isRestrictedPowerlineGlyph=function(f){return 57520<=f&&f<=57527},e.isEmoji=h,e.allowRescaling=function(f,o,d,m){return o===1&&d>Math.ceil(1.5*m)&&f!==void 0&&f>255&&!h(f)&&!a(f)&&!function(b){return 57344<=b&&b<=63743}(f)},e.treatGlyphAsBackgroundColor=function(f){return a(f)||function(o){return 9472<=o&&o<=9631}(f)},e.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},e.computeNextVariantOffset=function(f,o,d=0){return(f-(2*Math.round(o)-d))%(2*Math.round(o))}},296:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(f,o,d,m=!1){if(this.selectionStart=o,this.selectionEnd=d,!o||!d||o[0]===d[0]&&o[1]===d[1])return void this.clear();const b=f.buffers.active.ydisp,l=o[1]-b,i=d[1]-b,c=Math.max(l,0),n=Math.min(i,f.rows-1);c>=f.rows||n<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=m,this.viewportStartRow=l,this.viewportEndRow=i,this.viewportCappedStartRow=c,this.viewportCappedEndRow=n,this.startCol=o[0],this.endCol=d[0])}isCellSelected(f,o,d){return!!this.hasSelection&&(d-=f.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?o>=this.startCol&&d>=this.viewportCappedStartRow&&o<this.endCol&&d<=this.viewportCappedEndRow:o<this.startCol&&d>=this.viewportCappedStartRow&&o>=this.endCol&&d<=this.viewportCappedEndRow:d>this.viewportStartRow&&d<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&d===this.viewportStartRow&&o>=this.startCol&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&d===this.viewportEndRow&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&d===this.viewportStartRow&&o>=this.startCol)}}e.createSelectionRenderModel=function(){return new a}},509:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextureAtlas=void 0;const h=a(237),f=a(860),o=a(374),d=a(160),m=a(345),b=a(485),l=a(385),i=a(147),c=a(855),n={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};let r;class p{get pages(){return this._pages}constructor(S,k,L){this._document=S,this._config=k,this._unicodeService=L,this._didWarmUp=!1,this._cacheMap=new b.FourKeyMap,this._cacheMapCombined=new b.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new i.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new m.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new m.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=C(S,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,o.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(const S of this.pages)S.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){const S=new l.IdleTaskQueue;for(let k=33;k<126;k++)S.enqueue(()=>{if(!this._cacheMap.get(k,c.DEFAULT_COLOR,c.DEFAULT_COLOR,c.DEFAULT_EXT)){const L=this._drawToCache(k,c.DEFAULT_COLOR,c.DEFAULT_COLOR,c.DEFAULT_EXT);this._cacheMap.set(k,c.DEFAULT_COLOR,c.DEFAULT_COLOR,c.DEFAULT_EXT,L)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(const S of this._pages)S.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(p.maxAtlasPages&&this._pages.length>=Math.max(4,p.maxAtlasPages)){const k=this._pages.filter(H=>2*H.canvas.width<=(p.maxTextureSize||4096)).sort((H,$)=>$.canvas.width!==H.canvas.width?$.canvas.width-H.canvas.width:$.percentageUsed-H.percentageUsed);let L=-1,M=0;for(let H=0;H<k.length;H++)if(k[H].canvas.width!==M)L=H,M=k[H].canvas.width;else if(H-L==3)break;const A=k.slice(L,L+4),P=A.map(H=>H.glyphs[0].texturePage).sort((H,$)=>H>$?1:-1),F=this.pages.length-A.length,U=this._mergePages(A,F);U.version++;for(let H=P.length-1;H>=0;H--)this._deletePage(P[H]);this.pages.push(U),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(U.canvas)}const S=new v(this._document,this._textureSize);return this._pages.push(S),this._activePages.push(S),this._onAddTextureAtlasCanvas.fire(S.canvas),S}_mergePages(S,k){const L=2*S[0].canvas.width,M=new v(this._document,L,S);for(const[A,P]of S.entries()){const F=A*P.canvas.width%L,U=Math.floor(A/2)*P.canvas.height;M.ctx.drawImage(P.canvas,F,U);for(const $ of P.glyphs)$.texturePage=k,$.sizeClipSpace.x=$.size.x/L,$.sizeClipSpace.y=$.size.y/L,$.texturePosition.x+=F,$.texturePosition.y+=U,$.texturePositionClipSpace.x=$.texturePosition.x/L,$.texturePositionClipSpace.y=$.texturePosition.y/L;this._onRemoveTextureAtlasCanvas.fire(P.canvas);const H=this._activePages.indexOf(P);H!==-1&&this._activePages.splice(H,1)}return M}_deletePage(S){this._pages.splice(S,1);for(let k=S;k<this._pages.length;k++){const L=this._pages[k];for(const M of L.glyphs)M.texturePage--;L.version++}}getRasterizedGlyphCombinedChar(S,k,L,M,A){return this._getFromCacheMap(this._cacheMapCombined,S,k,L,M,A)}getRasterizedGlyph(S,k,L,M,A){return this._getFromCacheMap(this._cacheMap,S,k,L,M,A)}_getFromCacheMap(S,k,L,M,A,P=!1){return r=S.get(k,L,M,A),r||(r=this._drawToCache(k,L,M,A,P),S.set(k,L,M,A,r)),r}_getColorFromAnsiIndex(S){if(S>=this._config.colors.ansi.length)throw new Error("No color found for idx "+S);return this._config.colors.ansi[S]}_getBackgroundColor(S,k,L,M){if(this._config.allowTransparency)return d.NULL_COLOR;let A;switch(S){case 16777216:case 33554432:A=this._getColorFromAnsiIndex(k);break;case 50331648:const P=i.AttributeData.toColorRGB(k);A=d.channels.toColor(P[0],P[1],P[2]);break;default:A=L?d.color.opaque(this._config.colors.foreground):this._config.colors.background}return A}_getForegroundColor(S,k,L,M,A,P,F,U,H,$){const E=this._getMinimumContrastColor(S,k,L,M,A,P,F,H,U,$);if(E)return E;let R;switch(A){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&H&&P<8&&(P+=8),R=this._getColorFromAnsiIndex(P);break;case 50331648:const T=i.AttributeData.toColorRGB(P);R=d.channels.toColor(T[0],T[1],T[2]);break;default:R=F?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(R=d.color.opaque(R)),U&&(R=d.color.multiplyOpacity(R,h.DIM_OPACITY)),R}_resolveBackgroundRgba(S,k,L){switch(S){case 16777216:case 33554432:return this._getColorFromAnsiIndex(k).rgba;case 50331648:return k<<8;default:return L?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(S,k,L,M){switch(S){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&M&&k<8&&(k+=8),this._getColorFromAnsiIndex(k).rgba;case 50331648:return k<<8;default:return L?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(S,k,L,M,A,P,F,U,H,$){if(this._config.minimumContrastRatio===1||$)return;const E=this._getContrastCache(H),R=E.getColor(S,M);if(R!==void 0)return R||void 0;const T=this._resolveBackgroundRgba(k,L,F),I=this._resolveForegroundRgba(A,P,F,U),N=d.rgba.ensureContrastRatio(T,I,this._config.minimumContrastRatio/(H?2:1));if(!N)return void E.setColor(S,M,null);const j=d.channels.toColor(N>>24&255,N>>16&255,N>>8&255);return E.setColor(S,M,j),j}_getContrastCache(S){return S?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(S,k,L,M,A=!1){const P=typeof S=="number"?String.fromCharCode(S):S,F=Math.min(this._config.deviceCellWidth*Math.max(P.length,2)+4,this._textureSize);this._tmpCanvas.width<F&&(this._tmpCanvas.width=F);const U=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<U&&(this._tmpCanvas.height=U),this._tmpCtx.save(),this._workAttributeData.fg=L,this._workAttributeData.bg=k,this._workAttributeData.extended.ext=M,this._workAttributeData.isInvisible())return n;const H=!!this._workAttributeData.isBold(),$=!!this._workAttributeData.isInverse(),E=!!this._workAttributeData.isDim(),R=!!this._workAttributeData.isItalic(),T=!!this._workAttributeData.isUnderline(),I=!!this._workAttributeData.isStrikethrough(),N=!!this._workAttributeData.isOverline();let j=this._workAttributeData.getFgColor(),K=this._workAttributeData.getFgColorMode(),X=this._workAttributeData.getBgColor(),O=this._workAttributeData.getBgColorMode();if($){const V=j;j=X,X=V;const re=K;K=O,O=re}const D=this._getBackgroundColor(O,X,$,E);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=D.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";const W=H?this._config.fontWeightBold:this._config.fontWeight,z=R?"italic":"";this._tmpCtx.font=`${z} ${W} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=h.TEXT_BASELINE;const q=P.length===1&&(0,o.isPowerlineGlyph)(P.charCodeAt(0)),G=P.length===1&&(0,o.isRestrictedPowerlineGlyph)(P.charCodeAt(0)),ee=this._getForegroundColor(k,O,X,L,K,j,$,E,H,(0,o.treatGlyphAsBackgroundColor)(P.charCodeAt(0)));this._tmpCtx.fillStyle=ee.css;const Q=G?0:4;let oe=!1;this._config.customGlyphs!==!1&&(oe=(0,f.tryDrawCustomChar)(this._tmpCtx,P,Q,Q,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let le,Y=!q;if(le=typeof S=="number"?this._unicodeService.wcwidth(S):this._unicodeService.getStringCellWidth(S),T){this._tmpCtx.save();const V=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),re=V%2==1?.5:0;if(this._tmpCtx.lineWidth=V,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())Y=!1,this._tmpCtx.strokeStyle=`rgb(${i.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{Y=!1;let de=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&de<8&&(de+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(de).css}this._tmpCtx.beginPath();const he=Q,ce=Math.ceil(Q+this._config.deviceCharHeight)-re-(A?2*V:0),Be=ce+V,pe=ce+2*V;let Se=this._workAttributeData.getUnderlineVariantOffset();for(let de=0;de<le;de++){this._tmpCtx.save();const ae=he+de*this._config.deviceCellWidth,te=he+(de+1)*this._config.deviceCellWidth,et=ae+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(ae,ce),this._tmpCtx.lineTo(te,ce),this._tmpCtx.moveTo(ae,pe),this._tmpCtx.lineTo(te,pe);break;case 3:const Tt=V<=1?pe:Math.ceil(Q+this._config.deviceCharHeight-V/2)-re,Pt=V<=1?ce:Math.ceil(Q+this._config.deviceCharHeight+V/2)-re,Wi=new Path2D;Wi.rect(ae,ce,this._config.deviceCellWidth,pe-ce),this._tmpCtx.clip(Wi),this._tmpCtx.moveTo(ae-this._config.deviceCellWidth/2,Be),this._tmpCtx.bezierCurveTo(ae-this._config.deviceCellWidth/2,Pt,ae,Pt,ae,Be),this._tmpCtx.bezierCurveTo(ae,Tt,et,Tt,et,Be),this._tmpCtx.bezierCurveTo(et,Pt,te,Pt,te,Be),this._tmpCtx.bezierCurveTo(te,Tt,te+this._config.deviceCellWidth/2,Tt,te+this._config.deviceCellWidth/2,Be);break;case 4:const It=Se===0?0:Se>=V?2*V-Se:V-Se;Se>=V||It===0?(this._tmpCtx.setLineDash([Math.round(V),Math.round(V)]),this._tmpCtx.moveTo(ae+It,ce),this._tmpCtx.lineTo(te,ce)):(this._tmpCtx.setLineDash([Math.round(V),Math.round(V)]),this._tmpCtx.moveTo(ae,ce),this._tmpCtx.lineTo(ae+It,ce),this._tmpCtx.moveTo(ae+It+V,ce),this._tmpCtx.lineTo(te,ce)),Se=(0,o.computeNextVariantOffset)(te-ae,V,Se);break;case 5:const dr=.6,ur=.3,ri=te-ae,Ni=Math.floor(dr*ri),zi=Math.floor(ur*ri),fr=ri-Ni-zi;this._tmpCtx.setLineDash([Ni,zi,fr]),this._tmpCtx.moveTo(ae,ce),this._tmpCtx.lineTo(te,ce);break;default:this._tmpCtx.moveTo(ae,ce),this._tmpCtx.lineTo(te,ce)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!oe&&this._config.fontSize>=12&&!this._config.allowTransparency&&P!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";const de=this._tmpCtx.measureText(P);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in de&&de.actualBoundingBoxDescent>0){this._tmpCtx.save();const ae=new Path2D;ae.rect(he,ce-Math.ceil(V/2),this._config.deviceCellWidth*le,pe-ce+Math.ceil(V/2)),this._tmpCtx.clip(ae),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=D.css,this._tmpCtx.strokeText(P,Q,Q+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(N){const V=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),re=V%2==1?.5:0;this._tmpCtx.lineWidth=V,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(Q,Q+re),this._tmpCtx.lineTo(Q+this._config.deviceCharWidth*le,Q+re),this._tmpCtx.stroke()}if(oe||this._tmpCtx.fillText(P,Q,Q+this._config.deviceCharHeight),P==="_"&&!this._config.allowTransparency){let V=_(this._tmpCtx.getImageData(Q,Q,this._config.deviceCellWidth,this._config.deviceCellHeight),D,ee,Y);if(V)for(let re=1;re<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=D.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(P,Q,Q+this._config.deviceCharHeight-re),V=_(this._tmpCtx.getImageData(Q,Q,this._config.deviceCellWidth,this._config.deviceCellHeight),D,ee,Y),V);re++);}if(I){const V=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),re=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=V,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(Q,Q+Math.floor(this._config.deviceCharHeight/2)-re),this._tmpCtx.lineTo(Q+this._config.deviceCharWidth*le,Q+Math.floor(this._config.deviceCharHeight/2)-re),this._tmpCtx.stroke()}this._tmpCtx.restore();const we=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);let je;if(je=this._config.allowTransparency?function(V){for(let re=0;re<V.data.length;re+=4)if(V.data[re+3]>0)return!1;return!0}(we):_(we,D,ee,Y),je)return n;const ne=this._findGlyphBoundingBox(we,this._workBoundingBox,F,G,oe,Q);let ie,se;for(;;){if(this._activePages.length===0){const V=this._createNewPage();ie=V,se=V.currentRow,se.height=ne.size.y;break}ie=this._activePages[this._activePages.length-1],se=ie.currentRow;for(const V of this._activePages)ne.size.y<=V.currentRow.height&&(ie=V,se=V.currentRow);for(let V=this._activePages.length-1;V>=0;V--)for(const re of this._activePages[V].fixedRows)re.height<=se.height&&ne.size.y<=re.height&&(ie=this._activePages[V],se=re);if(se.y+ne.size.y>=ie.canvas.height||se.height>ne.size.y+2){let V=!1;if(ie.currentRow.y+ie.currentRow.height+ne.size.y>=ie.canvas.height){let re;for(const he of this._activePages)if(he.currentRow.y+he.currentRow.height+ne.size.y<he.canvas.height){re=he;break}if(re)ie=re;else if(p.maxAtlasPages&&this._pages.length>=p.maxAtlasPages&&se.y+ne.size.y<=ie.canvas.height&&se.height>=ne.size.y&&se.x+ne.size.x<=ie.canvas.width)V=!0;else{const he=this._createNewPage();ie=he,se=he.currentRow,se.height=ne.size.y,V=!0}}V||(ie.currentRow.height>0&&ie.fixedRows.push(ie.currentRow),se={x:0,y:ie.currentRow.y+ie.currentRow.height,height:ne.size.y},ie.fixedRows.push(se),ie.currentRow={x:0,y:se.y+se.height,height:0})}if(se.x+ne.size.x<=ie.canvas.width)break;se===ie.currentRow?(se.x=0,se.y+=se.height,se.height=0):ie.fixedRows.splice(ie.fixedRows.indexOf(se),1)}return ne.texturePage=this._pages.indexOf(ie),ne.texturePosition.x=se.x,ne.texturePosition.y=se.y,ne.texturePositionClipSpace.x=se.x/ie.canvas.width,ne.texturePositionClipSpace.y=se.y/ie.canvas.height,ne.sizeClipSpace.x/=ie.canvas.width,ne.sizeClipSpace.y/=ie.canvas.height,se.height=Math.max(se.height,ne.size.y),se.x+=ne.size.x,ie.ctx.putImageData(we,ne.texturePosition.x-this._workBoundingBox.left,ne.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,ne.size.x,ne.size.y),ie.addGlyph(ne),ie.version++,ne}_findGlyphBoundingBox(S,k,L,M,A,P){k.top=0;const F=M?this._config.deviceCellHeight:this._tmpCanvas.height,U=M?this._config.deviceCellWidth:L;let H=!1;for(let $=0;$<F;$++){for(let E=0;E<U;E++){const R=$*this._tmpCanvas.width*4+4*E+3;if(S.data[R]!==0){k.top=$,H=!0;break}}if(H)break}k.left=0,H=!1;for(let $=0;$<P+U;$++){for(let E=0;E<F;E++){const R=E*this._tmpCanvas.width*4+4*$+3;if(S.data[R]!==0){k.left=$,H=!0;break}}if(H)break}k.right=U,H=!1;for(let $=P+U-1;$>=P;$--){for(let E=0;E<F;E++){const R=E*this._tmpCanvas.width*4+4*$+3;if(S.data[R]!==0){k.right=$,H=!0;break}}if(H)break}k.bottom=F,H=!1;for(let $=F-1;$>=0;$--){for(let E=0;E<U;E++){const R=$*this._tmpCanvas.width*4+4*E+3;if(S.data[R]!==0){k.bottom=$,H=!0;break}}if(H)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:k.right-k.left+1,y:k.bottom-k.top+1},sizeClipSpace:{x:k.right-k.left+1,y:k.bottom-k.top+1},offset:{x:-k.left+P+(M||A?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-k.top+P+(M||A?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}e.TextureAtlas=p;class v{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(S){this._glyphs.push(S),this._usedPixels+=S.size.x*S.size.y}constructor(S,k,L){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],L)for(const M of L)this._glyphs.push(...M.glyphs),this._usedPixels+=M._usedPixels;this.canvas=C(S,k,k),this.ctx=(0,o.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function _(g,S,k,L){const M=S.rgba>>>24,A=S.rgba>>>16&255,P=S.rgba>>>8&255,F=k.rgba>>>24,U=k.rgba>>>16&255,H=k.rgba>>>8&255,$=Math.floor((Math.abs(M-F)+Math.abs(A-U)+Math.abs(P-H))/12);let E=!0;for(let R=0;R<g.data.length;R+=4)g.data[R]===M&&g.data[R+1]===A&&g.data[R+2]===P||L&&Math.abs(g.data[R]-M)+Math.abs(g.data[R+1]-A)+Math.abs(g.data[R+2]-P)<$?g.data[R+3]=0:E=!1;return E}function C(g,S,k){const L=g.createElement("canvas");return L.width=S,L.height=k,L}},577:function(x,e,a){var h=this&&this.__decorate||function(c,n,r,p){var v,_=arguments.length,C=_<3?n:p===null?p=Object.getOwnPropertyDescriptor(n,r):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(c,n,r,p);else for(var g=c.length-1;g>=0;g--)(v=c[g])&&(C=(_<3?v(C):_>3?v(n,r,C):v(n,r))||C);return _>3&&C&&Object.defineProperty(n,r,C),C},f=this&&this.__param||function(c,n){return function(r,p){n(r,p,c)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CharacterJoinerService=e.JoinedCellData=void 0;const o=a(147),d=a(855),m=a(782),b=a(97);class l extends o.AttributeData{constructor(n,r,p){super(),this.content=0,this.combinedData="",this.fg=n.fg,this.bg=n.bg,this.combinedData=r,this._width=p}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(n){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}e.JoinedCellData=l;let i=e.CharacterJoinerService=class tr{constructor(n){this._bufferService=n,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new m.CellData}register(n){const r={id:this._nextCharacterJoinerId++,handler:n};return this._characterJoiners.push(r),r.id}deregister(n){for(let r=0;r<this._characterJoiners.length;r++)if(this._characterJoiners[r].id===n)return this._characterJoiners.splice(r,1),!0;return!1}getJoinedCharacters(n){if(this._characterJoiners.length===0)return[];const r=this._bufferService.buffer.lines.get(n);if(!r||r.length===0)return[];const p=[],v=r.translateToString(!0);let _=0,C=0,g=0,S=r.getFg(0),k=r.getBg(0);for(let L=0;L<r.getTrimmedLength();L++)if(r.loadCell(L,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==S||this._workCell.bg!==k){if(L-_>1){const M=this._getJoinedRanges(v,g,C,r,_);for(let A=0;A<M.length;A++)p.push(M[A])}_=L,g=C,S=this._workCell.fg,k=this._workCell.bg}C+=this._workCell.getChars().length||d.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-_>1){const L=this._getJoinedRanges(v,g,C,r,_);for(let M=0;M<L.length;M++)p.push(L[M])}return p}_getJoinedRanges(n,r,p,v,_){const C=n.substring(r,p);let g=[];try{g=this._characterJoiners[0].handler(C)}catch(S){console.error(S)}for(let S=1;S<this._characterJoiners.length;S++)try{const k=this._characterJoiners[S].handler(C);for(let L=0;L<k.length;L++)tr._mergeRanges(g,k[L])}catch(k){console.error(k)}return this._stringRangesToCellRanges(g,v,_),g}_stringRangesToCellRanges(n,r,p){let v=0,_=!1,C=0,g=n[v];if(g){for(let S=p;S<this._bufferService.cols;S++){const k=r.getWidth(S),L=r.getString(S).length||d.WHITESPACE_CELL_CHAR.length;if(k!==0){if(!_&&g[0]<=C&&(g[0]=S,_=!0),g[1]<=C){if(g[1]=S,g=n[++v],!g)break;g[0]<=C?(g[0]=S,_=!0):_=!1}C+=L}}g&&(g[1]=this._bufferService.cols)}}static _mergeRanges(n,r){let p=!1;for(let v=0;v<n.length;v++){const _=n[v];if(p){if(r[1]<=_[0])return n[v-1][1]=r[1],n;if(r[1]<=_[1])return n[v-1][1]=Math.max(r[1],_[1]),n.splice(v,1),n;n.splice(v,1),v--}else{if(r[1]<=_[0])return n.splice(v,0,r),n;if(r[1]<=_[1])return _[0]=Math.min(r[0],_[0]),n;r[0]<_[1]&&(_[0]=Math.min(r[0],_[0]),p=!0)}}return p?n[n.length-1][1]=r[1]:n.push(r),n}};e.CharacterJoinerService=i=h([f(0,b.IBufferService)],i)},160:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.contrastRatio=e.toPaddedHex=e.rgba=e.rgb=e.css=e.color=e.channels=e.NULL_COLOR=void 0;let a=0,h=0,f=0,o=0;var d,m,b,l,i;function c(r){const p=r.toString(16);return p.length<2?"0"+p:p}function n(r,p){return r<p?(p+.05)/(r+.05):(r+.05)/(p+.05)}e.NULL_COLOR={css:"#00000000",rgba:0},function(r){r.toCss=function(p,v,_,C){return C!==void 0?`#${c(p)}${c(v)}${c(_)}${c(C)}`:`#${c(p)}${c(v)}${c(_)}`},r.toRgba=function(p,v,_,C=255){return(p<<24|v<<16|_<<8|C)>>>0},r.toColor=function(p,v,_,C){return{css:r.toCss(p,v,_,C),rgba:r.toRgba(p,v,_,C)}}}(d||(e.channels=d={})),function(r){function p(v,_){return o=Math.round(255*_),[a,h,f]=i.toChannels(v.rgba),{css:d.toCss(a,h,f,o),rgba:d.toRgba(a,h,f,o)}}r.blend=function(v,_){if(o=(255&_.rgba)/255,o===1)return{css:_.css,rgba:_.rgba};const C=_.rgba>>24&255,g=_.rgba>>16&255,S=_.rgba>>8&255,k=v.rgba>>24&255,L=v.rgba>>16&255,M=v.rgba>>8&255;return a=k+Math.round((C-k)*o),h=L+Math.round((g-L)*o),f=M+Math.round((S-M)*o),{css:d.toCss(a,h,f),rgba:d.toRgba(a,h,f)}},r.isOpaque=function(v){return(255&v.rgba)==255},r.ensureContrastRatio=function(v,_,C){const g=i.ensureContrastRatio(v.rgba,_.rgba,C);if(g)return d.toColor(g>>24&255,g>>16&255,g>>8&255)},r.opaque=function(v){const _=(255|v.rgba)>>>0;return[a,h,f]=i.toChannels(_),{css:d.toCss(a,h,f),rgba:_}},r.opacity=p,r.multiplyOpacity=function(v,_){return o=255&v.rgba,p(v,o*_/255)},r.toColorRGB=function(v){return[v.rgba>>24&255,v.rgba>>16&255,v.rgba>>8&255]}}(m||(e.color=m={})),function(r){let p,v;try{const _=document.createElement("canvas");_.width=1,_.height=1;const C=_.getContext("2d",{willReadFrequently:!0});C&&(p=C,p.globalCompositeOperation="copy",v=p.createLinearGradient(0,0,1,1))}catch{}r.toColor=function(_){if(_.match(/#[\da-f]{3,8}/i))switch(_.length){case 4:return a=parseInt(_.slice(1,2).repeat(2),16),h=parseInt(_.slice(2,3).repeat(2),16),f=parseInt(_.slice(3,4).repeat(2),16),d.toColor(a,h,f);case 5:return a=parseInt(_.slice(1,2).repeat(2),16),h=parseInt(_.slice(2,3).repeat(2),16),f=parseInt(_.slice(3,4).repeat(2),16),o=parseInt(_.slice(4,5).repeat(2),16),d.toColor(a,h,f,o);case 7:return{css:_,rgba:(parseInt(_.slice(1),16)<<8|255)>>>0};case 9:return{css:_,rgba:parseInt(_.slice(1),16)>>>0}}const C=_.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(C)return a=parseInt(C[1]),h=parseInt(C[2]),f=parseInt(C[3]),o=Math.round(255*(C[5]===void 0?1:parseFloat(C[5]))),d.toColor(a,h,f,o);if(!p||!v)throw new Error("css.toColor: Unsupported css format");if(p.fillStyle=v,p.fillStyle=_,typeof p.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(p.fillRect(0,0,1,1),[a,h,f,o]=p.getImageData(0,0,1,1).data,o!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:d.toRgba(a,h,f,o),css:_}}}(b||(e.css=b={})),function(r){function p(v,_,C){const g=v/255,S=_/255,k=C/255;return .2126*(g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4))+.7152*(S<=.03928?S/12.92:Math.pow((S+.055)/1.055,2.4))+.0722*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))}r.relativeLuminance=function(v){return p(v>>16&255,v>>8&255,255&v)},r.relativeLuminance2=p}(l||(e.rgb=l={})),function(r){function p(_,C,g){const S=_>>24&255,k=_>>16&255,L=_>>8&255;let M=C>>24&255,A=C>>16&255,P=C>>8&255,F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));for(;F<g&&(M>0||A>0||P>0);)M-=Math.max(0,Math.ceil(.1*M)),A-=Math.max(0,Math.ceil(.1*A)),P-=Math.max(0,Math.ceil(.1*P)),F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));return(M<<24|A<<16|P<<8|255)>>>0}function v(_,C,g){const S=_>>24&255,k=_>>16&255,L=_>>8&255;let M=C>>24&255,A=C>>16&255,P=C>>8&255,F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));for(;F<g&&(M<255||A<255||P<255);)M=Math.min(255,M+Math.ceil(.1*(255-M))),A=Math.min(255,A+Math.ceil(.1*(255-A))),P=Math.min(255,P+Math.ceil(.1*(255-P))),F=n(l.relativeLuminance2(M,A,P),l.relativeLuminance2(S,k,L));return(M<<24|A<<16|P<<8|255)>>>0}r.blend=function(_,C){if(o=(255&C)/255,o===1)return C;const g=C>>24&255,S=C>>16&255,k=C>>8&255,L=_>>24&255,M=_>>16&255,A=_>>8&255;return a=L+Math.round((g-L)*o),h=M+Math.round((S-M)*o),f=A+Math.round((k-A)*o),d.toRgba(a,h,f)},r.ensureContrastRatio=function(_,C,g){const S=l.relativeLuminance(_>>8),k=l.relativeLuminance(C>>8);if(n(S,k)<g){if(k<S){const A=p(_,C,g),P=n(S,l.relativeLuminance(A>>8));if(P<g){const F=v(_,C,g);return P>n(S,l.relativeLuminance(F>>8))?A:F}return A}const L=v(_,C,g),M=n(S,l.relativeLuminance(L>>8));if(M<g){const A=p(_,C,g);return M>n(S,l.relativeLuminance(A>>8))?L:A}return L}},r.reduceLuminance=p,r.increaseLuminance=v,r.toChannels=function(_){return[_>>24&255,_>>16&255,_>>8&255,255&_]}}(i||(e.rgba=i={})),e.toPaddedHex=c,e.contrastRatio=n},345:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.runAndSubscribe=e.forwardEvent=e.EventEmitter=void 0,e.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===a)return void this._listeners.splice(h,1)}}})),this._event}fire(a,h){const f=[];for(let o=0;o<this._listeners.length;o++)f.push(this._listeners[o]);for(let o=0;o<f.length;o++)f[o].call(void 0,a,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},e.forwardEvent=function(a,h){return a(f=>h.fire(f))},e.runAndSubscribe=function(a,h){return h(void 0),a(f=>h(f))}},859:(x,e)=>{function a(h){for(const f of h)f.dispose();h.length=0}Object.defineProperty(e,"__esModule",{value:!0}),e.getDisposeArrayDisposable=e.disposeArray=e.toDisposable=e.MutableDisposable=e.Disposable=void 0,e.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){const f=this._disposables.indexOf(h);f!==-1&&this._disposables.splice(f,1)}},e.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){this._isDisposed||h===this._value||(this._value?.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},e.toDisposable=function(h){return{dispose:h}},e.disposeArray=a,e.getDisposeArrayDisposable=function(h){return{dispose:()=>a(h)}}},485:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FourKeyMap=e.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(f,o,d){this._data[f]||(this._data[f]={}),this._data[f][o]=d}get(f,o){return this._data[f]?this._data[f][o]:void 0}clear(){this._data={}}}e.TwoKeyMap=a,e.FourKeyMap=class{constructor(){this._data=new a}set(h,f,o,d,m){this._data.get(h,f)||this._data.set(h,f,new a),this._data.get(h,f).set(o,d,m)}get(h,f,o,d){return this._data.get(h,f)?.get(o,d)}clear(){this._data.clear()}}},399:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isChromeOS=e.isLinux=e.isWindows=e.isIphone=e.isIpad=e.isMac=e.getSafariVersion=e.isSafari=e.isLegacyEdge=e.isFirefox=e.isNode=void 0,e.isNode=typeof process<"u"&&"title"in process;const a=e.isNode?"node":navigator.userAgent,h=e.isNode?"node":navigator.platform;e.isFirefox=a.includes("Firefox"),e.isLegacyEdge=a.includes("Edge"),e.isSafari=/^((?!chrome|android).)*safari/i.test(a),e.getSafariVersion=function(){if(!e.isSafari)return 0;const f=a.match(/Version\/(\d+)/);return f===null||f.length<2?0:parseInt(f[1])},e.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(h),e.isIpad=h==="iPad",e.isIphone=h==="iPhone",e.isWindows=["Windows","Win16","Win32","WinCE"].includes(h),e.isLinux=h.indexOf("Linux")>=0,e.isChromeOS=/\bCrOS\b/.test(a)},385:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DebouncedIdleTask=e.IdleTaskQueue=e.PriorityTaskQueue=void 0;const h=a(399);class f{constructor(){this._tasks=[],this._i=0}enqueue(m){this._tasks.push(m),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(m){this._idleCallback=void 0;let b=0,l=0,i=m.timeRemaining(),c=0;for(;this._i<this._tasks.length;){if(b=Date.now(),this._tasks[this._i]()||this._i++,b=Math.max(1,Date.now()-b),l=Math.max(b,l),c=m.timeRemaining(),1.5*l>c)return i-b<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-b))}ms`),void this._start();i=c}this.clear()}}class o extends f{_requestCallback(m){return setTimeout(()=>m(this._createDeadline(16)))}_cancelCallback(m){clearTimeout(m)}_createDeadline(m){const b=Date.now()+m;return{timeRemaining:()=>Math.max(0,b-Date.now())}}}e.PriorityTaskQueue=o,e.IdleTaskQueue=!h.isNode&&"requestIdleCallback"in window?class extends f{_requestCallback(d){return requestIdleCallback(d)}_cancelCallback(d){cancelIdleCallback(d)}}:o,e.DebouncedIdleTask=class{constructor(){this._queue=new e.IdleTaskQueue}set(d){this._queue.clear(),this._queue.enqueue(d)}flush(){this._queue.flush()}}},147:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtendedAttrs=e.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new h}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){const o=new a;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}e.AttributeData=a;class h{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}get underlineVariantOffset(){const o=(3758096384&this._ext)>>29;return o<0?4294967288^o:o}set underlineVariantOffset(o){this._ext&=536870911,this._ext|=o<<29&3758096384}constructor(o=0,d=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=d}clone(){return new h(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}e.ExtendedAttrs=h},782:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CellData=void 0;const h=a(133),f=a(855),o=a(147);class d extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(b){const l=new d;return l.setFromCharData(b),l}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,h.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(b){this.fg=b[f.CHAR_DATA_ATTR_INDEX],this.bg=0;let l=!1;if(b[f.CHAR_DATA_CHAR_INDEX].length>2)l=!0;else if(b[f.CHAR_DATA_CHAR_INDEX].length===2){const i=b[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){const c=b[f.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=c&&c<=57343?this.content=1024*(i-55296)+c-56320+65536|b[f.CHAR_DATA_WIDTH_INDEX]<<22:l=!0}else l=!0}else this.content=b[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|b[f.CHAR_DATA_WIDTH_INDEX]<<22;l&&(this.combinedData=b[f.CHAR_DATA_CHAR_INDEX],this.content=2097152|b[f.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}e.CellData=d},855:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WHITESPACE_CELL_CODE=e.WHITESPACE_CELL_WIDTH=e.WHITESPACE_CELL_CHAR=e.NULL_CELL_CODE=e.NULL_CELL_WIDTH=e.NULL_CELL_CHAR=e.CHAR_DATA_CODE_INDEX=e.CHAR_DATA_WIDTH_INDEX=e.CHAR_DATA_CHAR_INDEX=e.CHAR_DATA_ATTR_INDEX=e.DEFAULT_EXT=e.DEFAULT_ATTR=e.DEFAULT_COLOR=void 0,e.DEFAULT_COLOR=0,e.DEFAULT_ATTR=256|e.DEFAULT_COLOR<<9,e.DEFAULT_EXT=0,e.CHAR_DATA_ATTR_INDEX=0,e.CHAR_DATA_CHAR_INDEX=1,e.CHAR_DATA_WIDTH_INDEX=2,e.CHAR_DATA_CODE_INDEX=3,e.NULL_CELL_CHAR="",e.NULL_CELL_WIDTH=1,e.NULL_CELL_CODE=0,e.WHITESPACE_CELL_CHAR=" ",e.WHITESPACE_CELL_WIDTH=1,e.WHITESPACE_CELL_CODE=32},133:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utf8ToUtf32=e.StringToUtf32=e.utf32ToString=e.stringFromCodePoint=void 0,e.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},e.utf32ToString=function(a,h=0,f=a.length){let o="";for(let d=h;d<f;++d){let m=a[d];m>65535?(m-=65536,o+=String.fromCharCode(55296+(m>>10))+String.fromCharCode(m%1024+56320)):o+=String.fromCharCode(m)}return o},e.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,h){const f=a.length;if(!f)return 0;let o=0,d=0;if(this._interim){const m=a.charCodeAt(d++);56320<=m&&m<=57343?h[o++]=1024*(this._interim-55296)+m-56320+65536:(h[o++]=this._interim,h[o++]=m),this._interim=0}for(let m=d;m<f;++m){const b=a.charCodeAt(m);if(55296<=b&&b<=56319){if(++m>=f)return this._interim=b,o;const l=a.charCodeAt(m);56320<=l&&l<=57343?h[o++]=1024*(b-55296)+l-56320+65536:(h[o++]=b,h[o++]=l)}else b!==65279&&(h[o++]=b)}return o}},e.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,h){const f=a.length;if(!f)return 0;let o,d,m,b,l=0,i=0,c=0;if(this.interim[0]){let p=!1,v=this.interim[0];v&=(224&v)==192?31:(240&v)==224?15:7;let _,C=0;for(;(_=63&this.interim[++C])&&C<4;)v<<=6,v|=_;const g=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,S=g-C;for(;c<S;){if(c>=f)return 0;if(_=a[c++],(192&_)!=128){c--,p=!0;break}this.interim[C++]=_,v<<=6,v|=63&_}p||(g===2?v<128?c--:h[l++]=v:g===3?v<2048||v>=55296&&v<=57343||v===65279||(h[l++]=v):v<65536||v>1114111||(h[l++]=v)),this.interim.fill(0)}const n=f-4;let r=c;for(;r<f;){for(;!(!(r<n)||128&(o=a[r])||128&(d=a[r+1])||128&(m=a[r+2])||128&(b=a[r+3]));)h[l++]=o,h[l++]=d,h[l++]=m,h[l++]=b,r+=4;if(o=a[r++],o<128)h[l++]=o;else if((224&o)==192){if(r>=f)return this.interim[0]=o,l;if(d=a[r++],(192&d)!=128){r--;continue}if(i=(31&o)<<6|63&d,i<128){r--;continue}h[l++]=i}else if((240&o)==224){if(r>=f)return this.interim[0]=o,l;if(d=a[r++],(192&d)!=128){r--;continue}if(r>=f)return this.interim[0]=o,this.interim[1]=d,l;if(m=a[r++],(192&m)!=128){r--;continue}if(i=(15&o)<<12|(63&d)<<6|63&m,i<2048||i>=55296&&i<=57343||i===65279)continue;h[l++]=i}else if((248&o)==240){if(r>=f)return this.interim[0]=o,l;if(d=a[r++],(192&d)!=128){r--;continue}if(r>=f)return this.interim[0]=o,this.interim[1]=d,l;if(m=a[r++],(192&m)!=128){r--;continue}if(r>=f)return this.interim[0]=o,this.interim[1]=d,this.interim[2]=m,l;if(b=a[r++],(192&b)!=128){r--;continue}if(i=(7&o)<<18|(63&d)<<12|(63&m)<<6|63&b,i<65536||i>1114111)continue;h[l++]=i}}return l}}},776:function(x,e,a){var h=this&&this.__decorate||function(i,c,n,r){var p,v=arguments.length,_=v<3?c:r===null?r=Object.getOwnPropertyDescriptor(c,n):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(i,c,n,r);else for(var C=i.length-1;C>=0;C--)(p=i[C])&&(_=(v<3?p(_):v>3?p(c,n,_):p(c,n))||_);return v>3&&_&&Object.defineProperty(c,n,_),_},f=this&&this.__param||function(i,c){return function(n,r){c(n,r,i)}};Object.defineProperty(e,"__esModule",{value:!0}),e.traceCall=e.setTraceLogger=e.LogService=void 0;const o=a(859),d=a(97),m={trace:d.LogLevelEnum.TRACE,debug:d.LogLevelEnum.DEBUG,info:d.LogLevelEnum.INFO,warn:d.LogLevelEnum.WARN,error:d.LogLevelEnum.ERROR,off:d.LogLevelEnum.OFF};let b,l=e.LogService=class extends o.Disposable{get logLevel(){return this._logLevel}constructor(i){super(),this._optionsService=i,this._logLevel=d.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),b=this}_updateLogLevel(){this._logLevel=m[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(i){for(let c=0;c<i.length;c++)typeof i[c]=="function"&&(i[c]=i[c]())}_log(i,c,n){this._evalLazyOptionalParams(n),i.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+c,...n)}trace(i,...c){this._logLevel<=d.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,i,c)}debug(i,...c){this._logLevel<=d.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,i,c)}info(i,...c){this._logLevel<=d.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,i,c)}warn(i,...c){this._logLevel<=d.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,i,c)}error(i,...c){this._logLevel<=d.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,i,c)}};e.LogService=l=h([f(0,d.IOptionsService)],l),e.setTraceLogger=function(i){b=i},e.traceCall=function(i,c,n){if(typeof n.value!="function")throw new Error("not supported");const r=n.value;n.value=function(...p){if(b.logLevel!==d.LogLevelEnum.TRACE)return r.apply(this,p);b.trace(`GlyphRenderer#${r.name}(${p.map(_=>JSON.stringify(_)).join(", ")})`);const v=r.apply(this,p);return b.trace(`GlyphRenderer#${r.name} return`,v),v}}},726:(x,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createDecorator=e.getServiceDependencies=e.serviceRegistry=void 0;const a="di$target",h="di$dependencies";e.serviceRegistry=new Map,e.getServiceDependencies=function(f){return f[h]||[]},e.createDecorator=function(f){if(e.serviceRegistry.has(f))return e.serviceRegistry.get(f);const o=function(d,m,b){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(l,i,c){i[a]===i?i[h].push({id:l,index:c}):(i[h]=[{id:l,index:c}],i[a]=i)})(o,d,b)};return o.toString=()=>f,e.serviceRegistry.set(f,o),o}},97:(x,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IDecorationService=e.IUnicodeService=e.IOscLinkService=e.IOptionsService=e.ILogService=e.LogLevelEnum=e.IInstantiationService=e.ICharsetService=e.ICoreService=e.ICoreMouseService=e.IBufferService=void 0;const h=a(726);var f;e.IBufferService=(0,h.createDecorator)("BufferService"),e.ICoreMouseService=(0,h.createDecorator)("CoreMouseService"),e.ICoreService=(0,h.createDecorator)("CoreService"),e.ICharsetService=(0,h.createDecorator)("CharsetService"),e.IInstantiationService=(0,h.createDecorator)("InstantiationService"),function(o){o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=5]="OFF"}(f||(e.LogLevelEnum=f={})),e.ILogService=(0,h.createDecorator)("LogService"),e.IOptionsService=(0,h.createDecorator)("OptionsService"),e.IOscLinkService=(0,h.createDecorator)("OscLinkService"),e.IUnicodeService=(0,h.createDecorator)("UnicodeService"),e.IDecorationService=(0,h.createDecorator)("DecorationService")}},w={};function y(x){var e=w[x];if(e!==void 0)return e.exports;var a=w[x]={exports:{}};return u[x].call(a.exports,a,a.exports,y),a.exports}var B={};return(()=>{var x=B;Object.defineProperty(x,"__esModule",{value:!0}),x.CanvasAddon=void 0;const e=y(345),a=y(859),h=y(776),f=y(949);class o extends a.Disposable{constructor(){super(...arguments),this._onChangeTextureAtlas=this.register(new e.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new e.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event}get textureAtlas(){return this._renderer?.textureAtlas}activate(m){const b=m._core;if(!m.element)return void this.register(b.onWillOpen(()=>this.activate(m)));this._terminal=m;const l=b.coreService,i=b.optionsService,c=b.screenElement,n=b.linkifier,r=b,p=r._bufferService,v=r._renderService,_=r._characterJoinerService,C=r._charSizeService,g=r._coreBrowserService,S=r._decorationService,k=r._logService,L=r._themeService;(0,h.setTraceLogger)(k),this._renderer=new f.CanvasRenderer(m,c,n,p,C,i,_,l,g,S,L),this.register((0,e.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,e.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),v.setRenderer(this._renderer),v.handleResize(p.cols,p.rows),this.register((0,a.toDisposable)(()=>{v.setRenderer(this._terminal._core._createRenderer()),v.handleResize(m.cols,m.rows),this._renderer?.dispose(),this._renderer=void 0}))}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}}x.CanvasAddon=o})(),B})())}(fi)),fi.exports}var oa=na();let aa=class{terminal;fitAddon;canvasAddon;inputCallback;exitCallback;currentInput="";inputStartCol=0;constructor(){this.fitAddon=new ra.FitAddon,this.canvasAddon=new oa.CanvasAddon,this.terminal=new ia.Terminal({theme:{background:"#0d1117",foreground:"#c9d1d9",cursor:"#58a6ff",cursorAccent:"#0d1117",selectionBackground:"#264f78",black:"#484f58",red:"#ff7b72",green:"#7ee787",yellow:"#f2cc60",blue:"#58a6ff",magenta:"#bc8cff",cyan:"#39c5cf",white:"#c9d1d9",brightBlack:"#6e7681",brightRed:"#ffa198",brightGreen:"#56d364",brightYellow:"#e3b341",brightBlue:"#79c0ff",brightMagenta:"#d2a8ff",brightCyan:"#56d4dd",brightWhite:"#f0f6fc"},fontFamily:'"Cascadia Code", "Fira Code", "JetBrains Mono", "SF Mono", Monaco, "Inconsolata", "Roboto Mono", "Source Code Pro", monospace',fontSize:14,lineHeight:1.2,cursorBlink:!0,cursorStyle:"block",scrollback:1e3,tabStopWidth:4,allowProposedApi:!0,allowTransparency:!1,convertEol:!1,disableStdin:!1,drawBoldTextInBrightColors:!1,fastScrollModifier:"alt",fastScrollSensitivity:5,scrollSensitivity:1,smoothScrollDuration:0,windowsMode:!1,logLevel:"warn"}),this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(this.canvasAddon),this.setupXtermHandlers()}async init(){const s=document.getElementById("terminal");if(!s)throw new Error("Terminal element not found");s.innerHTML="",this.terminal.open(s),this.fitAddon.fit(),window.addEventListener("resize",()=>{this.fitAddon.fit()})}setupXtermHandlers(){this.terminal.onKey(({key:s,domEvent:u})=>{const w=!u.altKey&&!u.ctrlKey&&!u.metaKey;u.code==="Enter"?this.handleEnter():u.code==="Backspace"?this.handleBackspace():u.code==="Tab"?(u.preventDefault(),this.handleTabCompletion()):w&&this.handlePrintableKey(s)})}handleEnter(){this.terminal.writeln(""),this.inputCallback&&this.inputCallback(this.currentInput.trim()),this.currentInput=""}handleBackspace(){this.currentInput.length>0&&(this.currentInput=this.currentInput.slice(0,-1),this.terminal.write("\b \b"))}handleTabCompletion(){this.terminal.write("\x07")}handlePrintableKey(s){this.currentInput+=s,this.terminal.write(s)}write(s){this.terminal.write(s)}writeln(s){this.terminal.writeln(s)}clear(){this.terminal.clear()}writeSuccess(s){this.terminal.writeln(`\x1B[32m${s}\x1B[0m`)}writeError(s){this.terminal.writeln(`\x1B[31m${s}\x1B[0m`)}writeWarning(s){this.terminal.writeln(`\x1B[33m${s}\x1B[0m`)}writeInfo(s){this.terminal.writeln(`\x1B[34m${s}\x1B[0m`)}writeBanner(s){this.terminal.writeln(`\x1B[1;36m${s}\x1B[0m`)}updateProgress(s){this.terminal.write("\r\x1B[K"),this.terminal.write(`\x1B[33m${s}\x1B[0m`)}clearProgress(){this.terminal.write("\r\x1B[K")}showPrompt(s){this.terminal.write(s),this.inputStartCol=s.length}getCurrentInput(){return this.currentInput}clearCurrentInput(){for(let s=0;s<this.currentInput.length;s++)this.terminal.write("\b");this.terminal.write("\x1B[K"),this.currentInput=""}onInput(s){this.inputCallback=s}onExit(s){this.exitCallback=s}cleanup(){this.terminal.dispose()}};const ir=typeof window<"u"&&typeof window.document<"u",ca=typeof process<"u"&&process.versions&&process.versions.node,ha="https://corsproxy.io/?",la="https://api.1inch.dev";console.log(` DEBUG: Environment detection - isBrowser: ${ir}, isNode: ${ca}`);function ii(t){const s=`${la}${t}`;if(ir){const u=`${ha}${s}`;return console.log(` DEBUG: Browser environment - using CORS proxy: ${u}`),u}else return console.log(` DEBUG: Node.js environment - direct API call: ${s}`),s}const da="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",Fe={},ua=1440*60*1e3;function fa(t){t?(delete Fe[t],console.log(` DEBUG: Cleared USDC cache for chain ${t}`)):(Object.keys(Fe).forEach(s=>delete Fe[parseInt(s)]),console.log(" DEBUG: Cleared all USDC cache"))}async function sr(t,s,u){console.log(` DEBUG: findUsdcAddress called for chain ${t}`),(Fe[t]?.address==="0"||Fe[t]?.address===null)&&fa(t);const w=Fe[t];if(w&&Date.now()-w.timestamp<ua)return console.log(` DEBUG: Using cached USDC address for chain ${t}: ${w.address}`),w.address;console.log(` DEBUG: No cache found, searching for USDC on chain ${t}...`);try{const y=ii(`/token/v1.3/${t}/search?query=USDC`);console.log(` DEBUG: Making USDC search request to: ${y}`),console.log(` DEBUG: Using API key: ${s?"Present":"Missing"}`);const B=await u(y,{headers:{Authorization:`Bearer ${s}`,accept:"application/json"}});if(console.log(` DEBUG: USDC search response status: ${B.status} ${B.statusText}`),!B.ok)return console.warn(`Failed to search for USDC on chain ${t}: ${B.status}`),null;const x=await B.json();console.log(` DEBUG: USDC search response for chain ${t}: Found ${x.length} tokens`),console.log(` DEBUG: Searching for USDC in ${x.length} tokens...`);for(const e of x){if(console.log(` DEBUG: Checking token ${e.address}: ${e.symbol} (${e.decimals} decimals)`),!e.address||e.address==="0"||e.address==="0x0"||e.address.length<10){console.log(` DEBUG: Skipping invalid address: ${e.address}`);continue}if(e.symbol==="USDC"&&e.decimals===6)return console.log(` Found valid USDC on chain ${t}: ${e.address}`),Fe[t]={address:e.address,timestamp:Date.now()},e.address}return console.warn(`No USDC token found on chain ${t}`),null}catch(y){return console.warn(`Error searching for USDC on chain ${t}:`,y.message),null}}async function rr(t,s,u){if(!u)throw new Error("1inch API key not provided");const w=ii(`/balance/v1.2/${t}/balances/${s}`),y=await fetch(w,{headers:{Authorization:`Bearer ${u}`,Accept:"application/json"}});if(!y.ok)throw new Error(`1inch Balance API error: ${y.status} ${y.statusText}`);return await y.json()}async function nr(t,s){if(!s)throw new Error("1inch API key not provided");const u=ii(`/token/v1.2/${t}`);console.log(` DEBUG: Fetching metadata for chain ${t}`),console.log(` DEBUG: Using URL: ${u}`);const w=await fetch(u,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}});if(console.log(` DEBUG: Response status: ${w.status}`),console.log(" DEBUG: Response headers:",Object.fromEntries(w.headers.entries())),!w.ok)throw new Error(`1inch Token API error: ${w.status} ${w.statusText}`);const y=await w.json();if(console.log(" DEBUG: Raw metadata response type:",typeof y),console.log(" DEBUG: Raw metadata response structure:",Array.isArray(y)?`Array[${y.length}]`:`Object with keys: ${Object.keys(y).slice(0,5)}`),Array.isArray(y)){console.log(" DEBUG: Converting array metadata to object format"),console.log(" DEBUG: First array item:",y[0]);const B={};return y.forEach((x,e)=>{x&&x.address?(B[x.address.toLowerCase()]=x,e<3&&console.log(` DEBUG: Added token ${x.address} -> ${x.symbol}`)):console.log(` DEBUG: Skipping invalid token at index ${e}:`,x)}),console.log(" DEBUG: Converted metadata object keys:",Object.keys(B).slice(0,5)),B}if(y&&typeof y=="object"&&!Array.isArray(y)){const B=Object.keys(y);if(B.length>0&&B[0].startsWith("0x"))return console.log(" DEBUG: Data already in correct format"),y;if(y.tokens&&Array.isArray(y.tokens)){console.log(" DEBUG: Found nested tokens array");const e={};return y.tokens.forEach(a=>{a&&a.address&&(e[a.address.toLowerCase()]=a)}),e}const x=y[B[0]];if(x&&x.address){console.log(" DEBUG: Converting indexed object to address-keyed object");const e={};return Object.values(y).forEach(a=>{a&&a.address&&(e[a.address.toLowerCase()]=a)}),e}}return y}async function or(t,s,u,w,y){if(!y)throw new Error("1inch API key not provided");const B=ii(`/swap/v6.0/${t}/quote?src=${s}&dst=${u}&amount=${w}`);try{const x=await fetch(B,{headers:{Authorization:`Bearer ${y}`,Accept:"application/json"}});return x.ok?await x.json():(console.log(` DEBUG: 1inch API error for ${s}: ${x.status} ${x.statusText}`),null)}catch(x){return console.log(` DEBUG: Network error for ${s}:`,x),null}}const _a=Object.freeze(Object.defineProperty({__proto__:null,NATIVE_TOKEN_ADDRESS:da,findUsdcAddress:sr,getQuote:or,getTokenMetadata:nr,getWalletBalances:rr},Symbol.toStringTag,{value:"Module"}));async function pa(t,s,u,w,y,B){try{const x=go("0.01",u),e=x.toString(),a=await B.findUsdcAddress(w,y,fetch);if(!a||a==="0")return console.warn(`No USDC address found for chain ${w}`),0;const h=await B.getQuote(w,t,a,e,y);if(!h||!h.dstAmount)return 0;const f=parseFloat(Ue(x,u)),o=parseFloat(Ue(BigInt(h.dstAmount),6))/f;return parseFloat(Ue(BigInt(s),u))*o}catch{return 0}}async function ma(t,s,u,w,y,B){const x=[],e=Object.entries(t),a=e.length;for(let h=0;h<e.length;h++){const[f,o]=e[h],d=s[f.toLowerCase()];if(d){B?.({phase:"pricing",currentToken:d.symbol,tokenIndex:h+1,totalTokens:a,message:`Pricing ${d.symbol} (${h+1}/${a})`});try{const m=parseFloat(Ue(BigInt(o),d.decimals)),b=Ue(BigInt(o),d.decimals),l=await pa(f,o,d.decimals,u,w,y);x.push({address:f,symbol:d.symbol,name:d.name,decimals:d.decimals,balance:o,balanceFormatted:b,balanceNum:m,balanceUSD:l}),B?.({phase:"pricing",currentToken:d.symbol,tokenIndex:h+1,totalTokens:a,message:`${d.symbol}: $${l.toFixed(2)} (${h+1}/${a})`})}catch(m){console.warn(`Failed to process token ${d.symbol}:`,m),B?.({phase:"pricing",currentToken:d.symbol,tokenIndex:h+1,totalTokens:a,message:`${d.symbol}: Failed to price (${h+1}/${a})`})}}}return x}function ga(t,s={}){let u=[...t];return s.minUSDValue!==void 0&&(u=u.filter(w=>w.balanceUSD>=s.minUSDValue)),s.excludeZeroBalances&&(u=u.filter(w=>w.balanceNum>0)),s.excludeTokens&&s.excludeTokens.length>0&&(u=u.filter(w=>!s.excludeTokens.some(y=>w.address.toLowerCase()===y.toLowerCase()||w.symbol.toLowerCase()===y.toLowerCase()))),u.sort((w,y)=>y.balanceUSD-w.balanceUSD),s.maxTokensToProcess&&(u=u.slice(0,s.maxTokensToProcess)),u}function va(t,s=5,u=100){const w=t.filter(x=>x.balanceUSD<s),y=t.filter(x=>x.balanceUSD>=s&&x.balanceUSD<u),B=t.filter(x=>x.balanceUSD>=u);return{dustTokens:w,mediumTokens:y,significantTokens:B}}function ba(t){const s=t.reduce((w,y)=>w+y.balanceUSD,0),u=t.length;return{totalUSD:s,tokenCount:u}}async function Ca(t,s,u=5,w=_a){if(!s.oneinchApiKey)throw new Error("1inch API key not configured");const y=Xo(t.chainId);if(!y)throw new Error(`Unsupported chain ID: ${t.chainId}`);try{s.onProgress?.({phase:"starting",chainName:y.name,chainId:t.chainId,message:`Starting scan on ${y.name} (Chain ID: ${t.chainId})`}),console.log(`Scanning ${y.name} for token balances...`),s.onProgress?.({phase:"fetching_balances",chainName:y.name,chainId:t.chainId,message:`Fetching wallet balances from ${y.name}`});const B=await w.getWalletBalances(t.chainId,t.address,s.oneinchApiKey),x=Object.keys(B).length;s.onProgress?.({phase:"balances_received",chainName:y.name,chainId:t.chainId,tokenCount:x,message:`Found ${x} tokens with balances on ${y.name}`}),s.onProgress?.({phase:"fetching_metadata",chainName:y.name,chainId:t.chainId,message:`Fetching token metadata from ${y.name}`});const e=await w.getTokenMetadata(t.chainId,s.oneinchApiKey),a=Object.keys(e).length;s.onProgress?.({phase:"metadata_received",chainName:y.name,chainId:t.chainId,metadataCount:a,message:`Loaded metadata for ${a} tokens on ${y.name}`}),console.log(" Raw balance data:",x,"tokens found"),console.log(" Token metadata:",a,"tokens available"),s.onProgress?.({phase:"processing",chainName:y.name,chainId:t.chainId,totalTokens:x,message:`Processing ${x} tokens on ${y.name}`});const h=await ma(B,e,t.chainId,s.oneinchApiKey,w,s.onProgress);s.onProgress?.({phase:"filtering",chainName:y.name,chainId:t.chainId,totalTokens:h.length,message:`Filtering ${h.length} processed tokens on ${y.name}`}),console.log(`DEBUG: Before filtering - ${h.length} tokens processed`);const f=ga(h,{minUSDValue:.01,maxTokensToProcess:s.maxTokensToProcess||100,excludeZeroBalances:!0});console.log(`DEBUG: After filtering - ${f.length} tokens remain`),s.onProgress?.({phase:"filtering",chainName:y.name,chainId:t.chainId,totalTokens:f.length,message:`Filtered to ${f.length} valuable tokens on ${y.name}`});const{dustTokens:o,mediumTokens:d,significantTokens:m}=va(f,u,100),{totalUSD:b}=ba(f);return s.onProgress?.({phase:"complete",chainName:y.name,chainId:t.chainId,totalTokens:f.length,message:`Scan complete on ${y.name}: $${b.toFixed(2)} across ${f.length} tokens (${m.length} significant, ${d.length} medium, ${o.length} dust)`}),{allTokens:f,dustTokens:o,mediumTokens:d,significantTokens:m,totalUSD:b,chainId:t.chainId,chainName:y.name,tokens:[...f].map(l=>({...l,isDust:l.balanceUSD<u,formattedBalance:`${l.balanceFormatted} ${l.symbol}`,usdValue:l.balanceUSD}))}}catch(B){throw console.error(` Scan failed for ${y.name}:`,B),new Error(`Scan failed for ${y.name}: ${B.message}`)}}async function ar(t,s,u=5,w){const y={oneinchApiKey:s,maxTokensToProcess:1e3,excludeTokens:[],defaultMinUsdValue:u,onProgress:w?e=>{const a=console.log;console.log=x.log,w(e),console.log=a}:void 0},B={getWalletBalances:rr,getTokenMetadata:nr,getQuote:or,findUsdcAddress:sr},x={log:console.log,error:console.error,warn:console.warn,info:console.info};console.log=()=>{},console.error=()=>{},console.warn=()=>{},console.info=()=>{};try{const e=await Ca(t,y,u,B),a=Kt(e);return{result:e,output:a}}finally{console.log=x.log,console.error=x.error,console.warn=x.warn,console.info=x.info}}async function Sa(t,s,u=5,w){const y=[],B=[];B.push({type:"info",content:" Starting multi-chain token scan..."});for(const x of Ei())try{B.push({type:"info",content:` Scanning ${x.name} (${x.id})...`});const e={...t,chainId:x.id},{result:a}=await ar(e,s,u,w);if(a.allTokens.length>0){y.push(a);const h=Kt(a);B.push(...h)}else B.push({type:"info",content:` No tokens found on ${x.name}`})}catch(e){B.push({type:"error",content:` Error scanning ${x.name}: ${e instanceof Error?e.message:"Unknown error"}`})}if(y.length>0){const x=y.reduce((a,h)=>a+h.totalUSD,0),e=y.reduce((a,h)=>a+h.allTokens.length,0);B.push({type:"info",content:""},{type:"info",content:" Multi-Chain Summary:"},{type:"info",content:` Total Portfolio Value: $${x.toFixed(2)}`},{type:"info",content:` Total Tokens: ${e}`},{type:"info",content:` Chains Scanned: ${y.length}`})}else B.push({type:"error",content:" No chains scanned successfully"});return{results:y,output:B}}const wa={defaultChain:"base",defaultMinUsdValue:1,maxSlippage:1,minTokenBalance:.001,dustThresholdUsd:5,excludeTokens:[],includeZeroBalance:!1,maxTokensToProcess:100};function Li(){return{...wa,oneinchApiKey:"CRBW6UIUTDy4wMWscY90rJ4ggFn6GeQQ",walletConnectProjectId:"1a52918f92f69f5b50d50d09ab7cbf13"}}const jt="2.18.0",ya=()=>`@wagmi/core@${jt}`;var cr=function(t,s,u,w){if(u==="a"&&!w)throw new TypeError("Private accessor was defined without a getter");if(typeof s=="function"?t!==s||!w:!s.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return u==="m"?w:u==="a"?w.call(t):w?w.value:s.get(t)},Xt,hr;class Je extends Error{get docsBaseUrl(){return"https://wagmi.sh/core"}get version(){return ya()}constructor(s,u={}){super(),Xt.add(this),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WagmiCoreError"});const w=u.cause instanceof Je?u.cause.details:u.cause?.message?u.cause.message:u.details,y=u.cause instanceof Je&&u.cause.docsPath||u.docsPath;this.message=[s||"An error occurred.","",...u.metaMessages?[...u.metaMessages,""]:[],...y?[`Docs: ${this.docsBaseUrl}${y}.html${u.docsSlug?`#${u.docsSlug}`:""}`]:[],...w?[`Details: ${w}`]:[],`Version: ${this.version}`].join(`
`),u.cause&&(this.cause=u.cause),this.details=w,this.docsPath=y,this.metaMessages=u.metaMessages,this.shortMessage=s}walk(s){return cr(this,Xt,"m",hr).call(this,this,s)}}Xt=new WeakSet,hr=function t(s,u){return u?.(s)?s:s.cause?cr(this,Xt,"m",t).call(this,s.cause,u):s};class Jt extends Je{constructor(){super("Chain not configured."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ChainNotConfiguredError"})}}class xa extends Je{constructor(){super("Connector already connected."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorAlreadyConnectedError"})}}async function Ba(t,s){let u;if(typeof s.connector=="function"?u=t._internal.connectors.setup(s.connector):u=s.connector,u.uid===t.state.current)throw new xa;try{t.setState(e=>({...e,status:"connecting"})),u.emitter.emit("message",{type:"connecting"});const{connector:w,...y}=s,B=await u.connect(y),x=B.accounts;return u.emitter.off("connect",t._internal.events.connect),u.emitter.on("change",t._internal.events.change),u.emitter.on("disconnect",t._internal.events.disconnect),await t.storage?.setItem("recentConnectorId",u.id),t.setState(e=>({...e,connections:new Map(e.connections).set(u.uid,{accounts:x,chainId:B.chainId,connector:u}),current:u.uid,status:"connected"})),{accounts:x,chainId:B.chainId}}catch(w){throw t.setState(y=>({...y,status:y.current?"connected":"disconnected"})),w}}async function Ea(t,s={}){let u;if(s.connector)u=s.connector;else{const{connections:y,current:B}=t.state;u=y.get(B)?.connector}const w=t.state.connections;u&&(await u.disconnect(),u.emitter.off("change",t._internal.events.change),u.emitter.off("disconnect",t._internal.events.disconnect),u.emitter.on("connect",t._internal.events.connect),w.delete(u.uid)),t.setState(y=>{if(w.size===0)return{...y,connections:new Map,current:null,status:"disconnected"};const B=w.values().next().value;return{...y,connections:new Map(w),current:B.connector.uid}});{const y=t.state.current;if(!y)return;const B=t.state.connections.get(y)?.connector;if(!B)return;await t.storage?.setItem("recentConnectorId",B.id)}}function si(t){const s=t.state.current,u=t.state.connections.get(s),w=u?.accounts,y=w?.[0],B=t.chains.find(e=>e.id===u?.chainId),x=t.state.status;switch(x){case"connected":return{address:y,addresses:w,chain:B,chainId:u?.chainId,connector:u?.connector,isConnected:!0,isConnecting:!1,isDisconnected:!1,isReconnecting:!1,status:x};case"reconnecting":return{address:y,addresses:w,chain:B,chainId:u?.chainId,connector:u?.connector,isConnected:!!y,isConnecting:!1,isDisconnected:!1,isReconnecting:!0,status:x};case"connecting":return{address:y,addresses:w,chain:B,chainId:u?.chainId,connector:u?.connector,isConnected:!1,isConnecting:!0,isDisconnected:!1,isReconnecting:!1,status:x};case"disconnected":return{address:void 0,addresses:void 0,chain:void 0,chainId:void 0,connector:void 0,isConnected:!1,isConnecting:!1,isDisconnected:!0,isReconnecting:!1,status:x}}}function Fi(t){return t.state.chainId}class De extends Je{constructor(){super("Provider not found."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderNotFoundError"})}}Rt.type="injected";function Rt(t={}){const{shimDisconnect:s=!0,unstable_shimAsyncInject:u}=t;function w(){const a=t.target;if(typeof a=="function"){const h=a();if(h)return h}return typeof a=="object"?a:typeof a=="string"?{...La[a]??{id:a,name:`${a[0].toUpperCase()}${a.slice(1)}`,provider:`is${a[0].toUpperCase()}${a.slice(1)}`}}:{id:"injected",name:"Injected",provider(h){return h?.ethereum}}}let y,B,x,e;return a=>({get icon(){return w().icon},get id(){return w().id},get name(){return w().name},get supportsSimulation(){return!0},type:Rt.type,async setup(){const h=await this.getProvider();h?.on&&t.target&&(x||(x=this.onConnect.bind(this),h.on("connect",x)),y||(y=this.onAccountsChanged.bind(this),h.on("accountsChanged",y)))},async connect({chainId:h,isReconnecting:f}={}){const o=await this.getProvider();if(!o)throw new De;let d=[];if(f)d=await this.getAccounts().catch(()=>[]);else if(s)try{d=(await o.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}))[0]?.caveats?.[0]?.value?.map(b=>Oe(b)),d.length>0&&(d=await this.getAccounts())}catch(m){const b=m;if(b.code===_e.code)throw new _e(b);if(b.code===Re.code)throw b}try{!d?.length&&!f&&(d=(await o.request({method:"eth_requestAccounts"})).map(l=>Oe(l))),x&&(o.removeListener("connect",x),x=void 0),y||(y=this.onAccountsChanged.bind(this),o.on("accountsChanged",y)),B||(B=this.onChainChanged.bind(this),o.on("chainChanged",B)),e||(e=this.onDisconnect.bind(this),o.on("disconnect",e));let m=await this.getChainId();return h&&m!==h&&(m=(await this.switchChain({chainId:h}).catch(l=>{if(l.code===_e.code)throw l;return{id:m}}))?.id??m),s&&await a.storage?.removeItem(`${this.id}.disconnected`),t.target||await a.storage?.setItem("injected.connected",!0),{accounts:d,chainId:m}}catch(m){const b=m;throw b.code===_e.code?new _e(b):b.code===Re.code?new Re(b):b}},async disconnect(){const h=await this.getProvider();if(!h)throw new De;B&&(h.removeListener("chainChanged",B),B=void 0),e&&(h.removeListener("disconnect",e),e=void 0),x||(x=this.onConnect.bind(this),h.on("connect",x));try{await Ks(()=>h.request({method:"wallet_revokePermissions",params:[{eth_accounts:{}}]}),{timeout:100})}catch{}s&&await a.storage?.setItem(`${this.id}.disconnected`,!0),t.target||await a.storage?.removeItem("injected.connected")},async getAccounts(){const h=await this.getProvider();if(!h)throw new De;return(await h.request({method:"eth_accounts"})).map(o=>Oe(o))},async getChainId(){const h=await this.getProvider();if(!h)throw new De;const f=await h.request({method:"eth_chainId"});return Number(f)},async getProvider(){if(typeof window>"u")return;let h;const f=w();return typeof f.provider=="function"?h=f.provider(window):typeof f.provider=="string"?h=Gt(window,f.provider):h=f.provider,h&&!h.removeListener&&("off"in h&&typeof h.off=="function"?h.removeListener=h.off:h.removeListener=()=>{}),h},async isAuthorized(){try{if(s&&await a.storage?.getItem(`${this.id}.disconnected`)||!t.target&&!await a.storage?.getItem("injected.connected"))return!1;if(!await this.getProvider()){if(u!==void 0&&u!==!1){const d=async()=>(typeof window<"u"&&window.removeEventListener("ethereum#initialized",d),!!await this.getProvider()),m=typeof u=="number"?u:1e3;if(await Promise.race([...typeof window<"u"?[new Promise(l=>window.addEventListener("ethereum#initialized",()=>l(d()),{once:!0}))]:[],new Promise(l=>setTimeout(()=>l(d()),m))]))return!0}throw new De}return!!(await Vs(()=>this.getAccounts())).length}catch{return!1}},async switchChain({addEthereumChainParameter:h,chainId:f}){const o=await this.getProvider();if(!o)throw new De;const d=a.chains.find(b=>b.id===f);if(!d)throw new Pe(new Jt);const m=new Promise(b=>{const l=i=>{"chainId"in i&&i.chainId===f&&(a.emitter.off("change",l),b())};a.emitter.on("change",l)});try{return await Promise.all([o.request({method:"wallet_switchEthereumChain",params:[{chainId:J(f)}]}).then(async()=>{await this.getChainId()===f&&a.emitter.emit("change",{chainId:f})}),m]),d}catch(b){const l=b;if(l.code===4902||l?.data?.originalError?.code===4902)try{const{default:i,...c}=d.blockExplorers??{};let n;h?.blockExplorerUrls?n=h.blockExplorerUrls:i&&(n=[i.url,...Object.values(c).map(v=>v.url)]);let r;h?.rpcUrls?.length?r=h.rpcUrls:r=[d.rpcUrls.default?.http[0]??""];const p={blockExplorerUrls:n,chainId:J(f),chainName:h?.chainName??d.name,iconUrls:h?.iconUrls,nativeCurrency:h?.nativeCurrency??d.nativeCurrency,rpcUrls:r};return await Promise.all([o.request({method:"wallet_addEthereumChain",params:[p]}).then(async()=>{if(await this.getChainId()===f)a.emitter.emit("change",{chainId:f});else throw new _e(new Error("User rejected switch after adding network."))}),m]),d}catch(i){throw new _e(i)}throw l.code===_e.code?new _e(l):new Pe(l)}},async onAccountsChanged(h){if(h.length===0)this.onDisconnect();else if(a.emitter.listenerCount("connect")){const f=(await this.getChainId()).toString();this.onConnect({chainId:f}),s&&await a.storage?.removeItem(`${this.id}.disconnected`)}else a.emitter.emit("change",{accounts:h.map(f=>Oe(f))})},onChainChanged(h){const f=Number(h);a.emitter.emit("change",{chainId:f})},async onConnect(h){const f=await this.getAccounts();if(f.length===0)return;const o=Number(h.chainId);a.emitter.emit("connect",{accounts:f,chainId:o});const d=await this.getProvider();d&&(x&&(d.removeListener("connect",x),x=void 0),y||(y=this.onAccountsChanged.bind(this),d.on("accountsChanged",y)),B||(B=this.onChainChanged.bind(this),d.on("chainChanged",B)),e||(e=this.onDisconnect.bind(this),d.on("disconnect",e)))},async onDisconnect(h){const f=await this.getProvider();h&&h.code===1013&&f&&(await this.getAccounts()).length||(a.emitter.emit("disconnect"),f&&(B&&(f.removeListener("chainChanged",B),B=void 0),e&&(f.removeListener("disconnect",e),e=void 0),x||(x=this.onConnect.bind(this),f.on("connect",x))))}})}const La={coinbaseWallet:{id:"coinbaseWallet",name:"Coinbase Wallet",provider(t){return t?.coinbaseWalletExtension?t.coinbaseWalletExtension:Gt(t,"isCoinbaseWallet")}},metaMask:{id:"metaMask",name:"MetaMask",provider(t){return Gt(t,s=>{if(!s.isMetaMask||s.isBraveWallet&&!s._events&&!s._state)return!1;const u=["isApexWallet","isAvalanche","isBitKeep","isBlockWallet","isKuCoinWallet","isMathWallet","isOkxWallet","isOKExWallet","isOneInchIOSWallet","isOneInchAndroidWallet","isOpera","isPhantom","isPortal","isRabby","isTokenPocket","isTokenary","isUniswapWallet","isZerion"];for(const w of u)if(s[w])return!1;return!0})}},phantom:{id:"phantom",name:"Phantom",provider(t){return t?.phantom?.ethereum?t.phantom?.ethereum:Gt(t,"isPhantom")}}};function Gt(t,s){function u(y){return typeof s=="function"?s(y):typeof s=="string"?y[s]:!0}const w=t.ethereum;if(w?.providers)return w.providers.find(y=>u(y));if(w&&u(w))return w}function ka(t){if(typeof window>"u")return;const s=u=>t(u.detail);return window.addEventListener("eip6963:announceProvider",s),window.dispatchEvent(new CustomEvent("eip6963:requestProvider")),()=>window.removeEventListener("eip6963:announceProvider",s)}function Aa(){const t=new Set;let s=[];const u=()=>ka(y=>{s.some(({info:B})=>B.uuid===y.info.uuid)||(s=[...s,y],t.forEach(B=>B(s,{added:[y]})))});let w=u();return{_listeners(){return t},clear(){t.forEach(y=>y([],{removed:[...s]})),s=[]},destroy(){this.clear(),t.clear(),w?.()},findProvider({rdns:y}){return s.find(B=>B.info.rdns===y)},getProviders(){return s},reset(){this.clear(),w?.(),w=u()},subscribe(y,{emitImmediately:B}={}){return t.add(y),B&&y(s,{added:s}),()=>t.delete(y)}}}const Ma=t=>(s,u,w)=>{const y=w.subscribe;return w.subscribe=(x,e,a)=>{let h=x;if(e){const f=a?.equalityFn||Object.is;let o=x(w.getState());h=d=>{const m=x(d);if(!f(o,m)){const b=o;e(o=m,b)}},a?.fireImmediately&&e(o,o)}return y(h)},t(s,u,w)},Da=Ma;function Ra(t,s){let u;try{u=t()}catch{return}return{getItem:y=>{var B;const x=a=>a===null?null:JSON.parse(a,void 0),e=(B=u.getItem(y))!=null?B:null;return e instanceof Promise?e.then(x):x(e)},setItem:(y,B)=>u.setItem(y,JSON.stringify(B,void 0)),removeItem:y=>u.removeItem(y)}}const ki=t=>s=>{try{const u=t(s);return u instanceof Promise?u:{then(w){return ki(w)(u)},catch(w){return this}}}catch(u){return{then(w){return this},catch(w){return ki(w)(u)}}}},Ta=(t,s)=>(u,w,y)=>{let B={storage:Ra(()=>localStorage),partialize:l=>l,version:0,merge:(l,i)=>({...i,...l}),...s},x=!1;const e=new Set,a=new Set;let h=B.storage;if(!h)return t((...l)=>{console.warn(`[zustand persist middleware] Unable to update item '${B.name}', the given storage is currently unavailable.`),u(...l)},w,y);const f=()=>{const l=B.partialize({...w()});return h.setItem(B.name,{state:l,version:B.version})},o=y.setState;y.setState=(l,i)=>{o(l,i),f()};const d=t((...l)=>{u(...l),f()},w,y);y.getInitialState=()=>d;let m;const b=()=>{var l,i;if(!h)return;x=!1,e.forEach(n=>{var r;return n((r=w())!=null?r:d)});const c=((i=B.onRehydrateStorage)==null?void 0:i.call(B,(l=w())!=null?l:d))||void 0;return ki(h.getItem.bind(h))(B.name).then(n=>{if(n)if(typeof n.version=="number"&&n.version!==B.version){if(B.migrate)return[!0,B.migrate(n.state,n.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,n.state];return[!1,void 0]}).then(n=>{var r;const[p,v]=n;if(m=B.merge(v,(r=w())!=null?r:d),u(m,!0),p)return f()}).then(()=>{c?.(m,void 0),m=w(),x=!0,a.forEach(n=>n(m))}).catch(n=>{c?.(void 0,n)})};return y.persist={setOptions:l=>{B={...B,...l},l.storage&&(h=l.storage)},clearStorage:()=>{h?.removeItem(B.name)},getOptions:()=>B,rehydrate:()=>b(),hasHydrated:()=>x,onHydrate:l=>(e.add(l),()=>{e.delete(l)}),onFinishHydration:l=>(a.add(l),()=>{a.delete(l)})},B.skipHydration||b(),m||d},Pa=Ta,cs=t=>{let s;const u=new Set,w=(h,f)=>{const o=typeof h=="function"?h(s):h;if(!Object.is(o,s)){const d=s;s=f??(typeof o!="object"||o===null)?o:Object.assign({},s,o),u.forEach(m=>m(s,d))}},y=()=>s,e={setState:w,getState:y,getInitialState:()=>a,subscribe:h=>(u.add(h),()=>u.delete(h))},a=s=t(w,y,e);return e},_i=t=>t?cs(t):cs;var pi={exports:{}},hs;function Ia(){return hs||(hs=1,function(t){var s=Object.prototype.hasOwnProperty,u="~";function w(){}Object.create&&(w.prototype=Object.create(null),new w().__proto__||(u=!1));function y(a,h,f){this.fn=a,this.context=h,this.once=f||!1}function B(a,h,f,o,d){if(typeof f!="function")throw new TypeError("The listener must be a function");var m=new y(f,o||a,d),b=u?u+h:h;return a._events[b]?a._events[b].fn?a._events[b]=[a._events[b],m]:a._events[b].push(m):(a._events[b]=m,a._eventsCount++),a}function x(a,h){--a._eventsCount===0?a._events=new w:delete a._events[h]}function e(){this._events=new w,this._eventsCount=0}e.prototype.eventNames=function(){var h=[],f,o;if(this._eventsCount===0)return h;for(o in f=this._events)s.call(f,o)&&h.push(u?o.slice(1):o);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(f)):h},e.prototype.listeners=function(h){var f=u?u+h:h,o=this._events[f];if(!o)return[];if(o.fn)return[o.fn];for(var d=0,m=o.length,b=new Array(m);d<m;d++)b[d]=o[d].fn;return b},e.prototype.listenerCount=function(h){var f=u?u+h:h,o=this._events[f];return o?o.fn?1:o.length:0},e.prototype.emit=function(h,f,o,d,m,b){var l=u?u+h:h;if(!this._events[l])return!1;var i=this._events[l],c=arguments.length,n,r;if(i.fn){switch(i.once&&this.removeListener(h,i.fn,void 0,!0),c){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,f),!0;case 3:return i.fn.call(i.context,f,o),!0;case 4:return i.fn.call(i.context,f,o,d),!0;case 5:return i.fn.call(i.context,f,o,d,m),!0;case 6:return i.fn.call(i.context,f,o,d,m,b),!0}for(r=1,n=new Array(c-1);r<c;r++)n[r-1]=arguments[r];i.fn.apply(i.context,n)}else{var p=i.length,v;for(r=0;r<p;r++)switch(i[r].once&&this.removeListener(h,i[r].fn,void 0,!0),c){case 1:i[r].fn.call(i[r].context);break;case 2:i[r].fn.call(i[r].context,f);break;case 3:i[r].fn.call(i[r].context,f,o);break;case 4:i[r].fn.call(i[r].context,f,o,d);break;default:if(!n)for(v=1,n=new Array(c-1);v<c;v++)n[v-1]=arguments[v];i[r].fn.apply(i[r].context,n)}}return!0},e.prototype.on=function(h,f,o){return B(this,h,f,o,!1)},e.prototype.once=function(h,f,o){return B(this,h,f,o,!0)},e.prototype.removeListener=function(h,f,o,d){var m=u?u+h:h;if(!this._events[m])return this;if(!f)return x(this,m),this;var b=this._events[m];if(b.fn)b.fn===f&&(!d||b.once)&&(!o||b.context===o)&&x(this,m);else{for(var l=0,i=[],c=b.length;l<c;l++)(b[l].fn!==f||d&&!b[l].once||o&&b[l].context!==o)&&i.push(b[l]);i.length?this._events[m]=i.length===1?i[0]:i:x(this,m)}return this},e.prototype.removeAllListeners=function(h){var f;return h?(f=u?u+h:h,this._events[f]&&x(this,f)):(this._events=new w,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=u,e.EventEmitter=e,t.exports=e}(pi)),pi.exports}var Oa=Ia();const $a=ea(Oa);class Fa{constructor(s){Object.defineProperty(this,"uid",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_emitter",{enumerable:!0,configurable:!0,writable:!0,value:new $a})}on(s,u){this._emitter.on(s,u)}once(s,u){this._emitter.once(s,u)}off(s,u){this._emitter.off(s,u)}emit(s,...u){const w=u[0];this._emitter.emit(s,{uid:this.uid,...w})}listenerCount(s){return this._emitter.listenerCount(s)}}function Ha(t){return new Fa(t)}function Ua(t,s){return JSON.parse(t,(u,w)=>{let y=w;return y?.__type==="bigint"&&(y=BigInt(y.value)),y?.__type==="Map"&&(y=new Map(y.value)),s?.(u,y)??y})}function ls(t,s){return t.slice(0,s).join(".")||"."}function ds(t,s){const{length:u}=t;for(let w=0;w<u;++w)if(t[w]===s)return w+1;return 0}function Wa(t,s){const u=typeof t=="function",w=typeof s=="function",y=[],B=[];return function(e,a){if(typeof a=="object")if(y.length){const h=ds(y,this);h===0?y[y.length]=this:(y.splice(h),B.splice(h)),B[B.length]=e;const f=ds(y,a);if(f!==0)return w?s.call(this,e,a,ls(B,f)):`[ref=${ls(B,f)}]`}else y[0]=a,B[0]=e;return u?t.call(this,e,a):a}}function Na(t,s,u,w){return JSON.stringify(t,Wa((y,B)=>{let x=B;return typeof x=="bigint"&&(x={__type:"bigint",value:B.toString()}),x instanceof Map&&(x={__type:"Map",value:Array.from(B.entries())}),s?.(y,x)??x},w),u??void 0)}function za(t){const{deserialize:s=Ua,key:u="wagmi",serialize:w=Na,storage:y=lr}=t;function B(x){return x instanceof Promise?x.then(e=>e).catch(()=>null):x}return{...y,key:u,async getItem(x,e){const a=y.getItem(`${u}.${x}`),h=await B(a);return h?s(h)??null:e??null},async setItem(x,e){const a=`${u}.${x}`;e===null?await B(y.removeItem(a)):await B(y.setItem(a,w(e)))},async removeItem(x){await B(y.removeItem(`${u}.${x}`))}}}const lr={getItem:()=>null,setItem:()=>{},removeItem:()=>{}};function ja(){const t=typeof window<"u"&&window.localStorage?window.localStorage:lr;return{getItem(s){return t.getItem(s)},removeItem(s){t.removeItem(s)},setItem(s,u){try{t.setItem(s,u)}catch{}}}}const Ai=256;let Nt=Ai,zt;function Ga(t=11){if(!zt||Nt+t>Ai*2){zt="",Nt=0;for(let s=0;s<Ai;s++)zt+=(256+Math.random()*256|0).toString(16).substring(1)}return zt.substring(Nt,Nt+++t)}function qa(t){const{multiInjectedProviderDiscovery:s=!0,storage:u=za({storage:ja()}),syncConnectedChain:w=!0,ssr:y=!1,...B}=t,x=typeof window<"u"&&s?Aa():void 0,e=_i(()=>B.chains),a=_i(()=>{const v=[],_=new Set;for(const C of B.connectors??[]){const g=h(C);if(v.push(g),!y&&g.rdns){const S=typeof g.rdns=="string"?[g.rdns]:g.rdns;for(const k of S)_.add(k)}}if(!y&&x){const C=x.getProviders();for(const g of C)_.has(g.info.rdns)||v.push(h(f(g)))}return v});function h(v){const _=Ha(Ga()),C={...v({emitter:_,chains:e.getState(),storage:u,transports:B.transports}),emitter:_,uid:_.uid};return _.on("connect",r),C.setup?.(),C}function f(v){const{info:_}=v,C=v.provider;return Rt({target:{..._,id:_.rdns,provider:C}})}const o=new Map;function d(v={}){const _=v.chainId??i.getState().chainId,C=e.getState().find(S=>S.id===_);if(v.chainId&&!C)throw new Jt;{const S=o.get(i.getState().chainId);if(S&&!C)return S;if(!C)throw new Jt}{const S=o.get(_);if(S)return S}let g;if(B.client)g=B.client({chain:C});else{const S=C.id,k=e.getState().map(A=>A.id),L={},M=Object.entries(B);for(const[A,P]of M)if(!(A==="chains"||A==="client"||A==="connectors"||A==="transports"))if(typeof P=="object")if(S in P)L[A]=P[S];else{if(k.some(U=>U in P))continue;L[A]=P}else L[A]=P;g=Jn({...L,chain:C,batch:L.batch??{multicall:!0},transport:A=>B.transports[S]({...A,connectors:a})})}return o.set(_,g),g}function m(){return{chainId:e.getState()[0].id,connections:new Map,current:null,status:"disconnected"}}let b;const l="0.0.0-canary-";jt.startsWith(l)?b=Number.parseInt(jt.replace(l,"")):b=Number.parseInt(jt.split(".")[0]??"0");const i=_i(Da(u?Pa(m,{migrate(v,_){if(_===b)return v;const C=m(),g=c(v,C.chainId);return{...C,chainId:g}},name:"store",partialize(v){return{connections:{__type:"Map",value:Array.from(v.connections.entries()).map(([_,C])=>{const{id:g,name:S,type:k,uid:L}=C.connector;return[_,{...C,connector:{id:g,name:S,type:k,uid:L}}]})},chainId:v.chainId,current:v.current}},merge(v,_){typeof v=="object"&&v&&"status"in v&&delete v.status;const C=c(v,_.chainId);return{..._,...v,chainId:C}},skipHydration:y,storage:u,version:b}):m));i.setState(m());function c(v,_){return v&&typeof v=="object"&&"chainId"in v&&typeof v.chainId=="number"&&e.getState().some(C=>C.id===v.chainId)?v.chainId:_}w&&i.subscribe(({connections:v,current:_})=>_?v.get(_)?.chainId:void 0,v=>{if(e.getState().some(C=>C.id===v))return i.setState(C=>({...C,chainId:v??C.chainId}))}),x?.subscribe(v=>{const _=new Set,C=new Set;for(const S of a.getState())if(_.add(S.id),S.rdns){const k=typeof S.rdns=="string"?[S.rdns]:S.rdns;for(const L of k)C.add(L)}const g=[];for(const S of v){if(C.has(S.info.rdns))continue;const k=h(f(S));_.has(k.id)||g.push(k)}u&&!i.persist.hasHydrated()||a.setState(S=>[...S,...g],!0)});function n(v){i.setState(_=>{const C=_.connections.get(v.uid);return C?{..._,connections:new Map(_.connections).set(v.uid,{accounts:v.accounts??C.accounts,chainId:v.chainId??C.chainId,connector:C.connector})}:_})}function r(v){i.getState().status==="connecting"||i.getState().status==="reconnecting"||i.setState(_=>{const C=a.getState().find(g=>g.uid===v.uid);return C?(C.emitter.listenerCount("connect")&&C.emitter.off("connect",n),C.emitter.listenerCount("change")||C.emitter.on("change",n),C.emitter.listenerCount("disconnect")||C.emitter.on("disconnect",p),{..._,connections:new Map(_.connections).set(v.uid,{accounts:v.accounts,chainId:v.chainId,connector:C}),current:v.uid,status:"connected"}):_})}function p(v){i.setState(_=>{const C=_.connections.get(v.uid);if(C){const S=C.connector;S.emitter.listenerCount("change")&&C.connector.emitter.off("change",n),S.emitter.listenerCount("disconnect")&&C.connector.emitter.off("disconnect",p),S.emitter.listenerCount("connect")||C.connector.emitter.on("connect",r)}if(_.connections.delete(v.uid),_.connections.size===0)return{..._,connections:new Map,current:null,status:"disconnected"};const g=_.connections.values().next().value;return{..._,connections:new Map(_.connections),current:g.connector.uid}})}return{get chains(){return e.getState()},get connectors(){return a.getState()},storage:u,getClient:d,get state(){return i.getState()},setState(v){let _;typeof v=="function"?_=v(i.getState()):_=v;const C=m();typeof _!="object"&&(_=C),Object.keys(C).some(S=>!(S in _))&&(_=C),i.setState(_,!0)},subscribe(v,_,C){return i.subscribe(v,_,C?{...C,fireImmediately:C.emitImmediately}:void 0)},_internal:{mipd:x,store:i,ssr:!!y,syncConnectedChain:w,transports:B.transports,chains:{setState(v){const _=typeof v=="function"?v(e.getState()):v;if(_.length!==0)return e.setState(_,!0)},subscribe(v){return e.subscribe(v)}},connectors:{providerDetailToConnector:f,setup:h,setState(v){return a.setState(typeof v=="function"?v(a.getState()):v,!0)},subscribe(v){return a.subscribe(v)}},events:{change:n,connect:r,disconnect:p}}}}function Va(t){const{chain:s}=t,u=s.rpcUrls.default.http[0];if(!t.transports)return[u];const w=t.transports?.[s.id]?.({chain:s});return(w?.value?.transports||[w]).map(({value:B})=>B?.url||u)}Hi.type="walletConnect";function Hi(t){const s=t.isNewChainsStale??!0;let u,w;const y="eip155";let B,x,e,a,h,f;return o=>({id:"walletConnect",name:"WalletConnect",type:Hi.type,async setup(){const d=await this.getProvider().catch(()=>null);d&&(e||(e=this.onConnect.bind(this),d.on("connect",e)),h||(h=this.onSessionDelete.bind(this),d.on("session_delete",h)))},async connect({chainId:d,...m}={}){try{const b=await this.getProvider();if(!b)throw new De;a||(a=this.onDisplayUri,b.on("display_uri",a));let l=d;if(!l){const r=await o.storage?.getItem("state")??{};o.chains.some(v=>v.id===r.chainId)?l=r.chainId:l=o.chains[0]?.id}if(!l)throw new Error("No chains found on connector.");const i=await this.isChainsStale();if(b.session&&i&&await b.disconnect(),!b.session||i){const r=o.chains.filter(p=>p.id!==l).map(p=>p.id);await b.connect({optionalChains:[l,...r],..."pairingTopic"in m?{pairingTopic:m.pairingTopic}:{}}),this.setRequestedChainsIds(o.chains.map(p=>p.id))}const c=(await b.enable()).map(r=>Oe(r)),n=await this.getChainId();return a&&(b.removeListener("display_uri",a),a=void 0),e&&(b.removeListener("connect",e),e=void 0),B||(B=this.onAccountsChanged.bind(this),b.on("accountsChanged",B)),x||(x=this.onChainChanged.bind(this),b.on("chainChanged",x)),f||(f=this.onDisconnect.bind(this),b.on("disconnect",f)),h||(h=this.onSessionDelete.bind(this),b.on("session_delete",h)),{accounts:c,chainId:n}}catch(b){throw/(user rejected|connection request reset)/i.test(b?.message)?new _e(b):b}},async disconnect(){const d=await this.getProvider();try{await d?.disconnect()}catch(m){if(!/No matching key/i.test(m.message))throw m}finally{x&&(d?.removeListener("chainChanged",x),x=void 0),f&&(d?.removeListener("disconnect",f),f=void 0),e||(e=this.onConnect.bind(this),d?.on("connect",e)),B&&(d?.removeListener("accountsChanged",B),B=void 0),h&&(d?.removeListener("session_delete",h),h=void 0),this.setRequestedChainsIds([])}},async getAccounts(){return(await this.getProvider()).accounts.map(m=>Oe(m))},async getProvider({chainId:d}={}){async function m(){const b=o.chains.map(i=>i.id);if(!b.length)return;const{EthereumProvider:l}=await pn(async()=>{const{EthereumProvider:i}=await import("./index.es-DGxlsLMW.js").then(c=>c.V);return{EthereumProvider:i}},[]);return await l.init({...t,disableProviderPing:!0,optionalChains:b,projectId:t.projectId,rpcMap:Object.fromEntries(o.chains.map(i=>{const[c]=Va({chain:i,transports:o.transports});return[i.id,c]})),showQrModal:t.showQrModal??!0})}return u||(w||(w=m()),u=await w,u?.events.setMaxListeners(Number.POSITIVE_INFINITY)),d&&await this.switchChain?.({chainId:d}),u},async getChainId(){return(await this.getProvider()).chainId},async isAuthorized(){try{const[d,m]=await Promise.all([this.getAccounts(),this.getProvider()]);return d.length?await this.isChainsStale()&&m.session?(await m.disconnect().catch(()=>{}),!1):!0:!1}catch{return!1}},async switchChain({addEthereumChainParameter:d,chainId:m}){const b=await this.getProvider();if(!b)throw new De;const l=o.chains.find(i=>i.id===m);if(!l)throw new Pe(new Jt);try{await Promise.all([new Promise(c=>{const n=({chainId:r})=>{r===m&&(o.emitter.off("change",n),c())};o.emitter.on("change",n)}),b.request({method:"wallet_switchEthereumChain",params:[{chainId:J(m)}]})]);const i=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...i,m]),l}catch(i){const c=i;if(/(user rejected)/i.test(c.message))throw new _e(c);try{let n;d?.blockExplorerUrls?n=d.blockExplorerUrls:n=l.blockExplorers?.default.url?[l.blockExplorers?.default.url]:[];let r;d?.rpcUrls?.length?r=d.rpcUrls:r=[...l.rpcUrls.default.http];const p={blockExplorerUrls:n,chainId:J(m),chainName:d?.chainName??l.name,iconUrls:d?.iconUrls,nativeCurrency:d?.nativeCurrency??l.nativeCurrency,rpcUrls:r};await b.request({method:"wallet_addEthereumChain",params:[p]});const v=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...v,m]),l}catch(n){throw new _e(n)}}},onAccountsChanged(d){d.length===0?this.onDisconnect():o.emitter.emit("change",{accounts:d.map(m=>Oe(m))})},onChainChanged(d){const m=Number(d);o.emitter.emit("change",{chainId:m})},async onConnect(d){const m=Number(d.chainId),b=await this.getAccounts();o.emitter.emit("connect",{accounts:b,chainId:m})},async onDisconnect(d){this.setRequestedChainsIds([]),o.emitter.emit("disconnect");const m=await this.getProvider();B&&(m.removeListener("accountsChanged",B),B=void 0),x&&(m.removeListener("chainChanged",x),x=void 0),f&&(m.removeListener("disconnect",f),f=void 0),h&&(m.removeListener("session_delete",h),h=void 0),e||(e=this.onConnect.bind(this),m.on("connect",e))},onDisplayUri(d){o.emitter.emit("message",{type:"display_uri",data:d})},onSessionDelete(){this.onDisconnect()},getNamespaceChainsIds(){return u?u.session?.namespaces[y]?.accounts?.map(m=>Number.parseInt(m.split(":")[1]||""))??[]:[]},async getRequestedChainsIds(){return await o.storage?.getItem(this.requestedChainsStorageKey)??[]},async isChainsStale(){if(!s)return!1;const d=o.chains.map(l=>l.id),m=this.getNamespaceChainsIds();if(m.length&&!m.some(l=>d.includes(l)))return!1;const b=await this.getRequestedChainsIds();return!d.every(l=>b.includes(l))},async setRequestedChainsIds(d){await o.storage?.setItem(this.requestedChainsStorageKey,d)},get requestedChainsStorageKey(){return`${this.id}.requestedChains`}})}const Ka=Li(),Le=qa({chains:Te,connectors:[Rt(),Hi({projectId:Ka.walletConnectProjectId||"default-project-id",metadata:{name:"Uniter DeFi Terminal",description:"Multi-chain DeFi portfolio scanner",url:"https://uniter.sh",icons:["https://uniter.sh/icon.png"]}})],transports:Object.fromEntries(Te.map(t=>[t.id,ro()]))});let Ye=null;async function Xa(){try{const t=await Ba(Le,{connector:Rt()}),s=si(Le),u=Fi(Le);return Ye={address:s.address||"",chainId:u,chainName:ti(u)},Ye}catch(t){throw console.error("Wallet connection failed:",t),new Error("Failed to connect wallet. Please make sure you have a Web3 wallet installed.")}}async function Ja(){try{await Ea(Le),Ye=null}catch(t){throw console.error("Wallet disconnection failed:",t),new Error("Failed to disconnect wallet.")}}function Ui(){const t=si(Le);return t.isConnected&&!!t.address}function Ya(){if(Ui()){const t=si(Le),s=Fi(Le);return{address:t.address||"",chainId:s,chainName:ti(s)}}return Ye}async function Za(){if(Ui()){const t=si(Le),s=Fi(Le);return Ye={address:t.address||"",chainId:s,chainName:ti(s)},Ye}return null}console.log("Environment variables loaded:",{REOWN_PROJECT_ID:" Present",WALLETCONNECT_PROJECT_ID:" Missing",ONEINCH_API_KEY:" Present"});class Qa{currentSession=null;async connectWallet(){const s=await Xa();return this.currentSession=s,s}async disconnectWallet(){await Ja(),this.currentSession=null}isWalletConnected(){return Ui()}getCurrentSession(){return Ya()||this.currentSession}async restoreSession(){const s=await Za();return s&&(this.currentSession=s),s}async scanTokens(s,u,w){if(!s||!s.address)throw new Error("No wallet session available");const y=Li();if(!y.oneinchApiKey)throw new Error("1inch API key not found. Please set VITE_ONEINCH_API_KEY environment variable.");const B={address:s.address,chainId:u,client:null,topic:""},{result:x}=await ar(B,y.oneinchApiKey,5,w);return x}async scanTokensMultiChain(s,u){if(!s||!s.address)throw new Error("No wallet session available");const w=Li();if(!w.oneinchApiKey)throw new Error("1inch API key not found. Please set VITE_ONEINCH_API_KEY environment variable.");const y={address:s.address,chainId:0,client:null,topic:"",isDemo:s.isDemo||!1};s.isDemo&&console.log("Running in demo mode with address:",s.address);const{results:B}=await Sa(y,w.oneinchApiKey,w.defaultMinUsdValue||5,u);return B}getEnvironment(){return{isNode:!1,isBrowser:!0,canConnectWallet:!0,canScanTokens:!0}}}class ec{unifiedRenderer;webRenderer;constructor(){const s=new Qa,u=new Zo(s);this.webRenderer=new aa,this.unifiedRenderer=new Qo(u,this.webRenderer)}async init(){await this.webRenderer.init(),await this.unifiedRenderer.start()}}async function us(){try{await new ec().init()}catch(t){console.error("Failed to initialize web terminal:",t);const s=document.getElementById("terminal");s&&(s.innerHTML=`
        <div style="color: #ff7b72; padding: 20px; text-align: center;">
           Failed to initialize terminal<br>
          <small>${t instanceof Error?t.message:String(t)}</small>
        </div>
      `)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",us):us();export{Ge as E,pt as T,_e as U,pn as _,tc as a,eo as c,Ue as f,ea as g,ro as h,ue as t,qn as w};
